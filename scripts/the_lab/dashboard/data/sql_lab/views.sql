-- =============================================================
-- Cricket Playbook - View DDL Definitions
-- Generated: 2026-02-10T04:32:54.381277+00:00
-- Total views: 52
-- =============================================================

CREATE OR REPLACE VIEW analytics_batter_vs_bowler AS SELECT dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, dp_bowl.player_id AS bowler_id, dp_bowl.current_name AS bowler_name, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, CASE  WHEN ((count_star() < 10)) THEN ('LOW') WHEN ((count_star() < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY dp_bat.player_id, dp_bat.current_name, dp_bowl.player_id, dp_bowl.current_name;

CREATE OR REPLACE VIEW analytics_batter_vs_team AS SELECT dp.player_id, dp.current_name AS player_name, dt.team_id AS opponent_team_id, dt.team_name AS opponent_team, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, CASE  WHEN ((count(DISTINCT fb.match_id) < 5)) THEN ('LOW') WHEN ((count(DISTINCT fb.match_id) < 15)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN dim_team AS dt ON ((fb.bowling_team_id = dt.team_id)) GROUP BY dp.player_id, dp.current_name, dt.team_id, dt.team_name;

CREATE OR REPLACE VIEW analytics_batting_by_phase AS SELECT dp.player_id, dp.current_name AS player_name, fb.match_phase, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS batting_average, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_pct, CASE  WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 100)) THEN ('LOW') WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) GROUP BY dp.player_id, dp.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_batting_by_season AS SELECT dp.player_id, dp.current_name AS player_name, dm.season, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS batting_average, CASE  WHEN ((count(DISTINCT fb.match_id) < 5)) THEN ('LOW') WHEN ((count(DISTINCT fb.match_id) < 15)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN dim_match AS dm ON ((fb.match_id = dm.match_id)) GROUP BY dp.player_id, dp.current_name, dm.season;

CREATE OR REPLACE VIEW analytics_batting_by_tournament AS SELECT dp.player_id, dp.current_name AS player_name, dt.tournament_id, dt.tournament_name, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS batting_average, CASE  WHEN ((count(DISTINCT fb.match_id) < 10)) THEN ('LOW') WHEN ((count(DISTINCT fb.match_id) < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN dim_match AS dm ON ((fb.match_id = dm.match_id)) INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) GROUP BY dp.player_id, dp.current_name, dt.tournament_id, dt.tournament_name;

CREATE OR REPLACE VIEW analytics_batting_career AS WITH batting_stats AS (SELECT fb.batter_id AS player_id, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) AS dot_balls, max(fb.batter_runs) AS highest_ball_runs FROM fact_ball AS fb GROUP BY fb.batter_id), innings_scores AS (SELECT batter_id AS player_id, match_id, sum(batter_runs) AS innings_runs, sum(CASE  WHEN ((is_wicket AND (player_out_id = batter_id))) THEN (1) ELSE 0 END) AS got_out FROM fact_ball GROUP BY batter_id, match_id), high_scores AS (SELECT player_id, max(innings_runs) AS highest_score, sum(CASE  WHEN ((innings_runs >= 50)) THEN (1) ELSE 0 END) AS fifties, sum(CASE  WHEN ((innings_runs >= 100)) THEN (1) ELSE 0 END) AS hundreds FROM innings_scores GROUP BY player_id)SELECT dp.player_id, dp.current_name AS player_name, dp.primary_role, dp.is_wicketkeeper, bs.innings, bs.runs, bs.balls_faced, bs.dismissals, hs.highest_score, hs.fifties, hs.hundreds, bs.fours, bs.sixes, bs.dot_balls, round(((bs.runs * 100.0) / "nullif"(bs.balls_faced, 0)), 2) AS strike_rate, round(((bs.runs * 1.0) / "nullif"(bs.dismissals, 0)), 2) AS batting_average, round((((bs.fours + bs.sixes) * 100.0) / "nullif"(bs.balls_faced, 0)), 2) AS boundary_pct, round(((bs.dot_balls * 100.0) / "nullif"(bs.balls_faced, 0)), 2) AS dot_ball_pct, CASE  WHEN ((bs.innings < 10)) THEN ('LOW') WHEN ((bs.innings < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size_innings, CASE  WHEN ((bs.balls_faced < 100)) THEN ('LOW') WHEN ((bs.balls_faced < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size_balls FROM batting_stats AS bs INNER JOIN dim_player AS dp ON ((bs.player_id = dp.player_id)) INNER JOIN high_scores AS hs ON ((bs.player_id = hs.player_id));

CREATE OR REPLACE VIEW analytics_best_economy AS SELECT player_id, player_name, primary_role, matches_bowled, overs_bowled, runs_conceded, wickets, economy_rate, dot_ball_pct, sample_size_balls FROM analytics_bowling_career WHERE (balls_bowled >= 500) ORDER BY economy_rate ASC;

CREATE OR REPLACE VIEW analytics_best_strike_rates AS SELECT player_id, player_name, primary_role, innings, runs, balls_faced, strike_rate, batting_average, boundary_pct, sample_size_balls FROM analytics_batting_career WHERE (balls_faced >= 500) ORDER BY strike_rate DESC;

CREATE OR REPLACE VIEW analytics_bowling_by_phase AS SELECT dp.player_id, dp.current_name AS player_name, fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, round((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) / 6.0), 1) AS overs, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS economy_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END), 0)), 2) AS bowling_average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, CASE  WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 100)) THEN ('LOW') WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) GROUP BY dp.player_id, dp.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_bowling_by_tournament AS SELECT dp.player_id, dp.current_name AS player_name, dt.tournament_id, dt.tournament_name, count(DISTINCT fb.match_id) AS matches, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END) AS wickets, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS economy_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END), 0)), 2) AS bowling_average, CASE  WHEN ((count(DISTINCT fb.match_id) < 10)) THEN ('LOW') WHEN ((count(DISTINCT fb.match_id) < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) INNER JOIN dim_match AS dm ON ((fb.match_id = dm.match_id)) INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) GROUP BY dp.player_id, dp.current_name, dt.tournament_id, dt.tournament_name;

CREATE OR REPLACE VIEW analytics_bowling_career AS WITH bowling_stats AS (SELECT fb.bowler_id AS player_id, count(DISTINCT fb.match_id) AS matches_bowled, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.extra_type = 'wides')) THEN (1) ELSE 0 END) AS wides, sum(CASE  WHEN ((fb.extra_type = 'noballs')) THEN (1) ELSE 0 END) AS noballs, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded FROM fact_ball AS fb GROUP BY fb.bowler_id), best_figures AS (SELECT bowler_id AS player_id, match_id, sum(CASE  WHEN ((is_wicket AND (wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END) AS match_wickets, sum(total_runs) AS match_runs FROM fact_ball GROUP BY bowler_id, match_id), best_bowling AS (SELECT player_id, max(match_wickets) AS best_wickets, "first"(match_runs ORDER BY match_wickets DESC, match_runs ASC) AS best_runs FROM best_figures GROUP BY player_id)SELECT dp.player_id, dp.current_name AS player_name, dp.primary_role, bs.matches_bowled, bs.balls_bowled, round((bs.balls_bowled / 6.0), 1) AS overs_bowled, bs.runs_conceded, bs.wickets, bb.best_wickets, bb.best_runs, bs.dot_balls, bs.wides, bs.noballs, bs.fours_conceded, bs.sixes_conceded, round(((bs.runs_conceded * 6.0) / "nullif"(bs.balls_bowled, 0)), 2) AS economy_rate, round(((bs.runs_conceded * 1.0) / "nullif"(bs.wickets, 0)), 2) AS bowling_average, round(((bs.balls_bowled * 1.0) / "nullif"(bs.wickets, 0)), 2) AS bowling_strike_rate, round(((bs.dot_balls * 100.0) / "nullif"(bs.balls_bowled, 0)), 2) AS dot_ball_pct, CASE  WHEN ((bs.matches_bowled < 10)) THEN ('LOW') WHEN ((bs.matches_bowled < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size_matches, CASE  WHEN ((bs.balls_bowled < 100)) THEN ('LOW') WHEN ((bs.balls_bowled < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size_balls FROM bowling_stats AS bs INNER JOIN dim_player AS dp ON ((bs.player_id = dp.player_id)) INNER JOIN best_bowling AS bb ON ((bs.player_id = bb.player_id));

CREATE OR REPLACE VIEW analytics_death_over_specialists AS SELECT player_id, player_name, balls_bowled, overs, runs_conceded, wickets, economy_rate, dot_ball_pct, sample_size FROM analytics_bowling_by_phase WHERE ((match_phase = 'death') AND (balls_bowled >= 200)) ORDER BY economy_rate ASC;

CREATE OR REPLACE VIEW analytics_ipl_batter_phase AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id, dp.current_name AS player_name, fb.match_phase, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS batting_average, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_pct, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, CASE  WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 100)) THEN ('LOW') WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY dp.player_id, dp.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_phase_percentiles AS WITH qualified AS (SELECT * FROM analytics_ipl_batter_phase WHERE (balls_faced >= 100))SELECT player_id, player_name, match_phase, innings, runs, balls_faced, strike_rate, batting_average, boundary_pct, dot_ball_pct, sample_size, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY strike_rate) * 100), 1) AS sr_percentile, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY batting_average) * 100), 1) AS avg_percentile, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY boundary_pct) * 100), 1) AS boundary_percentile FROM qualified;

CREATE OR REPLACE VIEW analytics_ipl_batter_venue AS WITH ipl_matches AS (SELECT dm.match_id, dv.venue_name AS venue FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) INNER JOIN dim_venue AS dv ON ((dm.venue_id = dv.venue_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id AS batter_id, dp.current_name AS batter_name, im.venue, count(DISTINCT fb.match_id) AS innings, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 30)) THEN ('LOW') WHEN ((count_star() < 100)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN ipl_matches AS im ON ((fb.match_id = im.match_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY dp.player_id, dp.current_name, im.venue;

CREATE OR REPLACE VIEW analytics_ipl_batter_venue_phase AS WITH ipl_matches AS (SELECT dm.match_id, dv.venue_name AS venue FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) INNER JOIN dim_venue AS dv ON ((dm.venue_id = dv.venue_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id AS batter_id, dp.current_name AS batter_name, im.venue, fb.match_phase, count(DISTINCT fb.match_id) AS innings, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 12)) THEN ('LOW') WHEN ((count_star() < 36)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN ipl_matches AS im ON ((fb.match_id = im.match_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY dp.player_id, dp.current_name, im.venue, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_bowler AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, dp_bowl.player_id AS bowler_id, dp_bowl.current_name AS bowler_name, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 10)) THEN ('LOW') WHEN ((count_star() < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp_bat.player_id, dp_bat.current_name, dp_bowl.player_id, dp_bowl.current_name;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_bowler_phase AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, dp_bowl.player_id AS bowler_id, dp_bowl.current_name AS bowler_name, fb.match_phase, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 6)) THEN ('LOW') WHEN ((count_star() < 20)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp_bat.player_id, dp_bat.current_name, dp_bowl.player_id, dp_bowl.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_bowler_type AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown') AS bowler_type, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 50)) THEN ('LOW') WHEN ((count_star() < 200)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) LEFT JOIN ipl_2026_squads AS sq ON ((dp_bowl.player_id = sq.player_id)) LEFT JOIN dim_bowler_classification AS bc ON ((dp_bowl.player_id = bc.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp_bat.player_id, dp_bat.current_name, COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown');

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_bowler_type_phase AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown') AS bowler_type, fb.match_phase, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 30)) THEN ('LOW') WHEN ((count_star() < 100)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) LEFT JOIN ipl_2026_squads AS sq ON ((dp_bowl.player_id = sq.player_id)) LEFT JOIN dim_bowler_classification AS bc ON ((dp_bowl.player_id = bc.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp_bat.player_id, dp_bat.current_name, COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown'), fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_team AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id AS batter_id, dp.current_name AS batter_name, COALESCE(fa.canonical_name, dt_opp.team_name) AS opposition, count(DISTINCT fb.match_id) AS innings, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 30)) THEN ('LOW') WHEN ((count_star() < 100)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN dim_team AS dt_opp ON ((fb.bowling_team_id = dt_opp.team_id)) LEFT JOIN dim_franchise_alias AS fa ON ((dt_opp.team_name = fa.team_name)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp.player_id, dp.current_name, COALESCE(fa.canonical_name, dt_opp.team_name);

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_team_phase AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id AS batter_id, dp.current_name AS batter_name, COALESCE(fa.canonical_name, dt_opp.team_name) AS opposition, fb.match_phase, count(DISTINCT fb.match_id) AS innings, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 12)) THEN ('LOW') WHEN ((count_star() < 36)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN dim_team AS dt_opp ON ((fb.bowling_team_id = dt_opp.team_id)) LEFT JOIN dim_franchise_alias AS fa ON ((dt_opp.team_name = fa.team_name)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp.player_id, dp.current_name, COALESCE(fa.canonical_name, dt_opp.team_name), fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batting_benchmarks AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(fb.batter_runs) AS total_runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS total_balls, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS total_wickets, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS avg_batting_avg, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_boundary_pct, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_dot_ball_pct FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batting_career AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), batting_stats AS (SELECT fb.batter_id AS player_id, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) AS dot_balls FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.batter_id), innings_scores AS (SELECT fb.batter_id AS player_id, fb.match_id, sum(fb.batter_runs) AS innings_runs FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.batter_id, fb.match_id), high_scores AS (SELECT player_id, max(innings_runs) AS highest_score, sum(CASE  WHEN ((innings_runs >= 50)) THEN (1) ELSE 0 END) AS fifties, sum(CASE  WHEN ((innings_runs >= 100)) THEN (1) ELSE 0 END) AS hundreds FROM innings_scores GROUP BY player_id)SELECT dp.player_id, dp.current_name AS player_name, dp.primary_role, bs.innings, bs.runs, bs.balls_faced, bs.dismissals, hs.highest_score, hs.fifties, hs.hundreds, bs.fours, bs.sixes, bs.dot_balls, round(((bs.runs * 100.0) / "nullif"(bs.balls_faced, 0)), 2) AS strike_rate, round(((bs.runs * 1.0) / "nullif"(bs.dismissals, 0)), 2) AS batting_average, round((((bs.fours + bs.sixes) * 100.0) / "nullif"(bs.balls_faced, 0)), 2) AS boundary_pct, round(((bs.dot_balls * 100.0) / "nullif"(bs.balls_faced, 0)), 2) AS dot_ball_pct, CASE  WHEN ((bs.innings < 10)) THEN ('LOW') WHEN ((bs.innings < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM batting_stats AS bs INNER JOIN dim_player AS dp ON ((bs.player_id = dp.player_id)) INNER JOIN high_scores AS hs ON ((bs.player_id = hs.player_id));

CREATE OR REPLACE VIEW analytics_ipl_batting_percentiles AS WITH qualified_batters AS (SELECT * FROM analytics_ipl_batting_career WHERE (balls_faced >= 500))SELECT player_id, player_name, innings, runs, balls_faced, strike_rate, batting_average, boundary_pct, dot_ball_pct, sample_size, round((percent_rank() OVER (ORDER BY strike_rate) * 100), 1) AS sr_percentile, round((percent_rank() OVER (ORDER BY batting_average) * 100), 1) AS avg_percentile, round((percent_rank() OVER (ORDER BY boundary_pct) * 100), 1) AS boundary_percentile, round((percent_rank() OVER (ORDER BY dot_ball_pct DESC) * 100), 1) AS dot_ball_percentile FROM qualified_batters;

CREATE OR REPLACE VIEW analytics_ipl_bowler_phase AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id, dp.current_name AS player_name, fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, round((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) / 6.0), 1) AS overs, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS economy_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS bowling_average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 100)) THEN ('LOW') WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY dp.player_id, dp.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowler_phase_distribution AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), bowler_phase_stats AS (SELECT dp.player_id AS bowler_id, dp.current_name AS bowler_name, fb.match_phase, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp.player_id, dp.current_name, fb.match_phase), bowler_totals AS (SELECT bowler_id, bowler_name, sum(balls) AS total_balls, sum(wickets) AS total_wickets FROM bowler_phase_stats GROUP BY bowler_id, bowler_name)SELECT bps.bowler_id, bps.bowler_name, bps.match_phase, bps.balls, round((bps.balls / 6.0), 1) AS overs, bps.runs_conceded, bps.wickets, bps.dot_balls, round(((bps.runs_conceded * 6.0) / "nullif"(bps.balls, 0)), 2) AS economy, round(((bps.dot_balls * 100.0) / "nullif"(bps.balls, 0)), 2) AS dot_ball_pct, round(((bps.balls * 100.0) / "nullif"(bt.total_balls, 0)), 1) AS pct_overs_in_phase, round(((bps.wickets * 100.0) / "nullif"(bt.total_wickets, 0)), 1) AS pct_wickets_in_phase, round((((bps.wickets * 100.0) / "nullif"(bt.total_wickets, 0)) - ((bps.balls * 100.0) / "nullif"(bt.total_balls, 0))), 1) AS wicket_efficiency, bt.total_balls, bt.total_wickets, CASE  WHEN ((bt.total_balls < 120)) THEN ('LOW') WHEN ((bt.total_balls < 300)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM bowler_phase_stats AS bps INNER JOIN bowler_totals AS bt ON ((bps.bowler_id = bt.bowler_id)) ORDER BY bps.bowler_name, CASE  WHEN ((bps.match_phase = 'powerplay')) THEN (1) WHEN ((bps.match_phase = 'middle')) THEN (2) WHEN ((bps.match_phase = 'death')) THEN (3) ELSE NULL END;

CREATE OR REPLACE VIEW analytics_ipl_bowler_phase_percentiles AS WITH qualified AS (SELECT * FROM analytics_ipl_bowler_phase WHERE (balls_bowled >= 60))SELECT player_id, player_name, match_phase, matches, balls_bowled, overs, wickets, economy_rate, bowling_average, dot_ball_pct, boundary_conceded_pct, sample_size, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY economy_rate DESC) * 100), 1) AS economy_percentile, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY dot_ball_pct) * 100), 1) AS dot_ball_percentile FROM qualified;

CREATE OR REPLACE VIEW analytics_ipl_bowler_venue AS WITH ipl_matches AS (SELECT dm.match_id, dv.venue_name AS venue FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) INNER JOIN dim_venue AS dv ON ((dm.venue_id = dv.venue_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id AS bowler_id, dp.current_name AS bowler_name, im.venue, count(DISTINCT fb.match_id) AS matches, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(count_star(), 0)), 2) AS economy, round(((count_star() * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((count_star() < 30)) THEN ('LOW') WHEN ((count_star() < 100)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) INNER JOIN ipl_matches AS im ON ((fb.match_id = im.match_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY dp.player_id, dp.current_name, im.venue;

CREATE OR REPLACE VIEW analytics_ipl_bowler_venue_phase AS WITH ipl_matches AS (SELECT dm.match_id, dv.venue_name AS venue FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) INNER JOIN dim_venue AS dv ON ((dm.venue_id = dv.venue_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id AS bowler_id, dp.current_name AS bowler_name, im.venue, fb.match_phase, count(DISTINCT fb.match_id) AS matches, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(count_star(), 0)), 2) AS economy, round(((count_star() * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((count_star() < 12)) THEN ('LOW') WHEN ((count_star() < 36)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) INNER JOIN ipl_matches AS im ON ((fb.match_id = im.match_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY dp.player_id, dp.current_name, im.venue, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowler_vs_batter_handedness AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT dp_bowl.player_id AS bowler_id, dp_bowl.current_name AS bowler_name, sq.batting_hand, count_star() FILTER (WHERE fb.is_legal_ball) AS balls, sum((fb.batter_runs + fb.extra_runs)) AS runs, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, round(((sum((fb.batter_runs + fb.extra_runs)) * 6.0) / "nullif"(count_star() FILTER (WHERE fb.is_legal_ball), 0)), 2) AS economy, round(((count_star() FILTER (WHERE fb.is_legal_ball) * 1.0) / "nullif"(sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star() FILTER (WHERE fb.is_legal_ball), 0)), 2) AS dot_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star() FILTER (WHERE fb.is_legal_ball), 0)), 2) AS boundary_pct, round(((sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) * 1.0) / "nullif"(count_star() FILTER (WHERE fb.is_legal_ball), 0)), 4) AS wickets_per_ball, CASE  WHEN ((count_star() FILTER (WHERE fb.is_legal_ball) < 60)) THEN ('LOW') WHEN ((count_star() FILTER (WHERE fb.is_legal_ball) < 200)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) INNER JOIN ipl_2026_squads AS sq ON ((fb.batter_id = sq.player_id)) WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (sq.batting_hand IS NOT NULL)) GROUP BY dp_bowl.player_id, dp_bowl.current_name, sq.batting_hand;

CREATE OR REPLACE VIEW analytics_ipl_bowler_vs_batter_phase AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp_bowl.player_id AS bowler_id, dp_bowl.current_name AS bowler_name, dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, fb.match_phase, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(count_star(), 0)), 2) AS economy, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((count_star() < 6)) THEN ('LOW') WHEN ((count_star() < 20)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp_bowl.player_id, dp_bowl.current_name, dp_bat.player_id, dp_bat.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowler_vs_team AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id AS bowler_id, dp.current_name AS bowler_name, COALESCE(fa.canonical_name, dt_opp.team_name) AS opposition, count(DISTINCT fb.match_id) AS matches, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(count_star(), 0)), 2) AS economy, round(((count_star() * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((count_star() < 30)) THEN ('LOW') WHEN ((count_star() < 100)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) INNER JOIN dim_team AS dt_opp ON ((fb.batting_team_id = dt_opp.team_id)) LEFT JOIN dim_franchise_alias AS fa ON ((dt_opp.team_name = fa.team_name)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp.player_id, dp.current_name, COALESCE(fa.canonical_name, dt_opp.team_name);

CREATE OR REPLACE VIEW analytics_ipl_bowler_vs_team_phase AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id AS bowler_id, dp.current_name AS bowler_name, COALESCE(fa.canonical_name, dt_opp.team_name) AS opposition, fb.match_phase, count(DISTINCT fb.match_id) AS matches, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(count_star(), 0)), 2) AS economy, round(((count_star() * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((count_star() < 12)) THEN ('LOW') WHEN ((count_star() < 36)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) INNER JOIN dim_team AS dt_opp ON ((fb.batting_team_id = dt_opp.team_id)) LEFT JOIN dim_franchise_alias AS fa ON ((dt_opp.team_name = fa.team_name)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp.player_id, dp.current_name, COALESCE(fa.canonical_name, dt_opp.team_name), fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowling_benchmarks AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(fb.total_runs) AS total_runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS total_balls, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS total_wickets, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_economy, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS avg_bowling_avg, round(((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS avg_bowling_sr, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_dot_ball_pct FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowling_career AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), bowling_stats AS (SELECT fb.bowler_id AS player_id, count(DISTINCT fb.match_id) AS matches_bowled, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.bowler_id), best_figures AS (SELECT fb.bowler_id AS player_id, fb.match_id, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS match_wickets, sum(fb.total_runs) AS match_runs FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.bowler_id, fb.match_id), best_bowling AS (SELECT player_id, max(match_wickets) AS best_wickets, "first"(match_runs ORDER BY match_wickets DESC, match_runs ASC) AS best_runs FROM best_figures GROUP BY player_id)SELECT dp.player_id, dp.current_name AS player_name, dp.primary_role, bs.matches_bowled, bs.balls_bowled, round((bs.balls_bowled / 6.0), 1) AS overs_bowled, bs.runs_conceded, bs.wickets, bb.best_wickets, bb.best_runs, bs.dot_balls, bs.fours_conceded, bs.sixes_conceded, round(((bs.runs_conceded * 6.0) / "nullif"(bs.balls_bowled, 0)), 2) AS economy_rate, round(((bs.runs_conceded * 1.0) / "nullif"(bs.wickets, 0)), 2) AS bowling_average, round(((bs.balls_bowled * 1.0) / "nullif"(bs.wickets, 0)), 2) AS bowling_strike_rate, round(((bs.dot_balls * 100.0) / "nullif"(bs.balls_bowled, 0)), 2) AS dot_ball_pct, round((((bs.fours_conceded + bs.sixes_conceded) * 100.0) / "nullif"(bs.balls_bowled, 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((bs.matches_bowled < 10)) THEN ('LOW') WHEN ((bs.matches_bowled < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM bowling_stats AS bs INNER JOIN dim_player AS dp ON ((bs.player_id = dp.player_id)) INNER JOIN best_bowling AS bb ON ((bs.player_id = bb.player_id));

CREATE OR REPLACE VIEW analytics_ipl_bowling_percentiles AS WITH qualified_bowlers AS (SELECT * FROM analytics_ipl_bowling_career WHERE (balls_bowled >= 300))SELECT player_id, player_name, matches_bowled, balls_bowled, overs_bowled, wickets, economy_rate, bowling_average, bowling_strike_rate, dot_ball_pct, boundary_conceded_pct, sample_size, round((percent_rank() OVER (ORDER BY economy_rate DESC) * 100), 1) AS economy_percentile, round((percent_rank() OVER (ORDER BY bowling_average DESC) * 100), 1) AS avg_percentile, round((percent_rank() OVER (ORDER BY bowling_strike_rate DESC) * 100), 1) AS sr_percentile, round((percent_rank() OVER (ORDER BY dot_ball_pct) * 100), 1) AS dot_ball_percentile FROM qualified_bowlers;

CREATE OR REPLACE VIEW analytics_ipl_career_benchmarks AS (SELECT 'batting' AS category, count_star() AS qualified_players, round(avg(strike_rate), 2) AS avg_strike_rate, round(avg(batting_average), 2) AS avg_batting_avg, round(avg(boundary_pct), 2) AS avg_boundary_pct, round(avg(dot_ball_pct), 2) AS avg_dot_ball_pct, round(quantile_cont(0.5 ORDER BY strike_rate), 2) AS median_strike_rate, round(quantile_cont(0.5 ORDER BY batting_average), 2) AS median_batting_avg FROM analytics_ipl_batting_career WHERE (balls_faced >= 500)) UNION ALL (SELECT 'bowling' AS category, count_star() AS qualified_players, round(avg(economy_rate), 2) AS avg_economy, round(avg(bowling_average), 2) AS avg_bowling_avg, round(avg(dot_ball_pct), 2) AS avg_dot_ball_pct, round(avg(boundary_conceded_pct), 2) AS avg_boundary_pct, round(quantile_cont(0.5 ORDER BY economy_rate), 2) AS median_economy, round(quantile_cont(0.5 ORDER BY bowling_average), 2) AS median_bowling_avg FROM analytics_ipl_bowling_career WHERE (balls_bowled >= 300));

CREATE OR REPLACE VIEW analytics_ipl_squad_batting AS SELECT sq.team_name, sq.player_name, sq."role", sq.batting_hand, ct.price_cr, ct.acquisition_type, ct.year_joined, ipl.innings AS ipl_innings, ipl.runs AS ipl_runs, ipl.balls_faced AS ipl_balls, ipl.strike_rate AS ipl_sr, ipl.batting_average AS ipl_avg, ipl.boundary_pct AS ipl_boundary_pct, ipl.dot_ball_pct AS ipl_dot_pct, ipl.fifties AS ipl_fifties, ipl.hundreds AS ipl_hundreds, ipl.sample_size AS ipl_sample_size, t20.innings AS t20_innings, t20.runs AS t20_runs, t20.strike_rate AS t20_sr, t20.batting_average AS t20_avg, t20.sample_size_innings AS t20_sample_size FROM ipl_2026_squads AS sq LEFT JOIN ipl_2026_contracts AS ct ON (((sq.team_name = ct.team_name) AND (sq.player_name = ct.player_name))) LEFT JOIN analytics_ipl_batting_career AS ipl ON ((sq.player_id = ipl.player_id)) LEFT JOIN analytics_batting_career AS t20 ON ((sq.player_id = t20.player_id)) WHERE (sq."role" IN ('Batter', 'Wicketkeeper', 'All-rounder')) ORDER BY sq.team_name, COALESCE(ct.price_cr, 0) DESC;

CREATE OR REPLACE VIEW analytics_ipl_squad_batting_phase AS SELECT sq.team_name, sq.player_name, sq."role", ct.price_cr, bp.match_phase, bp.innings, bp.runs, bp.balls_faced, bp.strike_rate, bp.batting_average, bp.boundary_pct, bp.dot_ball_pct, bp.sample_size FROM ipl_2026_squads AS sq LEFT JOIN ipl_2026_contracts AS ct ON (((sq.team_name = ct.team_name) AND (sq.player_name = ct.player_name))) LEFT JOIN analytics_ipl_batter_phase AS bp ON ((sq.player_id = bp.player_id)) WHERE (sq."role" IN ('Batter', 'Wicketkeeper', 'All-rounder')) ORDER BY sq.team_name, sq.player_name, bp.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_squad_bowling AS SELECT sq.team_name, sq.player_name, sq."role", sq.bowling_arm, sq.bowling_type, ct.price_cr, ct.acquisition_type, ct.year_joined, ipl.matches_bowled AS ipl_matches, ipl.overs_bowled AS ipl_overs, ipl.wickets AS ipl_wickets, ipl.economy_rate AS ipl_economy, ipl.bowling_average AS ipl_avg, ipl.bowling_strike_rate AS ipl_sr, ipl.dot_ball_pct AS ipl_dot_pct, ipl.boundary_conceded_pct AS ipl_boundary_pct, ipl.sample_size AS ipl_sample_size, t20.matches_bowled AS t20_matches, t20.wickets AS t20_wickets, t20.economy_rate AS t20_economy, t20.bowling_average AS t20_avg, t20.sample_size_matches AS t20_sample_size FROM ipl_2026_squads AS sq LEFT JOIN ipl_2026_contracts AS ct ON (((sq.team_name = ct.team_name) AND (sq.player_name = ct.player_name))) LEFT JOIN analytics_ipl_bowling_career AS ipl ON ((sq.player_id = ipl.player_id)) LEFT JOIN analytics_bowling_career AS t20 ON ((sq.player_id = t20.player_id)) WHERE (sq."role" IN ('Bowler', 'All-rounder')) ORDER BY sq.team_name, COALESCE(ct.price_cr, 0) DESC;

CREATE OR REPLACE VIEW analytics_ipl_squad_bowling_phase AS SELECT sq.team_name, sq.player_name, sq."role", sq.bowling_type, ct.price_cr, bp.match_phase, bp.matches, bp.overs, bp.wickets, bp.economy_rate, bp.bowling_average, bp.dot_ball_pct, bp.boundary_conceded_pct, bp.sample_size FROM ipl_2026_squads AS sq LEFT JOIN ipl_2026_contracts AS ct ON (((sq.team_name = ct.team_name) AND (sq.player_name = ct.player_name))) LEFT JOIN analytics_ipl_bowler_phase AS bp ON ((sq.player_id = bp.player_id)) WHERE (sq."role" IN ('Bowler', 'All-rounder')) ORDER BY sq.team_name, sq.player_name, bp.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_team_roster AS SELECT sq.team_name, sq.player_name, sq."role", sq.bowling_type, sq.batting_hand, ct.price_cr, ct.acquisition_type, ct.year_joined, CASE  WHEN ((sq."role" = 'Batter')) THEN ('Batting') WHEN ((sq."role" = 'Bowler')) THEN ('Bowling') WHEN ((sq."role" = 'All-rounder')) THEN ('All-round') WHEN ((sq."role" = 'Wicketkeeper')) THEN ('Batting') ELSE 'Other' END AS primary_skill FROM ipl_2026_squads AS sq LEFT JOIN ipl_2026_contracts AS ct ON (((sq.team_name = ct.team_name) AND (sq.player_name = ct.player_name))) ORDER BY sq.team_name, COALESCE(ct.price_cr, 0) DESC;

CREATE OR REPLACE VIEW analytics_ipl_vs_bowler_type_benchmarks AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown') AS bowler_type, count_star() AS total_balls, sum(fb.batter_runs) AS total_runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS total_dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS avg_strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS avg_batting_avg, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS avg_boundary_pct FROM fact_ball AS fb INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) LEFT JOIN ipl_2026_squads AS sq ON ((dp_bowl.player_id = sq.player_id)) LEFT JOIN dim_bowler_classification AS bc ON ((dp_bowl.player_id = bc.player_id)) WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.is_legal_ball = CAST('t' AS BOOLEAN))) GROUP BY COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown');

CREATE OR REPLACE VIEW analytics_powerplay_hitters AS SELECT player_id, player_name, innings, runs, balls_faced, strike_rate, boundary_pct, sample_size FROM analytics_batting_by_phase WHERE ((match_phase = 'powerplay') AND (balls_faced >= 200)) ORDER BY strike_rate DESC;

CREATE OR REPLACE VIEW analytics_t20_batter_phase AS SELECT dp.player_id, dp.current_name AS player_name, fb.match_phase, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS batting_average, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_pct, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, CASE  WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 100)) THEN ('LOW') WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) GROUP BY dp.player_id, dp.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_t20_batter_vs_bowler_type AS SELECT dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown') AS bowler_type, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 50)) THEN ('LOW') WHEN ((count_star() < 200)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) LEFT JOIN ipl_2026_squads AS sq ON ((dp_bowl.player_id = sq.player_id)) LEFT JOIN dim_bowler_classification AS bc ON ((dp_bowl.player_id = bc.player_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY dp_bat.player_id, dp_bat.current_name, COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown');

CREATE OR REPLACE VIEW analytics_t20_bowler_phase AS SELECT dp.player_id, dp.current_name AS player_name, fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, round((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) / 6.0), 1) AS overs, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS economy_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS bowling_average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 100)) THEN ('LOW') WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) GROUP BY dp.player_id, dp.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_team_batting AS SELECT dt.team_id, dt.team_name, count(DISTINCT fb.match_id) AS matches, sum(fb.total_runs) AS total_runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS wickets_lost, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS run_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END), 0)), 2) AS runs_per_wicket FROM fact_ball AS fb INNER JOIN dim_team AS dt ON ((fb.batting_team_id = dt.team_id)) GROUP BY dt.team_id, dt.team_name ORDER BY total_runs DESC;

CREATE OR REPLACE VIEW analytics_team_bowling AS SELECT dt.team_id, dt.team_name, count(DISTINCT fb.match_id) AS matches, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets_taken, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS economy_rate FROM fact_ball AS fb INNER JOIN dim_team AS dt ON ((fb.bowling_team_id = dt.team_id)) GROUP BY dt.team_id, dt.team_name ORDER BY wickets_taken DESC;

CREATE OR REPLACE VIEW analytics_top_run_scorers AS SELECT player_id, player_name, primary_role, innings, runs, balls_faced, highest_score, fifties, hundreds, strike_rate, batting_average, boundary_pct, sample_size_innings FROM analytics_batting_career WHERE (innings >= 10) ORDER BY runs DESC;

CREATE OR REPLACE VIEW analytics_top_wicket_takers AS SELECT player_id, player_name, primary_role, matches_bowled, overs_bowled, wickets, best_wickets, best_runs, economy_rate, bowling_average, bowling_strike_rate, dot_ball_pct, sample_size_matches FROM analytics_bowling_career WHERE (matches_bowled >= 10) ORDER BY wickets DESC;
