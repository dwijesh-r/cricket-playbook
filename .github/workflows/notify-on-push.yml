name: Notify on Push

on:
  push:
    branches: [main]

jobs:
  notify:
    runs-on: ubuntu-latest
    # Only run if email secrets are configured
    if: ${{ secrets.EMAIL_USERNAME != '' && secrets.NOTIFY_EMAIL != '' }}
    steps:
      - name: Send email notification
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          secure: true
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_APP_PASSWORD }}
          subject: "‚úÖ Cricket Playbook: ${{ github.event.head_commit.message }}"
          to: ${{ secrets.NOTIFY_EMAIL }}
          from: Cricket Playbook Bot <${{ secrets.EMAIL_USERNAME }}>
          body: |
            üèè New commit pushed to cricket-playbook!

            üìù Message: ${{ github.event.head_commit.message }}
            üë§ Author: ${{ github.event.head_commit.author.name }}
            üîó Commit: https://github.com/${{ github.repository }}/commit/${{ github.sha }}
            üìÖ Time: ${{ github.event.head_commit.timestamp }}

            ---
            View all changes: https://github.com/${{ github.repository }}/commits/main

  # Fallback job that always succeeds (prevents failure emails when secrets not set)
  check-secrets:
    runs-on: ubuntu-latest
    steps:
      - name: Check if email secrets are configured
        run: |
          if [ -z "${{ secrets.EMAIL_USERNAME }}" ] || [ -z "${{ secrets.NOTIFY_EMAIL }}" ]; then
            echo "‚ö†Ô∏è Email notification skipped - secrets not configured"
            echo "To enable notifications, add these secrets in GitHub repo settings:"
            echo "  - EMAIL_USERNAME: your Gmail address"
            echo "  - EMAIL_APP_PASSWORD: Gmail app password"
            echo "  - NOTIFY_EMAIL: where to send notifications"
          else
            echo "‚úÖ Email secrets configured"
          fi
