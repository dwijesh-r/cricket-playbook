{
  "id": "TKT-244",
  "title": "Fix predicted XII players missing from depth charts",
  "state": "DONE",
  "priority": "P1",
  "epic_id": "EPIC-022",
  "sprint_id": "SPRINT-005",
  "assignee": "Stephen Curry",
  "effort": "Deep Work",
  "description": "Investigate and fix players who appear in predicted XII selections but are missing from corresponding depth charts. Cross-reference predicted_xii outputs with depth_chart outputs for all 10 teams. Ensure every player in the predicted XII has a valid depth chart entry with role, batting position, and bowling type.",
  "created_at": "2026-02-14T10:00:00Z",
  "updated_at": "2026-02-15T12:00:00Z",
  "progress_notes": [
    {
      "timestamp": "2026-02-15T12:00:00Z",
      "author": "Stephen Curry",
      "note": "INVESTIGATION COMPLETE - Root Cause Analysis and Fix Applied",
      "details": {
        "missing_players_found": 2,
        "original_ticket_count": 9,
        "explanation": "The ticket originally cited 9 missing players. At time of investigation, 2 were still missing (7 may have been resolved by prior depth chart regenerations or squad updates).",
        "missing_players": [
          {
            "team": "KKR",
            "player": "Ajinkya Rahane",
            "player_id": "29e95537",
            "role": "Batter (Elite Top-Order, Captain)",
            "best_position": "#3 Batter",
            "best_score": 66.8,
            "reason_missing": "Ranked 4th in both Opener (score 55.2) and #3 Batter (score 66.8) positions. With top-3 limit per position and 0 score on all other positions (not an all-rounder, bowler, finisher, or wicketkeeper), he appeared nowhere in the depth chart.",
            "cricket_context": "Rahane is a specialist top-order batter with PP_DOMINATOR and SPECIALIST_VS_PACE tags but a MIDDLE_LIABILITY tag. His entry point (avg_entry_ball=20.3, mode_position=3) places him squarely at #3. However, KKR's squad is stacked at the top with Finn Allen, Sunil Narine, Cameron Green, and Angkrish Raghuvanshi all scoring higher due to tags, overseas bonuses, and dual capabilities."
          },
          {
            "team": "DC",
            "player": "Auqib Nabi",
            "player_id": "7c3c0337",
            "role": "All-rounder (Workhorse Seamer, Uncapped IPL)",
            "best_position": "Allrounder (Bowling)",
            "best_score": 43.0,
            "reason_missing": "Ranked 4th in Bowling AR (score 43.0), 4th in Batting AR (score 35.0), 7th in Right-arm Pace (score 32.0), 11th in Middle Overs (score 22.1). With no batting tags, no entry point data, no overall SR, and price_cr=0.0, his scores were suppressed across all positions. DC's deep squad of all-rounders (Axar Patel, Nitish Rana, Tristan Stubbs) plus bowlers (Mitchell Starc, Mukesh Kumar, Lungi Ngidi) pushed him below top-3 everywhere.",
            "cricket_context": "Auqib Nabi is an uncapped IPL player with minimal historical data. He has WORKHORSE and PROVEN_WICKET_TAKER bowler tags from domestic cricket but zero IPL batting/entry data. His Founder selection suggests the franchise sees him as a key utility option despite the lack of IPL analytics history."
          }
        ],
        "root_cause": "The depth chart generator limits each position to top-3 players. When a predicted XII player ranks 4th or lower in EVERY position they qualify for, they are excluded entirely from the depth chart. This creates a data integrity gap where a player selected for the predicted starting XI doesn't appear in the team's depth chart at all.",
        "fix_applied": "Added _ensure_predicted_xii_coverage() function to generate_depth_charts.py. After all positions are generated with standard top-3 limits, this function: (1) cross-references all predicted XII player IDs against the players present in the depth chart, (2) for any missing player, scores them across all positions and appends them to their highest-scoring position at rank N+1, (3) preserves existing top-3 rankings and ratings unchanged. The predicted XII data is loaded from outputs/predicted_xii/predicted_xii_2026.json via a new load_predicted_xii_ids() function.",
        "files_modified": [
          "scripts/generators/generate_depth_charts.py"
        ],
        "files_regenerated": [
          "outputs/depth_charts/depth_charts_2026.json",
          "outputs/depth_charts/csk_depth_chart.json",
          "outputs/depth_charts/mi_depth_chart.json",
          "outputs/depth_charts/rcb_depth_chart.json",
          "outputs/depth_charts/kkr_depth_chart.json",
          "outputs/depth_charts/dc_depth_chart.json",
          "outputs/depth_charts/pbks_depth_chart.json",
          "outputs/depth_charts/rr_depth_chart.json",
          "outputs/depth_charts/srh_depth_chart.json",
          "outputs/depth_charts/gt_depth_chart.json",
          "outputs/depth_charts/lsg_depth_chart.json",
          "outputs/depth_charts/README.md",
          "scripts/the_lab/dashboard/data/depth_charts.js",
          "scripts/the_lab/dashboard/data/predicted_xii.js"
        ],
        "verification": {
          "all_teams_pass": true,
          "total_predicted_xii_players": 120,
          "total_in_depth_charts": 120,
          "missing_after_fix": 0,
          "tests_passing": "280 passed, 8 skipped",
          "linting": "All checks passed"
        }
      }
    }
  ]
}
