<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teams - The Lab</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* ==================== THEME SYSTEM ==================== */
        :root {
            --bg-primary: #000000;
            --bg-secondary: #1c1c1e;
            --bg-tertiary: #2c2c2e;
            --bg-elevated: #3a3a3c;
            --text-primary: #ffffff;
            --text-secondary: #8e8e93;
            --text-tertiary: #636366;
            --accent: #0a84ff;
            --accent-green: #30d158;
            --accent-yellow: #ffd60a;
            --accent-orange: #ff9f0a;
            --accent-red: #ff453a;
            --accent-purple: #bf5af2;
            --accent-pink: #ff375f;
            --accent-teal: #64d2ff;
            --border: rgba(255, 255, 255, 0.1);
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.08);
            --shadow: rgba(0, 0, 0, 0.4);
        }

        [data-theme="light"] {
            --bg-primary: #f5f5f7;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e5e5ea;
            --bg-elevated: #d1d1d6;
            --text-primary: #1d1d1f;
            --text-secondary: #6e6e73;
            --text-tertiary: #8e8e93;
            --accent: #007aff;
            --accent-green: #28cd41;
            --accent-yellow: #ffcc00;
            --accent-orange: #ff9500;
            --accent-red: #ff3b30;
            --accent-purple: #af52de;
            --accent-pink: #ff2d55;
            --accent-teal: #5ac8fa;
            --border: rgba(0, 0, 0, 0.08);
            --glass: rgba(0, 0, 0, 0.03);
            --glass-border: rgba(0, 0, 0, 0.06);
            --shadow: rgba(0, 0, 0, 0.15);
        }

        /* ==================== TOOLTIP SYSTEM (TKT-109) ==================== */
        .has-tooltip {
            position: relative;
            cursor: help;
        }
        .has-tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-primary);
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 1000;
            pointer-events: none;
            box-shadow: 0 4px 12px var(--shadow);
        }
        .has-tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }
        /* Help icon for inline tooltips */
        .help-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 14px;
            height: 14px;
            font-size: 10px;
            color: var(--text-tertiary);
            cursor: help;
            margin-left: 4px;
            vertical-align: middle;
        }
        .help-icon:hover { color: var(--accent); }

        /* Mobile-safe tooltip adjustments */
        @media (max-width: 768px) {
            .has-tooltip::after {
                white-space: normal;
                max-width: 200px;
                left: 0;
                transform: none;
                font-size: 11px;
            }
        }
        @media (max-width: 480px) {
            .has-tooltip::after {
                max-width: 160px;
                padding: 6px 10px;
                font-size: 10px;
            }
        }

        /* ==================== PROGRESSIVE DISCLOSURE (TKT-110) ==================== */
        .expandable {
            overflow: hidden;
        }
        .expandable-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 12px 16px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            transition: all 0.2s ease;
            user-select: none;
        }
        .expandable-header:hover {
            background: var(--bg-elevated);
        }
        .expandable-header h4 {
            margin: 0;
            font-size: 14px;
            font-weight: 600;
        }
        .expand-icon {
            font-size: 12px;
            color: var(--text-tertiary);
            transition: transform 0.3s ease;
        }
        .expandable.open .expand-icon {
            transform: rotate(180deg);
        }
        .expandable-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
            padding: 0 16px;
        }
        .expandable.open .expandable-content {
            max-height: 500px;
            padding: 16px;
        }
        /* Player row expandable details */
        .player-details-toggle {
            cursor: pointer;
            color: var(--accent);
            font-size: 11px;
            margin-left: 8px;
        }
        .player-details-toggle:hover {
            text-decoration: underline;
        }
        .player-expanded-row {
            display: none;
            background: var(--bg-tertiary);
        }
        .player-expanded-row.show {
            display: table-row;
        }
        .player-expanded-cell {
            padding: 16px 24px !important;
            border-bottom: 1px solid var(--border);
        }
        .player-detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
        }
        .player-detail-item {
            text-align: center;
        }
        .player-detail-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }
        .player-detail-label {
            font-size: 10px;
            text-transform: uppercase;
            color: var(--text-tertiary);
            letter-spacing: 0.5px;
            margin-top: 4px;
        }
        /* Show More / Extended Squad */
        .extended-squad-row {
            display: none;
        }
        .extended-squad-row.show {
            display: table-row;
        }
        .show-more-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px;
            border-top: 1px dashed var(--border);
            margin-top: 8px;
        }
        .show-more-btn {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border: 1px solid var(--border);
            color: var(--accent);
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s ease;
            font-family: inherit;
        }
        .show-more-btn:hover {
            background: linear-gradient(135deg, rgba(10, 132, 255, 0.15) 0%, rgba(191, 90, 242, 0.15) 100%);
            border-color: var(--accent);
            transform: translateY(-2px);
        }
        .show-more-hint {
            font-size: 12px;
            color: var(--text-tertiary);
        }
        .squad-expanded .extended-squad-row {
            display: table-row;
        }
        .squad-expanded .show-more-text {
            display: none !important;
        }
        .squad-expanded .show-less-text {
            display: inline !important;
        }
        .squad-expanded .show-more-hint {
            display: none;
        }

        /* ==================== PHASE PERFORMANCE BARS (TKT-111) ==================== */
        .phase-bars {
            display: flex;
            gap: 4px;
            align-items: center;
        }
        .phase-bar {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }
        .phase-bar-visual {
            width: 24px;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            position: relative;
            overflow: hidden;
        }
        .phase-bar-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        .phase-bar-fill.elite {
            width: 100%;
            background: linear-gradient(90deg, var(--accent-green) 0%, #4ade80 100%);
        }
        .phase-bar-fill.specialist {
            width: 75%;
            background: linear-gradient(90deg, var(--accent-teal) 0%, #22d3ee 100%);
        }
        .phase-bar-fill.average {
            width: 50%;
            background: var(--text-tertiary);
        }
        .phase-bar-label {
            font-size: 8px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .phase-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            font-size: 11px;
        }
        .phase-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        .phase-dot.pp { background: var(--accent-yellow); }
        .phase-dot.mid { background: var(--accent); }
        .phase-dot.death { background: var(--accent-red); }
        .phase-tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        .phase-tag.pp-elite { background: rgba(255, 214, 10, 0.2); color: var(--accent-yellow); }
        .phase-tag.mid-elite { background: rgba(10, 132, 255, 0.2); color: var(--accent); }
        .phase-tag.death-elite { background: rgba(255, 69, 58, 0.2); color: var(--accent-red); }
        .phase-tag.neutral { background: var(--bg-tertiary); color: var(--text-tertiary); }

        /* Batting vs Bowling phase differentiation */
        .phase-group {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        .phase-row {
            display: flex;
            align-items: center;
            gap: 3px;
        }
        .phase-label {
            font-size: 7px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            width: 20px;
            color: var(--text-tertiary);
            flex-shrink: 0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* Background */
        .bg-gradient {
            position: fixed;
            inset: 0;
            z-index: -4;
            background: linear-gradient(135deg, #000000 0%, #0a0a12 25%, #0d1020 50%, #0a0a15 75%, #000000 100%);
        }
        [data-theme="light"] .bg-gradient {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #f1f3f5 100%);
        }
        .bg-gradient::before {
            content: '';
            position: absolute;
            top: -20%;
            right: -10%;
            width: 60%;
            height: 60%;
            background: radial-gradient(ellipse, rgba(10, 132, 255, 0.18) 0%, transparent 70%);
            filter: blur(80px);
        }
        .bg-grid {
            position: fixed;
            inset: 0;
            z-index: -2;
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
            background-size: 60px 60px;
        }
        [data-theme="light"] .bg-grid {
            background-image:
                linear-gradient(rgba(0, 0, 0, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.03) 1px, transparent 1px);
        }

        /* Navigation */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 56px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            z-index: 100;
        }
        [data-theme="light"] .nav { background: rgba(245, 245, 247, 0.85); }
        .nav-brand { display: flex; align-items: center; gap: 12px; }
        .nav-logo {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-purple) 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        .nav-title { font-size: 16px; font-weight: 700; }
        .nav-title span { color: var(--accent); }
        .nav-tabs {
            display: flex;
            gap: 4px;
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            padding: 5px;
            border-radius: 12px;
            border: 1px solid var(--border);
        }
        .nav-tab {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.25s ease;
            border: none;
            background: none;
            font-family: inherit;
            text-decoration: none;
        }
        .nav-tab:hover { color: var(--text-primary); background: var(--bg-tertiary); }
        .nav-tab.active {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-purple) 100%);
            color: white;
        }
        .nav-actions { display: flex; align-items: center; gap: 10px; }
        .nav-time {
            font-size: 11px;
            color: var(--text-tertiary);
            font-variant-numeric: tabular-nums;
            font-weight: 500;
            padding: 6px 10px;
            background: var(--bg-secondary);
            border-radius: 6px;
            border: 1px solid var(--border);
        }
        @media (max-width: 600px) { .nav-time { display: none; } }
        .theme-toggle {
            width: 38px;
            height: 38px;
            border-radius: 10px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.25s ease;
        }
        .theme-toggle:hover { color: var(--accent-yellow); border-color: var(--accent-yellow); }

        /* Main */
        .main { padding-top: 56px; min-height: 100vh; }

        /* Team Selector */
        .team-selector {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 20px 24px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }
        .team-btn {
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.25s ease;
            border: 1px solid var(--border);
            background: var(--bg-tertiary);
            font-family: inherit;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .team-btn .pixel-logo,
        .team-btn svg {
            width: 24px;
            height: 24px;
            min-width: 24px;
            min-height: 24px;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            border-radius: 4px;
            display: inline-block;
        }
        .team-btn:hover {
            color: var(--text-primary);
            border-color: var(--accent);
            transform: translateY(-2px);
        }
        .team-btn.active {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-purple) 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 16px rgba(10, 132, 255, 0.3);
        }

        /* Team Header */
        .team-header-section {
            padding: 40px 24px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .team-header-card {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px;
            position: relative;
            overflow: hidden;
        }
        .team-header-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--team-color, var(--accent));
        }
        .team-header-content {
            display: flex;
            align-items: center;
            gap: 24px;
        }
        .team-badge {
            width: 80px;
            height: 80px;
            background: var(--bg-elevated);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
        }
        .team-header-info h1 {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 8px;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: flex-start;
        }
        @media (max-width: 768px) {
            .team-header-info h1 {
                font-size: 22px;
                justify-content: center;
            }
        }
        @media (max-width: 480px) {
            .team-header-info h1 {
                font-size: 18px;
            }
        }
        .team-header-info p {
            font-size: 14px;
            color: var(--text-secondary);
        }
        .team-meta {
            display: flex;
            gap: 24px;
            margin-top: 16px;
        }
        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-tertiary);
        }
        .meta-item strong { color: var(--text-primary); }

        /* Content Tabs */
        .content-tabs {
            display: flex;
            gap: 4px;
            padding: 0 24px;
            max-width: 1200px;
            margin: 0 auto 24px;
        }
        .content-tab {
            padding: 12px 24px;
            border-radius: 10px 10px 0 0;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.25s ease;
            border: 1px solid var(--border);
            border-bottom: none;
            background: var(--bg-tertiary);
            font-family: inherit;
        }
        .content-tab:hover { color: var(--text-primary); }
        .content-tab.active {
            background: var(--bg-secondary);
            color: var(--accent);
            border-color: var(--accent);
        }

        /* Content Panel */
        .content-panel {
            padding: 0 24px 60px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .panel { display: none; }
        .panel.active { display: block; }

        /* Predicted XI Panel */
        .xi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }
        .player-card {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: all 0.25s ease;
        }
        .player-card:hover {
            border-color: var(--accent);
            transform: translateX(4px);
        }
        .player-position {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-purple) 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 700;
            color: white;
        }
        .player-info { flex: 1; }
        .player-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .player-role {
            font-size: 12px;
            color: var(--text-tertiary);
        }
        .player-meta {
            text-align: right;
        }
        .player-price {
            font-size: 14px;
            font-weight: 600;
            color: var(--accent-green);
        }
        .player-overseas {
            font-size: 10px;
            color: var(--accent-orange);
            text-transform: uppercase;
        }

        /* ==================== STRATEGY OUTLOOK - Complete Redesign ==================== */
        .strategy-outlook {
            padding: 0;
        }
        .strategy-section {
            margin-bottom: 24px;
        }
        .strategy-section-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
            padding-bottom: 10px;
            padding-left: 12px;
            border-bottom: none;
            border-left: 3px solid var(--accent);
        }
        .strategy-section-title {
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-primary);
        }
        .strategy-section-badge {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
        }

        /* Phase Coverage Cards */
        .phase-coverage-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        .phase-card {
            background: linear-gradient(135deg, var(--bg-elevated) 0%, rgba(10, 132, 255, 0.04) 100%);
            border-radius: 12px;
            padding: 16px;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .phase-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }
        .phase-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }
        .phase-card.strong::before { background: var(--accent-green); }
        .phase-card.adequate::before { background: var(--accent-yellow); }
        .phase-card.thin::before { background: var(--accent-red); }
        .phase-card.thin {
            animation: pulse-border 2s ease-in-out infinite;
        }
        @keyframes pulse-border {
            0%, 100% { border-color: var(--border); }
            50% { border-color: var(--accent-red); }
        }
        .phase-card-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 8px;
        }
        .phase-card-label {
            font-size: 11px;
            text-transform: uppercase;
            font-weight: 700;
            color: var(--text-tertiary);
        }
        .phase-card-count {
            font-size: 28px;
            font-weight: 800;
        }
        .phase-card-count.strong { color: var(--accent-green); }
        .phase-card-count.adequate { color: var(--accent-yellow); }
        .phase-card-count.thin { color: var(--accent-red); }
        .phase-card-status {
            font-size: 10px;
            font-weight: 600;
        }
        .phase-card-status.strong { color: var(--accent-green); }
        .phase-card-status.adequate { color: var(--accent-yellow); }
        .phase-card-status.thin { color: var(--accent-red); }
        .phase-card-names {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 6px;
            line-height: 1.4;
        }

        /* Metric Row */
        .metric-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }
        .metric-item {
            background: linear-gradient(135deg, var(--bg-elevated) 0%, rgba(255, 255, 255, 0.03) 100%);
            border-radius: 10px;
            padding: 14px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.06);
            backdrop-filter: blur(4px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .metric-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }
        .metric-value {
            font-size: 26px;
            font-weight: 800;
        }
        .metric-label {
            font-size: 10px;
            text-transform: uppercase;
            color: var(--text-tertiary);
            margin-top: 2px;
        }
        .metric-note {
            font-size: 10px;
            margin-top: 4px;
            font-weight: 600;
        }

        /* Age Profile Bar */
        .age-profile-bar {
            display: flex;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            margin: 10px 0 8px 0;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
        }
        .age-segment {
            transition: width 0.3s ease;
        }
        .age-legend {
            display: flex;
            justify-content: center;
            gap: 16px;
            font-size: 10px;
            color: var(--text-tertiary);
        }
        .age-legend-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 4px;
            vertical-align: middle;
        }

        /* Venue Profile Cards */
        .venue-profile {
            background: var(--bg-elevated);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid var(--border);
        }
        .venue-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .venue-name {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
        }
        .venue-character {
            font-size: 11px;
            padding: 3px 10px;
            border-radius: 6px;
            font-weight: 700;
            text-transform: uppercase;
        }
        .venue-character.pace { background: rgba(10, 132, 255, 0.15); color: var(--accent); }
        .venue-character.spin { background: rgba(191, 90, 242, 0.15); color: var(--accent-purple); }
        .venue-character.balanced { background: rgba(48, 209, 88, 0.15); color: var(--accent-green); }

        .venue-phase-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 16px;
        }
        .venue-phase-card {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }
        .venue-phase-label {
            font-size: 10px;
            text-transform: uppercase;
            color: var(--text-tertiary);
            margin-bottom: 6px;
            font-weight: 600;
        }
        .venue-phase-stat {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }
        .venue-phase-sub {
            font-size: 10px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        /* Venue Records Table */
        .venue-records-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        .venue-records-table th {
            text-align: left;
            padding: 8px 10px;
            font-size: 10px;
            text-transform: uppercase;
            color: var(--text-tertiary);
            border-bottom: 1px solid var(--border);
            font-weight: 600;
        }
        .venue-records-table td {
            padding: 8px 10px;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            color: var(--text-secondary);
        }
        .venue-records-table tr:hover td {
            background: rgba(255,255,255,0.02);
        }
        .win-pct-bar {
            height: 4px;
            border-radius: 2px;
            background: var(--bg-tertiary);
            overflow: hidden;
            margin-top: 3px;
        }
        .win-pct-fill {
            height: 100%;
            border-radius: 2px;
        }

        /* Historic Trends */
        .trend-season-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        .trend-season-card {
            background: var(--bg-elevated);
            border-radius: 10px;
            padding: 16px;
            text-align: center;
            border: 1px solid var(--border);
            position: relative;
        }
        .trend-season-year {
            font-size: 12px;
            font-weight: 700;
            color: var(--text-tertiary);
            margin-bottom: 8px;
        }
        .trend-season-record {
            font-size: 20px;
            font-weight: 800;
            color: var(--text-primary);
        }
        .trend-season-winpct {
            font-size: 14px;
            font-weight: 700;
            margin-top: 4px;
        }
        .trend-arrow {
            font-size: 12px;
            margin-left: 4px;
        }
        .trend-arrow.up { color: var(--accent-green); }
        .trend-arrow.down { color: var(--accent-red); }
        .trend-arrow.flat { color: var(--text-tertiary); }

        /* Phase Trend Sparklines */
        .phase-trend-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 16px;
        }
        .phase-trend-card {
            background: var(--bg-elevated);
            border-radius: 10px;
            padding: 16px;
            border: 1px solid var(--border);
        }
        .phase-trend-title {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--text-tertiary);
            margin-bottom: 12px;
        }
        .phase-trend-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            font-size: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.03);
        }
        .phase-trend-row:last-child { border-bottom: none; }
        .phase-trend-label {
            color: var(--text-tertiary);
            font-size: 11px;
        }
        .phase-trend-values {
            display: flex;
            gap: 12px;
        }
        .phase-trend-val {
            font-weight: 600;
            min-width: 40px;
            text-align: right;
        }

        /* Vulnerability Alert */
        .vuln-card {
            background: rgba(255, 69, 58, 0.04);
            border: 1px solid rgba(255, 69, 58, 0.15);
            border-radius: 12px;
            padding: 16px;
        }
        .vuln-header {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--accent-red);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .vuln-list {
            margin: 0;
            padding-left: 18px;
            color: var(--text-secondary);
            font-size: 12px;
            line-height: 1.6;
        }

        /* Pressure & Momentum */
        .momentum-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }
        .momentum-card {
            background: var(--surface-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 16px;
        }
        .momentum-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .momentum-card-title {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
        }
        .momentum-rating {
            font-size: 11px;
            font-weight: 700;
            padding: 3px 10px;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        .momentum-rating.elite { background: rgba(48, 209, 88, 0.15); color: var(--accent-green); }
        .momentum-rating.strong { background: rgba(10, 132, 255, 0.15); color: var(--accent-blue); }
        .momentum-rating.average { background: rgba(255, 214, 10, 0.15); color: var(--accent-yellow); }
        .momentum-rating.weak { background: rgba(255, 69, 58, 0.15); color: var(--accent-red); }
        .momentum-rating.explosive { background: rgba(191, 90, 242, 0.15); color: var(--accent-purple); }
        .momentum-rating.limited { background: rgba(255, 69, 58, 0.15); color: var(--accent-red); }
        .momentum-stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid var(--border-primary);
            font-size: 12px;
        }
        .momentum-stat-row:last-child { border-bottom: none; }
        .momentum-player-name {
            color: var(--text-primary);
            font-weight: 600;
            flex: 1;
        }
        .momentum-stat-value {
            color: var(--text-secondary);
            font-size: 11px;
            text-align: right;
            min-width: 80px;
        }
        .momentum-stat-value .highlight {
            color: var(--accent-blue);
            font-weight: 700;
        }
        .momentum-team-summary {
            display: flex;
            gap: 16px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid var(--border-primary);
            font-size: 11px;
            color: var(--text-tertiary);
        }
        .clutch-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }
        .clutch-card {
            background: var(--surface-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 16px;
        }
        .clutch-card.positive { border-color: rgba(48, 209, 88, 0.25); }
        .clutch-card.negative { border-color: rgba(255, 69, 58, 0.25); }
        .clutch-card-header {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .clutch-card.positive .clutch-card-header { color: var(--accent-green); }
        .clutch-card.negative .clutch-card-header { color: var(--accent-red); }
        .clutch-player-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            font-size: 12px;
        }
        .clutch-delta {
            font-weight: 700;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 12px;
        }
        .clutch-delta.positive { background: rgba(48, 209, 88, 0.12); color: var(--accent-green); }
        .clutch-delta.negative { background: rgba(255, 69, 58, 0.12); color: var(--accent-red); }
        .flower-insight-box {
            background: linear-gradient(135deg, rgba(48, 209, 88, 0.05) 0%, rgba(10, 132, 255, 0.05) 100%);
            border: 1px solid rgba(48, 209, 88, 0.2);
            border-radius: 12px;
            padding: 16px;
        }
        .flower-insight-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--accent-green);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .flower-insight-text {
            font-size: 12.5px;
            color: var(--text-secondary);
            line-height: 1.65;
            font-style: italic;
        }

        /* Two-column layout */
        .strategy-two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        /* Responsive - Strategy Outlook */
        @media (max-width: 768px) {
            .phase-coverage-grid { grid-template-columns: 1fr; }
            .strategy-two-col { grid-template-columns: 1fr; }
            .trend-season-grid { grid-template-columns: 1fr; }
            .venue-phase-grid { grid-template-columns: 1fr; }
            .phase-trend-grid { grid-template-columns: 1fr; }
            .momentum-grid { grid-template-columns: 1fr; }
            .clutch-grid { grid-template-columns: 1fr; }
        }

        /* Impact Player */
        .impact-player {
            background: linear-gradient(135deg, rgba(191, 90, 242, 0.1) 0%, rgba(10, 132, 255, 0.1) 100%);
            border: 1px dashed var(--accent-purple);
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .impact-badge {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-pink) 100%);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
            color: white;
        }

        /* Depth Chart Panel â€” Tabular Redesign */
        .depth-section {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .depth-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        .depth-position {
            font-size: 18px;
            font-weight: 700;
        }
        .depth-rating {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-purple) 100%);
            color: white;
            padding: 6px 14px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 700;
        }
        .depth-table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .depth-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        .depth-table thead { position: sticky; top: 0; z-index: 2; }
        .depth-table th {
            background: var(--bg-tertiary);
            padding: 10px 12px;
            text-align: left;
            font-weight: 700;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            border-bottom: 2px solid var(--border);
            white-space: nowrap;
        }
        .depth-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border);
            vertical-align: middle;
        }
        .depth-table tr:hover td { background: rgba(255,255,255,0.03); }
        .depth-table tr.depth-row { cursor: pointer; transition: background 0.15s; }
        .depth-table tr.depth-row:hover { background: rgba(10,132,255,0.06); }
        .depth-table .rating-high { color: var(--accent-green); font-weight: 700; }
        .depth-table .rating-mid { color: var(--accent-yellow); font-weight: 700; }
        .depth-table .rating-low { color: var(--accent-red); font-weight: 700; }
        .depth-table .os-badge {
            font-size: 9px; color: var(--accent-orange);
            border: 1px solid var(--accent-orange);
            border-radius: 3px; padding: 1px 4px; margin-left: 4px;
        }
        .depth-table .bowl-type-tag {
            font-size: 8px; color: var(--accent); font-weight: 600;
            border: 1px solid rgba(10,132,255,0.3);
            border-radius: 3px; padding: 1px 3px; margin-left: 3px;
            background: rgba(10,132,255,0.08);
        }
        .bowl-variety-badge {
            font-size: 10px; font-weight: 600;
            padding: 2px 6px; border-radius: 4px;
            background: rgba(10,132,255,0.08);
            color: var(--text-secondary);
            margin-left: 4px;
        }
        .depth-detail-row td {
            padding: 0;
            border-bottom: 1px solid var(--border);
        }
        .depth-detail-inner {
            padding: 12px 16px;
            background: var(--bg-elevated);
            font-size: 12px;
            line-height: 1.6;
            color: var(--text-secondary);
            display: none;
        }
        .depth-detail-inner.open { display: block; }
        .depth-detail-inner .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px 24px;
        }
        .depth-players {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .depth-player {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-elevated);
            border-radius: 10px;
        }
        .depth-rank {
            width: 28px;
            height: 28px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            color: var(--text-secondary);
        }
        .depth-rank.primary { background: var(--accent); color: white; }
        .depth-player-info { flex: 1; }
        .depth-player-name { font-size: 14px; font-weight: 600; }
        .depth-player-rationale { font-size: 11px; color: var(--text-tertiary); margin-top: 2px; }

        /* Phil Steele Style Squad Roster */
        .squad-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid var(--border);
        }
        .squad-header h3 {
            font-size: 20px;
            font-weight: 700;
        }
        .squad-stats {
            display: flex;
            gap: 20px;
        }
        .squad-stat {
            text-align: center;
        }
        .squad-stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent);
        }
        .squad-stat-label {
            font-size: 10px;
            color: var(--text-tertiary);
            text-transform: uppercase;
        }

        /* Phil Steele Roster Table */
        .roster-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        .roster-table thead {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .roster-table th {
            background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-elevated) 100%);
            padding: 12px 8px;
            text-align: left;
            font-weight: 700;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            border-bottom: 2px solid var(--accent);
        }
        .roster-table th:first-child { border-radius: 8px 0 0 0; }
        .roster-table th:last-child { border-radius: 0 8px 0 0; }
        .roster-table td {
            padding: 10px 8px;
            border-bottom: 1px solid var(--border);
            transition: background 0.2s ease;
        }
        .roster-table tr:hover td {
            background: var(--glass);
        }
        .roster-table tr:nth-child(even) td {
            background: rgba(255, 255, 255, 0.02);
        }
        .roster-table tr:nth-child(even):hover td {
            background: var(--glass);
        }

        /* Player Name Column */
        .player-name-cell {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .player-number {
            width: 24px;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            color: var(--text-tertiary);
        }
        .player-name-text {
            font-weight: 600;
        }
        .retained-badge {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--accent-pink) 100%);
            color: white;
            font-size: 8px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 700;
            text-transform: uppercase;
        }

        /* Role Badge */
        .role-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .role-batter { background: rgba(48, 209, 88, 0.15); color: var(--accent-green); }
        .role-bowler { background: rgba(255, 69, 58, 0.15); color: var(--accent-red); }
        .role-all-rounder { background: rgba(10, 132, 255, 0.15); color: var(--accent); }
        .role-wicketkeeper { background: rgba(255, 214, 10, 0.15); color: var(--accent-yellow); }

        /* Nationality Flag */
        .nationality-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
        }
        .nationality-badge.overseas {
            background: rgba(255, 159, 10, 0.15);
            color: var(--accent-orange);
        }

        /* Price Column */
        .price-cell {
            font-weight: 700;
            font-family: 'Inter', monospace;
        }
        .price-high { color: var(--accent-green); }
        .price-mid { color: var(--accent-yellow); }
        .price-low { color: var(--text-tertiary); }

        /* Age Column */
        .age-cell {
            font-weight: 600;
        }
        .age-young { color: var(--accent-green); }
        .age-prime { color: var(--text-primary); }
        .age-veteran { color: var(--accent-orange); }

        /* IPL Experience Column */
        .ipl-exp-badge {
            font-weight: 600;
            font-size: 12px;
        }
        .ipl-exp-badge.veteran { color: var(--accent-green); }
        .ipl-exp-badge.uncapped { color: var(--accent-orange); font-style: italic; }

        /* Batting Hand */
        .batting-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            background: var(--bg-tertiary);
        }
        .batting-left { color: var(--accent-teal); }
        .batting-right { color: var(--text-secondary); }

        /* Phil Steele Dense Table Styles */
        .roster-table.phil-steele {
            font-size: 12px;
        }
        .roster-table.phil-steele th {
            padding: 10px 6px;
            font-size: 9px;
        }
        .roster-table.phil-steele td {
            padding: 8px 6px;
        }
        .compact-cell {
            text-align: center;
        }
        .hand-badge {
            display: inline-block;
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            background: var(--bg-tertiary);
        }
        .hand-badge.left-hand {
            background: rgba(100, 210, 255, 0.15);
            color: var(--accent-teal);
        }
        .bowl-cell {
            min-width: 100px;
        }
        .bowl-type-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 600;
            background: rgba(255, 69, 58, 0.12);
            color: var(--accent-red);
            white-space: nowrap;
        }
        .bowl-arm {
            font-size: 8px;
            font-weight: 700;
            padding: 1px 3px;
            border-radius: 2px;
            background: rgba(255, 255, 255, 0.08);
        }
        .bowl-arm.left-arm {
            background: rgba(100, 210, 255, 0.15);
            color: var(--accent-teal);
        }
        .archetype-cell {
            max-width: 140px;
        }
        .archetype-badge {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 600;
            background: rgba(191, 90, 242, 0.12);
            color: var(--accent-purple);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 130px;
        }
        .na-badge {
            color: var(--text-tertiary);
            font-size: 10px;
        }
        .nat-badge {
            font-size: 14px;
        }
        .nat-badge.overseas {
            filter: saturate(1.2);
        }
        .captain-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: linear-gradient(135deg, var(--accent-yellow) 0%, var(--accent-orange) 100%);
            color: #000;
            font-size: 9px;
            font-weight: 800;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .captain-row {
            background: linear-gradient(90deg, rgba(255, 214, 10, 0.12) 0%, rgba(255, 159, 10, 0.08) 50%, transparent 100%) !important;
            border-left: 3px solid var(--accent-yellow) !important;
        }
        .captain-row td:first-child {
            padding-left: 5px;
        }
        .captain-row:hover td {
            background: rgba(255, 214, 10, 0.15) !important;
        }
        .captain-row .player-name-text {
            font-weight: 700;
            color: var(--accent-yellow);
        }

        /* Squad Summary */
        .squad-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }
        .summary-card {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
        }
        .summary-card h4 {
            font-size: 11px;
            text-transform: uppercase;
            color: var(--text-tertiary);
            margin-bottom: 12px;
        }
        .summary-breakdown {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .breakdown-row {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
        }
        .breakdown-label { color: var(--text-secondary); }
        .breakdown-value { font-weight: 600; }

        /* Reigning Champion Badge */
        .reigning-badge {
            background: linear-gradient(135deg, #ffd700, #ff8c00);
            color: #000;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            animation: pulse-gold 2s ease-in-out infinite;
            white-space: nowrap;
        }
        .reigning-badge .badge-text {
            display: inline;
        }
        @keyframes pulse-gold {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
        }
        /* Mobile: Show only trophy icon */
        @media (max-width: 768px) {
            .reigning-badge .badge-text { display: none; }
            .reigning-badge { padding: 4px 8px; font-size: 14px; }
        }

        /* Search & Filters */
        .search-filter-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        .search-box {
            flex: 1;
            min-width: 200px;
            position: relative;
        }
        .search-box input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.25s ease;
        }
        .search-box input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.2);
        }
        .search-box::before {
            content: 'ðŸ”';
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
        }
        .filter-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .filter-select {
            padding: 10px 32px 10px 14px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 13px;
            font-family: inherit;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%238e8e93' d='M6 8L2 4h8z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
        }
        .filter-select:focus {
            outline: none;
            border-color: var(--accent);
        }
        .export-btn {
            padding: 10px 16px;
            border-radius: 10px;
            border: 1px solid var(--accent);
            background: transparent;
            color: var(--accent);
            font-size: 13px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.25s ease;
        }
        .export-btn:hover {
            background: var(--accent);
            color: white;
        }
        .filter-count {
            padding: 6px 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            font-size: 12px;
            color: var(--text-secondary);
        }
        .filter-count strong {
            color: var(--accent);
        }

        /* Compare Mode */
        .compare-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }
        .compare-team {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
        }
        .compare-team-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }
        .compare-team-icon {
            font-size: 32px;
        }
        .compare-team-name {
            font-size: 18px;
            font-weight: 700;
        }
        .compare-team select {
            margin-left: auto;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg-elevated);
            color: var(--text-primary);
            font-family: inherit;
        }
        .compare-stats {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .compare-stat-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }
        .compare-stat-label {
            font-size: 13px;
            color: var(--text-secondary);
        }
        .compare-stat-value {
            font-size: 16px;
            font-weight: 700;
        }
        .compare-stat-value.better {
            color: var(--accent-green);
        }
        .compare-stat-value.worse {
            color: var(--accent-red);
        }

        /* Data Timestamp */
        .data-timestamp {
            text-align: center;
            padding: 12px;
            font-size: 11px;
            color: var(--text-tertiary);
            border-top: 1px solid var(--border);
            margin-top: 40px;
        }

        /* Typewriter Animation */
        .typewriter-container {
            display: flex;
            justify-content: center;
            padding: 30px 24px 10px;
        }
        .typewriter-title {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent) 50%, var(--accent-purple) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            overflow: hidden;
            border-right: 3px solid var(--accent);
            white-space: nowrap;
            width: 0;
            animation: typing-teams 1s steps(14, end) 0.3s forwards, blink-caret 0.75s step-end 3, hide-caret 0.1s ease 2.5s forwards;
        }
        @keyframes typing-teams {
            from { width: 0; }
            to { width: 14ch; }
        }
        @keyframes blink-caret {
            from, to { border-color: transparent; }
            50% { border-color: var(--accent); }
        }
        @keyframes hide-caret {
            to { border-color: transparent; }
        }

        /* Loading State */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Mobile hamburger */
        .mobile-menu-btn {
            display: none;
            width: 44px;
            height: 44px;
            border-radius: 10px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            align-items: center;
            justify-content: center;
        }
        .mobile-nav {
            display: none;
            position: fixed;
            top: 56px;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: 16px;
            z-index: 99;
            flex-direction: column;
            gap: 8px;
        }
        .mobile-nav.active {
            display: flex;
        }
        .mobile-nav a {
            padding: 12px 16px;
            border-radius: 10px;
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.25s ease;
        }
        .mobile-nav a:hover, .mobile-nav a.active {
            background: var(--accent);
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-tabs { display: none; }
            .mobile-menu-btn { display: flex; }
            .team-selector { gap: 4px; padding: 12px; }
            .team-btn { padding: 8px 12px; font-size: 12px; }
            .team-header-content { flex-direction: column; text-align: center; }
            .team-meta { justify-content: center; flex-wrap: wrap; gap: 12px; }
            .meta-item { font-size: 11px; }
            .xi-grid { grid-template-columns: 1fr; }
            .roster-table-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; }
            .roster-table { font-size: 11px; min-width: 600px; }
            .roster-table th, .roster-table td { padding: 8px 4px; }
            .squad-summary { grid-template-columns: 1fr; }
            .search-filter-bar { flex-direction: column; align-items: stretch; }
            .search-box { min-width: 100%; }
            .filter-group { width: 100%; justify-content: space-between; }
            .filter-select { flex: 1; min-width: 0; }
            .compare-container { grid-template-columns: 1fr; }
            .content-tabs { overflow-x: auto; white-space: nowrap; padding-bottom: 8px; }
            .content-tab { flex-shrink: 0; }
        }

        /* ==================== NAVIGATION GUIDE ==================== */
        .nav-guide-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #ff9f0a 0%, #ff6b35 100%);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(255, 159, 10, 0.4);
            z-index: 90;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse-guide 2s ease-in-out infinite;
        }
        @keyframes pulse-guide {
            0%, 100% { box-shadow: 0 4px 20px rgba(255, 159, 10, 0.4); }
            50% { box-shadow: 0 4px 30px rgba(255, 159, 10, 0.6); }
        }
        .nav-guide-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 28px rgba(255, 159, 10, 0.6);
            animation: none;
        }
        /* ==================== PLAYER PROFILE MODAL (TKT-200) ==================== */
        .player-profile-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 250;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .player-profile-overlay.active { display: flex; }
        .player-profile-modal {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 32px;
            max-width: 640px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid var(--border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            position: relative;
        }
        .player-profile-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 10;
        }
        .player-profile-close:hover { background: var(--bg-elevated); color: var(--text-primary); }
        .pp-header {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }
        .pp-name {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0 0 4px 0;
        }
        .pp-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin: 0;
        }
        .pp-meta {
            display: flex;
            gap: 12px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        .pp-meta-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
        }
        .pp-meta-badge.price { color: var(--accent-green); }
        .pp-meta-badge.captain { color: var(--accent-yellow); }
        .pp-section {
            margin-bottom: 20px;
        }
        .pp-section-title {
            font-size: 13px;
            font-weight: 700;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
            border-left: 3px solid var(--accent);
            padding-left: 10px;
        }
        .pp-section-title.bowling { border-left-color: var(--accent-green); }
        .pp-stat-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 12px;
        }
        .pp-stat-card {
            background: var(--bg-tertiary);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }
        .pp-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }
        .pp-stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 2px;
        }
        .pp-phase-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        .pp-phase-card {
            background: var(--bg-tertiary);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }
        .pp-phase-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }
        .pp-phase-label.pp { color: var(--accent); }
        .pp-phase-label.mid { color: var(--accent-yellow); }
        .pp-phase-label.death { color: var(--accent-red); }
        .pp-phase-stat {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.6;
        }
        .pp-phase-stat strong {
            color: var(--text-primary);
            font-weight: 600;
        }
        .pp-sample {
            font-size: 10px;
            color: var(--text-tertiary);
            display: block;
            margin-top: 2px;
        }
        .pp-sample.low { color: var(--accent-orange); }
        .pp-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .pp-tag {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
        }
        .pp-tag.strength { background: rgba(48, 209, 88, 0.15); color: var(--accent-green); }
        .pp-tag.vulnerability { background: rgba(255, 69, 58, 0.15); color: var(--accent-red); }
        .pp-tag.phase-tag { background: rgba(10, 132, 255, 0.15); color: var(--accent); }
        .pp-tag.style { background: var(--bg-tertiary); color: var(--text-secondary); }
        .pp-matchup-table {
            width: 100%;
            font-size: 13px;
            border-collapse: collapse;
        }
        .pp-matchup-table th {
            text-align: left;
            padding: 6px 8px;
            color: var(--text-tertiary);
            font-weight: 600;
            font-size: 11px;
            text-transform: uppercase;
            border-bottom: 1px solid var(--border);
        }
        .pp-matchup-table td {
            padding: 6px 8px;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border);
        }
        .pp-matchup-table tr:last-child td { border-bottom: none; }
        .pp-vs-label { font-weight: 600; }
        .pp-vs-good { color: var(--accent-green); }
        .pp-vs-bad { color: var(--accent-red); }
        .pp-entry-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .pp-no-data {
            text-align: center;
            padding: 20px;
            color: var(--text-tertiary);
            font-size: 13px;
            font-style: italic;
        }
        /* Clickable player names */
        .player-clickable {
            cursor: pointer;
            transition: color 0.15s ease;
        }
        .player-clickable:hover {
            color: var(--accent);
            text-decoration: underline;
            text-underline-offset: 2px;
        }
        @media (max-width: 768px) {
            .player-profile-overlay { padding: 0; }
            .player-profile-modal {
                max-width: 100%;
                max-height: 100vh;
                height: 100vh;
                border-radius: 0;
                padding: 16px;
                font-size: 16px;
            }
            .player-profile-close {
                width: 44px;
                height: 44px;
                font-size: 20px;
                top: 12px;
                right: 12px;
            }
            .pp-name { font-size: 20px; }
            .pp-stat-grid { grid-template-columns: repeat(2, 1fr); }
            .pp-phase-grid { grid-template-columns: 1fr; }
            .pp-stat-card { padding: 12px; min-height: 44px; }
            .pp-matchup-table td, .pp-matchup-table th { padding: 10px 8px; }
            .pp-tag { padding: 8px 12px; font-size: 12px; min-height: 44px; display: inline-flex; align-items: center; }
            .pp-meta-badge { padding: 8px 12px; min-height: 44px; display: inline-flex; align-items: center; }
            .pp-section-title { font-size: 14px; padding: 8px 10px; }
        }
        .nav-guide-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .nav-guide-overlay.active { display: flex; }
        .nav-guide-modal {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 32px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid var(--border);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            position: relative;
        }
        .nav-guide-header { text-align: center; margin-bottom: 24px; }
        .nav-guide-header h3 { font-size: 22px; font-weight: 700; margin-bottom: 8px; }
        .nav-guide-header p { color: var(--text-secondary); font-size: 14px; }
        .nav-guide-item {
            display: flex;
            gap: 16px;
            padding: 16px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            margin-bottom: 12px;
            align-items: flex-start;
            transition: all 0.2s ease;
        }
        .nav-guide-item:hover { background: var(--bg-elevated); transform: translateX(4px); }
        .nav-guide-icon {
            font-size: 28px;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-secondary);
            border-radius: 12px;
            flex-shrink: 0;
        }
        .nav-guide-text h4 { font-size: 14px; font-weight: 600; margin-bottom: 4px; }
        .nav-guide-text p { font-size: 12px; color: var(--text-secondary); line-height: 1.4; }
        .nav-guide-start { border: 2px solid var(--accent-green); }
        .nav-guide-start .nav-guide-icon { background: rgba(48, 209, 88, 0.2); }
        .nav-guide-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .nav-guide-close:hover { background: var(--bg-elevated); color: var(--text-primary); }

        /* ==================== PRESSURE PERFORMANCE (TKT-050 Enhanced) ==================== */
        .pressure-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px;
            background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-elevated) 100%);
            border-radius: 16px;
            margin-bottom: 24px;
        }
        .pressure-header-info h3 {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 4px;
        }
        .pressure-header-info p {
            color: var(--text-tertiary);
            font-size: 13px;
        }
        .clutch-score-display { text-align: center; }
        .clutch-score-value { font-size: 42px; font-weight: 800; line-height: 1; }
        .clutch-score-label {
            font-size: 11px; color: var(--text-tertiary);
            text-transform: uppercase; letter-spacing: 0.5px; margin-top: 4px;
        }
        .pressure-summary-grid {
            display: grid; grid-template-columns: repeat(4, 1fr);
            gap: 12px; margin-bottom: 24px;
        }
        .pressure-summary-card {
            background: var(--bg-secondary); border: 1px solid var(--border);
            border-radius: 12px; padding: 16px; text-align: center;
        }
        .pressure-summary-card .count { font-size: 28px; font-weight: 800; line-height: 1.2; }
        .pressure-summary-card .label {
            font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px;
            color: var(--text-tertiary); margin-top: 4px;
        }
        .pressure-summary-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 24px;
        }
        .pressure-summary-table thead th {
            padding: 10px 16px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-tertiary);
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border);
            text-align: center;
            font-weight: 600;
        }
        .pressure-summary-table thead th:first-child { text-align: left; }
        .pressure-summary-table tbody td {
            padding: 12px 16px;
            font-size: 14px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }
        .pressure-summary-table tbody td:first-child {
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
        }
        .pressure-summary-table tbody tr:last-child td { border-bottom: none; }
        .pressure-summary-table .table-count {
            font-size: 20px;
            font-weight: 800;
            line-height: 1.2;
        }
        .pressure-summary-table .table-pct {
            font-size: 11px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }
        .pressure-section-title {
            font-size: 16px; font-weight: 700; margin-bottom: 16px;
            padding-bottom: 8px; border-bottom: 1px solid var(--border);
        }
        .pressure-player-list { display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px; }

        /* Player card wrapper - contains summary + expandable detail */
        .pressure-player-card {
            background: var(--bg-secondary); border: 1px solid var(--border);
            border-radius: 12px; overflow: hidden; transition: all 0.2s ease;
        }
        .pressure-player-card:hover { border-color: var(--accent); }
        .pressure-player-card.expanded { border-color: var(--accent); }

        .pressure-player-summary {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 16px; cursor: pointer; user-select: none;
        }
        .pressure-rank {
            width: 28px; height: 28px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 13px; font-weight: 700;
            background: var(--bg-tertiary); color: var(--text-secondary); flex-shrink: 0;
        }
        .pressure-rank.top { background: var(--accent); color: white; }
        .pressure-player-info { flex: 1; min-width: 0; }
        .pressure-player-name {
            font-size: 14px; font-weight: 600; display: flex;
            align-items: center; gap: 8px; flex-wrap: wrap;
        }
        .pressure-player-name .player-name-text {
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
            flex-shrink: 1; min-width: 0;
        }
        .pressure-player-detail { font-size: 12px; color: var(--text-tertiary); margin-top: 2px; }
        .pressure-stat { text-align: right; flex-shrink: 0; }
        .pressure-stat-value { font-size: 16px; font-weight: 700; }
        .pressure-stat-label { font-size: 10px; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.3px; }
        .pressure-badge {
            display: inline-block; padding: 3px 8px; border-radius: 6px;
            font-size: 10px; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.3px; flex-shrink: 0;
        }
        .pressure-badge.clutch { background: rgba(48, 209, 88, 0.2); color: var(--accent-green); }
        .pressure-badge.pressure-proof { background: rgba(10, 132, 255, 0.2); color: var(--accent); }
        .pressure-badge.moderate { background: rgba(255, 214, 10, 0.2); color: var(--accent-yellow); }
        .pressure-badge.pressure-sensitive { background: rgba(255, 69, 58, 0.2); color: var(--accent-red); }
        .pressure-badge.elite { background: rgba(48, 209, 88, 0.2); color: var(--accent-green); }
        .pressure-badge.strong { background: rgba(10, 132, 255, 0.2); color: var(--accent); }
        .pressure-badge.average { background: rgba(255, 214, 10, 0.2); color: var(--accent-yellow); }
        .pressure-badge.vulnerable { background: rgba(255, 69, 58, 0.2); color: var(--accent-red); }

        /* Entry context badges - enhanced visibility */
        .entry-badge {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 3px 10px; border-radius: 6px;
            font-size: 10px; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.5px; flex-shrink: 0; white-space: nowrap;
            border: 1px solid transparent;
        }
        .entry-badge .entry-balls { font-weight: 400; opacity: 0.8; font-size: 9px; }
        .entry-badge.fresh { background: rgba(10, 132, 255, 0.2); color: #4aa8ff; border-color: rgba(10, 132, 255, 0.3); }
        .entry-badge.building { background: rgba(255, 159, 10, 0.2); color: #ff9f0a; border-color: rgba(255, 159, 10, 0.3); }
        .entry-badge.set { background: rgba(48, 209, 88, 0.2); color: #30d158; border-color: rgba(48, 209, 88, 0.3); }
        .entry-badge.deep-set { background: rgba(0, 125, 27, 0.3); color: #00c22b; border-color: rgba(0, 125, 27, 0.4); }

        /* Sample size badges */
        .sample-badge {
            display: inline-flex; align-items: center; justify-content: center;
            width: 18px; height: 18px; border-radius: 4px;
            font-size: 9px; font-weight: 700; letter-spacing: 0.3px;
            flex-shrink: 0; cursor: help;
        }
        .sample-large { background: rgba(48, 209, 88, 0.2); color: #30d158; }
        .sample-medium { background: rgba(255, 214, 10, 0.2); color: #ffd60a; }
        .sample-small { background: rgba(255, 69, 58, 0.2); color: #ff453a; }

        .pressure-wscore { text-align: right; flex-shrink: 0; min-width: 48px; }
        .pressure-wscore-value { font-size: 14px; font-weight: 700; }
        .pressure-wscore-label { font-size: 9px; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.3px; }

        .pressure-expand-icon {
            font-size: 10px; color: var(--text-tertiary); transition: transform 0.3s ease;
            flex-shrink: 0; padding: 4px;
        }
        .pressure-player-card.expanded .pressure-expand-icon { transform: rotate(180deg); }

        /* Expandable detail panel */
        .pressure-player-detail-panel {
            max-height: 0; overflow: hidden; transition: max-height 0.4s ease;
        }
        .pressure-player-card.expanded .pressure-player-detail-panel { max-height: 600px; }
        .pressure-detail-inner {
            padding: 0 16px 16px; display: flex; flex-direction: column; gap: 12px;
            border-top: 1px solid var(--border);
        }

        /* Phase comparison (15-17 vs 18-20) */
        .pressure-phase-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 12px;
        }
        .pressure-phase-card {
            background: var(--bg-tertiary); border-radius: 8px; padding: 10px 12px;
        }
        .pressure-phase-label {
            font-size: 10px; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.5px; color: var(--text-tertiary); margin-bottom: 6px;
        }
        .pressure-phase-stats {
            display: flex; flex-wrap: wrap; gap: 8px;
        }
        .pressure-phase-stat {
            display: flex; flex-direction: column; align-items: center; min-width: 40px;
        }
        .pressure-phase-stat .val { font-size: 14px; font-weight: 700; }
        .pressure-phase-stat .lbl { font-size: 9px; color: var(--text-tertiary); text-transform: uppercase; }

        /* Band breakdown mini-table */
        .pressure-band-table {
            width: 100%; border-collapse: collapse; font-size: 11px;
        }
        .pressure-band-table th {
            text-align: left; padding: 4px 8px; font-size: 9px; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.5px;
            color: var(--text-tertiary); border-bottom: 1px solid var(--border);
        }
        .pressure-band-table td {
            padding: 4px 8px; border-bottom: 1px solid var(--glass-border);
        }
        .pressure-band-table tr:last-child td { border-bottom: none; }
        .pressure-band-tag {
            font-weight: 600; font-size: 10px; display: inline-block;
            padding: 1px 6px; border-radius: 4px;
        }
        .pressure-band-tag.comfortable { background: rgba(48, 209, 88, 0.15); color: var(--accent-green); }
        .pressure-band-tag.building { background: rgba(10, 132, 255, 0.15); color: var(--accent); }
        .pressure-band-tag.high { background: rgba(255, 214, 10, 0.15); color: var(--accent-yellow); }
        .pressure-band-tag.extreme { background: rgba(255, 159, 10, 0.15); color: var(--accent-orange); }
        .pressure-band-tag.near-impossible { background: rgba(255, 69, 58, 0.15); color: var(--accent-red); }

        .pressure-columns { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }

        /* Pressure roster table */
        .pressure-roster .pressure-table-row { cursor: pointer; transition: background 0.15s; }
        .pressure-roster .pressure-table-row:hover { background: var(--bg-elevated); }
        .pressure-roster .pressure-table-row.expanded { background: var(--bg-elevated); border-bottom: none; }
        .pressure-roster .pressure-table-name { white-space: nowrap; }
        .pressure-table-role-tag {
            display: inline-block; font-size: 9px; font-weight: 700; padding: 1px 5px;
            border-radius: 4px; margin-left: 6px; vertical-align: middle; letter-spacing: 0.5px;
        }
        .pressure-table-role-tag.bat { background: rgba(10, 132, 255, 0.15); color: var(--accent); }
        .pressure-table-role-tag.bwl { background: rgba(255, 159, 10, 0.15); color: var(--accent-orange); }
        .pressure-table-detail { display: none; }
        .pressure-table-detail.visible { display: table-row; }
        .pressure-table-detail td { padding: 12px 16px; background: var(--bg-tertiary); border-top: none; }
        .pressure-table-detail .pressure-detail-inner { max-width: 700px; }

        /* Qualification criteria */
        .pressure-qual-note {
            margin-top: 16px; padding: 12px 16px;
            background: var(--bg-tertiary); border: 1px solid var(--border);
            border-radius: 10px; font-size: 11px; color: var(--text-tertiary);
            line-height: 1.6;
        }
        .pressure-qual-note strong { color: var(--text-secondary); }

        /* Glossary */
        .pressure-glossary-toggle {
            display: flex; align-items: center; justify-content: center; gap: 8px;
            margin-top: 24px; padding: 10px 20px;
            background: var(--bg-tertiary); border: 1px solid var(--border);
            border-radius: 10px; color: var(--text-secondary);
            font-size: 13px; font-weight: 600; cursor: pointer;
            transition: all 0.2s ease; user-select: none; width: 100%;
        }
        .pressure-glossary-toggle:hover { background: var(--bg-elevated); color: var(--text-primary); border-color: var(--accent); }
        .pressure-glossary-toggle .toggle-arrow { font-size: 10px; transition: transform 0.3s ease; }
        .pressure-glossary-toggle.open .toggle-arrow { transform: rotate(180deg); }
        .pressure-glossary-body { max-height: 0; overflow: hidden; transition: max-height 0.4s ease; margin-top: 0; }
        .pressure-glossary-body.open { max-height: 2000px; margin-top: 16px; }
        .pressure-glossary-section { margin-bottom: 20px; }
        .pressure-glossary-section h4 {
            font-size: 14px; font-weight: 700; color: var(--accent);
            margin-bottom: 10px; padding-bottom: 6px; border-bottom: 1px solid var(--border);
        }
        .pressure-glossary-table {
            width: 100%; border-collapse: collapse; font-size: 12px;
        }
        .pressure-glossary-table th {
            text-align: left; padding: 6px 10px; background: var(--bg-tertiary);
            color: var(--text-secondary); font-weight: 600; font-size: 10px;
            text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid var(--border);
        }
        .pressure-glossary-table td {
            padding: 6px 10px; color: var(--text-secondary);
            border-bottom: 1px solid var(--glass-border); vertical-align: top; line-height: 1.5;
        }
        .pressure-glossary-table tr:last-child td { border-bottom: none; }
        .pressure-glossary-table .band-tag {
            font-weight: 700; color: var(--text-primary); font-family: 'Inter', sans-serif; font-size: 11px;
        }
        .pressure-glossary-note { font-size: 11px; color: var(--text-tertiary); line-height: 1.6; margin-top: 8px; }

        /* Methodology & Conditions collapsible */
        .pressure-methodology-toggle {
            display: flex; align-items: center; justify-content: center; gap: 8px;
            margin-bottom: 20px; padding: 10px 20px;
            background: var(--bg-tertiary); border: 1px solid var(--border);
            border-radius: 10px; color: var(--text-secondary);
            font-size: 13px; font-weight: 600; cursor: pointer;
            transition: all 0.2s ease; user-select: none; width: 100%;
        }
        .pressure-methodology-toggle:hover { background: var(--bg-elevated); color: var(--text-primary); border-color: var(--accent); }
        .pressure-methodology-toggle .toggle-arrow { font-size: 10px; transition: transform 0.3s ease; }
        .pressure-methodology-toggle.open .toggle-arrow { transform: rotate(180deg); }
        .pressure-methodology-body { max-height: 0; overflow: hidden; transition: max-height 0.4s ease; margin-top: 0; }
        .pressure-methodology-body.open { max-height: 5000px; margin-top: 16px; margin-bottom: 20px; }
        .pressure-methodology-body .meth-section { margin-bottom: 16px; }
        .pressure-methodology-body .meth-section h4 {
            font-size: 13px; font-weight: 700; color: var(--accent);
            margin-bottom: 8px; padding-bottom: 4px; border-bottom: 1px solid var(--border);
        }
        .pressure-methodology-body .meth-section p,
        .pressure-methodology-body .meth-section li {
            font-size: 12px; color: var(--text-secondary); line-height: 1.6; margin: 0;
        }
        .pressure-methodology-body .meth-section ul {
            margin: 4px 0 0 16px; padding: 0; list-style: disc;
        }
        .pressure-methodology-body .meth-section code {
            font-family: 'JetBrains Mono', monospace; font-size: 11px;
            background: var(--bg-tertiary); padding: 1px 5px; border-radius: 4px;
            color: var(--accent);
        }
        .pressure-methodology-body .meth-table {
            width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 6px;
        }
        .pressure-methodology-body .meth-table th {
            text-align: left; padding: 5px 10px; background: var(--bg-tertiary);
            color: var(--text-secondary); font-weight: 600; font-size: 10px;
            text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid var(--border);
        }
        .pressure-methodology-body .meth-table td {
            padding: 5px 10px; color: var(--text-secondary);
            border-bottom: 1px solid var(--glass-border); vertical-align: top; line-height: 1.5;
        }
        .pressure-methodology-body .meth-table tr:last-child td { border-bottom: none; }
        .pressure-methodology-body .meth-table .meth-label {
            font-weight: 700; color: var(--text-primary); font-family: 'Inter', sans-serif; font-size: 11px;
            white-space: nowrap;
        }

        /* Filter bar and pill toggle buttons */
        .pressure-filter-bar {
            display: flex; flex-wrap: wrap; gap: 16px; align-items: center;
            margin-bottom: 20px; padding: 14px 18px;
            background: var(--bg-secondary); border: 1px solid var(--border);
            border-radius: 12px;
        }
        .pressure-filter-group {
            display: flex; align-items: center; gap: 6px;
        }
        .pressure-filter-group-label {
            font-size: 10px; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.5px; color: var(--text-tertiary); margin-right: 4px;
            white-space: nowrap;
        }
        .pressure-pill {
            display: inline-block; padding: 5px 12px; border-radius: 20px;
            font-size: 11px; font-weight: 600; cursor: pointer;
            background: var(--bg-tertiary); color: var(--text-secondary);
            border: 1px solid var(--border); transition: all 0.2s ease;
            user-select: none; white-space: nowrap;
        }
        .pressure-pill:hover {
            border-color: var(--accent); color: var(--text-primary);
        }
        .pressure-pill.active {
            background: var(--accent); color: white;
            border-color: var(--accent);
        }

        /* Dimmed card when player lacks selected band */
        .pressure-player-card.pressure-dimmed {
            opacity: 0.35; pointer-events: none;
        }

        /* Phase comparison color indicators in detail panel */
        .pressure-phase-comparison {
            font-size: 10px; font-weight: 700; margin-top: 4px;
            padding: 2px 8px; border-radius: 4px; display: inline-block;
        }
        .pressure-phase-comparison.improved { color: var(--accent-green); background: rgba(48, 209, 88, 0.12); }
        .pressure-phase-comparison.declined { color: var(--accent-red); background: rgba(255, 69, 58, 0.12); }

        /* Prominent qualification note */
        .pressure-qual-note-prominent {
            display: block; font-size: 12px; font-weight: 700;
            color: var(--text-secondary); margin-top: 2px;
        }
        .pressure-qual-note-prominent span {
            background: var(--bg-tertiary); padding: 2px 8px;
            border-radius: 4px; font-size: 11px;
        }

        /* Prominent ball count in summary */
        .pressure-balls-prominent {
            display: inline-block; padding: 1px 6px; border-radius: 4px;
            background: var(--bg-tertiary); font-size: 11px; font-weight: 700;
            color: var(--text-secondary); margin-left: 4px;
        }

        /* Filtered phase stat display on card */
        .pressure-filtered-stat {
            text-align: right; flex-shrink: 0;
        }
        .pressure-filtered-stat .pressure-stat-value { font-size: 15px; }
        .pressure-filtered-stat .pressure-stat-label { font-size: 9px; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.3px; }

        /* Pressure Table (TKT-050 redesign) */
        .pressure-table-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .pressure-roster-table {
            width: 100%; border-collapse: collapse; font-size: 12px;
        }
        .pressure-roster-table thead { position: sticky; top: 0; z-index: 10; }
        .pressure-roster-table th {
            background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-elevated) 100%);
            padding: 10px 6px; text-align: left; font-weight: 700;
            font-size: 9px; text-transform: uppercase; letter-spacing: 0.5px;
            color: var(--text-secondary); border-bottom: 2px solid var(--accent);
            cursor: pointer; user-select: none; white-space: nowrap;
        }
        .pressure-roster-table th:first-child { border-radius: 8px 0 0 0; }
        .pressure-roster-table th:last-child { border-radius: 0 8px 0 0; }
        .pressure-roster-table th:hover { color: var(--accent); }
        .pressure-roster-table th .sort-arrow {
            display: inline-block; margin-left: 3px; font-size: 8px;
            color: var(--text-tertiary); transition: color 0.15s;
        }
        .pressure-roster-table th.sorted-asc .sort-arrow,
        .pressure-roster-table th.sorted-desc .sort-arrow { color: var(--accent); }
        .pressure-roster-table td {
            padding: 8px 6px; border-bottom: 1px solid var(--border);
            transition: background 0.2s ease;
        }
        .pressure-roster-table tr.pressure-data-row { cursor: pointer; }
        .pressure-roster-table tr.pressure-data-row:hover td { background: var(--glass); }
        .pressure-roster-table tr:nth-child(4n+1).pressure-data-row td {
            background: rgba(255, 255, 255, 0.02);
        }
        .pressure-roster-table tr:nth-child(4n+1).pressure-data-row:hover td {
            background: var(--glass);
        }
        .pressure-roster-table tr.pressure-data-row.pressure-dimmed td { opacity: 0.35; }
        .pressure-roster-table .player-name-text { font-weight: 600; font-size: 13px; }

        /* Pressure table role badge */
        .pressure-role-badge {
            display: inline-block; padding: 2px 6px; border-radius: 4px;
            font-size: 9px; font-weight: 700; text-transform: uppercase;
        }
        .pressure-role-badge.role-bat { background: rgba(48, 209, 88, 0.15); color: var(--accent-green); }
        .pressure-role-badge.role-bowl { background: rgba(255, 69, 58, 0.15); color: var(--accent-red); }

        /* Expandable detail row in pressure table */
        .pressure-detail-row { display: none; }
        .pressure-detail-row.expanded { display: table-row; }
        .pressure-detail-row td {
            padding: 0 !important; border-bottom: 1px solid var(--border);
        }
        .pressure-detail-content {
            padding: 12px 16px; display: flex; flex-direction: column; gap: 12px;
            background: var(--bg-tertiary); border-left: 3px solid var(--accent);
        }

        /* Pressure table search/filter bar */
        .pressure-search-filter-bar {
            display: flex; align-items: center; gap: 12px; margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .pressure-search-box input {
            background: var(--bg-tertiary); border: 1px solid var(--border);
            border-radius: 8px; padding: 8px 12px; color: var(--text-primary);
            font-size: 13px; width: 200px; outline: none;
        }
        .pressure-search-box input:focus { border-color: var(--accent); }
        .pressure-role-filter {
            display: flex; gap: 6px; align-items: center;
        }
        .pressure-table-count {
            font-size: 12px; color: var(--text-tertiary); margin-left: auto;
        }

        @media (max-width: 768px) {
            .pressure-summary-grid { grid-template-columns: repeat(2, 1fr); }
            .pressure-summary-table { font-size: 12px; }
            .pressure-summary-table thead th { padding: 8px 10px; font-size: 10px; }
            .pressure-summary-table tbody td { padding: 10px; }
            .pressure-summary-table .table-count { font-size: 16px; }
            .pressure-columns { grid-template-columns: 1fr; }
            .pressure-phase-grid { grid-template-columns: 1fr; }
            .pressure-glossary-table { font-size: 11px; }
            .pressure-glossary-table th, .pressure-glossary-table td { padding: 5px 6px; }
            .pressure-glossary-section { overflow-x: auto; -webkit-overflow-scrolling: touch; }
            .pressure-band-table { font-size: 10px; }
            .pressure-player-summary { gap: 8px; padding: 10px 12px; }
            .pressure-filter-bar { gap: 10px; padding: 10px 12px; }
            .pressure-filter-group { flex-wrap: wrap; }
            .pressure-roster-table { font-size: 11px; min-width: 700px; }
            .pressure-roster-table th, .pressure-roster-table td { padding: 8px 4px; }
            .pressure-search-box input { width: 140px; }
            .pressure-search-filter-bar { gap: 8px; }
        }

        /* Prevent horizontal overflow */
        html, body { overflow-x: hidden; max-width: 100vw; }

        /* Touch target minimum sizes (WCAG 44x44px) */
        .mobile-nav a { min-height: 44px; display: flex; align-items: center; }
        .theme-toggle { min-width: 44px; min-height: 44px; }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    <div class="bg-grid"></div>
    <div class="loading-overlay" id="loading"><div class="loading-spinner"></div></div>

    <nav class="nav">
        <div class="nav-brand">
            <div class="nav-logo">ðŸ</div>
            <div class="nav-title">Cricket <span>Playbook</span></div>
        </div>
        <div class="nav-tabs">
            <a href="index.html" class="nav-tab">Home</a>
            <a href="teams.html" class="nav-tab active">Teams</a>
            <a href="artifacts.html" class="nav-tab">Artifacts</a>
            <a href="analysis.html" class="nav-tab">Analysis</a>
            <a href="research.html" class="nav-tab">Research</a>
            <a href="research-desk.html" class="nav-tab">The Film Room</a>
            <a href="about.html" class="nav-tab">About</a>
        </div>
        <div class="nav-actions">
            <span class="nav-time" id="navTime">--:--:--</span>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">â˜°</button>
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">ðŸŒ™</button>
        </div>
    </nav>

    <div class="mobile-nav" id="mobile-nav">
        <a href="index.html">Home</a>
        <a href="teams.html" class="active">Teams</a>
        <a href="artifacts.html">Artifacts</a>
        <a href="analysis.html">Analysis</a>
        <a href="research.html">Research</a>
        <a href="research-desk.html">The Film Room</a>
        <a href="about.html">About</a>
    </div>

    <main class="main">
        <!-- Page Title with Typewriter -->
        <div class="typewriter-container">
            <h1 class="typewriter-title">IPL 2026 Teams</h1>
        </div>

        <!-- Team Selector -->
        <div class="team-selector" id="team-selector">
            <!-- Populated by JS -->
        </div>

        <!-- Team Header -->
        <section class="team-header-section">
            <div class="team-header-card" id="team-header">
                <!-- Populated by JS -->
            </div>
        </section>

        <!-- Content Tabs -->
        <div class="content-tabs">
            <button class="content-tab active" data-tab="xi">Predicted XI</button>
            <button class="content-tab" data-tab="squad">Full Squad</button>
            <button class="content-tab" data-tab="depth">Depth Chart</button>
            <button class="content-tab" data-tab="balance">Strategy Outlook</button>
            <button class="content-tab" data-tab="pressure">Pressure</button>
            <button class="content-tab" data-tab="compare">âš”ï¸ Compare</button>
        </div>

        <!-- Content Panels -->
        <div class="content-panel">
            <div class="panel active" id="panel-xi">
                <div class="xi-grid" id="xi-grid"></div>
                <div class="impact-player" id="impact-player"></div>
            </div>
            <div class="panel" id="panel-squad">
                <div id="squad-content"></div>
            </div>
            <div class="panel" id="panel-depth">
                <div id="depth-content"></div>
            </div>
            <div class="panel" id="panel-balance">
                <div class="strategy-outlook" id="balance-content"></div>
            </div>
            <div class="panel" id="panel-pressure">
                <div id="pressure-content"></div>
            </div>
            <div class="panel" id="panel-compare">
                <div id="compare-content"></div>
            </div>
        </div>

        <div class="data-timestamp" id="data-timestamp">
            ðŸ“Š Data last updated: February 5, 2026 â€¢ Source: Cricsheet ball-by-ball data (2023-2025)
        </div>
    </main>

    <script src="data/teams.js"></script>
    <script src="data/predicted_xii.js"></script>
    <script src="data/depth_charts.js"></script>
    <script src="data/full_squads.js"></script>
    <script src="data/pressure_metrics.js"></script>
    <script src="data/venue_data.js"></script>
    <script src="data/historic_trends.js"></script>
    <script src="data/momentum_insights.js"></script>
    <script src="data/player_profiles.js"></script>

    <script>
        // Pixelated Team Logos (8x8 grid style)
        const TEAM_PIXEL_LOGOS = {
            MI: `<svg viewBox="0 0 8 8" class="pixel-logo"><rect fill="#004ba0" width="8" height="8"/><rect fill="#d4af37" x="2" y="1" width="1" height="5"/><rect fill="#d4af37" x="5" y="1" width="1" height="5"/><rect fill="#d4af37" x="3" y="2" width="1" height="1"/><rect fill="#d4af37" x="4" y="3" width="1" height="1"/><rect fill="#d4af37" x="3" y="4" width="1" height="1"/></svg>`,
            CSK: `<svg viewBox="0 0 8 8" class="pixel-logo"><rect fill="#ffc20e" width="8" height="8"/><rect fill="#0081e9" x="3" y="1" width="2" height="2"/><rect fill="#0081e9" x="2" y="3" width="4" height="1"/><rect fill="#0081e9" x="2" y="4" width="1" height="2"/><rect fill="#0081e9" x="5" y="4" width="1" height="2"/><rect fill="#0081e9" x="3" y="6" width="2" height="1"/></svg>`,
            RCB: `<svg viewBox="0 0 8 8" class="pixel-logo"><rect fill="#d4213d" width="8" height="8"/><rect fill="#000000" x="3" y="1" width="2" height="2"/><rect fill="#d4af37" x="2" y="3" width="4" height="1"/><rect fill="#d4af37" x="1" y="4" width="2" height="2"/><rect fill="#d4af37" x="5" y="4" width="2" height="2"/><rect fill="#000000" x="3" y="5" width="2" height="2"/></svg>`,
            KKR: `<svg viewBox="0 0 8 8" class="pixel-logo"><rect fill="#3a225d" width="8" height="8"/><rect fill="#d4af37" x="3" y="0" width="2" height="2"/><rect fill="#d4af37" x="2" y="2" width="4" height="1"/><rect fill="#d4af37" x="2" y="3" width="1" height="3"/><rect fill="#d4af37" x="5" y="3" width="1" height="3"/><rect fill="#d4af37" x="3" y="4" width="2" height="1"/><rect fill="#d4af37" x="3" y="6" width="2" height="2"/></svg>`,
            DC: `<svg viewBox="0 0 8 8" class="pixel-logo"><rect fill="#0078bc" width="8" height="8"/><rect fill="#ef1b23" x="2" y="1" width="4" height="1"/><rect fill="#ef1b23" x="1" y="2" width="2" height="2"/><rect fill="#ef1b23" x="5" y="2" width="2" height="2"/><rect fill="#ffffff" x="3" y="2" width="2" height="3"/><rect fill="#ef1b23" x="2" y="5" width="4" height="2"/></svg>`,
            PBKS: `<svg viewBox="0 0 8 8" class="pixel-logo"><rect fill="#ed1b24" width="8" height="8"/><rect fill="#a7a9ac" x="3" y="1" width="2" height="2"/><rect fill="#a7a9ac" x="2" y="3" width="4" height="1"/><rect fill="#a7a9ac" x="1" y="4" width="2" height="2"/><rect fill="#a7a9ac" x="5" y="4" width="2" height="2"/><rect fill="#a7a9ac" x="3" y="6" width="2" height="1"/></svg>`,
            RR: `<svg viewBox="0 0 8 8" class="pixel-logo"><rect fill="#ea1a85" width="8" height="8"/><rect fill="#254aa5" x="1" y="2" width="1" height="2"/><rect fill="#254aa5" x="6" y="2" width="1" height="2"/><rect fill="#d4af37" x="2" y="1" width="4" height="1"/><rect fill="#d4af37" x="2" y="2" width="1" height="1"/><rect fill="#d4af37" x="5" y="2" width="1" height="1"/><rect fill="#d4af37" x="3" y="3" width="2" height="1"/><rect fill="#254aa5" x="2" y="4" width="4" height="3"/></svg>`,
            SRH: `<svg viewBox="0 0 8 8" class="pixel-logo"><rect fill="#f7a721" width="8" height="8"/><rect fill="#000000" x="3" y="1" width="2" height="1"/><rect fill="#000000" x="2" y="2" width="4" height="2"/><rect fill="#f7a721" x="3" y="2" width="2" height="1"/><rect fill="#000000" x="1" y="4" width="2" height="3"/><rect fill="#000000" x="5" y="4" width="2" height="3"/><rect fill="#000000" x="3" y="6" width="2" height="1"/></svg>`,
            GT: `<svg viewBox="0 0 8 8" class="pixel-logo"><rect fill="#1c1c1c" width="8" height="8"/><rect fill="#d5a239" x="2" y="1" width="4" height="1"/><rect fill="#d5a239" x="1" y="2" width="6" height="1"/><rect fill="#d5a239" x="1" y="3" width="1" height="2"/><rect fill="#d5a239" x="6" y="3" width="1" height="2"/><rect fill="#d5a239" x="2" y="4" width="4" height="1"/><rect fill="#d5a239" x="3" y="5" width="2" height="2"/></svg>`,
            LSG: `<svg viewBox="0 0 8 8" class="pixel-logo"><rect fill="#a72056" width="8" height="8"/><rect fill="#ffcc00" x="2" y="1" width="4" height="1"/><rect fill="#ffcc00" x="1" y="2" width="2" height="2"/><rect fill="#ffcc00" x="5" y="2" width="2" height="2"/><rect fill="#ffcc00" x="3" y="3" width="2" height="1"/><rect fill="#ffcc00" x="2" y="4" width="4" height="1"/><rect fill="#00b7eb" x="3" y="5" width="2" height="2"/></svg>`
        };

        // Generate SQUADS from PREDICTED_XII if not loaded separately
        // Use FULL_SQUADS if available (Phil Steele style full roster)
        // Falls back to predicted XI if full data not loaded
        const SQUADS = {};
        if (typeof FULL_SQUADS !== 'undefined' && typeof TEAM_ORDER !== 'undefined') {
            // Use full squad data from CSV (20-25 players per team)
            TEAM_ORDER.forEach(abbrev => {
                const fullSquad = FULL_SQUADS[abbrev];
                if (fullSquad && fullSquad.length > 0) {
                    const players = fullSquad.map(p => ({
                        name: p.name,
                        playerId: p.playerId,
                        role: p.role,
                        batting: p.battingHand,
                        bowlingArm: p.bowlingArm,
                        bowlingType: p.bowlingType,
                        overseas: p.nationality !== 'IND',
                        nationality: p.nationality,
                        age: p.age,
                        batterClass: p.batterClass,
                        bowlerClass: p.bowlerClass,
                        batterTags: p.batterTags || [],
                        bowlerTags: p.bowlerTags || [],
                        isCaptain: p.isCaptain,
                        price: p.price || 0,
                        retainedStatus: p.acquisition || (p.retained ? 'Retained' : 'Auction'),
                        iplMatches: p.iplMatches || 0,
                        isUncapped: p.isUncapped || false
                    }));
                    // Sort: Captain first, then by role, then alphabetically
                    players.sort((a, b) => {
                        if (a.isCaptain && !b.isCaptain) return -1;
                        if (!a.isCaptain && b.isCaptain) return 1;
                        const roleOrder = {'Batter': 1, 'Wicketkeeper': 2, 'All-rounder': 3, 'Bowler': 4};
                        return (roleOrder[a.role] || 5) - (roleOrder[b.role] || 5);
                    });
                    const totalSpent = players.reduce((sum, p) => sum + (p.price || 0), 0);
                    SQUADS[abbrev] = {
                        squad: players,
                        purseSpent: totalSpent,
                        purseRemaining: 120 - totalSpent
                    };
                }
            });
        } else if (typeof TEAM_ORDER !== 'undefined' && typeof PREDICTED_XII !== 'undefined') {
            // Fallback to predicted XI only
            TEAM_ORDER.forEach(abbrev => {
                const predicted = PREDICTED_XII[abbrev];
                if (predicted && predicted.xi) {
                    const players = predicted.xi.map(p => ({
                        name: p.name,
                        role: p.role,
                        batting: p.batting || 'Unknown',
                        overseas: p.overseas,
                        price: p.price,
                        nationality: p.overseas ? 'Overseas' : 'IND',
                        age: 28,
                        retainedStatus: p.price > 10 ? 'Retained' : 'Auction'
                    }));
                    if (predicted.impactPlayer && predicted.impactPlayer.name) {
                        players.push({
                            name: predicted.impactPlayer.name,
                            role: predicted.impactPlayer.role || 'All-rounder',
                            batting: 'Unknown',
                            overseas: false,
                            price: predicted.impactPlayer.price,
                            nationality: 'IND',
                            age: 25,
                            retainedStatus: 'Auction',
                            isImpact: true
                        });
                    }
                    const totalSpent = players.reduce((sum, p) => sum + p.price, 0);
                    SQUADS[abbrev] = {
                        squad: players,
                        purseSpent: totalSpent,
                        purseRemaining: 120 - totalSpent
                    };
                }
            });
        }

        let currentTeam = 'MI';
        let compareTeam = 'CSK';
        let squadFilters = { search: '', role: '', nationality: '', ageGroup: '' };
        let pressureFilters = { phase: 'all', band: 'all', entry: 'all' };

        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            document.querySelector('.theme-toggle').textContent = newTheme === 'dark' ? 'ðŸŒ™' : 'â˜€ï¸';
        }

        function toggleMobileMenu() {
            const nav = document.getElementById('mobile-nav');
            nav.classList.toggle('active');
        }

        function showLoading() {
            document.getElementById('loading').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loading').classList.remove('active');
        }

        const savedTheme = localStorage.getItem('theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);

        function populateTeamSelector() {
            const selector = document.getElementById('team-selector');
            selector.innerHTML = '';
            TEAM_ORDER.forEach(abbrev => {
                const team = TEAMS[abbrev];
                const pixelLogo = TEAM_PIXEL_LOGOS[abbrev] || team.icon;
                const btn = document.createElement('button');
                btn.className = `team-btn ${abbrev === currentTeam ? 'active' : ''}`;
                btn.innerHTML = `${pixelLogo}<span>${abbrev}</span>`;
                btn.onclick = () => selectTeam(abbrev);
                selector.appendChild(btn);
            });
        }

        function selectTeam(abbrev) {
            currentTeam = abbrev;
            // Reset filters when switching teams
            squadFilters = { search: '', role: '', nationality: '', ageGroup: '' };
            // Update compare team if it's the same as current
            if (compareTeam === abbrev) {
                compareTeam = TEAM_ORDER.find(t => t !== abbrev) || 'CSK';
            }
            document.querySelectorAll('.team-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent === abbrev);
            });
            renderTeam();
            // Re-render compare if that tab is active
            if (document.getElementById('panel-compare').classList.contains('active')) {
                renderCompareView();
            }
            history.pushState(null, '', `?team=${abbrev}`);
        }

        function renderTeam() {
            const team = TEAMS[currentTeam];
            const predicted = PREDICTED_XII[currentTeam];
            const rating = DEPTH_CHART_RATINGS[currentTeam];
            const squadData = SQUADS[currentTeam];

            // Header with coach and reigning badge
            const header = document.getElementById('team-header');
            header.style.setProperty('--team-color', team.primaryColor);
            const reigningBadge = team.reigning ? '<span class="reigning-badge">ðŸ†<span class="badge-text"> Defending Champions</span></span>' : '';
            const headerPixelLogo = TEAM_PIXEL_LOGOS[currentTeam] || team.icon;
            header.innerHTML = `
                <div class="team-header-content">
                    <div class="team-badge">${headerPixelLogo}</div>
                    <div class="team-header-info">
                        <h1>${team.fullName} ${reigningBadge}</h1>
                        <p>IPL 2026 â€¢ ${team.homeVenue}</p>
                        <div class="team-meta">
                            <div class="meta-item">ðŸ† <strong>${team.titles}x</strong> Champions</div>
                            <div class="meta-item">ðŸ‘‘ Captain: <strong>${predicted.captain}</strong></div>
                            <div class="meta-item">ðŸŽ¯ Coach: <strong>${team.coach}</strong></div>
                            <div class="meta-item">â­ Rating: <strong>${rating.overall}</strong></div>
                        </div>
                        <div style="margin-top: 12px;">
                            <a href="https://github.com/dwijesh-r/cricket-playbook/blob/main/stat_packs/${currentTeam}/${currentTeam}_stat_pack.md"
                               target="_blank"
                               style="display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; background: var(--accent); color: white; border-radius: 8px; text-decoration: none; font-size: 13px; font-weight: 600; transition: all 0.2s ease;">
                                ðŸ“Š View Full Stat Pack
                                <span style="font-size: 10px; opacity: 0.8;">â†—</span>
                            </a>
                        </div>
                    </div>
                </div>
            `;

            // Phil Steele Style Squad Table
            renderSquadTable(team, squadData);

            // Predicted XI
            const xiGrid = document.getElementById('xi-grid');
            xiGrid.innerHTML = '';
            predicted.xi.forEach(player => {
                const card = document.createElement('div');
                card.className = 'player-card';
                card.innerHTML = `
                    <div class="player-position">${player.position}</div>
                    <div class="player-info">
                        <div class="player-name player-clickable" onclick="openPlayerProfile('${player.name.replace(/'/g, "\\\\'")}')">${player.name}</div>
                        <div class="player-role">${player.role} â€¢ ${player.batting}</div>
                    </div>
                    <div class="player-meta">
                        <div class="player-price">â‚¹${player.price} Cr</div>
                        ${player.overseas ? '<div class="player-overseas">ðŸŒ Overseas</div>' : ''}
                    </div>
                `;
                xiGrid.appendChild(card);
            });

            // Impact Player
            const impact = document.getElementById('impact-player');
            impact.innerHTML = `
                <div class="impact-badge">âš¡ IMPACT</div>
                <div class="player-info">
                    <div class="player-name player-clickable" onclick="openPlayerProfile('${predicted.impactPlayer.name.replace(/'/g, "\\\\'")}')">${predicted.impactPlayer.name}</div>
                    <div class="player-role">${predicted.impactPlayer.role}</div>
                </div>
                <div class="player-meta">
                    <div class="player-price">â‚¹${predicted.impactPlayer.price} Cr</div>
                </div>
            `;

            // ========== STRATEGY OUTLOOK (Kevin De Bruyne Redesign) ==========
            const balance = predicted.balance;
            const balanceContent = document.getElementById('balance-content');
            const xi = predicted.xi || [];
            const squad = FULL_SQUADS[currentTeam] || [];
            const xiNames = new Set(xi.map(p => p.name));
            const xiSquadData = squad.filter(p => xiNames.has(p.name));
            const depthData = typeof FULL_DEPTH_CHARTS !== 'undefined' ? FULL_DEPTH_CHARTS[currentTeam] : null;

            // --- Phase Coverage (Bowling) ---
            const ppBowlers = xiSquadData.filter(p =>
                (p.bowlerTags || []).some(t => t.includes('PP_') || t === 'NEW_BALL_SPECIALIST') ||
                (p.bowlerClass || '') === 'Powerplay Assassin'
            );
            const midBowlers = xiSquadData.filter(p =>
                ['Middle-Overs Spinner', 'Holding Spinner'].includes(p.bowlerClass || '') ||
                (p.bowlerTags || []).some(t => t.includes('MIDDLE') || t === 'WORKHORSE')
            );
            const deathBowlers = xiSquadData.filter(p =>
                (p.bowlerTags || []).some(t => t.includes('DEATH'))
            );
            const phaseClass = (count) => count >= 3 ? 'strong' : count >= 2 ? 'adequate' : 'thin';
            const phaseLabel = (count) => count >= 3 ? 'Strong' : count >= 2 ? 'Adequate' : 'Thin';

            // --- Batting Depth ---
            const canBat = xiSquadData.filter(p => p.batterClass && p.batterClass !== '-').length;
            const canBatClass = canBat >= 7 ? 'strong' : canBat >= 5 ? 'adequate' : 'thin';
            const finishers = xiSquadData.filter(p => (p.batterTags || []).some(t => t.includes('FINISHER') || t.includes('DEATH'))).length;
            const finishersClass = finishers >= 3 ? 'strong' : finishers >= 2 ? 'adequate' : 'thin';
            const sixHitters = xiSquadData.filter(p => (p.batterTags || []).some(t => t.includes('SIX_HITTER'))).length;

            // --- Key Player Dependency ---
            const totalXIPrice = xi.reduce((s, p) => s + (p.price || 0), 0);
            const sortedByPrice = [...xi].sort((a, b) => b.price - a.price);
            const top3Price = sortedByPrice.slice(0, 3).reduce((s, p) => s + p.price, 0);
            const top3Pct = totalXIPrice > 0 ? ((top3Price / totalXIPrice) * 100).toFixed(0) : 0;
            const top3Names = sortedByPrice.slice(0, 3).map(p => p.name.split(' ').pop()).join(', ');
            const dependencyClass = top3Pct >= 55 ? 'thin' : top3Pct >= 45 ? 'adequate' : 'strong';
            const dependencyLabel = top3Pct >= 55 ? 'High Risk' : top3Pct >= 45 ? 'Moderate' : 'Distributed';

            // --- Full Roster Age Profile ---
            const rosterAges = squad.map(p => parseInt(p.age) || 0).filter(a => a > 0);
            const medianAge = rosterAges.length > 0 ? rosterAges.sort((a,b) => a-b)[Math.floor(rosterAges.length/2)] : 0;
            const xiiAges = xiSquadData.map(p => parseInt(p.age) || 0).filter(a => a > 0);
            const xiiMedian = xiiAges.length > 0 ? xiiAges.sort((a,b) => a-b)[Math.floor(xiiAges.length/2)] : 0;
            const u23 = rosterAges.filter(a => a < 23).length;
            const prime = rosterAges.filter(a => a >= 23 && a <= 28).length;
            const experienced = rosterAges.filter(a => a >= 29 && a <= 32).length;
            const veteran = rosterAges.filter(a => a >= 33).length;
            const totalAge = rosterAges.length || 1;
            const u23Pct = ((u23 / totalAge) * 100).toFixed(0);
            const primePct = ((prime / totalAge) * 100).toFixed(0);
            const expPct = ((experienced / totalAge) * 100).toFixed(0);
            const vetPct = ((veteran / totalAge) * 100).toFixed(0);
            const veterans50Plus = squad.filter(p => (p.iplMatches || 0) >= 50).length;
            const uncappedCount = squad.filter(p => p.isUncapped).length;

            // --- Venue Alignment ---
            const venueBias = team.venueBias || 'neutral';
            const spinCount = balance.spinners || 0;
            const paceCount = balance.pacers || 0;

            // --- Overseas Flexibility ---
            const overseasInXI = xi.filter(p => p.overseas);
            const overseasInSquad = squad.filter(p => p.nationality !== 'IND');
            const overseasBench = overseasInSquad.filter(p => !xiNames.has(p.name));
            const overseasBenchClass = overseasBench.length >= 4 ? 'strong' : overseasBench.length >= 2 ? 'adequate' : 'thin';

            // --- Vulnerabilities from Depth Chart ---
            const vulns = depthData && depthData.vulnerabilities ? depthData.vulnerabilities : [];

            // --- Venue Data (new data source) ---
            let venueData = null;
            if (typeof VENUE_DATA !== 'undefined' && VENUE_DATA.venueProfiles && VENUE_DATA.venueProfiles[currentTeam]) {
                const vp = VENUE_DATA.venueProfiles[currentTeam];
                const pp = vp.phases && vp.phases.powerplay;
                const mid = vp.phases && vp.phases.middle;
                const dth = vp.phases && vp.phases.death;
                const avgRR = (phase) => phase ? ((phase.battingFirst.runRate + phase.chasing.runRate) / 2).toFixed(2) : '-';
                const avgBdry = (phase) => phase ? ((phase.battingFirst.boundaryPct + phase.chasing.boundaryPct) / 2).toFixed(1) : '-';
                const avgDot = (phase) => phase ? ((phase.battingFirst.dotPct + phase.chasing.dotPct) / 2).toFixed(1) : '-';
                venueData = {
                    homeVenue: {
                        name: vp.venueName,
                        character: vp.character,
                        avgFirstInningsScore: vp.avgFirstInningsScore,
                        chaseFriendly: vp.chaseFriendly,
                        chaseWinPct: vp.chaseWinPct,
                        ppRunRate: avgRR(pp),
                        middleRunRate: avgRR(mid),
                        deathRunRate: avgRR(dth),
                        ppBoundaryPct: avgBdry(pp),
                        middleDotPct: avgDot(mid),
                        deathBoundaryPct: avgBdry(dth)
                    },
                    records: (VENUE_DATA.teamVenueRecords && VENUE_DATA.teamVenueRecords[currentTeam]) || []
                };
            }

            // --- Historic Trends (new data source) ---
            let historicData = null;
            if (typeof HISTORIC_TRENDS !== 'undefined' && HISTORIC_TRENDS.seasonRecords && HISTORIC_TRENDS.seasonRecords[currentTeam]) {
                const seasons = HISTORIC_TRENDS.seasonRecords[currentTeam].map(s => ({
                    year: s.season, matches: s.matches, wins: s.wins, losses: s.losses, winPct: s.winPct, position: s.position
                }));
                let phaseTrends = null;
                const pt = HISTORIC_TRENDS.phaseTrends && HISTORIC_TRENDS.phaseTrends[currentTeam];
                if (pt && pt.batting && pt.bowling) {
                    const battingSR = { Powerplay: {}, Middle: {}, Death: {} };
                    const bowlingEcon = { Powerplay: {}, Middle: {}, Death: {} };
                    pt.batting.forEach(b => {
                        battingSR.Powerplay[b.season] = b.powerplaySR;
                        battingSR.Middle[b.season] = b.middleSR;
                        battingSR.Death[b.season] = b.deathSR;
                    });
                    pt.bowling.forEach(b => {
                        bowlingEcon.Powerplay[b.season] = b.powerplayEcon;
                        bowlingEcon.Middle[b.season] = b.middleEcon;
                        bowlingEcon.Death[b.season] = b.deathEcon;
                    });
                    phaseTrends = { battingSR, bowlingEcon };
                }
                historicData = { seasons, phaseTrends };
            }

            // ===== Build Section 1: Team Composition Scorecard =====
            let section1HTML = `
            <div class="strategy-section">
                <div class="strategy-section-header">
                    <div class="strategy-section-title">Team Composition Scorecard</div>
                    <span class="strategy-section-badge" style="background: rgba(10, 132, 255, 0.15); color: var(--accent);">XI Analysis</span>
                </div>

                <!-- Phase Coverage -->
                <div class="phase-coverage-grid">
                    <div class="phase-card ${phaseClass(ppBowlers.length)}">
                        <div class="phase-card-label">Powerplay</div>
                        <div class="phase-card-count ${phaseClass(ppBowlers.length)}">${ppBowlers.length}</div>
                        <div class="phase-card-status ${phaseClass(ppBowlers.length)}">${phaseLabel(ppBowlers.length)}</div>
                        <div class="phase-card-names">${ppBowlers.map(p => p.name.split(' ').pop()).join(', ') || 'None tagged'}</div>
                    </div>
                    <div class="phase-card ${phaseClass(midBowlers.length)}">
                        <div class="phase-card-label">Middle Overs</div>
                        <div class="phase-card-count ${phaseClass(midBowlers.length)}">${midBowlers.length}</div>
                        <div class="phase-card-status ${phaseClass(midBowlers.length)}">${phaseLabel(midBowlers.length)}</div>
                        <div class="phase-card-names">${midBowlers.map(p => p.name.split(' ').pop()).join(', ') || 'None tagged'}</div>
                    </div>
                    <div class="phase-card ${phaseClass(deathBowlers.length)}">
                        <div class="phase-card-label">Death Overs</div>
                        <div class="phase-card-count ${phaseClass(deathBowlers.length)}">${deathBowlers.length}</div>
                        <div class="phase-card-status ${phaseClass(deathBowlers.length)}">${phaseLabel(deathBowlers.length)}</div>
                        <div class="phase-card-names">${deathBowlers.map(p => p.name.split(' ').pop()).join(', ') || 'None tagged'}</div>
                    </div>
                </div>

                <!-- Compact Metrics Row -->
                <div class="metric-row" style="margin-top: 16px;">
                    <div class="metric-item">
                        <div class="metric-value phase-card-count ${canBatClass}">${canBat}</div>
                        <div class="metric-label">Can Bat</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value phase-card-count ${finishersClass}">${finishers}</div>
                        <div class="metric-label">Finishers</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value" style="color: var(--accent);">${sixHitters}</div>
                        <div class="metric-label">Six Hitters</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value phase-card-count ${dependencyClass}">${top3Pct}%</div>
                        <div class="metric-label">Star Dependency</div>
                        <div class="metric-note phase-card-status ${dependencyClass}">${dependencyLabel}</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value" style="color: var(--accent-orange);">${overseasInXI.length}/4</div>
                        <div class="metric-label">Overseas Slots</div>
                        <div class="metric-note phase-card-count ${overseasBenchClass}">${overseasBench.length} bench</div>
                    </div>
                </div>

                <!-- Age Profile Bar -->
                <div class="metric-item" style="margin-top: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 4px;">
                        <div class="metric-label" style="margin-top: 0;">Roster Age Profile</div>
                        <div style="font-size: 14px; font-weight: 700; color: var(--accent);">${medianAge} <span style="font-size: 10px; font-weight: 400; color: var(--text-tertiary);">roster median</span> <span style="font-size: 12px; font-weight: 600; color: var(--text-secondary); margin-left: 8px;">${xiiMedian} <span style="font-size: 10px; font-weight: 400; color: var(--text-tertiary);">XII</span></span></div>
                    </div>
                    <div class="age-profile-bar">
                        <div class="age-segment" style="width: ${u23Pct}%; background: var(--accent-green);"></div>
                        <div class="age-segment" style="width: ${primePct}%; background: var(--accent);"></div>
                        <div class="age-segment" style="width: ${expPct}%; background: var(--accent-yellow);"></div>
                        <div class="age-segment" style="width: ${vetPct}%; background: var(--accent-orange);"></div>
                    </div>
                    <div class="age-legend">
                        <span><span class="age-legend-dot" style="background: var(--accent-green);"></span>U-23 (${u23})</span>
                        <span><span class="age-legend-dot" style="background: var(--accent);"></span>23-28 (${prime})</span>
                        <span><span class="age-legend-dot" style="background: var(--accent-yellow);"></span>29-32 (${experienced})</span>
                        <span><span class="age-legend-dot" style="background: var(--accent-orange);"></span>33+ (${veteran})</span>
                    </div>
                    <div style="font-size: 10px; color: var(--text-tertiary); text-align: center; margin-top: 6px;">${veterans50Plus} IPL veterans (50+ caps) &middot; ${uncappedCount} uncapped</div>
                </div>
            </div>`;

            // ===== Build Section 2: Home Venue Intelligence =====
            let section2HTML = '';
            if (venueData) {
                const homeVenue = venueData.homeVenue || {};
                const venueCharacter = (homeVenue.character || venueBias || 'balanced').toLowerCase();
                const charClass = venueCharacter === 'pace' ? 'pace' : venueCharacter === 'spin' ? 'spin' : 'balanced';
                const venueRecords = (venueData.records || []).slice(0, 5);

                let ppRR = homeVenue.ppRunRate || '-';
                let midRR = homeVenue.middleRunRate || '-';
                let deathRR = homeVenue.deathRunRate || '-';
                let ppBdry = homeVenue.ppBoundaryPct || '-';
                let midDot = homeVenue.middleDotPct || '-';
                let deathBdry = homeVenue.deathBoundaryPct || '-';

                let recordsHTML = '';
                if (venueRecords.length > 0) {
                    recordsHTML = `
                    <table class="venue-records-table">
                        <thead>
                            <tr>
                                <th>Venue</th>
                                <th>Mat</th>
                                <th>W-L</th>
                                <th>Win%</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${venueRecords.map(r => {
                                const winPct = r.winPct || (r.matches > 0 ? ((r.wins / r.matches) * 100).toFixed(0) : 0);
                                const barColor = winPct >= 60 ? 'var(--accent-green)' : winPct >= 45 ? 'var(--accent-yellow)' : 'var(--accent-red)';
                                return `<tr>
                                    <td>${r.venue || r.name || '-'}</td>
                                    <td>${r.matches || '-'}</td>
                                    <td>${r.wins || 0}-${r.losses || 0}</td>
                                    <td>
                                        ${winPct}%
                                        <div class="win-pct-bar"><div class="win-pct-fill" style="width: ${winPct}%; background: ${barColor};"></div></div>
                                    </td>
                                </tr>`;
                            }).join('')}
                        </tbody>
                    </table>`;
                }

                section2HTML = `
                <div class="strategy-section">
                    <div class="strategy-section-header">
                        <div class="strategy-section-title">Home Venue Intelligence</div>
                        <span class="strategy-section-badge" style="background: rgba(191, 90, 242, 0.15); color: var(--accent-purple);">Venue</span>
                    </div>

                    <div class="venue-profile">
                        <div class="venue-header">
                            <div class="venue-name">${homeVenue.name || team.homeVenue || 'Home Venue'}</div>
                            <div>
                                <span class="venue-character ${charClass}">${venueCharacter}</span>
                                <span style="font-size: 10px; color: var(--text-tertiary); margin-left: 8px;">${spinCount} spin &middot; ${paceCount} pace</span>
                            </div>
                        </div>

                        <div class="venue-phase-grid">
                            <div class="venue-phase-card">
                                <div class="venue-phase-label">Powerplay RR</div>
                                <div class="venue-phase-stat">${ppRR}</div>
                                <div class="venue-phase-sub">${ppBdry}${ppBdry !== '-' ? '% boundary' : ''}</div>
                            </div>
                            <div class="venue-phase-card">
                                <div class="venue-phase-label">Middle RR</div>
                                <div class="venue-phase-stat">${midRR}</div>
                                <div class="venue-phase-sub">${midDot}${midDot !== '-' ? '% dots' : ''}</div>
                            </div>
                            <div class="venue-phase-card">
                                <div class="venue-phase-label">Death RR</div>
                                <div class="venue-phase-stat">${deathRR}</div>
                                <div class="venue-phase-sub">${deathBdry}${deathBdry !== '-' ? '% boundary' : ''}</div>
                            </div>
                        </div>

                        ${recordsHTML}
                    </div>
                </div>`;
            } else {
                section2HTML = `
                <div class="strategy-section">
                    <div class="strategy-section-header">
                        <div class="strategy-section-title">Home Venue Intelligence</div>
                        <span class="strategy-section-badge" style="background: rgba(191, 90, 242, 0.15); color: var(--accent-purple);">Venue</span>
                    </div>
                    <div class="venue-profile" style="text-align: center; padding: 32px;">
                        <div style="font-size: 13px; color: var(--text-tertiary);">Venue data loading...</div>
                        <div style="font-size: 12px; color: var(--text-tertiary); margin-top: 8px;">${team.homeVenue || 'Home Venue'} &middot; ${venueBias} bias &middot; ${spinCount} spin / ${paceCount} pace</div>
                    </div>
                </div>`;
            }

            // ===== Build Section 3: Historic Trajectory =====
            let section3HTML = '';
            if (historicData && historicData.seasons && historicData.seasons.length > 0) {
                const seasons = historicData.seasons.slice(-3);
                const getTrendArrow = (curr, prev) => {
                    if (!prev) return '<span class="trend-arrow flat">--</span>';
                    if (curr > prev) return '<span class="trend-arrow up">&#9650;</span>';
                    if (curr < prev) return '<span class="trend-arrow down">&#9660;</span>';
                    return '<span class="trend-arrow flat">&#9654;</span>';
                };
                const getWinPctColor = (pct) => pct >= 60 ? 'var(--accent-green)' : pct >= 45 ? 'var(--accent-yellow)' : 'var(--accent-red)';

                let seasonCardsHTML = seasons.map((s, i) => {
                    const prevSeason = i > 0 ? seasons[i - 1] : null;
                    const prevPct = prevSeason ? prevSeason.winPct : null;
                    return `
                    <div class="trend-season-card">
                        <div class="trend-season-year">${s.year}</div>
                        <div class="trend-season-record">${s.wins || 0}-${s.losses || 0}</div>
                        <div class="trend-season-winpct" style="color: ${getWinPctColor(s.winPct || 0)};">
                            ${(s.winPct || 0).toFixed(0)}%
                            ${getTrendArrow(s.winPct, prevPct)}
                        </div>
                    </div>`;
                }).join('');

                // Phase trend comparison
                let phaseTrendHTML = '';
                const phaseTrends = historicData.phaseTrends;
                if (phaseTrends) {
                    const trendYears = seasons.map(s => s.year);
                    const buildTrendRows = (data, phases) => {
                        return phases.map(phase => {
                            const vals = trendYears.map(y => {
                                const entry = data && data[phase] ? data[phase][y] : null;
                                return entry !== null && entry !== undefined ? entry : '-';
                            });
                            return `
                            <div class="phase-trend-row">
                                <span class="phase-trend-label">${phase}</span>
                                <div class="phase-trend-values">
                                    ${vals.map((v, vi) => `<span class="phase-trend-val" style="color: var(--text-secondary);" title="${trendYears[vi]}">${v}</span>`).join('')}
                                </div>
                            </div>`;
                        }).join('');
                    };

                    const batPhases = ['Powerplay', 'Middle', 'Death'];
                    const bowlPhases = ['Powerplay', 'Middle', 'Death'];

                    phaseTrendHTML = `
                    <div class="phase-trend-grid">
                        <div class="phase-trend-card">
                            <div class="phase-trend-title">Batting SR by Phase</div>
                            <div class="phase-trend-row" style="border-bottom: 1px solid var(--border); margin-bottom: 4px; padding-bottom: 4px;">
                                <span class="phase-trend-label" style="font-weight: 700;">Phase</span>
                                <div class="phase-trend-values">
                                    ${trendYears.map(y => `<span class="phase-trend-val" style="color: var(--text-tertiary); font-size: 10px;">${y}</span>`).join('')}
                                </div>
                            </div>
                            ${buildTrendRows(phaseTrends.battingSR, batPhases)}
                        </div>
                        <div class="phase-trend-card">
                            <div class="phase-trend-title">Bowling Economy by Phase</div>
                            <div class="phase-trend-row" style="border-bottom: 1px solid var(--border); margin-bottom: 4px; padding-bottom: 4px;">
                                <span class="phase-trend-label" style="font-weight: 700;">Phase</span>
                                <div class="phase-trend-values">
                                    ${trendYears.map(y => `<span class="phase-trend-val" style="color: var(--text-tertiary); font-size: 10px;">${y}</span>`).join('')}
                                </div>
                            </div>
                            ${buildTrendRows(phaseTrends.bowlingEcon, bowlPhases)}
                        </div>
                    </div>`;
                }

                section3HTML = `
                <div class="strategy-section">
                    <div class="strategy-section-header">
                        <div class="strategy-section-title">Historic Trajectory</div>
                        <span class="strategy-section-badge" style="background: rgba(48, 209, 88, 0.15); color: var(--accent-green);">Trends</span>
                    </div>
                    <div class="trend-season-grid">
                        ${seasonCardsHTML}
                    </div>
                    ${phaseTrendHTML}
                </div>`;
            } else {
                section3HTML = `
                <div class="strategy-section">
                    <div class="strategy-section-header">
                        <div class="strategy-section-title">Historic Trajectory</div>
                        <span class="strategy-section-badge" style="background: rgba(48, 209, 88, 0.15); color: var(--accent-green);">Trends</span>
                    </div>
                    <div class="trend-season-card" style="text-align: center; padding: 32px;">
                        <div style="font-size: 13px; color: var(--text-tertiary);">Historic data loading...</div>
                    </div>
                </div>`;
            }

            // ===== Build Section 4: Structural Vulnerabilities =====
            let section4HTML = '';
            if (vulns.length > 0) {
                section4HTML = `
                <div class="strategy-section">
                    <div class="strategy-section-header">
                        <div class="strategy-section-title">Structural Vulnerabilities</div>
                        <span class="strategy-section-badge" style="background: rgba(255, 69, 58, 0.15); color: var(--accent-red);">${vulns.length} Found</span>
                    </div>
                    <div class="vuln-card">
                        <div class="vuln-header">
                            <span>&#9888;</span> Areas of Concern
                        </div>
                        <ul class="vuln-list">
                            ${vulns.map(v => '<li>' + v + '</li>').join('')}
                        </ul>
                    </div>
                </div>`;
            }

            // ===== Build Section 5: Pressure & Momentum =====
            let section5HTML = '';
            const mTeam = (typeof MOMENTUM_INSIGHTS !== 'undefined' && MOMENTUM_INSIGHTS.teams) ? MOMENTUM_INSIGHTS.teams[currentTeam] : null;
            if (mTeam) {
                const bp = mTeam.bowlingPressure;
                const br = mTeam.battingResilience;
                const cp = mTeam.clutchPerformers;

                const ratingClass = (r) => r ? r.toLowerCase().replace(/\s/g, '') : 'average';

                const bowlerRows = (bp.topBowlers || []).map(b => `
                    <div class="momentum-stat-row">
                        <span class="momentum-player-name">${b.name}</span>
                        <span class="momentum-stat-value">Avg <span class="highlight">${b.avgLength.toFixed(1)}</span> dots &middot; Max ${b.maxLength} &middot; ${b.dotSequences} seq</span>
                    </div>`).join('');

                const batterRows = (br.topBatters || []).map(b => `
                    <div class="momentum-stat-row">
                        <span class="momentum-player-name">${b.name}</span>
                        <span class="momentum-stat-value">Avg <span class="highlight">${b.avgLength.toFixed(1)}</span> bdry &middot; Max ${b.maxLength} &middot; ${b.boundarySequences} seq</span>
                    </div>`).join('');

                const clutchRows = (cp.topClutch || []).map(p => `
                    <div class="clutch-player-row">
                        <span class="momentum-player-name">${p.name}</span>
                        <span style="color: var(--text-tertiary); font-size: 11px;">${p.normalSR.toFixed(1)} &rarr; ${p.pressureSR.toFixed(1)}</span>
                        <span class="clutch-delta positive">${p.delta}</span>
                    </div>`).join('');

                const chokeRows = (cp.chokeRisks || []).map(p => `
                    <div class="clutch-player-row">
                        <span class="momentum-player-name">${p.name}</span>
                        <span style="color: var(--text-tertiary); font-size: 11px;">${p.normalSR.toFixed(1)} &rarr; ${p.pressureSR.toFixed(1)}</span>
                        <span class="clutch-delta negative">${p.delta}</span>
                    </div>`).join('');

                const avgDelta = cp.teamAvgDelta || 0;
                const deltaColor = avgDelta >= 0 ? 'var(--accent-green)' : 'var(--accent-red)';
                const deltaSign = avgDelta >= 0 ? '+' : '';

                section5HTML = `
                <div class="strategy-section">
                    <div class="strategy-section-header">
                        <div class="strategy-section-title">Pressure & Momentum</div>
                        <span class="strategy-section-badge" style="background: rgba(191, 90, 242, 0.15); color: var(--accent-purple);">Sequences</span>
                    </div>

                    <div class="momentum-grid">
                        <div class="momentum-card">
                            <div class="momentum-card-header">
                                <span class="momentum-card-title">Bowling Pressure</span>
                                <span class="momentum-rating ${ratingClass(bp.rating)}">${bp.rating}</span>
                            </div>
                            ${bowlerRows}
                            <div class="momentum-team-summary">
                                <span>Total sequences: <strong>${bp.teamTotalSequences}</strong></span>
                                <span>Best streak: <strong>${bp.bestMaxStreak}</strong> dots</span>
                            </div>
                        </div>
                        <div class="momentum-card">
                            <div class="momentum-card-header">
                                <span class="momentum-card-title">Batting Resilience</span>
                                <span class="momentum-rating ${ratingClass(br.rating)}">${br.rating}</span>
                            </div>
                            ${batterRows}
                            <div class="momentum-team-summary">
                                <span>Total sequences: <strong>${br.teamTotalSequences}</strong></span>
                                <span>Best streak: <strong>${br.bestMaxStreak}</strong> boundaries</span>
                            </div>
                        </div>
                    </div>

                    <div class="clutch-grid">
                        <div class="clutch-card positive">
                            <div class="clutch-card-header">
                                <span>&#9650;</span> Clutch Performers
                            </div>
                            ${clutchRows}
                        </div>
                        <div class="clutch-card negative">
                            <div class="clutch-card-header">
                                <span>&#9660;</span> Choke Risks
                            </div>
                            ${chokeRows}
                        </div>
                    </div>

                    <div style="text-align: center; font-size: 12px; color: var(--text-tertiary); margin-bottom: 16px;">
                        Team Avg Pressure Delta: <span style="color: ${deltaColor}; font-weight: 700;">${deltaSign}${avgDelta.toFixed(1)}</span> SR points
                    </div>

                    <div class="flower-insight-box">
                        <div class="flower-insight-label">
                            <span>&#127793;</span> Andy Flower &mdash; Pressure Analysis
                        </div>
                        <div class="flower-insight-text">"${mTeam.andyFlowerInsight}"</div>
                    </div>
                </div>`;
            }

            // ===== Assemble Full Strategy Outlook =====
            balanceContent.innerHTML = section1HTML + section2HTML + section3HTML + section4HTML + section5HTML;

            // Depth Chart â€” Tabular Redesign
            const depthContent = document.getElementById('depth-content');
            const fullDepth = FULL_DEPTH_CHARTS[currentTeam];

            if (fullDepth && fullDepth.positions && fullDepth.positions.length > 0) {
                // Classify positions into batting and bowling sections
                const battingPositionNames = ['Opener', 'Number 3', '#3 Batter', 'Middle Order', 'Finisher', 'Wicketkeeper', 'Allrounder'];
                const bowlingPositionNames = ['Right-arm Pace', 'Left-arm Pace', 'Off-spin', 'Leg-spin', 'Left-arm Spin', 'Middle Overs Specialist', 'Allrounder',
                    'Lead Pacer', 'Lead Spinner', 'Supporting Pacer (PP)', 'Supporting Pacer (Death)'];

                const battingPositions = [];
                const bowlingPositions = [];
                fullDepth.positions.forEach(pos => {
                    if (battingPositionNames.some(n => pos.name.includes(n) || n.includes(pos.name))) {
                        battingPositions.push(pos);
                    } else {
                        bowlingPositions.push(pos);
                    }
                });

                // Bowling variety summary from bowler positions
                const bowlTypeSummary = {};
                const bowlTypeLabels = {'Right-arm Pace': 'RA Pace', 'Left-arm Pace': 'LA Pace', 'Off-spin': 'Off', 'Leg-spin': 'Leg', 'Left-arm Spin': 'LA Spin'};
                bowlingPositions.forEach(pos => {
                    const label = bowlTypeLabels[pos.name];
                    if (label) {
                        bowlTypeSummary[label] = pos.players ? pos.players.length : 0;
                    }
                });
                const varietySummary = Object.entries(bowlTypeSummary).map(([k, v]) => `<span class="bowl-variety-badge">${k}: ${v}</span>`).join(' ');

                // Build table rows helper
                const buildRows = (positions, globalOffset) => positions.map((pos, localIdx) => {
                    const posIdx = globalOffset + localIdx;
                    const ratingClass = pos.rating >= 8 ? 'rating-high' : pos.rating >= 6 ? 'rating-mid' : 'rating-low';
                    const p1 = pos.players[0] || { name: '-', score: 0, overseas: false, price: 0, rationale: '', bowlingType: '' };
                    const p2 = pos.players[1] || { name: '-', score: 0, overseas: false, price: 0, rationale: '', bowlingType: '' };
                    const p3 = pos.players[2] || { name: '-', score: 0, overseas: false, price: 0, rationale: '', bowlingType: '' };
                    const osBadge = (p) => p.overseas ? '<span class="os-badge">OS</span>' : '';
                    const bowlBadge = (p) => {
                        if (!p.bowlingType || p.name === '-') return '';
                        const short = {'Fast': 'F', 'Fast-Medium': 'FM', 'Medium': 'M', 'Off-spin': 'Off', 'Off-break': 'Off', 'Leg-spin': 'Leg', 'Wrist-spin': 'WS', 'Orthodox': 'Orth', 'Slow Left-arm': 'SLA', 'LA Orthodox': 'Orth'}[p.bowlingType] || p.bowlingType.substring(0, 3);
                        const arm = p.bowlingArm === 'Left-arm' ? 'L' : 'R';
                        return `<span class="bowl-type-tag">${arm}${short}</span>`;
                    };

                    const detailContent = `
                        <div class="detail-grid">
                            <div><span style="color:var(--accent-green);">Strength:</span> ${pos.whatWorks}</div>
                            <div><span style="color:var(--accent-orange);">Concern:</span> ${pos.whatDoesnt}</div>
                        </div>
                        <div style="margin-top:8px; display:flex; gap:16px; flex-wrap:wrap;">
                            ${pos.players.map(p => `<span style="font-size:11px;"><strong>${p.name}</strong> ${p.score.toFixed(0)}% â€” ${p.rationale} (â‚¹${p.price} Cr)</span>`).join(' | ')}
                        </div>
                    `;

                    return `
                        <tr class="depth-row" onclick="toggleDepthDetail(${posIdx})">
                            <td style="font-weight:600;">${pos.name}</td>
                            <td>${p1.name !== '-' ? `<span class="player-clickable" onclick="event.stopPropagation(); openPlayerProfile('${p1.name.replace(/'/g, "\\\\'")}')">${p1.name}</span>` : '-'}${osBadge(p1)}${bowlBadge(p1)}</td>
                            <td>${p2.name !== '-' ? `<span class="player-clickable" onclick="event.stopPropagation(); openPlayerProfile('${p2.name.replace(/'/g, "\\\\'")}')">${p2.name}</span>` : '-'}${osBadge(p2)}${bowlBadge(p2)}</td>
                            <td>${p3.name !== '-' ? `<span class="player-clickable" onclick="event.stopPropagation(); openPlayerProfile('${p3.name.replace(/'/g, "\\\\'")}')">${p3.name}</span>` : '-'}${osBadge(p3)}${bowlBadge(p3)}</td>
                            <td class="${ratingClass}">${pos.rating}/10</td>
                        </tr>
                        <tr class="depth-detail-row">
                            <td colspan="5">
                                <div class="depth-detail-inner" id="depth-detail-${posIdx}">
                                    ${detailContent}
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');

                const battingRows = buildRows(battingPositions, 0);
                const bowlingRows = buildRows(bowlingPositions, battingPositions.length);

                const vulnerabilitiesHtml = fullDepth.vulnerabilities && fullDepth.vulnerabilities.length > 0 ?
                    `<div class="depth-section" style="border: 1px dashed var(--accent-orange); background: rgba(255, 159, 10, 0.05); margin-bottom: 16px;">
                        <div class="depth-header">
                            <div class="depth-position">Key Vulnerabilities</div>
                        </div>
                        <ul style="margin: 0; padding-left: 20px; color: var(--text-secondary);">
                            ${fullDepth.vulnerabilities.map(v => `<li style="margin: 6px 0; font-size: 13px;">${v}</li>`).join('')}
                        </ul>
                    </div>` : '';

                depthContent.innerHTML = `
                    <div class="depth-section" style="background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-elevated) 100%); margin-bottom: 24px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-size: 24px; font-weight: 800;">Full Depth Chart</div>
                                <div style="color: var(--text-tertiary); font-size: 13px;">Click any row for details</div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 36px; font-weight: 800; color: var(--accent);">${fullDepth.overall}</div>
                                <div style="font-size: 11px; color: var(--text-tertiary);">Overall Rating</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 24px; margin-top: 16px; flex-wrap: wrap;">
                            <div><span style="color: var(--accent-green);">Strongest:</span> ${fullDepth.strongest}</div>
                            <div><span style="color: var(--accent-orange);">Weakest:</span> ${fullDepth.weakest}</div>
                        </div>
                    </div>
                    ${vulnerabilitiesHtml}

                    <div class="depth-section-label" style="display:flex; align-items:center; gap:8px; margin-bottom:8px; border-left: 3px solid var(--accent); padding-left:10px;">
                        <span style="font-size:13px; font-weight:700; text-transform:uppercase; letter-spacing:0.5px;">Batting Depth</span>
                    </div>
                    <div class="depth-table-wrap" style="margin-bottom:24px;">
                        <table class="depth-table">
                            <thead>
                                <tr>
                                    <th>Position</th>
                                    <th>#1 Primary</th>
                                    <th>#2 Backup</th>
                                    <th>#3 Option</th>
                                    <th>Rating</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${battingRows}
                            </tbody>
                        </table>
                    </div>

                    <div class="depth-section-label" style="display:flex; align-items:center; gap:8px; margin-bottom:8px; border-left: 3px solid var(--accent-green); padding-left:10px;">
                        <span style="font-size:13px; font-weight:700; text-transform:uppercase; letter-spacing:0.5px;">Bowling Depth</span>
                        <span style="font-size:10px; color:var(--text-tertiary); margin-left:auto;">${varietySummary}</span>
                    </div>
                    <div class="depth-table-wrap">
                        <table class="depth-table">
                            <thead>
                                <tr>
                                    <th>Position</th>
                                    <th>#1 Primary</th>
                                    <th>#2 Backup</th>
                                    <th>#3 Option</th>
                                    <th>Rating</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${bowlingRows}
                            </tbody>
                        </table>
                    </div>
                `;
            } else {
                depthContent.innerHTML = `
                    <div class="depth-section">
                        <div class="depth-header">
                            <div class="depth-position">Depth Chart Summary</div>
                            <div class="depth-rating">${rating.overall}</div>
                        </div>
                        <div class="depth-players">
                            <div class="depth-player">
                                <div class="depth-rank primary">+</div>
                                <div class="depth-player-info">
                                    <div class="depth-player-name">Strongest: ${rating.strongest}</div>
                                </div>
                            </div>
                            <div class="depth-player">
                                <div class="depth-rank">!</div>
                                <div class="depth-player-info">
                                    <div class="depth-player-name">Weakest: ${rating.weakest}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p style="color: var(--text-tertiary); font-size: 14px; text-align: center;">
                        Full depth chart data available in <a href="artifacts.html" style="color: var(--accent);">Artifacts</a>
                    </p>
                `;
            }

            // Pressure Performance (TKT-050)
            renderPressureCard();
        }

        function toggleDepthDetail(idx) {
            const el = document.getElementById('depth-detail-' + idx);
            if (el) el.classList.toggle('open');
        }

        function setPressureFilter(filterType, value) {
            pressureFilters[filterType] = value;
            renderPressureCard();
        }

        function renderPressureCard() {
            const pressureContent = document.getElementById('pressure-content');
            const pressure = typeof PRESSURE_DATA !== 'undefined' ? PRESSURE_DATA[currentTeam] : null;
            const meta = typeof PRESSURE_DATA !== 'undefined' ? PRESSURE_DATA._meta : null;

            if (!pressure) {
                pressureContent.innerHTML = `
                    <div style="text-align: center; padding: 48px 24px; color: var(--text-tertiary);">
                        <div style="font-size: 48px; margin-bottom: 16px;">ðŸ“Š</div>
                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">No Pressure Data Available</div>
                        <div style="font-size: 13px;">Pressure performance data is not yet available for this team.</div>
                    </div>
                `;
                return;
            }

            const s = pressure.summary;
            const team = TEAMS[currentTeam];
            const pf = pressureFilters;

            const clutchColor = s.clutchScore >= 6 ? 'var(--accent-green)' :
                               s.clutchScore >= 4 ? 'var(--accent-yellow)' :
                               s.clutchScore >= 2 ? 'var(--accent-orange)' : 'var(--accent-red)';

            const ratingBadge = (rating) => {
                const cls = rating.toLowerCase().replace('_', '-');
                const label = rating.replace('_', ' ');
                return `<span class="pressure-badge ${cls}">${label}</span>`;
            };

            const srDeltaDisplay = (delta) => {
                const color = delta >= 10 ? 'var(--accent-green)' :
                             delta >= 5 ? 'var(--accent-yellow)' :
                             delta >= 0 ? 'var(--text-secondary)' : 'var(--accent-red)';
                const sign = delta >= 0 ? '+' : '';
                return `<span style="color: ${color}; font-weight: 700;">${sign}${delta.toFixed(1)}%</span>`;
            };

            const econDisplay = (econ) => {
                if (!econ) return '<span style="color: var(--text-tertiary);">-</span>';
                const color = econ <= 6.0 ? 'var(--accent-green)' :
                             econ <= 7.5 ? 'var(--accent-yellow)' :
                             econ <= 9.0 ? 'var(--accent-orange)' : 'var(--accent-red)';
                return `<span style="color: ${color}; font-weight: 700;">${econ.toFixed(2)}</span>`;
            };

            const srColor = (sr) => {
                if (!sr) return 'var(--text-tertiary)';
                if (sr >= 170) return 'var(--accent-green)';
                if (sr >= 140) return 'var(--accent-yellow)';
                if (sr >= 120) return 'var(--text-secondary)';
                return 'var(--accent-red)';
            };

            // Economy color for band table (lower is better for bowlers)
            const econColor = (econ) => {
                if (!econ) return 'var(--text-tertiary)';
                if (econ <= 6.0) return 'var(--accent-green)';
                if (econ <= 7.5) return 'var(--accent-yellow)';
                if (econ <= 9.0) return 'var(--accent-orange)';
                return 'var(--accent-red)';
            };

            // Dot% color (higher dot% is good for bowlers, bad for batters)
            const dotPctColorBatter = (pct) => {
                if (!pct) return 'var(--text-tertiary)';
                if (pct <= 25) return 'var(--accent-green)';
                if (pct <= 35) return 'var(--accent-yellow)';
                return 'var(--accent-red)';
            };

            const dotPctColorBowler = (pct) => {
                if (!pct) return 'var(--text-tertiary)';
                if (pct >= 45) return 'var(--accent-green)';
                if (pct >= 35) return 'var(--accent-yellow)';
                return 'var(--accent-red)';
            };

            const entryBadge = (ctx, avgBalls) => {
                const cls = ctx.toLowerCase().replace('_', '-');
                const ballsLabel = avgBalls > 0 ? `<span class="entry-balls" title="Average balls faced before entering pressure phase">~${avgBalls.toFixed(0)} balls before pressure</span>` : '';
                return `<span class="entry-badge ${cls}" title="Entry context: how established the batter was when pressure began">${ctx.replace('_', ' ')} ${ballsLabel}</span>`;
            };

            const wScoreColor = (score) => {
                if (score >= 30) return 'var(--accent-green)';
                if (score >= 15) return 'var(--accent-yellow)';
                if (score >= 0) return 'var(--text-secondary)';
                return 'var(--accent-red)';
            };

            const bandTagClass = (band) => band.toLowerCase().replace('_', '-');

            // Phase comparison indicator
            const phaseCompareIndicator = (deathVal, setupVal, higherIsBetter) => {
                if (!deathVal || !setupVal) return '';
                const diff = deathVal - setupVal;
                const better = higherIsBetter ? diff > 0 : diff < 0;
                const cls = better ? 'improved' : 'declined';
                const sign = diff >= 0 ? '+' : '';
                const label = better ? 'Death > Setup' : 'Death < Setup';
                return `<div class="pressure-phase-comparison ${cls}">${label} (${sign}${diff.toFixed(1)})</div>`;
            };

            // Get batter's filtered phase stat for card display
            const getBatterFilteredPhaseStat = (b) => {
                if (pf.phase === 'all' || !b.phaseStats) return null;
                const phaseKey = pf.phase === 'setup' ? 'setup' : 'death';
                const phaseData = b.phaseStats[phaseKey];
                if (!phaseData || !phaseData.sr) return null;
                const phaseLabel = pf.phase === 'setup' ? 'Ov 15-17 SR' : 'Ov 18-20 SR';
                return { value: phaseData.sr.toFixed(1), label: phaseLabel, color: srColor(phaseData.sr) };
            };

            // Get bowler's filtered phase stat for card display
            const getBowlerFilteredPhaseStat = (bw) => {
                if (pf.phase === 'all' || !bw.phaseStats) return null;
                const phaseKey = pf.phase === 'setup' ? 'setup' : 'death';
                const phaseData = bw.phaseStats[phaseKey];
                if (!phaseData || !phaseData.economy) return null;
                const phaseLabel = pf.phase === 'setup' ? 'Ov 15-17 Econ' : 'Ov 18-20 Econ';
                return { value: phaseData.economy.toFixed(2), label: phaseLabel, color: econColor(phaseData.economy) };
            };

            // Check if player has a matching band in bandBreakdown
            const playerHasBand = (bandBreakdown, bandFilter) => {
                if (bandFilter === 'all' || !bandBreakdown) return true;
                return bandBreakdown.some(bd => bd.band === bandFilter);
            };

            // Get band-specific stat for display
            const getBatterBandStat = (b) => {
                if (pf.band === 'all' || !b.bandBreakdown) return null;
                const bd = b.bandBreakdown.find(x => x.band === pf.band);
                if (!bd) return null;
                return { value: bd.sr.toFixed(1), label: `${pf.band.replace('_', ' ')} SR`, color: srColor(bd.sr), balls: bd.balls };
            };

            const getBowlerBandStat = (bw) => {
                if (pf.band === 'all' || !bw.bandBreakdown) return null;
                const bd = bw.bandBreakdown.find(x => x.band === pf.band);
                if (!bd) return null;
                return { value: bd.economy.toFixed(2), label: `${pf.band.replace('_', ' ')} Econ`, color: econColor(bd.economy), balls: bd.balls };
            };

            // Batter band breakdown table with color-coded values
            const batterBandTable = (bands) => {
                if (!bands || bands.length === 0) return '';
                return `
                    <table class="pressure-band-table">
                        <thead><tr><th>RRR Band</th><th>Balls</th><th>SR</th><th>Bdry%</th><th>6s%</th><th>Dot%</th></tr></thead>
                        <tbody>
                            ${bands.map(bd => `
                                <tr>
                                    <td><span class="pressure-band-tag ${bandTagClass(bd.band)}">${bd.band.replace('_', ' ')}</span></td>
                                    <td>${bd.balls}</td>
                                    <td style="color: ${srColor(bd.sr)}; font-weight: 600;">${bd.sr.toFixed(1)}</td>
                                    <td style="color: ${srColor(bd.boundaryPct * 4)}; font-weight: 600;">${bd.boundaryPct.toFixed(1)}%</td>
                                    <td style="color: ${srColor(bd.sixPct * 6)}; font-weight: 600;">${bd.sixPct.toFixed(1)}%</td>
                                    <td style="color: ${dotPctColorBatter(bd.dotPct)}; font-weight: 600;">${bd.dotPct.toFixed(1)}%</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>`;
            };

            // Bowler band breakdown table with color-coded values
            const bowlerBandTable = (bands) => {
                if (!bands || bands.length === 0) return '';
                return `
                    <table class="pressure-band-table">
                        <thead><tr><th>RRR Band</th><th>Balls</th><th>Econ</th><th>Dot%</th><th>Bdry Conc%</th><th>Wkts</th></tr></thead>
                        <tbody>
                            ${bands.map(bd => `
                                <tr>
                                    <td><span class="pressure-band-tag ${bandTagClass(bd.band)}">${bd.band.replace('_', ' ')}</span></td>
                                    <td>${bd.balls}</td>
                                    <td style="color: ${econColor(bd.economy)}; font-weight: 600;">${bd.economy ? bd.economy.toFixed(2) : '-'}</td>
                                    <td style="color: ${dotPctColorBowler(bd.dotPct)}; font-weight: 600;">${bd.dotPct.toFixed(1)}%</td>
                                    <td style="color: ${bd.boundaryConcededPct <= 20 ? 'var(--accent-green)' : bd.boundaryConcededPct <= 35 ? 'var(--accent-yellow)' : 'var(--accent-red)'}; font-weight: 600;">${bd.boundaryConcededPct.toFixed(1)}%</td>
                                    <td>${bd.wickets}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>`;
            };

            // Batter phase stats with color-coded comparison
            const batterPhaseHtml = (ps) => {
                if (!ps) return '';
                const setup = ps.setup || {};
                const death = ps.death || {};
                if (!setup.balls && !death.balls) return '';
                const srCompare = phaseCompareIndicator(death.sr, setup.sr, true);
                return `
                    <div class="pressure-phase-grid">
                        <div class="pressure-phase-card">
                            <div class="pressure-phase-label">Overs 15-17 (Setup)</div>
                            <div class="pressure-phase-stats">
                                <div class="pressure-phase-stat"><div class="val">${setup.balls || 0}</div><div class="lbl">Balls</div></div>
                                <div class="pressure-phase-stat"><div class="val" style="color: ${srColor(setup.sr)};">${setup.sr ? setup.sr.toFixed(1) : '-'}</div><div class="lbl">SR</div></div>
                                <div class="pressure-phase-stat"><div class="val" style="color: ${srColor((setup.boundaryPct || 0) * 4)};">${setup.boundaryPct ? setup.boundaryPct.toFixed(1) + '%' : '-'}</div><div class="lbl">Bdry</div></div>
                                <div class="pressure-phase-stat"><div class="val" style="color: ${dotPctColorBatter(setup.dotPct)};">${setup.dotPct ? setup.dotPct.toFixed(1) + '%' : '-'}</div><div class="lbl">Dot</div></div>
                            </div>
                        </div>
                        <div class="pressure-phase-card">
                            <div class="pressure-phase-label">Overs 18-20 (Death)</div>
                            <div class="pressure-phase-stats">
                                <div class="pressure-phase-stat"><div class="val">${death.balls || 0}</div><div class="lbl">Balls</div></div>
                                <div class="pressure-phase-stat"><div class="val" style="color: ${srColor(death.sr)};">${death.sr ? death.sr.toFixed(1) : '-'}</div><div class="lbl">SR</div></div>
                                <div class="pressure-phase-stat"><div class="val" style="color: ${srColor((death.boundaryPct || 0) * 4)};">${death.boundaryPct ? death.boundaryPct.toFixed(1) + '%' : '-'}</div><div class="lbl">Bdry</div></div>
                                <div class="pressure-phase-stat"><div class="val" style="color: ${dotPctColorBatter(death.dotPct)};">${death.dotPct ? death.dotPct.toFixed(1) + '%' : '-'}</div><div class="lbl">Dot</div></div>
                            </div>
                            ${srCompare}
                        </div>
                    </div>`;
            };

            // Bowler phase stats with color-coded comparison
            const bowlerPhaseHtml = (ps) => {
                if (!ps) return '';
                const setup = ps.setup || {};
                const death = ps.death || {};
                if (!setup.balls && !death.balls) return '';
                const econCompare = phaseCompareIndicator(death.economy, setup.economy, false);
                return `
                    <div class="pressure-phase-grid">
                        <div class="pressure-phase-card">
                            <div class="pressure-phase-label">Overs 15-17 (Setup)</div>
                            <div class="pressure-phase-stats">
                                <div class="pressure-phase-stat"><div class="val">${setup.balls || 0}</div><div class="lbl">Balls</div></div>
                                <div class="pressure-phase-stat"><div class="val" style="color: ${econColor(setup.economy)};">${setup.economy ? setup.economy.toFixed(2) : '-'}</div><div class="lbl">Econ</div></div>
                                <div class="pressure-phase-stat"><div class="val" style="color: ${dotPctColorBowler(setup.dotPct)};">${setup.dotPct ? setup.dotPct.toFixed(1) + '%' : '-'}</div><div class="lbl">Dot</div></div>
                                <div class="pressure-phase-stat"><div class="val">${setup.wickets || 0}</div><div class="lbl">Wkts</div></div>
                            </div>
                        </div>
                        <div class="pressure-phase-card">
                            <div class="pressure-phase-label">Overs 18-20 (Death)</div>
                            <div class="pressure-phase-stats">
                                <div class="pressure-phase-stat"><div class="val">${death.balls || 0}</div><div class="lbl">Balls</div></div>
                                <div class="pressure-phase-stat"><div class="val" style="color: ${econColor(death.economy)};">${death.economy ? death.economy.toFixed(2) : '-'}</div><div class="lbl">Econ</div></div>
                                <div class="pressure-phase-stat"><div class="val" style="color: ${dotPctColorBowler(death.dotPct)};">${death.dotPct ? death.dotPct.toFixed(1) + '%' : '-'}</div><div class="lbl">Dot</div></div>
                                <div class="pressure-phase-stat"><div class="val">${death.wickets || 0}</div><div class="lbl">Wkts</div></div>
                            </div>
                            ${econCompare}
                        </div>
                    </div>`;
            };

            // Filter pill builder
            const pill = (filterType, value, label) => {
                const isActive = pf[filterType] === value;
                return `<span class="pressure-pill ${isActive ? 'active' : ''}" onclick="setPressureFilter('${filterType}', '${value}')">${label}</span>`;
            };

            // Build filter bar
            const filterBarHtml = `
                <div class="pressure-filter-bar">
                    <div class="pressure-filter-group">
                        <span class="pressure-filter-group-label">Phase</span>
                        ${pill('phase', 'all', 'All')}
                        ${pill('phase', 'setup', 'Ov 15-17')}
                        ${pill('phase', 'death', 'Ov 18-20')}
                    </div>
                    <div class="pressure-filter-group">
                        <span class="pressure-filter-group-label">Band</span>
                        ${pill('band', 'all', 'All')}
                        ${pill('band', 'HIGH', 'HIGH')}
                        ${pill('band', 'EXTREME', 'EXTREME')}
                        ${pill('band', 'NEAR_IMPOSSIBLE', 'NEAR IMPOSSIBLE')}
                    </div>
                    <div class="pressure-filter-group">
                        <span class="pressure-filter-group-label">Entry Context</span>
                        ${pill('entry', 'all', 'All')}
                        ${pill('entry', 'FRESH', 'FRESH')}
                        ${pill('entry', 'BUILDING', 'BUILDING')}
                        ${pill('entry', 'SET', 'SET')}
                        ${pill('entry', 'DEEP_SET', 'DEEP SET')}
                    </div>
                </div>`;

            // Build unified ALL-players table (batters + bowlers combined)
            let allBatters = [...(pressure.allBatters || pressure.topBatters || [])];
            let allBowlers = [...(pressure.allBowlers || pressure.topBowlers || [])];

            // Apply entry context filter (batters only)
            if (pf.entry !== 'all') {
                allBatters = allBatters.filter(b => b.entryContext === pf.entry);
            }

            // Sort batters
            if (pf.phase === 'death') {
                allBatters.sort((a, b) => (b.phaseStats?.death?.sr || 0) - (a.phaseStats?.death?.sr || 0));
            } else if (pf.phase === 'setup') {
                allBatters.sort((a, b) => (b.phaseStats?.setup?.sr || 0) - (a.phaseStats?.setup?.sr || 0));
            } else if (pf.band !== 'all') {
                allBatters.sort((a, b) => {
                    const asr = ((a.bandBreakdown || []).find(x => x.band === pf.band) || {}).sr || -1;
                    const bsr = ((b.bandBreakdown || []).find(x => x.band === pf.band) || {}).sr || -1;
                    return bsr - asr;
                });
            }

            // Sort bowlers
            if (pf.phase === 'death') {
                allBowlers.sort((a, b) => (a.phaseStats?.death?.economy || 99) - (b.phaseStats?.death?.economy || 99));
            } else if (pf.phase === 'setup') {
                allBowlers.sort((a, b) => (a.phaseStats?.setup?.economy || 99) - (b.phaseStats?.setup?.economy || 99));
            } else if (pf.band !== 'all') {
                allBowlers.sort((a, b) => {
                    const ae = ((a.bandBreakdown || []).find(x => x.band === pf.band) || {}).economy || 99;
                    const be = ((b.bandBreakdown || []).find(x => x.band === pf.band) || {}).economy || 99;
                    return ae - be;
                });
            }

            // Merge into unified rows: batters first, then bowlers
            const allRows = [
                ...allBatters.map(b => ({ type: 'BAT', ...b })),
                ...allBowlers.map(bw => ({ type: 'BWL', ...bw }))
            ];

            // Pressure table sort state
            const pressureSortCol = window._pressureSortCol || 'default';
            const pressureSortAsc = window._pressureSortAsc !== undefined ? window._pressureSortAsc : true;

            // Build batter row
            const batterRow = (b, idx) => {
                const sampleCls = b.pressureBalls >= 150 ? 'large' : b.pressureBalls >= 80 ? 'medium' : 'small';
                const sampleLabel = b.pressureBalls >= 150 ? 'L' : b.pressureBalls >= 80 ? 'M' : 'S';
                return `
                <tr class="pressure-table-row" onclick="this.classList.toggle('expanded'); this.nextElementSibling.classList.toggle('visible');">
                    <td>${idx + 1}</td>
                    <td class="pressure-table-name">
                        <span class="player-name-text player-clickable" onclick="event.stopPropagation(); openPlayerProfile('${b.name.replace(/'/g, "\\\\'")}')">${b.name}</span>
                        <span class="pressure-table-role-tag bat">BAT</span>
                    </td>
                    <td>${ratingBadge(b.rating)}</td>
                    <td style="color: ${srColor(b.pressureSR)}; font-weight: 700;">${b.pressureSR.toFixed(1)}</td>
                    <td>${srDeltaDisplay(b.srDelta)}</td>
                    <td style="color: ${wScoreColor(b.pressureScore)}; font-weight: 700;">${b.pressureScore.toFixed(1)}</td>
                    <td><span class="sample-badge sample-${sampleCls}">${sampleLabel}</span> ${b.pressureBalls}</td>
                    <td><span class="entry-badge ${b.entryContext.toLowerCase().replace('_','-')}">${b.entryContext.replace('_',' ')}</span></td>
                </tr>
                <tr class="pressure-table-detail">
                    <td colspan="8">
                        <div class="pressure-detail-inner">
                            ${batterPhaseHtml(b.phaseStats)}
                            ${batterBandTable(b.bandBreakdown)}
                        </div>
                    </td>
                </tr>`;
            };

            // Build bowler row
            const bowlerRow = (bw, idx) => {
                const sampleCls = bw.legalBalls >= 120 ? 'large' : bw.legalBalls >= 60 ? 'medium' : 'small';
                const sampleLabel = bw.legalBalls >= 120 ? 'L' : bw.legalBalls >= 60 ? 'M' : 'S';
                return `
                <tr class="pressure-table-row" onclick="this.classList.toggle('expanded'); this.nextElementSibling.classList.toggle('visible');">
                    <td>${idx + 1}</td>
                    <td class="pressure-table-name">
                        <span class="player-name-text player-clickable" onclick="event.stopPropagation(); openPlayerProfile('${bw.name.replace(/'/g, "\\\\'")}')">${bw.name}</span>
                        <span class="pressure-table-role-tag bwl">BWL</span>
                    </td>
                    <td>${ratingBadge(bw.rating)}</td>
                    <td>${econDisplay(bw.economy)}</td>
                    <td><span style="color: var(--text-secondary);">${bw.dotBallPct.toFixed(1)}%</span></td>
                    <td><span style="color: var(--text-secondary);">${bw.wickets} wkt</span></td>
                    <td><span class="sample-badge sample-${sampleCls}">${sampleLabel}</span> ${bw.legalBalls}</td>
                    <td><span class="pressure-band-tag ${bandTagClass(bw.pressureBand)}" style="font-size:10px;">${bw.pressureBand.replace('_',' ')}</span></td>
                </tr>
                <tr class="pressure-table-detail">
                    <td colspan="8">
                        <div class="pressure-detail-inner">
                            ${bowlerPhaseHtml(bw.phaseStats)}
                            ${bowlerBandTable(bw.bandBreakdown)}
                        </div>
                    </td>
                </tr>`;
            };

            const batterRowsHtml = allBatters.map((b, i) => batterRow(b, i)).join('');
            const bowlerRowsHtml = allBowlers.map((bw, i) => bowlerRow(bw, i)).join('');

            const qualNote = meta ? `
                <div class="pressure-qual-note">
                    <strong>Qualification:</strong> Batters need ${meta.minBatterPressureBalls}+ pressure balls (RRR &ge; 10) and ${meta.minBatterOverallBalls}+ overall balls.
                    Bowlers need ${meta.minBowlerLegalBalls}+ balls across HIGH/EXTREME/NEAR_IMPOSSIBLE bands (${meta.minBowlerBandBalls}+ per band).
                    <span class="pressure-qual-note-prominent"><span>Sample sizes: L = large, M = medium, S = small &mdash; interpret S with caution</span></span>
                    Click any player card to expand RRR band breakdown and over-phase execution stats.
                </div>` : '';

            pressureContent.innerHTML = `
                <div class="pressure-header">
                    <div class="pressure-header-info">
                        <h3>Pressure Performance</h3>
                        <p>How ${team.fullName} players perform when RRR >= 10 (since 2023)</p>
                    </div>
                    <div class="clutch-score-display">
                        <div class="clutch-score-value" style="color: ${clutchColor};">${s.clutchScore.toFixed(1)}</div>
                        <div class="clutch-score-label">Clutch Score</div>
                    </div>
                </div>

                <div class="pressure-methodology-toggle" onclick="this.classList.toggle('open'); this.nextElementSibling.classList.toggle('open');">
                    <span class="toggle-arrow">&#9660;</span> &#128203; Methodology &amp; Conditions &mdash; How is this calculated?
                </div>
                <div class="pressure-methodology-body">
                    <div class="meth-section">
                        <h4>1. Data Scope</h4>
                        <ul>
                            <li>IPL matches from <strong>2023&ndash;2025 only</strong> (since 2023)</li>
                            <li><strong>2nd innings (chase) only</strong> &mdash; pressure is defined by the required run rate during a chase</li>
                            <li>Source views: <code>analytics_ipl_pressure_deltas_since2023</code>, <code>analytics_ipl_batter_pressure_bands_since2023</code>, <code>analytics_ipl_bowler_pressure_bands_since2023</code></li>
                        </ul>
                    </div>
                    <div class="meth-section">
                        <h4>2. What Defines "Pressure"</h4>
                        <ul>
                            <li>Required Run Rate (RRR) <strong>&ge; 10.0</strong> runs per over</li>
                            <li>Formula: <code>RRR = (Target &minus; Cumulative Runs) &times; 6.0 / Balls Remaining</code></li>
                            <li>Only balls where <code>balls_remaining &gt; 0</code></li>
                        </ul>
                    </div>
                    <div class="meth-section">
                        <h4>3. RRR Pressure Bands</h4>
                        <table class="meth-table">
                            <thead><tr><th>Band</th><th>RRR Range</th><th>Description</th></tr></thead>
                            <tbody>
                                <tr><td class="meth-label">COMFORTABLE</td><td>RRR &lt; 8</td><td>Run rate is manageable, batters can play normally</td></tr>
                                <tr><td class="meth-label">BUILDING</td><td>8 &le; RRR &lt; 10</td><td>Above par, scoring needs to accelerate</td></tr>
                                <tr><td class="meth-label">HIGH</td><td>10 &le; RRR &lt; 12</td><td>Aggressive required, boundaries needed every 2&ndash;3 balls</td></tr>
                                <tr><td class="meth-label">EXTREME</td><td>12 &le; RRR &lt; 15</td><td>Six-hitting territory, almost every ball must score</td></tr>
                                <tr><td class="meth-label">NEAR_IMPOSSIBLE</td><td>RRR &ge; 15</td><td>Miracle needed, requires continuous boundaries to win</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="meth-section">
                        <h4>4. Over Phases (Under Pressure)</h4>
                        <table class="meth-table">
                            <thead><tr><th>Phase</th><th>DB Over Index</th><th>Human Overs</th><th>Description</th></tr></thead>
                            <tbody>
                                <tr><td class="meth-label">Setup</td><td>14&ndash;16</td><td>Overs 15&ndash;17</td><td>Where batting teams begin acceleration</td></tr>
                                <tr><td class="meth-label">Death</td><td>17&ndash;19</td><td>Overs 18&ndash;20</td><td>Highest-leverage balls of the innings</td></tr>
                            </tbody>
                        </table>
                        <p style="margin-top: 6px;"><strong>Both phases:</strong> Only counted when RRR &ge; 10 at that specific ball.</p>
                    </div>
                    <div class="meth-section">
                        <h4>5. Entry Context (Batters Only)</h4>
                        <table class="meth-table">
                            <thead><tr><th>Context</th><th>Balls Faced Before Pressure</th><th>Meaning</th></tr></thead>
                            <tbody>
                                <tr><td class="meth-label">FRESH</td><td>&lt; 8 balls</td><td>Walked in during pressure phase &mdash; facing it cold</td></tr>
                                <tr><td class="meth-label">BUILDING</td><td>8&ndash;12 balls</td><td>Getting set when pressure hit &mdash; partially established</td></tr>
                                <tr><td class="meth-label">SET</td><td>12&ndash;17 balls</td><td>Well established before pressure phase</td></tr>
                                <tr><td class="meth-label">DEEP_SET</td><td>&ge; 17 balls</td><td>Long innings before pressure &mdash; fully in rhythm</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="meth-section">
                        <h4>6. Qualification Thresholds (Who Appears on This Tab)</h4>
                        <table class="meth-table">
                            <thead><tr><th>Role</th><th>Condition</th></tr></thead>
                            <tbody>
                                <tr><td class="meth-label">Batters</td><td>&ge; 60 pressure balls (10 overs) <strong>AND</strong> &ge; 50 overall balls</td></tr>
                                <tr><td class="meth-label">Bowlers</td><td>&ge; 30 legal balls across HIGH / EXTREME / NEAR_IMPOSSIBLE bands, with &ge; 10 balls per individual band</td></tr>
                                <tr><td class="meth-label">Both</td><td>Player must be in an <strong>IPL 2026 squad</strong></td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="meth-section">
                        <h4>7. Pressure Ratings (How Players Are Tagged)</h4>
                        <table class="meth-table">
                            <thead><tr><th>Rating</th><th>Condition</th></tr></thead>
                            <tbody>
                                <tr><td class="meth-label">CLUTCH</td><td>SR improves 10%+ <strong>AND</strong> dot% drops in 12+ RRR bands</td></tr>
                                <tr><td class="meth-label">PRESSURE_PROOF</td><td>Metrics within &plusmn;5% of overall across all bands</td></tr>
                                <tr><td class="meth-label">MODERATE</td><td>Performance changes between 5&ndash;10% under pressure</td></tr>
                                <tr><td class="meth-label">PRESSURE_SENSITIVE</td><td>SR drops 10%+ <strong>OR</strong> dot% rises 10%+ in 12+ RRR bands</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="meth-section">
                        <h4>8. Weighted Score (Batter Ranking Metric)</h4>
                        <ul>
                            <li>Combines <strong>SR delta</strong> with <strong>sample size</strong> (log&#8322; scaling) and <strong>death overs bonus</strong> (30% weight for overs 16&ndash;20 execution)</li>
                        </ul>
                    </div>
                    <div class="meth-section">
                        <h4>9. Filter Behavior</h4>
                        <table class="meth-table">
                            <thead><tr><th>Filter</th><th>Behavior</th></tr></thead>
                            <tbody>
                                <tr><td class="meth-label">Phase</td><td>Shows top 5 players sorted by that phase's SR (batters) or economy (bowlers)</td></tr>
                                <tr><td class="meth-label">Band</td><td>Shows top 5 sorted by band-specific SR / economy; dims players without data in that band</td></tr>
                                <tr><td class="meth-label">Entry Context</td><td>Filters to batters matching that context, then shows top 5</td></tr>
                                <tr><td class="meth-label">Default (All)</td><td>Batters by weighted pressure score, bowlers by economy</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <table class="pressure-summary-table">
                    <thead>
                        <tr>
                            <th>Rating</th>
                            <th>Players</th>
                            <th>% of Squad</th>
                            <th>Indicator</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="color: var(--accent-green);">Clutch</td>
                            <td><span class="table-count" style="color: var(--accent-green);">${s.clutch}</span></td>
                            <td><span class="table-pct">${s.total > 0 ? ((s.clutch / s.total) * 100).toFixed(0) : 0}%</span></td>
                            <td><span class="pressure-badge clutch">SR +10% under pressure</span></td>
                        </tr>
                        <tr>
                            <td style="color: var(--accent);">Pressure-Proof</td>
                            <td><span class="table-count" style="color: var(--accent);">${s.pressureProof}</span></td>
                            <td><span class="table-pct">${s.total > 0 ? ((s.pressureProof / s.total) * 100).toFixed(0) : 0}%</span></td>
                            <td><span class="pressure-badge pressure-proof">Within &plusmn;5%</span></td>
                        </tr>
                        <tr>
                            <td style="color: var(--accent-yellow);">Moderate</td>
                            <td><span class="table-count" style="color: var(--accent-yellow);">${s.moderate}</span></td>
                            <td><span class="table-pct">${s.total > 0 ? ((s.moderate / s.total) * 100).toFixed(0) : 0}%</span></td>
                            <td><span class="pressure-badge moderate">5-10% change</span></td>
                        </tr>
                        <tr>
                            <td style="color: var(--accent-red);">Pressure-Sensitive</td>
                            <td><span class="table-count" style="color: var(--accent-red);">${s.pressureSensitive}</span></td>
                            <td><span class="table-pct">${s.total > 0 ? ((s.pressureSensitive / s.total) * 100).toFixed(0) : 0}%</span></td>
                            <td><span class="pressure-badge pressure-sensitive">SR -10% under pressure</span></td>
                        </tr>
                    </tbody>
                </table>

                ${filterBarHtml}

                <div class="pressure-section-title" style="margin-top: 16px;">Batters Under Pressure <span style="font-size: 10px; font-weight: 400; color: var(--text-tertiary); margin-left: 6px;">min 20 balls at RRR &ge; 10</span></div>
                <div class="roster-table-wrapper">
                <table class="roster-table phil-steele pressure-roster">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Player</th>
                            <th class="has-tooltip" data-tooltip="Pressure rating: CLUTCH, PRESSURE_PROOF, MODERATE, or PRESSURE_SENSITIVE">Rating</th>
                            <th class="has-tooltip" data-tooltip="Strike rate under pressure (RRR >= 10)">Pressure SR</th>
                            <th class="has-tooltip" data-tooltip="Change in SR from overall to pressure situations. Positive = better under pressure.">SR Delta</th>
                            <th class="has-tooltip" data-tooltip="Weighted pressure score combining SR delta, sample size, and death overs bonus">W.Score</th>
                            <th class="has-tooltip" data-tooltip="Sample size: L (150+), M (80-149), S (<80 balls)">Sample</th>
                            <th class="has-tooltip" data-tooltip="How established the batter was when pressure began">Entry</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${batterRowsHtml || '<tr><td colspan="8" style="text-align:center; padding:24px; color:var(--text-tertiary);">No batter pressure data' + (pf.entry !== 'all' ? ' for ' + pf.entry.replace('_', ' ') + ' entry context' : '') + '</td></tr>'}
                    </tbody>
                </table>
                </div>

                <div class="pressure-section-title" style="margin-top: 24px;">Bowlers Under Pressure <span style="font-size: 10px; font-weight: 400; color: var(--text-tertiary); margin-left: 6px;">min 15 balls in HIGH+ bands</span></div>
                <div class="roster-table-wrapper">
                <table class="roster-table phil-steele pressure-roster">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Player</th>
                            <th class="has-tooltip" data-tooltip="Pressure rating: ELITE, STRONG, AVERAGE, or VULNERABLE">Rating</th>
                            <th class="has-tooltip" data-tooltip="Economy rate under pressure (HIGH+ RRR bands)">Economy</th>
                            <th class="has-tooltip" data-tooltip="Dot ball percentage under pressure">Dot%</th>
                            <th class="has-tooltip" data-tooltip="Wickets taken under pressure">Wkts</th>
                            <th class="has-tooltip" data-tooltip="Sample size: L (120+), M (60-119), S (<60 balls)">Sample</th>
                            <th class="has-tooltip" data-tooltip="Highest RRR pressure band with qualifying data">Top Band</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${bowlerRowsHtml || '<tr><td colspan="8" style="text-align:center; padding:24px; color:var(--text-tertiary);">No bowler pressure data</td></tr>'}
                    </tbody>
                </table>
                </div>

                ${qualNote}

                <div class="pressure-glossary-toggle" onclick="this.classList.toggle('open'); this.nextElementSibling.classList.toggle('open');">
                    <span class="toggle-arrow">&#9660;</span> What do these ratings mean?
                </div>
                <div class="pressure-glossary-body">
                    <div class="pressure-glossary-section">
                        <h4>Pressure Bands (RRR-Based)</h4>
                        <table class="pressure-glossary-table">
                            <thead><tr><th>Band</th><th>RRR Range</th><th>What It Means</th></tr></thead>
                            <tbody>
                                <tr><td class="band-tag">COMFORTABLE</td><td>&lt; 8</td><td>Cruising â€” run rate is manageable, batters can play normally</td></tr>
                                <tr><td class="band-tag">BUILDING</td><td>8 &ndash; 10</td><td>Above par â€” scoring needs to accelerate, risk-taking begins</td></tr>
                                <tr><td class="band-tag">HIGH</td><td>10 &ndash; 12</td><td>Aggressive required â€” boundaries needed every 2-3 balls</td></tr>
                                <tr><td class="band-tag">EXTREME</td><td>12 &ndash; 15</td><td>Six-hitting territory â€” almost every ball must score</td></tr>
                                <tr><td class="band-tag">NEAR_IMPOSSIBLE</td><td>15+</td><td>Miracle needed â€” requires continuous boundaries to win</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="pressure-glossary-section">
                        <h4>Pressure Ratings (Performance Tags)</h4>
                        <table class="pressure-glossary-table">
                            <thead><tr><th>Rating</th><th>For Batters</th><th>For Bowlers</th></tr></thead>
                            <tbody>
                                <tr><td class="band-tag">CLUTCH</td><td>SR improves 10%+ AND dot% drops in 12+ RRR bands</td><td>Economy improves AND dot% rises in 12+ RRR bands</td></tr>
                                <tr><td class="band-tag">PRESSURE_PROOF</td><td>Metrics within &plusmn;5% of overall across all bands</td><td>Metrics within &plusmn;5% of overall across all bands</td></tr>
                                <tr><td class="band-tag">MODERATE</td><td>Performance changes between 5-10% under pressure</td><td>Economy/dot% changes 5-10% under pressure</td></tr>
                                <tr><td class="band-tag">PRESSURE_SENSITIVE</td><td>SR drops 10%+ OR dot% rises 10%+ in 12+ RRR bands</td><td>Economy rises 15%+ OR boundary% conceded rises 10%+</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="pressure-glossary-section">
                        <h4>Entry Context (Batter Only)</h4>
                        <table class="pressure-glossary-table">
                            <thead><tr><th>Context</th><th>Balls Before Pressure</th><th>Meaning</th></tr></thead>
                            <tbody>
                                <tr><td class="band-tag">FRESH</td><td>&lt; 10</td><td>Walked in during pressure phase â€” facing it cold</td></tr>
                                <tr><td class="band-tag">BUILDING</td><td>10 &ndash; 25</td><td>Getting set when pressure hit â€” partially established</td></tr>
                                <tr><td class="band-tag">SET</td><td>25 &ndash; 40</td><td>Well established before pressure phase</td></tr>
                                <tr><td class="band-tag">DEEP_SET</td><td>40+</td><td>Long innings before pressure â€” fully in rhythm</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="pressure-glossary-section">
                        <h4>Other Terms</h4>
                        <table class="pressure-glossary-table">
                            <tbody>
                                <tr><td class="band-tag" style="width: 140px;">Weighted Score</td><td>Composite metric combining SR delta with sample size (log&#8322; scaling) and death overs bonus (30% weight for overs 16-20 execution)</td></tr>
                                <tr><td class="band-tag">SR Delta</td><td>Percentage change in strike rate between overall performance and pressure situations. Positive = better under pressure.</td></tr>
                                <tr><td class="band-tag">Overs 15-17</td><td>Setup phase under pressure â€” where batting teams begin acceleration and bowlers set up their death plans</td></tr>
                                <tr><td class="band-tag">Overs 18-20</td><td>Death execution phase â€” the highest-leverage balls of the innings where pressure performance matters most</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function renderSquadTable(team, squadData) {
            const squadContent = document.getElementById('squad-content');
            const squad = squadData.squad;

            // Apply filters
            let filteredSquad = squad.filter(player => {
                // Search filter
                if (squadFilters.search && !player.name.toLowerCase().includes(squadFilters.search.toLowerCase())) {
                    return false;
                }
                // Role filter
                if (squadFilters.role && player.role !== squadFilters.role) {
                    return false;
                }
                // Nationality filter
                if (squadFilters.nationality === 'IND' && player.nationality !== 'IND') {
                    return false;
                }
                if (squadFilters.nationality === 'Overseas' && player.nationality === 'IND') {
                    return false;
                }
                // Age filter
                if (squadFilters.ageGroup) {
                    if (squadFilters.ageGroup === 'U25' && player.age >= 25) return false;
                    if (squadFilters.ageGroup === '25-30' && (player.age < 25 || player.age > 30)) return false;
                    if (squadFilters.ageGroup === '31+' && player.age < 31) return false;
                }
                return true;
            });

            // Calculate stats
            const totalSpent = squadData.purseSpent;
            const totalRemaining = squadData.purseRemaining;
            const overseas = squad.filter(p => p.nationality !== 'IND').length;
            const retained = squad.filter(p => p.retainedStatus === 'Retained').length;
            const avgAge = (squad.reduce((sum, p) => sum + p.age, 0) / squad.length).toFixed(1);

            // Role breakdown
            const batters = squad.filter(p => p.role === 'Batter').length;
            const bowlers = squad.filter(p => p.role === 'Bowler').length;
            const allRounders = squad.filter(p => p.role === 'All-rounder').length;
            const keepers = squad.filter(p => p.role === 'Wicketkeeper').length;

            // Nationality flags
            const getFlag = (nat) => {
                const flags = {
                    'IND': 'ðŸ‡®ðŸ‡³', 'AUS': 'ðŸ‡¦ðŸ‡º', 'ENG': 'ðŸ´ó §ó ¢ó ¥ó ®ó §ó ¿', 'SA': 'ðŸ‡¿ðŸ‡¦', 'NZ': 'ðŸ‡³ðŸ‡¿',
                    'WI': 'ðŸï¸', 'AFG': 'ðŸ‡¦ðŸ‡«', 'SL': 'ðŸ‡±ðŸ‡°', 'PAK': 'ðŸ‡µðŸ‡°'
                };
                return flags[nat] || 'ðŸŒ';
            };

            // Role class
            const getRoleClass = (role) => {
                const classes = {
                    'Batter': 'role-batter',
                    'Bowler': 'role-bowler',
                    'All-rounder': 'role-all-rounder',
                    'Wicketkeeper': 'role-wicketkeeper'
                };
                return classes[role] || '';
            };

            // Price class
            const getPriceClass = (price) => {
                if (price >= 10) return 'price-high';
                if (price >= 3) return 'price-mid';
                return 'price-low';
            };

            // Age class
            const getAgeClass = (age) => {
                if (age <= 24) return 'age-young';
                if (age <= 32) return 'age-prime';
                return 'age-veteran';
            };

            const isFiltered = filteredSquad.length !== squad.length;
            const filterCountText = isFiltered ? `Showing <strong>${filteredSquad.length}</strong> of ${squad.length} players` : '';

            squadContent.innerHTML = `
                <div class="squad-header">
                    <h3>ðŸ“‹ Full Squad Roster</h3>
                    <div class="squad-stats">
                        <div class="squad-stat">
                            <div class="squad-stat-value">${squad.length}</div>
                            <div class="squad-stat-label has-tooltip" data-tooltip="Total players in the squad roster">Players</div>
                        </div>
                        <div class="squad-stat">
                            <div class="squad-stat-value">â‚¹${totalSpent.toFixed(1)}Cr</div>
                            <div class="squad-stat-label has-tooltip" data-tooltip="Total auction spend in Indian Rupees (Crores)">Spent</div>
                        </div>
                        <div class="squad-stat">
                            <div class="squad-stat-value">${overseas}</div>
                            <div class="squad-stat-label has-tooltip" data-tooltip="Non-Indian players (max 4 can play in XI)">Overseas</div>
                        </div>
                        <div class="squad-stat">
                            <div class="squad-stat-value">${avgAge}</div>
                            <div class="squad-stat-label has-tooltip" data-tooltip="Average age of squad members">Avg Age</div>
                        </div>
                    </div>
                </div>

                <div class="search-filter-bar">
                    <div class="search-box">
                        <input type="text" id="squad-search" placeholder="Search players..." value="${squadFilters.search}" onkeyup="handleSquadSearch(event)">
                    </div>
                    <div class="filter-group">
                        <select class="filter-select" id="filter-role" onchange="handleFilterChange()">
                            <option value="">All Roles</option>
                            <option value="Batter" ${squadFilters.role === 'Batter' ? 'selected' : ''}>Batter</option>
                            <option value="Bowler" ${squadFilters.role === 'Bowler' ? 'selected' : ''}>Bowler</option>
                            <option value="All-rounder" ${squadFilters.role === 'All-rounder' ? 'selected' : ''}>All-rounder</option>
                            <option value="Wicketkeeper" ${squadFilters.role === 'Wicketkeeper' ? 'selected' : ''}>Wicketkeeper</option>
                        </select>
                        <select class="filter-select" id="filter-nationality" onchange="handleFilterChange()">
                            <option value="">All Nationalities</option>
                            <option value="IND" ${squadFilters.nationality === 'IND' ? 'selected' : ''}>ðŸ‡®ðŸ‡³ Indian</option>
                            <option value="Overseas" ${squadFilters.nationality === 'Overseas' ? 'selected' : ''}>ðŸŒ Overseas</option>
                        </select>
                        <select class="filter-select" id="filter-age" onchange="handleFilterChange()">
                            <option value="">All Ages</option>
                            <option value="U25" ${squadFilters.ageGroup === 'U25' ? 'selected' : ''}>Under 25</option>
                            <option value="25-30" ${squadFilters.ageGroup === '25-30' ? 'selected' : ''}>25-30</option>
                            <option value="31+" ${squadFilters.ageGroup === '31+' ? 'selected' : ''}>31+</option>
                        </select>
                    </div>
                    <button class="export-btn" onclick="exportSquadCSV()">
                        ðŸ“¥ Export CSV
                    </button>
                </div>
                ${isFiltered ? `<div class="filter-count">${filterCountText}</div>` : ''}

                <div class="roster-table-wrapper">
                <table class="roster-table phil-steele">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Player</th>
                            <th class="has-tooltip" data-tooltip="Primary playing role: Batter, Bowler, All-rounder, or Wicketkeeper">Role</th>
                            <th class="has-tooltip" data-tooltip="Batting hand: R (Right) or L (Left)">Bat</th>
                            <th class="has-tooltip" data-tooltip="Bowling arm and type (e.g., RA Fast = Right-arm Fast)">Bowl</th>
                            <th class="has-tooltip" data-tooltip="Player archetype from clustering analysis (e.g., Power Hitter, Anchor, Finisher)">Archetype</th>
                            <th class="has-tooltip" data-tooltip="Phase specialization split by batting (BAT) and bowling (BWL): PP (1-6), MID (7-15), DTH (16-20)">Phase</th>
                            <th class="has-tooltip" data-tooltip="Player's current age">Age</th>
                            <th class="has-tooltip" data-tooltip="IPL matches played (max of batting innings or bowling matches since 2023). U = uncapped">IPL</th>
                            <th class="has-tooltip" data-tooltip="Nationality: Indian or Overseas (max 4 overseas per XI)">Nat</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredSquad.length === 0 ? `
                            <tr>
                                <td colspan="10" style="text-align: center; padding: 32px; color: var(--text-tertiary);">
                                    No players match your filters. Try adjusting your search criteria.
                                </td>
                            </tr>
                        ` : filteredSquad.map((player, idx) => {
                            const archetype = player.batterClass !== '-' ? player.batterClass : player.bowlerClass !== '-' ? player.bowlerClass : '-';
                            // Bowl column: arm abbreviation + type
                            const bowlArm = player.bowlingArm === 'Left-arm' ? 'LA' : player.bowlingArm === 'Right-arm' ? 'RA' : '';
                            const bowlTypeRaw = player.bowlingType !== '-' ? player.bowlingType : '';
                            const bowlType = bowlTypeRaw === 'LA Orthodox' ? 'Orthodox' : bowlTypeRaw;
                            const isLeftArm = bowlArm === 'LA';
                            const batHand = player.batting ? (player.batting.includes('Left') ? 'L' : 'R') : '-';
                            const isExtendedSquad = idx >= 11; // Beyond Predicted XI

                            // Phase indicators - separated by batting and bowling (TKT-111 / TKT-181)
                            const batTags = player.batterTags || [];
                            const bowlTags = player.bowlerTags || [];

                            // Batting phase detection
                            const batPP = batTags.some(t => t.includes('PP_') || t === 'EXPLOSIVE_OPENER');
                            const batMid = batTags.some(t => t.includes('MIDDLE') || t === 'ACCUMULATOR' || t === 'ANCHOR' || t === 'MIDDLE_OVERS_ACCELERATOR');
                            const batDeath = batTags.some(t => t.includes('DEATH') || t === 'FINISHER');
                            const hasBatPhase = batPP || batMid || batDeath;

                            // Bowling phase detection
                            const bwlPP = bowlTags.some(t => t.includes('PP_') || t === 'NEW_BALL_SPECIALIST');
                            const bwlMid = bowlTags.some(t => t.includes('MID_') || t.includes('MIDDLE') || t === 'WORKHORSE');
                            const bwlDeath = bowlTags.some(t => t.includes('DEATH'));
                            const hasBwlPhase = bwlPP || bwlMid || bwlDeath;

                            let phaseHtml;
                            if (hasBatPhase || hasBwlPhase) {
                                let rows = '';
                                if (hasBatPhase) {
                                    rows += `<div class="phase-row">
                                        <span class="phase-label">BAT</span>
                                        ${batPP ? '<span class="phase-tag pp-elite" title="Batting: Powerplay (1-6)">PP</span>' : ''}
                                        ${batMid ? '<span class="phase-tag mid-elite" title="Batting: Middle overs (7-15)">MID</span>' : ''}
                                        ${batDeath ? '<span class="phase-tag death-elite" title="Batting: Death overs (16-20)">DTH</span>' : ''}
                                    </div>`;
                                }
                                if (hasBwlPhase) {
                                    rows += `<div class="phase-row">
                                        <span class="phase-label">BWL</span>
                                        ${bwlPP ? '<span class="phase-tag pp-elite" title="Bowling: Powerplay (1-6)">PP</span>' : ''}
                                        ${bwlMid ? '<span class="phase-tag mid-elite" title="Bowling: Middle overs (7-15)">MID</span>' : ''}
                                        ${bwlDeath ? '<span class="phase-tag death-elite" title="Bowling: Death overs (16-20)">DTH</span>' : ''}
                                    </div>`;
                                }
                                phaseHtml = `<div class="phase-group">${rows}</div>`;
                            } else {
                                phaseHtml = '<span class="na-badge">-</span>';
                            }
                            return `
                            <tr class="${player.isCaptain ? 'captain-row' : ''} ${isExtendedSquad ? 'extended-squad-row' : ''}">
                                <td>
                                    <div class="player-number">${player.isCaptain ? 'ðŸ‘‘' : idx + 1}</div>
                                </td>
                                <td>
                                    <div class="player-name-cell">
                                        <span class="player-name-text player-clickable" onclick="openPlayerProfile('${player.name.replace(/'/g, "\\\\'")}', '${player.playerId}')">${player.name}</span>
                                    </div>
                                </td>
                                <td>
                                    <span class="role-badge ${getRoleClass(player.role)}">${player.role.substring(0, 3).toUpperCase()}</span>
                                </td>
                                <td class="compact-cell">
                                    <span class="hand-badge ${batHand === 'L' ? 'left-hand' : ''}">${batHand}</span>
                                </td>
                                <td class="compact-cell bowl-cell">
                                    ${bowlType ? `<span class="bowl-type-badge"><span class="bowl-arm ${isLeftArm ? 'left-arm' : ''}">${bowlArm}</span>${bowlType}</span>` : '<span class="na-badge">-</span>'}
                                </td>
                                <td class="archetype-cell">
                                    ${archetype !== '-' ? `<span class="archetype-badge">${archetype}</span>` : '<span class="na-badge">-</span>'}
                                </td>
                                <td class="phase-cell">
                                    ${phaseHtml}
                                </td>
                                <td>
                                    <span class="age-cell ${getAgeClass(player.age)}">${player.age}</span>
                                </td>
                                <td class="compact-cell">
                                    <span class="ipl-exp-badge ${player.isUncapped ? 'uncapped' : (player.iplMatches || 0) >= 30 ? 'veteran' : ''}">${player.isUncapped ? 'U' : (player.iplMatches || 0)}</span>
                                </td>
                                <td>
                                    <span class="nat-badge ${player.nationality !== 'IND' ? 'overseas' : ''}">
                                        ${getFlag(player.nationality)}
                                    </span>
                                </td>
                            </tr>
                        `}).join('')}
                    </tbody>
                </table>
                </div>
                ${filteredSquad.length > 11 ? `
                <div class="show-more-container">
                    <button class="show-more-btn" onclick="toggleExtendedSquad()">
                        <span class="show-more-text">Show Full Squad (+${filteredSquad.length - 11} more)</span>
                        <span class="show-less-text" style="display: none;">Show Predicted XI Only</span>
                    </button>
                    <span class="show-more-hint">Currently showing Predicted XI (top 11)</span>
                </div>
                ` : ''}

                <div class="squad-summary">
                    <div class="summary-card">
                        <h4>Squad Composition</h4>
                        <div class="summary-breakdown">
                            <div class="breakdown-row">
                                <span class="breakdown-label">Batters</span>
                                <span class="breakdown-value">${batters}</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">Bowlers</span>
                                <span class="breakdown-value">${bowlers}</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">All-rounders</span>
                                <span class="breakdown-value">${allRounders}</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">Wicketkeepers</span>
                                <span class="breakdown-value">${keepers}</span>
                            </div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <h4>Auction Summary</h4>
                        <div class="summary-breakdown">
                            <div class="breakdown-row">
                                <span class="breakdown-label">Total Spent</span>
                                <span class="breakdown-value">â‚¹${totalSpent.toFixed(2)} Cr</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">Remaining</span>
                                <span class="breakdown-value">â‚¹${totalRemaining.toFixed(2)} Cr</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">Retained</span>
                                <span class="breakdown-value">${retained} players</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">Bought at Auction</span>
                                <span class="breakdown-value">${squad.length - retained} players</span>
                            </div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <h4>Age Distribution</h4>
                        <div class="summary-breakdown">
                            <div class="breakdown-row">
                                <span class="breakdown-label">Under 25</span>
                                <span class="breakdown-value">${squad.filter(p => p.age < 25).length}</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">25-30</span>
                                <span class="breakdown-value">${squad.filter(p => p.age >= 25 && p.age <= 30).length}</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">31-35</span>
                                <span class="breakdown-value">${squad.filter(p => p.age >= 31 && p.age <= 35).length}</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">Over 35</span>
                                <span class="breakdown-value">${squad.filter(p => p.age > 35).length}</span>
                            </div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <h4>Nationalities</h4>
                        <div class="summary-breakdown">
                            <div class="breakdown-row">
                                <span class="breakdown-label">ðŸ‡®ðŸ‡³ Indian</span>
                                <span class="breakdown-value">${squad.filter(p => p.nationality === 'IND').length}</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">ðŸŒ Overseas</span>
                                <span class="breakdown-value">${overseas}</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">Countries</span>
                                <span class="breakdown-value">${new Set(squad.map(p => p.nationality)).size}</span>
                            </div>
                        </div>
                    </div>
                    <div class="summary-card">
                        <h4>IPL Experience</h4>
                        <div class="summary-breakdown">
                            ${(() => {
                                const experienced = squad.filter(p => (p.iplMatches || 0) > 0).sort((a,b) => b.iplMatches - a.iplMatches);
                                const uncapped = squad.filter(p => p.isUncapped).length;
                                const totalMatches = squad.reduce((sum, p) => sum + (p.iplMatches || 0), 0);
                                const avgMatches = experienced.length > 0 ? Math.round(totalMatches / squad.length) : 0;
                                const mostExp = experienced.length > 0 ? experienced[0] : null;
                                return `
                                <div class="breakdown-row">
                                    <span class="breakdown-label">Uncapped Players</span>
                                    <span class="breakdown-value">${uncapped}</span>
                                </div>
                                <div class="breakdown-row">
                                    <span class="breakdown-label">Avg IPL Matches</span>
                                    <span class="breakdown-value">${avgMatches}</span>
                                </div>
                                <div class="breakdown-row">
                                    <span class="breakdown-label">Most Experienced</span>
                                    <span class="breakdown-value">${mostExp ? mostExp.name.split(' ').pop() + ' (' + mostExp.iplMatches + ')' : '-'}</span>
                                </div>
                                <div class="breakdown-row">
                                    <span class="breakdown-label">IPL Veterans (30+)</span>
                                    <span class="breakdown-value">${squad.filter(p => (p.iplMatches || 0) >= 30).length}</span>
                                </div>
                                `;
                            })()}
                        </div>
                    </div>
                </div>
            `;
        }

        // Filter handlers
        function handleSquadSearch(event) {
            squadFilters.search = event.target.value;
            renderSquadTable(TEAMS[currentTeam], SQUADS[currentTeam]);
        }

        function handleFilterChange() {
            squadFilters.role = document.getElementById('filter-role').value;
            squadFilters.nationality = document.getElementById('filter-nationality').value;
            squadFilters.ageGroup = document.getElementById('filter-age').value;
            renderSquadTable(TEAMS[currentTeam], SQUADS[currentTeam]);
        }

        function clearFilters() {
            squadFilters = { search: '', role: '', nationality: '', ageGroup: '' };
            renderSquadTable(TEAMS[currentTeam], SQUADS[currentTeam]);
        }

        // Toggle extended squad visibility (Progressive Disclosure - TKT-110)
        function toggleExtendedSquad() {
            const squadContent = document.getElementById('squad-content');
            squadContent.classList.toggle('squad-expanded');
        }

        // Export squad to CSV
        function exportSquadCSV() {
            const squadData = SQUADS[currentTeam];
            const squad = squadData.squad;
            const team = TEAMS[currentTeam];

            // CSV header
            const headers = ['#', 'Player', 'Role', 'Age', 'Nationality', 'Batting Hand', 'Price (Cr)', 'Retained'];

            // CSV rows
            const rows = squad.map((player, idx) => [
                idx + 1,
                player.name,
                player.role,
                player.age,
                player.nationality,
                player.batting,
                player.price.toFixed(2),
                player.retainedStatus === 'Retained' ? 'Yes' : 'No'
            ]);

            // Build CSV content
            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
            ].join('\n');

            // Add team summary
            const summary = `\n\n"Team Summary"\n"Total Spent","â‚¹${squadData.purseSpent.toFixed(2)} Cr"\n"Remaining","â‚¹${squadData.purseRemaining.toFixed(2)} Cr"\n"Total Players","${squad.length}"`;

            // Create and download file
            const blob = new Blob([csvContent + summary], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `${currentTeam}_squad_ipl2026.csv`;
            link.click();
            URL.revokeObjectURL(link.href);
        }

        // Render Compare View
        function renderCompareView() {
            const compareContent = document.getElementById('compare-content');

            const teamOptions = TEAM_ORDER.map(abbrev =>
                `<option value="${abbrev}" ${abbrev === compareTeam ? 'selected' : ''}>${TEAMS[abbrev].fullName}</option>`
            ).join('');

            const team1 = TEAMS[currentTeam];
            const team2 = TEAMS[compareTeam];
            const pixelLogo1 = TEAM_PIXEL_LOGOS[currentTeam] || team1.icon;
            const pixelLogo2 = TEAM_PIXEL_LOGOS[compareTeam] || team2.icon;
            const squad1 = SQUADS[currentTeam];
            const squad2 = SQUADS[compareTeam];
            const predicted1 = PREDICTED_XII[currentTeam];
            const predicted2 = PREDICTED_XII[compareTeam];
            const rating1 = DEPTH_CHART_RATINGS[currentTeam];
            const rating2 = DEPTH_CHART_RATINGS[compareTeam];

            // Pressure data for clutch score comparison
            const pressure1 = typeof PRESSURE_DATA !== 'undefined' ? PRESSURE_DATA[currentTeam] : null;
            const pressure2 = typeof PRESSURE_DATA !== 'undefined' ? PRESSURE_DATA[compareTeam] : null;

            // Calculate comparison metrics
            const metrics = [
                { label: 'Overall Rating', val1: rating1.overall, val2: rating2.overall, higher: 'better', tooltip: 'Composite team strength rating (0-100)' },
                { label: 'Titles Won', val1: team1.titles, val2: team2.titles, higher: 'better', tooltip: 'IPL championship titles won' },
                { label: 'Squad Size', val1: squad1.squad.length, val2: squad2.squad.length, higher: 'neutral', tooltip: 'Total players in squad roster' },
                { label: 'Purse Spent (Cr)', val1: squad1.purseSpent.toFixed(1), val2: squad2.purseSpent.toFixed(1), higher: 'neutral', tooltip: 'Auction spend in Indian Rupees (Crores)' },
                { label: 'Purse Remaining (Cr)', val1: squad1.purseRemaining.toFixed(1), val2: squad2.purseRemaining.toFixed(1), higher: 'neutral', tooltip: 'Remaining auction budget out of 120 Cr salary cap' },
                { label: 'Overseas Players', val1: squad1.squad.filter(p => p.nationality !== 'IND').length, val2: squad2.squad.filter(p => p.nationality !== 'IND').length, higher: 'neutral', tooltip: 'Non-Indian players (max 4 can play per XI)' },
                { label: 'Avg Squad Age', val1: (squad1.squad.reduce((s, p) => s + p.age, 0) / squad1.squad.length).toFixed(1), val2: (squad2.squad.reduce((s, p) => s + p.age, 0) / squad2.squad.length).toFixed(1), higher: 'neutral', tooltip: 'Average age of squad members' },
                { label: 'Batters', val1: squad1.squad.filter(p => p.role === 'Batter').length, val2: squad2.squad.filter(p => p.role === 'Batter').length, higher: 'neutral', tooltip: 'Players whose primary role is batting' },
                { label: 'Bowlers', val1: squad1.squad.filter(p => p.role === 'Bowler').length, val2: squad2.squad.filter(p => p.role === 'Bowler').length, higher: 'neutral', tooltip: 'Players whose primary role is bowling' },
                { label: 'All-Rounders', val1: squad1.squad.filter(p => p.role === 'All-rounder').length, val2: squad2.squad.filter(p => p.role === 'All-rounder').length, higher: 'neutral', tooltip: 'Players who contribute with both bat and ball' },
                { label: 'Left-Handers in Top 6', val1: predicted1.balance.leftHandersTop6, val2: predicted2.balance.leftHandersTop6, higher: 'neutral', tooltip: 'Left-handed batters in top 6 positions (disrupts bowling rhythm)' },
                { label: 'Bowling Options', val1: predicted1.balance.bowlingOptions, val2: predicted2.balance.bowlingOptions, higher: 'better', tooltip: 'Total bowling options available in predicted XI (part-timers included)' },
                { label: 'Spinners in XI', val1: predicted1.balance.spinners, val2: predicted2.balance.spinners, higher: 'neutral', tooltip: 'Spin bowling options in predicted XI' },
                { label: 'Pacers in XI', val1: predicted1.balance.pacers, val2: predicted2.balance.pacers, higher: 'neutral', tooltip: 'Pace bowling options in predicted XI' },
                { label: 'Strongest Position', val1: rating1.strongest, val2: rating2.strongest, higher: 'neutral', tooltip: 'Highest-rated position in depth chart' },
                { label: 'Weakest Position', val1: rating1.weakest, val2: rating2.weakest, higher: 'neutral', tooltip: 'Lowest-rated position in depth chart (area of concern)' },
                { label: 'Venue Bias', val1: predicted1.venueBias.charAt(0).toUpperCase() + predicted1.venueBias.slice(1), val2: predicted2.venueBias.charAt(0).toUpperCase() + predicted2.venueBias.slice(1), higher: 'neutral', tooltip: 'Home venue surface bias (pace or spin favoring)' },
                { label: 'Clutch Score', val1: pressure1 ? pressure1.summary.clutchScore.toFixed(1) : 'N/A', val2: pressure2 ? pressure2.summary.clutchScore.toFixed(1) : 'N/A', higher: 'better', tooltip: 'Team clutch performance rating under pressure (RRR >= 10)' },
            ];

            const getCompareClass = (metric, isTeam1) => {
                const v1 = parseFloat(metric.val1);
                const v2 = parseFloat(metric.val2);
                if (metric.higher === 'neutral' || v1 === v2) return '';
                if (isTeam1) {
                    return v1 > v2 ? 'better' : 'worse';
                }
                return v2 > v1 ? 'better' : 'worse';
            };

            compareContent.innerHTML = `
                <div class="compare-container">
                    <div class="compare-team" style="border-top: 4px solid ${team1.primaryColor};">
                        <div class="compare-team-header">
                            <span class="compare-team-icon">${pixelLogo1}</span>
                            <span class="compare-team-name">${team1.fullName}</span>
                        </div>
                        <div class="compare-stats">
                            ${metrics.map(m => `
                                <div class="compare-stat-row">
                                    <span class="compare-stat-label has-tooltip" data-tooltip="${m.tooltip}">${m.label}</span>
                                    <span class="compare-stat-value ${getCompareClass(m, true)}">${m.val1}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="compare-team" style="border-top: 4px solid ${team2.primaryColor};">
                        <div class="compare-team-header">
                            <span class="compare-team-icon">${pixelLogo2}</span>
                            <span class="compare-team-name">${team2.fullName}</span>
                            <select onchange="updateCompareTeam(this.value)">${teamOptions}</select>
                        </div>
                        <div class="compare-stats">
                            ${metrics.map(m => `
                                <div class="compare-stat-row">
                                    <span class="compare-stat-label has-tooltip" data-tooltip="${m.tooltip}">${m.label}</span>
                                    <span class="compare-stat-value ${getCompareClass(m, false)}">${m.val2}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                <p style="text-align: center; color: var(--text-tertiary); font-size: 13px; margin-top: 24px;">
                    ðŸ’¡ Green indicates a better value, red indicates a lower value for comparative metrics.
                </p>
            `;
        }

        function updateCompareTeam(abbrev) {
            if (abbrev !== currentTeam) {
                compareTeam = abbrev;
                renderCompareView();
            }
        }

        // Tab switching
        document.querySelectorAll('.content-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.content-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                tab.classList.add('active');
                const tabId = tab.dataset.tab;
                document.getElementById(`panel-${tabId}`).classList.add('active');

                // Render compare view when tab is clicked
                if (tabId === 'compare') {
                    renderCompareView();
                }
            });
        });

        // Timer - User's local timezone
        function updateTime() {
            document.getElementById('navTime').textContent = new Date().toLocaleTimeString('en-US', { hour12: false });
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const teamParam = params.get('team');
            if (teamParam && TEAMS[teamParam]) {
                currentTeam = teamParam;
            }
            populateTeamSelector();
            renderTeam();
            document.querySelector('.theme-toggle').textContent = savedTheme === 'dark' ? 'ðŸŒ™' : 'â˜€ï¸';
            updateTime();
            setInterval(updateTime, 1000);
        });

        // Navigation Guide
        function toggleNavGuide() {
            document.getElementById('nav-guide-overlay').classList.toggle('active');
        }
        function closeNavGuide(e) {
            if (e.target === e.currentTarget) toggleNavGuide();
        }

        // ==================== PLAYER PROFILE MODAL (TKT-200) ====================

        function openPlayerProfile(playerName, playerId, teamAbbrev) {
            const team = teamAbbrev || currentTeam;
            const profiles = typeof PLAYER_PROFILES !== 'undefined' ? PLAYER_PROFILES[team] : null;
            if (!profiles) {
                console.warn('No profile data for team:', team);
                return;
            }

            // Find profile by ID first, then by name
            let profile = playerId ? profiles[playerId] : null;
            if (!profile) {
                profile = Object.values(profiles).find(p => p.player_name === playerName);
            }
            if (!profile) {
                console.warn('No profile found for:', playerName);
                return;
            }

            const content = document.getElementById('player-profile-content');
            content.innerHTML = renderPlayerProfile(profile);

            const overlay = document.getElementById('player-profile-overlay');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closePlayerProfile(event) {
            if (event && event.target !== event.currentTarget && event.type === 'click') return;
            const overlay = document.getElementById('player-profile-overlay');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
        }

        function classifyTag(tag) {
            const strengthTags = ['SPECIALIST_VS_PACE', 'SPECIALIST_VS_SPIN', 'SPECIALIST_VS_OFF_SPIN', 'SPECIALIST_VS_LEG_SPIN', 'SPECIALIST_VS_LEFT_ARM_SPIN', 'PP_DOMINATOR', 'EXPLOSIVE_OPENER', 'DEATH_FINISHER', 'CONSISTENT', 'LHB_SPECIALIST', 'RHB_SPECIALIST', 'LHB_WICKET_TAKER', 'RHB_WICKET_TAKER', 'ECONOMICAL', 'DOT_BALL_KING', 'PROVEN_WICKET_TAKER', 'DEATH_ELITE', 'MID_OVERS_ELITE', 'PP_STRIKE_WEAPON', 'PACE_SPECIALIST'];
            const vulnerabilityTags = ['VULNERABLE_VS_PACE', 'VULNERABLE_VS_SPIN', 'VULNERABLE_VS_OFF_SPIN', 'VULNERABLE_VS_LEG_SPIN', 'VULNERABLE_VS_LEFT_ARM_SPIN', 'LHB_VULNERABLE', 'RHB_VULNERABLE', 'EXPENSIVE', 'PP_LIABILITY'];
            const phaseTags = ['PP_DOMINATOR', 'MIDDLE_OVERS_ACCELERATOR', 'MIDDLE_ANCHOR', 'DEATH_SPECIALIST', 'MIDDLE_OVERS_CONTROLLER', 'PRESSURE_BUILDER', 'NEW_BALL_SPECIALIST', 'DEATH_COMPLETE'];

            if (vulnerabilityTags.includes(tag)) return 'vulnerability';
            if (phaseTags.includes(tag)) return 'phase-tag';
            if (strengthTags.includes(tag)) return 'strength';
            return 'style';
        }

        function formatTagName(tag) {
            return tag.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase())
                      .replace('Vs ', 'vs ').replace('Pp ', 'PP ')
                      .replace('Lhb ', 'LHB ').replace('Rhb ', 'RHB ')
                      .replace('Mid ', 'Mid-').replace('Sr ', 'SR ');
        }

        function sampleBadge(size) {
            if (!size) return '';
            if (size === 'LOW') return '<span class="pp-sample low">(LOW sample)</span>';
            if (size === 'MEDIUM') return '<span class="pp-sample">(MEDIUM)</span>';
            return '';
        }

        function renderPlayerProfile(p) {
            let html = '';

            // Header
            const subtitle = [p.role, p.batting_hand, p.bowling_type ? `${p.bowling_arm} ${p.bowling_type}` : null, p.nationality].filter(Boolean).join(' \u00b7 ');
            html += `<div class="pp-header">
                <h2 class="pp-name">${p.player_name}</h2>
                <p class="pp-subtitle">${subtitle}</p>
                <div class="pp-meta">
                    <span class="pp-meta-badge price">\u20b9${p.price_cr} Cr</span>
                    <span class="pp-meta-badge">${p.acquisition_type}</span>
                    ${p.is_captain ? '<span class="pp-meta-badge captain">\ud83d\udc51 Captain</span>' : ''}
                    ${p.archetype && p.archetype !== '-' ? `<span class="pp-meta-badge">${p.archetype}</span>` : ''}
                    <span class="pp-meta-badge">Age ${p.age}</span>
                </div>
            </div>`;

            if (!p.has_ipl_data) {
                html += '<div class="pp-no-data">No IPL data available (uncapped/new signing)</div>';
                return html;
            }

            // Batting Section
            const bat = p.batting;
            if (bat && bat.career) {
                const c = bat.career;
                html += `<div class="pp-section">
                    <div class="pp-section-title">Batting Career (IPL 2023+)</div>
                    <div class="pp-stat-grid">
                        <div class="pp-stat-card"><div class="pp-stat-value">${c.runs || 0}</div><div class="pp-stat-label">Runs</div></div>
                        <div class="pp-stat-card"><div class="pp-stat-value">${c.innings || 0}</div><div class="pp-stat-label">Innings</div></div>
                        <div class="pp-stat-card"><div class="pp-stat-value">${c.average != null ? c.average.toFixed(1) : '-'}</div><div class="pp-stat-label">Average</div></div>
                        <div class="pp-stat-card"><div class="pp-stat-value">${c.strike_rate != null ? c.strike_rate.toFixed(1) : '-'}</div><div class="pp-stat-label">SR</div></div>
                    </div>
                    <div class="pp-stat-grid">
                        <div class="pp-stat-card"><div class="pp-stat-value">${c.fifties || 0}</div><div class="pp-stat-label">50s</div></div>
                        <div class="pp-stat-card"><div class="pp-stat-value">${c.hundreds || 0}</div><div class="pp-stat-label">100s</div></div>
                        <div class="pp-stat-card"><div class="pp-stat-value">${c.boundary_pct != null ? c.boundary_pct.toFixed(1) + '%' : '-'}</div><div class="pp-stat-label">Boundary%</div></div>
                        <div class="pp-stat-card"><div class="pp-stat-value">${c.dot_ball_pct != null ? c.dot_ball_pct.toFixed(1) + '%' : '-'}</div><div class="pp-stat-label">Dot%</div></div>
                    </div>
                    ${sampleBadge(c.sample_size)}
                </div>`;

                // Phase Performance
                if (bat.phase) {
                    const phases = ['powerplay', 'middle', 'death'];
                    const phaseLabels = {powerplay: 'Powerplay', middle: 'Middle', death: 'Death'};
                    const phaseClasses = {powerplay: 'pp', middle: 'mid', death: 'death'};
                    html += `<div class="pp-section">
                        <div class="pp-section-title">Phase Performance</div>
                        <div class="pp-phase-grid">
                            ${phases.map(ph => {
                                const d = bat.phase[ph];
                                if (!d) return '';
                                return `<div class="pp-phase-card">
                                    <div class="pp-phase-label ${phaseClasses[ph]}">${phaseLabels[ph]}</div>
                                    <div class="pp-phase-stat"><strong>SR ${d.sr != null ? d.sr.toFixed(1) : '-'}</strong></div>
                                    <div class="pp-phase-stat">Avg ${d.avg != null ? d.avg.toFixed(1) : '-'}</div>
                                    <div class="pp-phase-stat">Bound ${d.boundary_pct != null ? d.boundary_pct.toFixed(1) : '-'}%</div>
                                    <div class="pp-phase-stat">${d.balls || 0} balls</div>
                                    ${sampleBadge(d.sample_size)}
                                </div>`;
                            }).join('')}
                        </div>
                    </div>`;
                }

                // vs Bowling Type
                if (bat.vs_bowling_type && Object.keys(bat.vs_bowling_type).length > 0) {
                    const types = Object.entries(bat.vs_bowling_type)
                        .filter(([_, v]) => v.balls >= 10)
                        .sort((a, b) => (b[1].balls || 0) - (a[1].balls || 0));
                    if (types.length > 0) {
                        html += `<div class="pp-section">
                            <div class="pp-section-title">vs Bowling Type</div>
                            <table class="pp-matchup-table">
                                <thead><tr><th>Type</th><th>SR</th><th>Avg</th><th>Balls</th></tr></thead>
                                <tbody>
                                    ${types.map(([type, v]) => `<tr>
                                        <td class="pp-vs-label">${type}</td>
                                        <td>${v.sr != null ? v.sr.toFixed(1) : '-'}</td>
                                        <td>${v.avg != null ? v.avg.toFixed(1) : '-'}</td>
                                        <td>${v.balls}${v.sample_size === 'LOW' ? ' <span style="color:var(--accent-orange);">(LOW)</span>' : ''}</td>
                                    </tr>`).join('')}
                                </tbody>
                            </table>
                        </div>`;
                    }
                }

                // vs Teams (best and worst)
                if (bat.vs_teams) {
                    const best = bat.vs_teams.best || [];
                    const worst = bat.vs_teams.worst || [];
                    if (best.length > 0 || worst.length > 0) {
                        html += `<div class="pp-section">
                            <div class="pp-section-title">vs Teams</div>
                            <table class="pp-matchup-table">
                                <thead><tr><th>Team</th><th>SR</th><th>Avg</th><th>Inn</th></tr></thead>
                                <tbody>
                                    ${best.map(t => `<tr><td class="pp-vs-label pp-vs-good">${t.team}</td><td>${t.sr != null ? t.sr.toFixed(1) : '-'}</td><td>${t.avg != null ? t.avg.toFixed(1) : '-'}</td><td>${t.innings || 0}</td></tr>`).join('')}
                                    ${worst.length > 0 ? `<tr><td colspan="4" style="padding:4px;border:none;"></td></tr>` : ''}
                                    ${worst.map(t => `<tr><td class="pp-vs-label pp-vs-bad">${t.team}</td><td>${t.sr != null ? t.sr.toFixed(1) : '-'}</td><td>${t.avg != null ? t.avg.toFixed(1) : '-'}</td><td>${t.innings || 0}</td></tr>`).join('')}
                                </tbody>
                            </table>
                        </div>`;
                    }
                }

                // Entry Point
                if (bat.entry_point) {
                    const ep = bat.entry_point;
                    html += `<div class="pp-section">
                        <div class="pp-section-title">Entry Point</div>
                        <div class="pp-entry-badge">${ep.classification || '-'} \u00b7 Position ${ep.mode_batting_position || '-'} \u00b7 Ball ${ep.avg_entry_ball != null ? Math.round(ep.avg_entry_ball) : '-'}</div>
                    </div>`;
                }

                // Batting Tags
                if (bat.tags && bat.tags.length > 0) {
                    html += `<div class="pp-section">
                        <div class="pp-section-title">Batting Tags</div>
                        <div class="pp-tags">
                            ${bat.tags.map(tag => `<span class="pp-tag ${classifyTag(tag)}">${formatTagName(tag)}</span>`).join('')}
                        </div>
                    </div>`;
                }
            }

            // Bowling Section
            const bowl = p.bowling;
            if (bowl && bowl.career) {
                const c = bowl.career;
                html += `<div class="pp-section">
                    <div class="pp-section-title bowling">Bowling Career (IPL 2023+)</div>
                    <div class="pp-stat-grid">
                        <div class="pp-stat-card"><div class="pp-stat-value">${c.wickets || 0}</div><div class="pp-stat-label">Wickets</div></div>
                        <div class="pp-stat-card"><div class="pp-stat-value">${c.overs || 0}</div><div class="pp-stat-label">Overs</div></div>
                        <div class="pp-stat-card"><div class="pp-stat-value">${c.economy != null ? c.economy.toFixed(2) : '-'}</div><div class="pp-stat-label">Economy</div></div>
                        <div class="pp-stat-card"><div class="pp-stat-value">${c.strike_rate != null ? c.strike_rate.toFixed(1) : '-'}</div><div class="pp-stat-label">SR</div></div>
                    </div>
                    <div class="pp-stat-grid">
                        <div class="pp-stat-card"><div class="pp-stat-value">${c.average != null ? c.average.toFixed(1) : '-'}</div><div class="pp-stat-label">Average</div></div>
                        <div class="pp-stat-card"><div class="pp-stat-value">${c.dot_ball_pct != null ? c.dot_ball_pct.toFixed(1) + '%' : '-'}</div><div class="pp-stat-label">Dot%</div></div>
                        <div class="pp-stat-card"><div class="pp-stat-value">${c.boundary_conceded_pct != null ? c.boundary_conceded_pct.toFixed(1) + '%' : '-'}</div><div class="pp-stat-label">Bound%</div></div>
                        <div class="pp-stat-card"><div class="pp-stat-value">${c.matches || 0}</div><div class="pp-stat-label">Matches</div></div>
                    </div>
                    ${sampleBadge(c.sample_size)}
                </div>`;

                // Bowling Phase Performance
                if (bowl.phase) {
                    const phases = ['powerplay', 'middle', 'death'];
                    const phaseLabels = {powerplay: 'Powerplay', middle: 'Middle', death: 'Death'};
                    const phaseClasses = {powerplay: 'pp', middle: 'mid', death: 'death'};
                    html += `<div class="pp-section">
                        <div class="pp-section-title bowling">Bowling Phase</div>
                        <div class="pp-phase-grid">
                            ${phases.map(ph => {
                                const d = bowl.phase[ph];
                                if (!d) return '';
                                return `<div class="pp-phase-card">
                                    <div class="pp-phase-label ${phaseClasses[ph]}">${phaseLabels[ph]}</div>
                                    <div class="pp-phase-stat"><strong>Econ ${d.economy != null ? d.economy.toFixed(2) : '-'}</strong></div>
                                    <div class="pp-phase-stat">Wkts ${d.wickets || 0}</div>
                                    <div class="pp-phase-stat">SR ${d.strike_rate != null ? d.strike_rate.toFixed(1) : '-'}</div>
                                    <div class="pp-phase-stat">${d.overs || 0} overs</div>
                                    ${sampleBadge(d.sample_size)}
                                </div>`;
                            }).join('')}
                        </div>
                    </div>`;
                }

                // vs Batting Hand
                if (bowl.vs_batting_hand && Object.keys(bowl.vs_batting_hand).length > 0) {
                    html += `<div class="pp-section">
                        <div class="pp-section-title bowling">vs Batting Hand</div>
                        <table class="pp-matchup-table">
                            <thead><tr><th>Hand</th><th>Econ</th><th>SR</th><th>Wkts</th></tr></thead>
                            <tbody>
                                ${Object.entries(bowl.vs_batting_hand).map(([hand, v]) => `<tr>
                                    <td class="pp-vs-label">${hand}</td>
                                    <td>${v.economy != null ? v.economy.toFixed(2) : '-'}</td>
                                    <td>${v.strike_rate != null ? v.strike_rate.toFixed(1) : '-'}</td>
                                    <td>${v.wickets || 0}${v.sample_size === 'LOW' ? ' <span style="color:var(--accent-orange);">(LOW)</span>' : ''}</td>
                                </tr>`).join('')}
                            </tbody>
                        </table>
                    </div>`;
                }

                // vs Teams (bowling)
                if (bowl.vs_teams) {
                    const best = bowl.vs_teams.best || [];
                    const worst = bowl.vs_teams.worst || [];
                    if (best.length > 0 || worst.length > 0) {
                        html += `<div class="pp-section">
                            <div class="pp-section-title bowling">vs Teams (Bowling)</div>
                            <table class="pp-matchup-table">
                                <thead><tr><th>Team</th><th>Econ</th><th>SR</th><th>Wkts</th></tr></thead>
                                <tbody>
                                    ${best.map(t => `<tr><td class="pp-vs-label pp-vs-good">${t.team}</td><td>${t.economy != null ? t.economy.toFixed(2) : '-'}</td><td>${t.strike_rate != null ? t.strike_rate.toFixed(1) : '-'}</td><td>${t.wickets || 0}</td></tr>`).join('')}
                                    ${worst.length > 0 ? `<tr><td colspan="4" style="padding:4px;border:none;"></td></tr>` : ''}
                                    ${worst.map(t => `<tr><td class="pp-vs-label pp-vs-bad">${t.team}</td><td>${t.economy != null ? t.economy.toFixed(2) : '-'}</td><td>${t.strike_rate != null ? t.strike_rate.toFixed(1) : '-'}</td><td>${t.wickets || 0}</td></tr>`).join('')}
                                </tbody>
                            </table>
                        </div>`;
                    }
                }

                // Bowling Tags
                if (bowl.tags && bowl.tags.length > 0) {
                    html += `<div class="pp-section">
                        <div class="pp-section-title bowling">Bowling Tags</div>
                        <div class="pp-tags">
                            ${bowl.tags.map(tag => `<span class="pp-tag ${classifyTag(tag)}">${formatTagName(tag)}</span>`).join('')}
                        </div>
                    </div>`;
                }
            }

            return html;
        }

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const overlay = document.getElementById('player-profile-overlay');
                if (overlay && overlay.classList.contains('active')) {
                    closePlayerProfile();
                    e.stopPropagation();
                }
            }
        });
    </script>

    <!-- Navigation Guide Button -->
    <button class="nav-guide-btn" onclick="toggleNavGuide()" title="Quick Navigation Guide">â“</button>

    <!-- Player Profile Modal (TKT-200) -->
    <div class="player-profile-overlay" id="player-profile-overlay" onclick="closePlayerProfile(event)">
        <div class="player-profile-modal" onclick="event.stopPropagation()">
            <button class="player-profile-close" onclick="closePlayerProfile()">&#x2715;</button>
            <div id="player-profile-content"></div>
        </div>
    </div>

    <!-- Navigation Guide Modal -->
    <div class="nav-guide-overlay" id="nav-guide-overlay" onclick="closeNavGuide(event)">
        <div class="nav-guide-modal" onclick="event.stopPropagation()">
            <button class="nav-guide-close" onclick="toggleNavGuide()">âœ•</button>
            <div class="nav-guide-header">
                <h3>ðŸ The Playbook Rundown</h3>
                <p>Your pre-game briefing from the coaching staff</p>
            </div>
            <a href="index.html" class="nav-guide-item" style="text-decoration: none; color: inherit;">
                <div class="nav-guide-icon">ðŸ </div>
                <div class="nav-guide-text">
                    <h4>Home â€” "The Main Event"</h4>
                    <p>The Lab homepage. Your IPL 2026 analytics command center.</p>
                </div>
            </a>
            <a href="teams.html" class="nav-guide-item nav-guide-start" style="text-decoration: none; color: inherit;">
                <div class="nav-guide-icon">ðŸ</div>
                <div class="nav-guide-text">
                    <h4>Team Breakdowns â€” "The Dugout"</h4>
                    <p>ðŸ“ You Are Here. Andy Flower's domain â€” predicted XIs, depth charts, full rosters.</p>
                </div>
            </a>
            <a href="artifacts.html" class="nav-guide-item" style="text-decoration: none; color: inherit;">
                <div class="nav-guide-icon">ðŸ“Š</div>
                <div class="nav-guide-text">
                    <h4>Artifacts â€” "The Trophy Cabinet"</h4>
                    <p>All 10 franchise stat packs. Stephen Curry approved â€” clean data, no turnovers.</p>
                </div>
            </a>
            <a href="analysis.html" class="nav-guide-item" style="text-decoration: none; color: inherit;">
                <div class="nav-guide-icon">ðŸ”¬</div>
                <div class="nav-guide-text">
                    <h4>Analysis â€” "Studying Film"</h4>
                    <p>Tom Brady-level prep. Matchups, clustering, phase breakdowns.</p>
                </div>
            </a>
            <a href="research.html" class="nav-guide-item" style="text-decoration: none; color: inherit;">
                <div class="nav-guide-icon">ðŸ“š</div>
                <div class="nav-guide-text">
                    <h4>Research â€” "Pep's Tactical Notebook"</h4>
                    <p>Methodology docs. How we grade players, explained.</p>
                </div>
            </a>
            <a href="research-desk.html" class="nav-guide-item" style="text-decoration: none; color: inherit;">
                <div class="nav-guide-icon">ðŸŽ¬</div>
                <div class="nav-guide-text">
                    <h4>The Film Room â€” "Breaking Down Tape"</h4>
                    <p>Pull up the tape on any player, team, or matchup. The full scouting database, coach-style.</p>
                </div>
            </a>
            <a href="about.html" class="nav-guide-item" style="text-decoration: none; color: inherit;">
                <div class="nav-guide-icon">ðŸŒ¹</div>
                <div class="nav-guide-text">
                    <h4>About â€” "The Origin Story"</h4>
                    <p>The story, the vision, the Founder. How Cricket Playbook came to be.</p>
                </div>
            </a>
            <a href="../../mission_control/dashboard/index.html" class="nav-guide-item" style="text-decoration: none; color: inherit;">
                <div class="nav-guide-icon">ðŸ“¡</div>
                <div class="nav-guide-text">
                    <h4>The Boardroom â€” "Front Office Moves"</h4>
                    <p>Florentino's war room. Tickets, sprints, agent roster.</p>
                </div>
            </a>
        </div>
    </div>
</body>
</html>
