-- =============================================================
-- Cricket Playbook - View DDL Definitions
-- Generated: 2026-02-13T20:03:29.965969+00:00
-- Total views: 163
-- =============================================================

CREATE OR REPLACE VIEW analytics_batter_vs_bowler AS SELECT dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, dp_bowl.player_id AS bowler_id, dp_bowl.current_name AS bowler_name, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, CASE  WHEN ((count_star() < 10)) THEN ('LOW') WHEN ((count_star() < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY dp_bat.player_id, dp_bat.current_name, dp_bowl.player_id, dp_bowl.current_name;

CREATE OR REPLACE VIEW analytics_batter_vs_team AS SELECT dp.player_id, dp.current_name AS player_name, dt.team_id AS opponent_team_id, dt.team_name AS opponent_team, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, CASE  WHEN ((count(DISTINCT fb.match_id) < 5)) THEN ('LOW') WHEN ((count(DISTINCT fb.match_id) < 15)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN dim_team AS dt ON ((fb.bowling_team_id = dt.team_id)) GROUP BY dp.player_id, dp.current_name, dt.team_id, dt.team_name;

CREATE OR REPLACE VIEW analytics_batting_by_phase AS SELECT dp.player_id, dp.current_name AS player_name, fb.match_phase, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS batting_average, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_pct, CASE  WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 100)) THEN ('LOW') WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) GROUP BY dp.player_id, dp.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_batting_by_season AS SELECT dp.player_id, dp.current_name AS player_name, dm.season, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS batting_average, CASE  WHEN ((count(DISTINCT fb.match_id) < 5)) THEN ('LOW') WHEN ((count(DISTINCT fb.match_id) < 15)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN dim_match AS dm ON ((fb.match_id = dm.match_id)) GROUP BY dp.player_id, dp.current_name, dm.season;

CREATE OR REPLACE VIEW analytics_batting_by_tournament AS SELECT dp.player_id, dp.current_name AS player_name, dt.tournament_id, dt.tournament_name, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS batting_average, CASE  WHEN ((count(DISTINCT fb.match_id) < 10)) THEN ('LOW') WHEN ((count(DISTINCT fb.match_id) < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN dim_match AS dm ON ((fb.match_id = dm.match_id)) INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) GROUP BY dp.player_id, dp.current_name, dt.tournament_id, dt.tournament_name;

CREATE OR REPLACE VIEW analytics_batting_career AS WITH batting_stats AS (SELECT fb.batter_id AS player_id, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) AS dot_balls, max(fb.batter_runs) AS highest_ball_runs FROM fact_ball AS fb GROUP BY fb.batter_id), innings_scores AS (SELECT batter_id AS player_id, match_id, sum(batter_runs) AS innings_runs, sum(CASE  WHEN ((is_wicket AND (player_out_id = batter_id))) THEN (1) ELSE 0 END) AS got_out FROM fact_ball GROUP BY batter_id, match_id), high_scores AS (SELECT player_id, max(innings_runs) AS highest_score, sum(CASE  WHEN ((innings_runs >= 50)) THEN (1) ELSE 0 END) AS fifties, sum(CASE  WHEN ((innings_runs >= 100)) THEN (1) ELSE 0 END) AS hundreds FROM innings_scores GROUP BY player_id)SELECT dp.player_id, dp.current_name AS player_name, dp.primary_role, dp.is_wicketkeeper, bs.innings, bs.runs, bs.balls_faced, bs.dismissals, hs.highest_score, hs.fifties, hs.hundreds, bs.fours, bs.sixes, bs.dot_balls, round(((bs.runs * 100.0) / "nullif"(bs.balls_faced, 0)), 2) AS strike_rate, round(((bs.runs * 1.0) / "nullif"(bs.dismissals, 0)), 2) AS batting_average, round((((bs.fours + bs.sixes) * 100.0) / "nullif"(bs.balls_faced, 0)), 2) AS boundary_pct, round(((bs.dot_balls * 100.0) / "nullif"(bs.balls_faced, 0)), 2) AS dot_ball_pct, CASE  WHEN ((bs.innings < 10)) THEN ('LOW') WHEN ((bs.innings < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size_innings, CASE  WHEN ((bs.balls_faced < 100)) THEN ('LOW') WHEN ((bs.balls_faced < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size_balls FROM batting_stats AS bs INNER JOIN dim_player AS dp ON ((bs.player_id = dp.player_id)) INNER JOIN high_scores AS hs ON ((bs.player_id = hs.player_id));

CREATE OR REPLACE VIEW analytics_best_economy AS SELECT player_id, player_name, primary_role, matches_bowled, overs_bowled, runs_conceded, wickets, economy_rate, dot_ball_pct, sample_size_balls FROM analytics_bowling_career WHERE (balls_bowled >= 500) ORDER BY economy_rate ASC;

CREATE OR REPLACE VIEW analytics_best_strike_rates AS SELECT player_id, player_name, primary_role, innings, runs, balls_faced, strike_rate, batting_average, boundary_pct, sample_size_balls FROM analytics_batting_career WHERE (balls_faced >= 500) ORDER BY strike_rate DESC;

CREATE OR REPLACE VIEW analytics_bowling_by_phase AS SELECT dp.player_id, dp.current_name AS player_name, fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, round((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) / 6.0), 1) AS overs, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS economy_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END), 0)), 2) AS bowling_average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, CASE  WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 100)) THEN ('LOW') WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) GROUP BY dp.player_id, dp.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_bowling_by_tournament AS SELECT dp.player_id, dp.current_name AS player_name, dt.tournament_id, dt.tournament_name, count(DISTINCT fb.match_id) AS matches, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END) AS wickets, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS economy_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END), 0)), 2) AS bowling_average, CASE  WHEN ((count(DISTINCT fb.match_id) < 10)) THEN ('LOW') WHEN ((count(DISTINCT fb.match_id) < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) INNER JOIN dim_match AS dm ON ((fb.match_id = dm.match_id)) INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) GROUP BY dp.player_id, dp.current_name, dt.tournament_id, dt.tournament_name;

CREATE OR REPLACE VIEW analytics_bowling_career AS WITH bowling_stats AS (SELECT fb.bowler_id AS player_id, count(DISTINCT fb.match_id) AS matches_bowled, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.extra_type = 'wides')) THEN (1) ELSE 0 END) AS wides, sum(CASE  WHEN ((fb.extra_type = 'noballs')) THEN (1) ELSE 0 END) AS noballs, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded FROM fact_ball AS fb GROUP BY fb.bowler_id), best_figures AS (SELECT bowler_id AS player_id, match_id, sum(CASE  WHEN ((is_wicket AND (wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END) AS match_wickets, sum(total_runs) AS match_runs FROM fact_ball GROUP BY bowler_id, match_id), best_bowling AS (SELECT player_id, max(match_wickets) AS best_wickets, "first"(match_runs ORDER BY match_wickets DESC, match_runs ASC) AS best_runs FROM best_figures GROUP BY player_id)SELECT dp.player_id, dp.current_name AS player_name, dp.primary_role, bs.matches_bowled, bs.balls_bowled, round((bs.balls_bowled / 6.0), 1) AS overs_bowled, bs.runs_conceded, bs.wickets, bb.best_wickets, bb.best_runs, bs.dot_balls, bs.wides, bs.noballs, bs.fours_conceded, bs.sixes_conceded, round(((bs.runs_conceded * 6.0) / "nullif"(bs.balls_bowled, 0)), 2) AS economy_rate, round(((bs.runs_conceded * 1.0) / "nullif"(bs.wickets, 0)), 2) AS bowling_average, round(((bs.balls_bowled * 1.0) / "nullif"(bs.wickets, 0)), 2) AS bowling_strike_rate, round(((bs.dot_balls * 100.0) / "nullif"(bs.balls_bowled, 0)), 2) AS dot_ball_pct, CASE  WHEN ((bs.matches_bowled < 10)) THEN ('LOW') WHEN ((bs.matches_bowled < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size_matches, CASE  WHEN ((bs.balls_bowled < 100)) THEN ('LOW') WHEN ((bs.balls_bowled < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size_balls FROM bowling_stats AS bs INNER JOIN dim_player AS dp ON ((bs.player_id = dp.player_id)) INNER JOIN best_bowling AS bb ON ((bs.player_id = bb.player_id));

CREATE OR REPLACE VIEW analytics_death_over_specialists AS SELECT player_id, player_name, balls_bowled, overs, runs_conceded, wickets, economy_rate, dot_ball_pct, sample_size FROM analytics_bowling_by_phase WHERE ((match_phase = 'death') AND (balls_bowled >= 200)) ORDER BY economy_rate ASC;

CREATE OR REPLACE VIEW analytics_ipl_batter_entry_point_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), first_appearance AS (SELECT fb.batter_id, fb.match_id, fb.innings, fb.batting_team_id, fb.bowling_team_id, min(fb.ball_seq) AS entry_ball_seq, min(fb."over") AS entry_over FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.batter_id, fb.match_id, fb.innings, fb.batting_team_id, fb.bowling_team_id), with_position AS (SELECT fa.*, row_number() OVER (PARTITION BY fa.match_id, fa.innings ORDER BY fa.entry_ball_seq) AS batting_position FROM first_appearance AS fa), team_state AS (SELECT wp.*, COALESCE((SELECT sum(fb2.total_runs) FROM fact_ball AS fb2 WHERE ((fb2.match_id = wp.match_id) AND (fb2.innings = wp.innings) AND (fb2.ball_seq < wp.entry_ball_seq))), 0) AS team_score_at_entry, COALESCE((SELECT sum(CASE  WHEN (fb2.is_wicket) THEN (1) ELSE 0 END) FROM fact_ball AS fb2 WHERE ((fb2.match_id = wp.match_id) AND (fb2.innings = wp.innings) AND (fb2.ball_seq < wp.entry_ball_seq))), 0) AS team_wickets_at_entry FROM with_position AS wp), innings1_total AS (SELECT fb.match_id, (sum(fb.total_runs) + 1) AS chase_target FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.innings = 1)) GROUP BY fb.match_id)SELECT ts.batter_id, dp.current_name AS batter_name, ts.match_id, ts.innings, ts.batting_position, ts.entry_over, ts.entry_ball_seq, ts.team_score_at_entry, ts.team_wickets_at_entry, CASE  WHEN ((ts.innings = 1)) THEN (NULL) ELSE i1.chase_target END AS chase_target, dt_bat.team_name AS team_name, dt_bowl.team_name AS opposition FROM team_state AS ts INNER JOIN dim_player AS dp ON ((ts.batter_id = dp.player_id)) INNER JOIN dim_team AS dt_bat ON ((ts.batting_team_id = dt_bat.team_id)) INNER JOIN dim_team AS dt_bowl ON ((ts.bowling_team_id = dt_bowl.team_id)) LEFT JOIN innings1_total AS i1 ON ((ts.match_id = i1.match_id));

CREATE OR REPLACE VIEW analytics_ipl_batter_entry_point_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), first_appearance AS (SELECT fb.batter_id, fb.match_id, fb.innings, fb.batting_team_id, fb.bowling_team_id, min(fb.ball_seq) AS entry_ball_seq, min(fb."over") AS entry_over FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.batter_id, fb.match_id, fb.innings, fb.batting_team_id, fb.bowling_team_id), with_position AS (SELECT fa.*, row_number() OVER (PARTITION BY fa.match_id, fa.innings ORDER BY fa.entry_ball_seq) AS batting_position FROM first_appearance AS fa), team_state AS (SELECT wp.*, COALESCE((SELECT sum(fb2.total_runs) FROM fact_ball AS fb2 WHERE ((fb2.match_id = wp.match_id) AND (fb2.innings = wp.innings) AND (fb2.ball_seq < wp.entry_ball_seq))), 0) AS team_score_at_entry, COALESCE((SELECT sum(CASE  WHEN (fb2.is_wicket) THEN (1) ELSE 0 END) FROM fact_ball AS fb2 WHERE ((fb2.match_id = wp.match_id) AND (fb2.innings = wp.innings) AND (fb2.ball_seq < wp.entry_ball_seq))), 0) AS team_wickets_at_entry FROM with_position AS wp), innings1_total AS (SELECT fb.match_id, (sum(fb.total_runs) + 1) AS chase_target FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.innings = 1)) GROUP BY fb.match_id)SELECT ts.batter_id, dp.current_name AS batter_name, ts.match_id, ts.innings, ts.batting_position, ts.entry_over, ts.entry_ball_seq, ts.team_score_at_entry, ts.team_wickets_at_entry, CASE  WHEN ((ts.innings = 1)) THEN (NULL) ELSE i1.chase_target END AS chase_target, dt_bat.team_name AS team_name, dt_bowl.team_name AS opposition FROM team_state AS ts INNER JOIN dim_player AS dp ON ((ts.batter_id = dp.player_id)) INNER JOIN dim_team AS dt_bat ON ((ts.batting_team_id = dt_bat.team_id)) INNER JOIN dim_team AS dt_bowl ON ((ts.bowling_team_id = dt_bowl.team_id)) LEFT JOIN innings1_total AS i1 ON ((ts.match_id = i1.match_id));

CREATE OR REPLACE VIEW analytics_ipl_batter_phase AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id, dp.current_name AS player_name, fb.match_phase, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS batting_average, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_pct, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, CASE  WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 100)) THEN ('LOW') WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY dp.player_id, dp.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_phase_alltime AS SELECT * FROM analytics_ipl_batter_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_phase_percentiles AS WITH qualified AS (SELECT * FROM analytics_ipl_batter_phase WHERE (balls_faced >= 100))SELECT player_id, player_name, match_phase, innings, runs, balls_faced, strike_rate, batting_average, boundary_pct, dot_ball_pct, sample_size, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY strike_rate) * 100), 1) AS sr_percentile, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY batting_average) * 100), 1) AS avg_percentile, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY boundary_pct) * 100), 1) AS boundary_percentile FROM qualified;

CREATE OR REPLACE VIEW analytics_ipl_batter_phase_percentiles_alltime AS WITH qualified AS (SELECT * FROM analytics_ipl_batter_phase_alltime WHERE (balls_faced >= 100))SELECT player_id, player_name, match_phase, innings, runs, balls_faced, strike_rate, batting_average, boundary_pct, dot_ball_pct, sample_size, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY strike_rate) * 100), 1) AS sr_percentile, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY batting_average) * 100), 1) AS avg_percentile, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY boundary_pct) * 100), 1) AS boundary_percentile FROM qualified;

CREATE OR REPLACE VIEW analytics_ipl_batter_phase_percentiles_since2023 AS WITH qualified AS (SELECT * FROM analytics_ipl_batter_phase_since2023 WHERE (balls_faced >= 100))SELECT player_id, player_name, match_phase, innings, runs, balls_faced, strike_rate, batting_average, boundary_pct, dot_ball_pct, sample_size, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY strike_rate) * 100), 1) AS sr_percentile, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY batting_average) * 100), 1) AS avg_percentile, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY boundary_pct) * 100), 1) AS boundary_percentile FROM qualified;

CREATE OR REPLACE VIEW analytics_ipl_batter_phase_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT dp.player_id, dp.current_name AS player_name, fb.match_phase, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS batting_average, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_pct, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, CASE  WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 100)) THEN ('LOW') WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY dp.player_id, dp.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_pressure_bands_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), first_innings_total AS (SELECT fb.match_id, sum(fb.total_runs) AS target_runs FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.innings = 1)) GROUP BY fb.match_id), running_context AS (SELECT fb.match_id, fb.innings, fb.ball_seq, fb.batter_id, fb.bowler_id, fb.batter_runs, fb.extra_runs, fb.total_runs, fb.is_wicket, fb.is_legal_ball, sum(fb.total_runs) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS cumulative_runs, (fit.target_runs + 1) AS "target", (120 - fb.ball_seq) AS balls_remaining, COALESCE(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) OVER (PARTITION BY fb.match_id, fb.innings, fb.batter_id ORDER BY fb.ball_seq ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING), 0) AS batter_balls_before FROM fact_ball AS fb INNER JOIN first_innings_total AS fit ON ((fb.match_id = fit.match_id)) WHERE ((fb.innings = 2) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches)))), with_bands AS (SELECT *, CASE  WHEN ((balls_remaining <= 0)) THEN (NULL) WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 15)) THEN ('NEAR_IMPOSSIBLE') WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 12)) THEN ('EXTREME') WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 10)) THEN ('HIGH') WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 8)) THEN ('BUILDING') ELSE 'COMFORTABLE' END AS pressure_band FROM running_context WHERE (balls_remaining > 0)), band_entry AS (SELECT batter_id, match_id, innings, pressure_band, min(batter_balls_before) AS entry_balls_before FROM with_bands WHERE (pressure_band IS NOT NULL) GROUP BY batter_id, match_id, innings, pressure_band)SELECT wb.batter_id AS player_id, dp.current_name AS player_name, wb.pressure_band, count(DISTINCT wb.match_id) AS innings, sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(wb.batter_runs) AS runs, round(((sum(wb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(wb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN (wb.is_wicket) THEN (1) ELSE 0 END), 0)), 2) AS batting_average, round(((sum(CASE  WHEN ((wb.batter_runs IN (4, 6))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_pct, round(((sum(CASE  WHEN (((wb.batter_runs = 0) AND (wb.extra_runs = 0) AND wb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, round(((sum(CASE  WHEN ((wb.batter_runs = 6)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS six_pct, sum(CASE  WHEN (wb.is_wicket) THEN (1) ELSE 0 END) AS dismissals, round(avg(be.entry_balls_before), 1) AS avg_balls_before_entry, CASE  WHEN ((avg(be.entry_balls_before) > 40)) THEN ('DEEP_SET') WHEN ((avg(be.entry_balls_before) > 25)) THEN ('SET') WHEN ((avg(be.entry_balls_before) >= 10)) THEN ('BUILDING') ELSE 'FRESH' END AS entry_context FROM with_bands AS wb INNER JOIN dim_player AS dp ON ((wb.batter_id = dp.player_id)) INNER JOIN band_entry AS be ON (((wb.batter_id = be.batter_id) AND (wb.match_id = be.match_id) AND (wb.innings = be.innings) AND (wb.pressure_band = be.pressure_band))) WHERE (wb.pressure_band IS NOT NULL) GROUP BY wb.batter_id, dp.current_name, wb.pressure_band HAVING (sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END) >= 15);

CREATE OR REPLACE VIEW analytics_ipl_batter_pressure_bands_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), first_innings_total AS (SELECT fb.match_id, sum(fb.total_runs) AS target_runs FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.innings = 1)) GROUP BY fb.match_id), running_context AS (SELECT fb.match_id, fb.innings, fb.ball_seq, fb.batter_id, fb.bowler_id, fb.batter_runs, fb.extra_runs, fb.total_runs, fb.is_wicket, fb.is_legal_ball, sum(fb.total_runs) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS cumulative_runs, (fit.target_runs + 1) AS "target", (120 - fb.ball_seq) AS balls_remaining, COALESCE(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) OVER (PARTITION BY fb.match_id, fb.innings, fb.batter_id ORDER BY fb.ball_seq ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING), 0) AS batter_balls_before FROM fact_ball AS fb INNER JOIN first_innings_total AS fit ON ((fb.match_id = fit.match_id)) WHERE ((fb.innings = 2) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches)))), with_bands AS (SELECT *, CASE  WHEN ((balls_remaining <= 0)) THEN (NULL) WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 15)) THEN ('NEAR_IMPOSSIBLE') WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 12)) THEN ('EXTREME') WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 10)) THEN ('HIGH') WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 8)) THEN ('BUILDING') ELSE 'COMFORTABLE' END AS pressure_band FROM running_context WHERE (balls_remaining > 0)), band_entry AS (SELECT batter_id, match_id, innings, pressure_band, min(batter_balls_before) AS entry_balls_before FROM with_bands WHERE (pressure_band IS NOT NULL) GROUP BY batter_id, match_id, innings, pressure_band)SELECT wb.batter_id AS player_id, dp.current_name AS player_name, wb.pressure_band, count(DISTINCT wb.match_id) AS innings, sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(wb.batter_runs) AS runs, round(((sum(wb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(wb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN (wb.is_wicket) THEN (1) ELSE 0 END), 0)), 2) AS batting_average, round(((sum(CASE  WHEN ((wb.batter_runs IN (4, 6))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_pct, round(((sum(CASE  WHEN (((wb.batter_runs = 0) AND (wb.extra_runs = 0) AND wb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, round(((sum(CASE  WHEN ((wb.batter_runs = 6)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS six_pct, sum(CASE  WHEN (wb.is_wicket) THEN (1) ELSE 0 END) AS dismissals, round(avg(be.entry_balls_before), 1) AS avg_balls_before_entry, CASE  WHEN ((avg(be.entry_balls_before) > 40)) THEN ('DEEP_SET') WHEN ((avg(be.entry_balls_before) > 25)) THEN ('SET') WHEN ((avg(be.entry_balls_before) >= 10)) THEN ('BUILDING') ELSE 'FRESH' END AS entry_context FROM with_bands AS wb INNER JOIN dim_player AS dp ON ((wb.batter_id = dp.player_id)) INNER JOIN band_entry AS be ON (((wb.batter_id = be.batter_id) AND (wb.match_id = be.match_id) AND (wb.innings = be.innings) AND (wb.pressure_band = be.pressure_band))) WHERE (wb.pressure_band IS NOT NULL) GROUP BY wb.batter_id, dp.current_name, wb.pressure_band HAVING (sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END) >= 15);

CREATE OR REPLACE VIEW analytics_ipl_batter_recent_form AS WITH ipl_balls AS (SELECT fb.batter_id, fb.match_id, dm.match_date, fb.batter_runs, fb.is_legal_ball, fb.is_wicket, fb.player_out_id FROM fact_ball AS fb INNER JOIN dim_match AS dm ON ((fb.match_id = dm.match_id)) INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), match_ranked AS (SELECT batter_id, match_id, dense_rank() OVER (PARTITION BY batter_id ORDER BY max(match_date) DESC, match_id DESC) AS match_rank FROM ipl_balls GROUP BY batter_id, match_id), tagged AS (SELECT ib.*, mr.match_rank FROM ipl_balls AS ib INNER JOIN match_ranked AS mr ON (((ib.batter_id = mr.batter_id) AND (ib.match_id = mr.match_id)))), agg AS (SELECT batter_id, count(DISTINCT CASE  WHEN ((match_rank <= 10)) THEN (match_id) ELSE NULL END) AS last10_innings, sum(CASE  WHEN ((match_rank <= 10)) THEN (batter_runs) ELSE 0 END) AS last10_runs, sum(CASE  WHEN (((match_rank <= 10) AND is_legal_ball)) THEN (1) ELSE 0 END) AS last10_balls, sum(CASE  WHEN (((match_rank <= 10) AND is_wicket AND (player_out_id = batter_id))) THEN (1) ELSE 0 END) AS last10_dismissals, sum(CASE  WHEN (((match_rank <= 10) AND (batter_runs IN (4, 6)))) THEN (1) ELSE 0 END) AS last10_boundaries, sum(CASE  WHEN (((match_rank <= 10) AND (batter_runs = 0) AND is_legal_ball)) THEN (1) ELSE 0 END) AS last10_dots, count(DISTINCT CASE  WHEN ((match_rank <= 20)) THEN (match_id) ELSE NULL END) AS last20_innings, sum(CASE  WHEN ((match_rank <= 20)) THEN (batter_runs) ELSE 0 END) AS last20_runs, sum(CASE  WHEN (((match_rank <= 20) AND is_legal_ball)) THEN (1) ELSE 0 END) AS last20_balls, sum(CASE  WHEN (((match_rank <= 20) AND is_wicket AND (player_out_id = batter_id))) THEN (1) ELSE 0 END) AS last20_dismissals, sum(CASE  WHEN (((match_rank <= 20) AND (batter_runs IN (4, 6)))) THEN (1) ELSE 0 END) AS last20_boundaries, sum(CASE  WHEN (((match_rank <= 20) AND (batter_runs = 0) AND is_legal_ball)) THEN (1) ELSE 0 END) AS last20_dots, sum(batter_runs) AS career_runs, sum(CASE  WHEN (is_legal_ball) THEN (1) ELSE 0 END) AS career_balls, sum(CASE  WHEN ((is_wicket AND (player_out_id = batter_id))) THEN (1) ELSE 0 END) AS career_dismissals FROM tagged GROUP BY batter_id)SELECT sq.team_name, dp.player_id AS batter_id, dp.current_name AS batter_name, a.last10_innings, a.last10_runs, a.last10_balls, round(((a.last10_runs * 100.0) / "nullif"(a.last10_balls, 0)), 2) AS last10_sr, round(((a.last10_runs * 1.0) / "nullif"(a.last10_dismissals, 0)), 2) AS last10_avg, round(((a.last10_boundaries * 100.0) / "nullif"(a.last10_balls, 0)), 2) AS last10_boundary_pct, round(((a.last10_dots * 100.0) / "nullif"(a.last10_balls, 0)), 2) AS last10_dot_pct, a.last20_innings, a.last20_runs, a.last20_balls, round(((a.last20_runs * 100.0) / "nullif"(a.last20_balls, 0)), 2) AS last20_sr, round(((a.last20_runs * 1.0) / "nullif"(a.last20_dismissals, 0)), 2) AS last20_avg, round(((a.last20_boundaries * 100.0) / "nullif"(a.last20_balls, 0)), 2) AS last20_boundary_pct, round(((a.last20_dots * 100.0) / "nullif"(a.last20_balls, 0)), 2) AS last20_dot_pct, round(((a.career_runs * 100.0) / "nullif"(a.career_balls, 0)), 2) AS career_sr, round(((a.career_runs * 1.0) / "nullif"(a.career_dismissals, 0)), 2) AS career_avg, round((((a.last10_runs * 100.0) / "nullif"(a.last10_balls, 0)) - ((a.career_runs * 100.0) / "nullif"(a.career_balls, 0))), 2) AS sr_delta_last10, round((((a.last20_runs * 100.0) / "nullif"(a.last20_balls, 0)) - ((a.career_runs * 100.0) / "nullif"(a.career_balls, 0))), 2) AS sr_delta_last20 FROM agg AS a INNER JOIN dim_player AS dp ON ((a.batter_id = dp.player_id)) INNER JOIN ipl_2026_squads AS sq ON ((dp.player_id = sq.player_id));

CREATE OR REPLACE VIEW analytics_ipl_batter_venue AS WITH ipl_matches AS (SELECT dm.match_id, dv.venue_name AS venue FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) INNER JOIN dim_venue AS dv ON ((dm.venue_id = dv.venue_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id AS batter_id, dp.current_name AS batter_name, im.venue, count(DISTINCT fb.match_id) AS innings, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 30)) THEN ('LOW') WHEN ((count_star() < 100)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN ipl_matches AS im ON ((fb.match_id = im.match_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY dp.player_id, dp.current_name, im.venue;

CREATE OR REPLACE VIEW analytics_ipl_batter_venue_alltime AS SELECT * FROM analytics_ipl_batter_venue;

CREATE OR REPLACE VIEW analytics_ipl_batter_venue_phase AS WITH ipl_matches AS (SELECT dm.match_id, dv.venue_name AS venue FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) INNER JOIN dim_venue AS dv ON ((dm.venue_id = dv.venue_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id AS batter_id, dp.current_name AS batter_name, im.venue, fb.match_phase, count(DISTINCT fb.match_id) AS innings, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 12)) THEN ('LOW') WHEN ((count_star() < 36)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN ipl_matches AS im ON ((fb.match_id = im.match_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY dp.player_id, dp.current_name, im.venue, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_venue_phase_alltime AS SELECT * FROM analytics_ipl_batter_venue_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_venue_phase_since2023 AS WITH ipl_matches AS (SELECT dm.match_id, dv.venue_name AS venue FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) INNER JOIN dim_venue AS dv ON ((dm.venue_id = dv.venue_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT dp.player_id AS batter_id, dp.current_name AS batter_name, im.venue, fb.match_phase, count(DISTINCT fb.match_id) AS innings, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 12)) THEN ('LOW') WHEN ((count_star() < 36)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN ipl_matches AS im ON ((fb.match_id = im.match_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY dp.player_id, dp.current_name, im.venue, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_venue_since2023 AS WITH ipl_matches AS (SELECT dm.match_id, dv.venue_name AS venue FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) INNER JOIN dim_venue AS dv ON ((dm.venue_id = dv.venue_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT dp.player_id AS batter_id, dp.current_name AS batter_name, im.venue, count(DISTINCT fb.match_id) AS innings, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 30)) THEN ('LOW') WHEN ((count_star() < 100)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN ipl_matches AS im ON ((fb.match_id = im.match_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY dp.player_id, dp.current_name, im.venue;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_bowler AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, dp_bowl.player_id AS bowler_id, dp_bowl.current_name AS bowler_name, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 10)) THEN ('LOW') WHEN ((count_star() < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp_bat.player_id, dp_bat.current_name, dp_bowl.player_id, dp_bowl.current_name;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_bowler_alltime AS SELECT * FROM analytics_ipl_batter_vs_bowler;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_bowler_phase AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, dp_bowl.player_id AS bowler_id, dp_bowl.current_name AS bowler_name, fb.match_phase, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 6)) THEN ('LOW') WHEN ((count_star() < 20)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp_bat.player_id, dp_bat.current_name, dp_bowl.player_id, dp_bowl.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_bowler_phase_alltime AS SELECT * FROM analytics_ipl_batter_vs_bowler_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_bowler_phase_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, dp_bowl.player_id AS bowler_id, dp_bowl.current_name AS bowler_name, fb.match_phase, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 6)) THEN ('LOW') WHEN ((count_star() < 20)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp_bat.player_id, dp_bat.current_name, dp_bowl.player_id, dp_bowl.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_bowler_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, dp_bowl.player_id AS bowler_id, dp_bowl.current_name AS bowler_name, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 10)) THEN ('LOW') WHEN ((count_star() < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp_bat.player_id, dp_bat.current_name, dp_bowl.player_id, dp_bowl.current_name;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_bowler_type AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown') AS bowler_type, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 50)) THEN ('LOW') WHEN ((count_star() < 200)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) LEFT JOIN ipl_2026_squads AS sq ON ((dp_bowl.player_id = sq.player_id)) LEFT JOIN dim_bowler_classification AS bc ON ((dp_bowl.player_id = bc.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp_bat.player_id, dp_bat.current_name, COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown');

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_bowler_type_alltime AS SELECT * FROM analytics_ipl_batter_vs_bowler_type;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_bowler_type_phase AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown') AS bowler_type, fb.match_phase, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 30)) THEN ('LOW') WHEN ((count_star() < 100)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) LEFT JOIN ipl_2026_squads AS sq ON ((dp_bowl.player_id = sq.player_id)) LEFT JOIN dim_bowler_classification AS bc ON ((dp_bowl.player_id = bc.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp_bat.player_id, dp_bat.current_name, COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown'), fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_bowler_type_phase_alltime AS SELECT * FROM analytics_ipl_batter_vs_bowler_type_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_bowler_type_phase_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown') AS bowler_type, fb.match_phase, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 30)) THEN ('LOW') WHEN ((count_star() < 100)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) LEFT JOIN ipl_2026_squads AS sq ON ((dp_bowl.player_id = sq.player_id)) LEFT JOIN dim_bowler_classification AS bc ON ((dp_bowl.player_id = bc.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp_bat.player_id, dp_bat.current_name, COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown'), fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_bowler_type_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown') AS bowler_type, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 50)) THEN ('LOW') WHEN ((count_star() < 200)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) LEFT JOIN ipl_2026_squads AS sq ON ((dp_bowl.player_id = sq.player_id)) LEFT JOIN dim_bowler_classification AS bc ON ((dp_bowl.player_id = bc.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp_bat.player_id, dp_bat.current_name, COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown');

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_team AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id AS batter_id, dp.current_name AS batter_name, COALESCE(fa.canonical_name, dt_opp.team_name) AS opposition, count(DISTINCT fb.match_id) AS innings, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 30)) THEN ('LOW') WHEN ((count_star() < 100)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN dim_team AS dt_opp ON ((fb.bowling_team_id = dt_opp.team_id)) LEFT JOIN dim_franchise_alias AS fa ON ((dt_opp.team_name = fa.team_name)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp.player_id, dp.current_name, COALESCE(fa.canonical_name, dt_opp.team_name);

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_team_alltime AS SELECT * FROM analytics_ipl_batter_vs_team;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_team_phase AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id AS batter_id, dp.current_name AS batter_name, COALESCE(fa.canonical_name, dt_opp.team_name) AS opposition, fb.match_phase, count(DISTINCT fb.match_id) AS innings, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 12)) THEN ('LOW') WHEN ((count_star() < 36)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN dim_team AS dt_opp ON ((fb.bowling_team_id = dt_opp.team_id)) LEFT JOIN dim_franchise_alias AS fa ON ((dt_opp.team_name = fa.team_name)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp.player_id, dp.current_name, COALESCE(fa.canonical_name, dt_opp.team_name), fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_team_phase_alltime AS SELECT * FROM analytics_ipl_batter_vs_team_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_team_phase_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT dp.player_id AS batter_id, dp.current_name AS batter_name, COALESCE(fa.canonical_name, dt_opp.team_name) AS opposition, fb.match_phase, count(DISTINCT fb.match_id) AS innings, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 12)) THEN ('LOW') WHEN ((count_star() < 36)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN dim_team AS dt_opp ON ((fb.bowling_team_id = dt_opp.team_id)) LEFT JOIN dim_franchise_alias AS fa ON ((dt_opp.team_name = fa.team_name)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp.player_id, dp.current_name, COALESCE(fa.canonical_name, dt_opp.team_name), fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batter_vs_team_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT dp.player_id AS batter_id, dp.current_name AS batter_name, COALESCE(fa.canonical_name, dt_opp.team_name) AS opposition, count(DISTINCT fb.match_id) AS innings, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 30)) THEN ('LOW') WHEN ((count_star() < 100)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) INNER JOIN dim_team AS dt_opp ON ((fb.bowling_team_id = dt_opp.team_id)) LEFT JOIN dim_franchise_alias AS fa ON ((dt_opp.team_name = fa.team_name)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp.player_id, dp.current_name, COALESCE(fa.canonical_name, dt_opp.team_name);

CREATE OR REPLACE VIEW analytics_ipl_batting_benchmarks AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(fb.batter_runs) AS total_runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS total_balls, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS total_wickets, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS avg_batting_avg, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_boundary_pct, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_dot_ball_pct FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batting_benchmarks_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(fb.batter_runs) AS total_runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS total_balls, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS total_wickets, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS avg_batting_avg, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_boundary_pct, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_dot_ball_pct FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batting_benchmarks_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(fb.batter_runs) AS total_runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS total_balls, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS total_wickets, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS avg_batting_avg, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_boundary_pct, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_dot_ball_pct FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_batting_career AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), batting_stats AS (SELECT fb.batter_id AS player_id, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) AS dot_balls FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.batter_id), innings_scores AS (SELECT fb.batter_id AS player_id, fb.match_id, sum(fb.batter_runs) AS innings_runs FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.batter_id, fb.match_id), high_scores AS (SELECT player_id, max(innings_runs) AS highest_score, sum(CASE  WHEN ((innings_runs >= 50)) THEN (1) ELSE 0 END) AS fifties, sum(CASE  WHEN ((innings_runs >= 100)) THEN (1) ELSE 0 END) AS hundreds FROM innings_scores GROUP BY player_id)SELECT dp.player_id, dp.current_name AS player_name, dp.primary_role, bs.innings, bs.runs, bs.balls_faced, bs.dismissals, hs.highest_score, hs.fifties, hs.hundreds, bs.fours, bs.sixes, bs.dot_balls, round(((bs.runs * 100.0) / "nullif"(bs.balls_faced, 0)), 2) AS strike_rate, round(((bs.runs * 1.0) / "nullif"(bs.dismissals, 0)), 2) AS batting_average, round((((bs.fours + bs.sixes) * 100.0) / "nullif"(bs.balls_faced, 0)), 2) AS boundary_pct, round(((bs.dot_balls * 100.0) / "nullif"(bs.balls_faced, 0)), 2) AS dot_ball_pct, CASE  WHEN ((bs.innings < 10)) THEN ('LOW') WHEN ((bs.innings < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM batting_stats AS bs INNER JOIN dim_player AS dp ON ((bs.player_id = dp.player_id)) INNER JOIN high_scores AS hs ON ((bs.player_id = hs.player_id));

CREATE OR REPLACE VIEW analytics_ipl_batting_career_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), batting_stats AS (SELECT fb.batter_id AS player_id, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) AS dot_balls FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.batter_id), innings_scores AS (SELECT fb.batter_id AS player_id, fb.match_id, sum(fb.batter_runs) AS innings_runs FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.batter_id, fb.match_id), high_scores AS (SELECT player_id, max(innings_runs) AS highest_score, sum(CASE  WHEN ((innings_runs >= 50)) THEN (1) ELSE 0 END) AS fifties, sum(CASE  WHEN ((innings_runs >= 100)) THEN (1) ELSE 0 END) AS hundreds FROM innings_scores GROUP BY player_id)SELECT dp.player_id, dp.current_name AS player_name, dp.primary_role, bs.innings, bs.runs, bs.balls_faced, bs.dismissals, hs.highest_score, hs.fifties, hs.hundreds, bs.fours, bs.sixes, bs.dot_balls, round(((bs.runs * 100.0) / "nullif"(bs.balls_faced, 0)), 2) AS strike_rate, round(((bs.runs * 1.0) / "nullif"(bs.dismissals, 0)), 2) AS batting_average, round((((bs.fours + bs.sixes) * 100.0) / "nullif"(bs.balls_faced, 0)), 2) AS boundary_pct, round(((bs.dot_balls * 100.0) / "nullif"(bs.balls_faced, 0)), 2) AS dot_ball_pct, CASE  WHEN ((bs.innings < 10)) THEN ('LOW') WHEN ((bs.innings < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM batting_stats AS bs INNER JOIN dim_player AS dp ON ((bs.player_id = dp.player_id)) INNER JOIN high_scores AS hs ON ((bs.player_id = hs.player_id));

CREATE OR REPLACE VIEW analytics_ipl_batting_career_since2023 AS SELECT * FROM analytics_ipl_batting_career;

CREATE OR REPLACE VIEW analytics_ipl_batting_order_flexibility_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), first_appearance AS (SELECT fb.batter_id, fb.match_id, fb.innings, fb.batting_team_id, min(fb.ball_seq) AS entry_ball_seq FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.batter_id, fb.match_id, fb.innings, fb.batting_team_id), with_position AS (SELECT fa.*, row_number() OVER (PARTITION BY fa.match_id, fa.innings ORDER BY fa.entry_ball_seq) AS batting_position FROM first_appearance AS fa), with_wickets AS (SELECT wp.*, COALESCE((SELECT sum(CASE  WHEN (fb2.is_wicket) THEN (1) ELSE 0 END) FROM fact_ball AS fb2 WHERE ((fb2.match_id = wp.match_id) AND (fb2.innings = wp.innings) AND (fb2.ball_seq < wp.entry_ball_seq))), 0) AS team_wickets_at_entry FROM with_position AS wp)SELECT ww.batter_id, dp.current_name AS batter_name, dtt.team_name, count_star() AS innings_count, round(avg(ww.batting_position), 2) AS avg_batting_position, round(avg(CASE  WHEN ((ww.team_wickets_at_entry = 0)) THEN (ww.batting_position) ELSE NULL END), 2) AS avg_position_0_wickets, round(avg(CASE  WHEN ((ww.team_wickets_at_entry = 1)) THEN (ww.batting_position) ELSE NULL END), 2) AS avg_position_1_wicket, round(avg(CASE  WHEN ((ww.team_wickets_at_entry >= 2)) THEN (ww.batting_position) ELSE NULL END), 2) AS avg_position_2plus_wickets, round((avg(CASE  WHEN ((ww.team_wickets_at_entry >= 2)) THEN (ww.batting_position) ELSE NULL END) - avg(CASE  WHEN ((ww.team_wickets_at_entry = 0)) THEN (ww.batting_position) ELSE NULL END)), 2) AS position_shift FROM with_wickets AS ww INNER JOIN dim_player AS dp ON ((ww.batter_id = dp.player_id)) INNER JOIN dim_team AS dtt ON ((ww.batting_team_id = dtt.team_id)) GROUP BY ww.batter_id, dp.current_name, dtt.team_name HAVING (count_star() >= 5);

CREATE OR REPLACE VIEW analytics_ipl_batting_order_flexibility_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), first_appearance AS (SELECT fb.batter_id, fb.match_id, fb.innings, fb.batting_team_id, min(fb.ball_seq) AS entry_ball_seq FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.batter_id, fb.match_id, fb.innings, fb.batting_team_id), with_position AS (SELECT fa.*, row_number() OVER (PARTITION BY fa.match_id, fa.innings ORDER BY fa.entry_ball_seq) AS batting_position FROM first_appearance AS fa), with_wickets AS (SELECT wp.*, COALESCE((SELECT sum(CASE  WHEN (fb2.is_wicket) THEN (1) ELSE 0 END) FROM fact_ball AS fb2 WHERE ((fb2.match_id = wp.match_id) AND (fb2.innings = wp.innings) AND (fb2.ball_seq < wp.entry_ball_seq))), 0) AS team_wickets_at_entry FROM with_position AS wp)SELECT ww.batter_id, dp.current_name AS batter_name, dtt.team_name, count_star() AS innings_count, round(avg(ww.batting_position), 2) AS avg_batting_position, round(avg(CASE  WHEN ((ww.team_wickets_at_entry = 0)) THEN (ww.batting_position) ELSE NULL END), 2) AS avg_position_0_wickets, round(avg(CASE  WHEN ((ww.team_wickets_at_entry = 1)) THEN (ww.batting_position) ELSE NULL END), 2) AS avg_position_1_wicket, round(avg(CASE  WHEN ((ww.team_wickets_at_entry >= 2)) THEN (ww.batting_position) ELSE NULL END), 2) AS avg_position_2plus_wickets, round((avg(CASE  WHEN ((ww.team_wickets_at_entry >= 2)) THEN (ww.batting_position) ELSE NULL END) - avg(CASE  WHEN ((ww.team_wickets_at_entry = 0)) THEN (ww.batting_position) ELSE NULL END)), 2) AS position_shift FROM with_wickets AS ww INNER JOIN dim_player AS dp ON ((ww.batter_id = dp.player_id)) INNER JOIN dim_team AS dtt ON ((ww.batting_team_id = dtt.team_id)) GROUP BY ww.batter_id, dp.current_name, dtt.team_name HAVING (count_star() >= 5);

CREATE OR REPLACE VIEW analytics_ipl_batting_percentiles AS WITH qualified_batters AS (SELECT * FROM analytics_ipl_batting_career WHERE (balls_faced >= 500))SELECT player_id, player_name, innings, runs, balls_faced, strike_rate, batting_average, boundary_pct, dot_ball_pct, sample_size, round((percent_rank() OVER (ORDER BY strike_rate) * 100), 1) AS sr_percentile, round((percent_rank() OVER (ORDER BY batting_average) * 100), 1) AS avg_percentile, round((percent_rank() OVER (ORDER BY boundary_pct) * 100), 1) AS boundary_percentile, round((percent_rank() OVER (ORDER BY dot_ball_pct DESC) * 100), 1) AS dot_ball_percentile FROM qualified_batters;

CREATE OR REPLACE VIEW analytics_ipl_batting_percentiles_alltime AS WITH qualified_batters AS (SELECT * FROM analytics_ipl_batting_career_alltime WHERE (balls_faced >= 500))SELECT player_id, player_name, innings, runs, balls_faced, strike_rate, batting_average, boundary_pct, dot_ball_pct, sample_size, round((percent_rank() OVER (ORDER BY strike_rate) * 100), 1) AS sr_percentile, round((percent_rank() OVER (ORDER BY batting_average) * 100), 1) AS avg_percentile, round((percent_rank() OVER (ORDER BY boundary_pct) * 100), 1) AS boundary_percentile, round((percent_rank() OVER (ORDER BY dot_ball_pct DESC) * 100), 1) AS dot_ball_percentile FROM qualified_batters;

CREATE OR REPLACE VIEW analytics_ipl_batting_percentiles_since2023 AS SELECT * FROM analytics_ipl_batting_percentiles;

CREATE OR REPLACE VIEW analytics_ipl_bowler_over_breakdown_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT fb.bowler_id, dp.current_name AS bowler_name, (fb."over" + 1) AS over_number, count(DISTINCT fb.match_id) AS times_bowled, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS wickets, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS economy, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_conceded_pct FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.bowler_id, dp.current_name, fb."over";

CREATE OR REPLACE VIEW analytics_ipl_bowler_over_breakdown_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT fb.bowler_id, dp.current_name AS bowler_name, (fb."over" + 1) AS over_number, count(DISTINCT fb.match_id) AS times_bowled, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS wickets, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS economy, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_conceded_pct FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.bowler_id, dp.current_name, fb."over";

CREATE OR REPLACE VIEW analytics_ipl_bowler_phase AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id, dp.current_name AS player_name, fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, round((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) / 6.0), 1) AS overs, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS economy_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS bowling_average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 100)) THEN ('LOW') WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY dp.player_id, dp.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowler_phase_alltime AS SELECT * FROM analytics_ipl_bowler_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowler_phase_distribution AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), bowler_phase_stats AS (SELECT dp.player_id AS bowler_id, dp.current_name AS bowler_name, fb.match_phase, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp.player_id, dp.current_name, fb.match_phase), bowler_totals AS (SELECT bowler_id, bowler_name, sum(balls) AS total_balls, sum(wickets) AS total_wickets FROM bowler_phase_stats GROUP BY bowler_id, bowler_name)SELECT bps.bowler_id, bps.bowler_name, bps.match_phase, bps.balls, round((bps.balls / 6.0), 1) AS overs, bps.runs_conceded, bps.wickets, bps.dot_balls, round(((bps.runs_conceded * 6.0) / "nullif"(bps.balls, 0)), 2) AS economy, round(((bps.dot_balls * 100.0) / "nullif"(bps.balls, 0)), 2) AS dot_ball_pct, round(((bps.balls * 100.0) / "nullif"(bt.total_balls, 0)), 1) AS pct_overs_in_phase, round(((bps.wickets * 100.0) / "nullif"(bt.total_wickets, 0)), 1) AS pct_wickets_in_phase, round((((bps.wickets * 100.0) / "nullif"(bt.total_wickets, 0)) - ((bps.balls * 100.0) / "nullif"(bt.total_balls, 0))), 1) AS wicket_efficiency, bt.total_balls, bt.total_wickets, CASE  WHEN ((bt.total_balls < 120)) THEN ('LOW') WHEN ((bt.total_balls < 300)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM bowler_phase_stats AS bps INNER JOIN bowler_totals AS bt ON ((bps.bowler_id = bt.bowler_id)) ORDER BY bps.bowler_name, CASE  WHEN ((bps.match_phase = 'powerplay')) THEN (1) WHEN ((bps.match_phase = 'middle')) THEN (2) WHEN ((bps.match_phase = 'death')) THEN (3) ELSE NULL END;

CREATE OR REPLACE VIEW analytics_ipl_bowler_phase_distribution_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), bowler_phase_stats AS (SELECT dp.player_id AS bowler_id, dp.current_name AS bowler_name, fb.match_phase, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp.player_id, dp.current_name, fb.match_phase), bowler_totals AS (SELECT bowler_id, bowler_name, sum(balls) AS total_balls, sum(wickets) AS total_wickets FROM bowler_phase_stats GROUP BY bowler_id, bowler_name)SELECT bps.bowler_id, bps.bowler_name, bps.match_phase, bps.balls, round((bps.balls / 6.0), 1) AS overs, bps.runs_conceded, bps.wickets, bps.dot_balls, round(((bps.runs_conceded * 6.0) / "nullif"(bps.balls, 0)), 2) AS economy, round(((bps.dot_balls * 100.0) / "nullif"(bps.balls, 0)), 2) AS dot_ball_pct, round(((bps.balls * 100.0) / "nullif"(bt.total_balls, 0)), 1) AS pct_overs_in_phase, round(((bps.wickets * 100.0) / "nullif"(bt.total_wickets, 0)), 1) AS pct_wickets_in_phase, round((((bps.wickets * 100.0) / "nullif"(bt.total_wickets, 0)) - ((bps.balls * 100.0) / "nullif"(bt.total_balls, 0))), 1) AS wicket_efficiency, bt.total_balls, bt.total_wickets, CASE  WHEN ((bt.total_balls < 120)) THEN ('LOW') WHEN ((bt.total_balls < 300)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM bowler_phase_stats AS bps INNER JOIN bowler_totals AS bt ON ((bps.bowler_id = bt.bowler_id)) ORDER BY bps.bowler_name, CASE  WHEN ((bps.match_phase = 'powerplay')) THEN (1) WHEN ((bps.match_phase = 'middle')) THEN (2) WHEN ((bps.match_phase = 'death')) THEN (3) ELSE NULL END;

CREATE OR REPLACE VIEW analytics_ipl_bowler_phase_distribution_since2023 AS SELECT * FROM analytics_ipl_bowler_phase_distribution;

CREATE OR REPLACE VIEW analytics_ipl_bowler_phase_percentiles AS WITH qualified AS (SELECT * FROM analytics_ipl_bowler_phase WHERE (balls_bowled >= 60))SELECT player_id, player_name, match_phase, matches, balls_bowled, overs, wickets, economy_rate, bowling_average, dot_ball_pct, boundary_conceded_pct, sample_size, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY economy_rate DESC) * 100), 1) AS economy_percentile, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY dot_ball_pct) * 100), 1) AS dot_ball_percentile FROM qualified;

CREATE OR REPLACE VIEW analytics_ipl_bowler_phase_percentiles_alltime AS WITH qualified AS (SELECT * FROM analytics_ipl_bowler_phase_alltime WHERE (balls_bowled >= 60))SELECT player_id, player_name, match_phase, matches, balls_bowled, overs, wickets, economy_rate, bowling_average, dot_ball_pct, boundary_conceded_pct, sample_size, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY economy_rate DESC) * 100), 1) AS economy_percentile, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY dot_ball_pct) * 100), 1) AS dot_ball_percentile FROM qualified;

CREATE OR REPLACE VIEW analytics_ipl_bowler_phase_percentiles_since2023 AS WITH qualified AS (SELECT * FROM analytics_ipl_bowler_phase_since2023 WHERE (balls_bowled >= 60))SELECT player_id, player_name, match_phase, matches, balls_bowled, overs, wickets, economy_rate, bowling_average, dot_ball_pct, boundary_conceded_pct, sample_size, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY economy_rate DESC) * 100), 1) AS economy_percentile, round((percent_rank() OVER (PARTITION BY match_phase ORDER BY dot_ball_pct) * 100), 1) AS dot_ball_percentile FROM qualified;

CREATE OR REPLACE VIEW analytics_ipl_bowler_phase_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT dp.player_id, dp.current_name AS player_name, fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, round((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) / 6.0), 1) AS overs, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS economy_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS bowling_average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 100)) THEN ('LOW') WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY dp.player_id, dp.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowler_pressure_bands_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), first_innings_total AS (SELECT fb.match_id, sum(fb.total_runs) AS target_runs FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.innings = 1)) GROUP BY fb.match_id), running_context AS (SELECT fb.match_id, fb.innings, fb.ball_seq, fb.batter_id, fb.bowler_id, fb.batter_runs, fb.extra_runs, fb.total_runs, fb.is_wicket, fb.wicket_type, fb.is_legal_ball, sum(fb.total_runs) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS cumulative_runs, (fit.target_runs + 1) AS "target", (120 - fb.ball_seq) AS balls_remaining FROM fact_ball AS fb INNER JOIN first_innings_total AS fit ON ((fb.match_id = fit.match_id)) WHERE ((fb.innings = 2) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches)))), with_bands AS (SELECT *, CASE  WHEN ((balls_remaining <= 0)) THEN (NULL) WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 15)) THEN ('NEAR_IMPOSSIBLE') WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 12)) THEN ('EXTREME') WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 10)) THEN ('HIGH') WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 8)) THEN ('BUILDING') ELSE 'COMFORTABLE' END AS pressure_band FROM running_context WHERE (balls_remaining > 0))SELECT wb.bowler_id AS player_id, dp.current_name AS player_name, wb.pressure_band, sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END) AS legal_balls, round((sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END) / 6.0), 1) AS overs, sum(wb.total_runs) AS runs_conceded, round(((sum(wb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS economy, round(((sum(CASE  WHEN (((wb.batter_runs = 0) AND (wb.extra_runs = 0) AND wb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, round(((sum(CASE  WHEN ((wb.batter_runs IN (4, 6))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_conceded_pct, round(((sum(CASE  WHEN ((wb.batter_runs = 6)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS six_conceded_pct, sum(CASE  WHEN ((wb.is_wicket AND (wb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, round(((sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END) * 1.0) / "nullif"(sum(CASE  WHEN ((wb.is_wicket AND (wb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS bowling_strike_rate FROM with_bands AS wb INNER JOIN dim_player AS dp ON ((wb.bowler_id = dp.player_id)) WHERE (wb.pressure_band IS NOT NULL) GROUP BY wb.bowler_id, dp.current_name, wb.pressure_band HAVING (sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END) >= 15);

CREATE OR REPLACE VIEW analytics_ipl_bowler_pressure_bands_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), first_innings_total AS (SELECT fb.match_id, sum(fb.total_runs) AS target_runs FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.innings = 1)) GROUP BY fb.match_id), running_context AS (SELECT fb.match_id, fb.innings, fb.ball_seq, fb.batter_id, fb.bowler_id, fb.batter_runs, fb.extra_runs, fb.total_runs, fb.is_wicket, fb.wicket_type, fb.is_legal_ball, sum(fb.total_runs) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS cumulative_runs, (fit.target_runs + 1) AS "target", (120 - fb.ball_seq) AS balls_remaining FROM fact_ball AS fb INNER JOIN first_innings_total AS fit ON ((fb.match_id = fit.match_id)) WHERE ((fb.innings = 2) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches)))), with_bands AS (SELECT *, CASE  WHEN ((balls_remaining <= 0)) THEN (NULL) WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 15)) THEN ('NEAR_IMPOSSIBLE') WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 12)) THEN ('EXTREME') WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 10)) THEN ('HIGH') WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 8)) THEN ('BUILDING') ELSE 'COMFORTABLE' END AS pressure_band FROM running_context WHERE (balls_remaining > 0))SELECT wb.bowler_id AS player_id, dp.current_name AS player_name, wb.pressure_band, sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END) AS legal_balls, round((sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END) / 6.0), 1) AS overs, sum(wb.total_runs) AS runs_conceded, round(((sum(wb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS economy, round(((sum(CASE  WHEN (((wb.batter_runs = 0) AND (wb.extra_runs = 0) AND wb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, round(((sum(CASE  WHEN ((wb.batter_runs IN (4, 6))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_conceded_pct, round(((sum(CASE  WHEN ((wb.batter_runs = 6)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS six_conceded_pct, sum(CASE  WHEN ((wb.is_wicket AND (wb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, round(((sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END) * 1.0) / "nullif"(sum(CASE  WHEN ((wb.is_wicket AND (wb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS bowling_strike_rate FROM with_bands AS wb INNER JOIN dim_player AS dp ON ((wb.bowler_id = dp.player_id)) WHERE (wb.pressure_band IS NOT NULL) GROUP BY wb.bowler_id, dp.current_name, wb.pressure_band HAVING (sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END) >= 15);

CREATE OR REPLACE VIEW analytics_ipl_bowler_recent_form AS WITH ipl_balls AS (SELECT fb.bowler_id, fb.match_id, dm.match_date, fb.batter_runs, fb.extra_runs, fb.total_runs, fb.is_legal_ball, fb.is_wicket, fb.wicket_type FROM fact_ball AS fb INNER JOIN dim_match AS dm ON ((fb.match_id = dm.match_id)) INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), match_ranked AS (SELECT bowler_id, match_id, dense_rank() OVER (PARTITION BY bowler_id ORDER BY max(match_date) DESC, match_id DESC) AS match_rank FROM ipl_balls GROUP BY bowler_id, match_id), tagged AS (SELECT ib.*, mr.match_rank FROM ipl_balls AS ib INNER JOIN match_ranked AS mr ON (((ib.bowler_id = mr.bowler_id) AND (ib.match_id = mr.match_id)))), agg AS (SELECT bowler_id, count(DISTINCT CASE  WHEN ((match_rank <= 10)) THEN (match_id) ELSE NULL END) AS last10_matches, sum(CASE  WHEN (((match_rank <= 10) AND is_legal_ball)) THEN (1) ELSE 0 END) AS last10_balls, sum(CASE  WHEN ((match_rank <= 10)) THEN (total_runs) ELSE 0 END) AS last10_runs_conceded, sum(CASE  WHEN (((match_rank <= 10) AND is_wicket AND (wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END) AS last10_wickets, sum(CASE  WHEN (((match_rank <= 10) AND (batter_runs = 0) AND (extra_runs = 0))) THEN (1) ELSE 0 END) AS last10_dots, count(DISTINCT CASE  WHEN ((match_rank <= 20)) THEN (match_id) ELSE NULL END) AS last20_matches, sum(CASE  WHEN (((match_rank <= 20) AND is_legal_ball)) THEN (1) ELSE 0 END) AS last20_balls, sum(CASE  WHEN ((match_rank <= 20)) THEN (total_runs) ELSE 0 END) AS last20_runs_conceded, sum(CASE  WHEN (((match_rank <= 20) AND is_wicket AND (wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END) AS last20_wickets, sum(CASE  WHEN (((match_rank <= 20) AND (batter_runs = 0) AND (extra_runs = 0))) THEN (1) ELSE 0 END) AS last20_dots, sum(CASE  WHEN (is_legal_ball) THEN (1) ELSE 0 END) AS career_balls, sum(total_runs) AS career_runs_conceded, sum(CASE  WHEN ((is_wicket AND (wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END) AS career_wickets FROM tagged GROUP BY bowler_id)SELECT sq.team_name, dp.player_id AS bowler_id, dp.current_name AS bowler_name, a.last10_matches, round((a.last10_balls / 6.0), 1) AS last10_overs, a.last10_wickets, round(((a.last10_runs_conceded * 6.0) / "nullif"(a.last10_balls, 0)), 2) AS last10_economy, round(((a.last10_balls * 1.0) / "nullif"(a.last10_wickets, 0)), 2) AS last10_sr, round(((a.last10_dots * 100.0) / "nullif"(a.last10_balls, 0)), 2) AS last10_dot_pct, a.last20_matches, round((a.last20_balls / 6.0), 1) AS last20_overs, a.last20_wickets, round(((a.last20_runs_conceded * 6.0) / "nullif"(a.last20_balls, 0)), 2) AS last20_economy, round(((a.last20_balls * 1.0) / "nullif"(a.last20_wickets, 0)), 2) AS last20_sr, round(((a.last20_dots * 100.0) / "nullif"(a.last20_balls, 0)), 2) AS last20_dot_pct, round(((a.career_runs_conceded * 6.0) / "nullif"(a.career_balls, 0)), 2) AS career_economy, round(((a.career_balls * 1.0) / "nullif"(a.career_wickets, 0)), 2) AS career_sr, round((((a.last10_runs_conceded * 6.0) / "nullif"(a.last10_balls, 0)) - ((a.career_runs_conceded * 6.0) / "nullif"(a.career_balls, 0))), 2) AS economy_delta_last10, round((((a.last20_runs_conceded * 6.0) / "nullif"(a.last20_balls, 0)) - ((a.career_runs_conceded * 6.0) / "nullif"(a.career_balls, 0))), 2) AS economy_delta_last20 FROM agg AS a INNER JOIN dim_player AS dp ON ((a.bowler_id = dp.player_id)) INNER JOIN ipl_2026_squads AS sq ON ((dp.player_id = sq.player_id));

CREATE OR REPLACE VIEW analytics_ipl_bowler_venue AS WITH ipl_matches AS (SELECT dm.match_id, dv.venue_name AS venue FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) INNER JOIN dim_venue AS dv ON ((dm.venue_id = dv.venue_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id AS bowler_id, dp.current_name AS bowler_name, im.venue, count(DISTINCT fb.match_id) AS matches, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(count_star(), 0)), 2) AS economy, round(((count_star() * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((count_star() < 30)) THEN ('LOW') WHEN ((count_star() < 100)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) INNER JOIN ipl_matches AS im ON ((fb.match_id = im.match_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY dp.player_id, dp.current_name, im.venue;

CREATE OR REPLACE VIEW analytics_ipl_bowler_venue_alltime AS SELECT * FROM analytics_ipl_bowler_venue;

CREATE OR REPLACE VIEW analytics_ipl_bowler_venue_phase AS WITH ipl_matches AS (SELECT dm.match_id, dv.venue_name AS venue FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) INNER JOIN dim_venue AS dv ON ((dm.venue_id = dv.venue_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id AS bowler_id, dp.current_name AS bowler_name, im.venue, fb.match_phase, count(DISTINCT fb.match_id) AS matches, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(count_star(), 0)), 2) AS economy, round(((count_star() * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((count_star() < 12)) THEN ('LOW') WHEN ((count_star() < 36)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) INNER JOIN ipl_matches AS im ON ((fb.match_id = im.match_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY dp.player_id, dp.current_name, im.venue, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowler_venue_phase_alltime AS SELECT * FROM analytics_ipl_bowler_venue_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowler_venue_phase_since2023 AS WITH ipl_matches AS (SELECT dm.match_id, dv.venue_name AS venue FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) INNER JOIN dim_venue AS dv ON ((dm.venue_id = dv.venue_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT dp.player_id AS bowler_id, dp.current_name AS bowler_name, im.venue, fb.match_phase, count(DISTINCT fb.match_id) AS matches, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(count_star(), 0)), 2) AS economy, round(((count_star() * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((count_star() < 12)) THEN ('LOW') WHEN ((count_star() < 36)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) INNER JOIN ipl_matches AS im ON ((fb.match_id = im.match_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY dp.player_id, dp.current_name, im.venue, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowler_venue_since2023 AS WITH ipl_matches AS (SELECT dm.match_id, dv.venue_name AS venue FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) INNER JOIN dim_venue AS dv ON ((dm.venue_id = dv.venue_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT dp.player_id AS bowler_id, dp.current_name AS bowler_name, im.venue, count(DISTINCT fb.match_id) AS matches, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(count_star(), 0)), 2) AS economy, round(((count_star() * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((count_star() < 30)) THEN ('LOW') WHEN ((count_star() < 100)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) INNER JOIN ipl_matches AS im ON ((fb.match_id = im.match_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY dp.player_id, dp.current_name, im.venue;

CREATE OR REPLACE VIEW analytics_ipl_bowler_vs_batter_handedness AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT dp_bowl.player_id AS bowler_id, dp_bowl.current_name AS bowler_name, sq.batting_hand, count_star() FILTER (WHERE fb.is_legal_ball) AS balls, sum((fb.batter_runs + fb.extra_runs)) AS runs, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, round(((sum((fb.batter_runs + fb.extra_runs)) * 6.0) / "nullif"(count_star() FILTER (WHERE fb.is_legal_ball), 0)), 2) AS economy, round(((count_star() FILTER (WHERE fb.is_legal_ball) * 1.0) / "nullif"(sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star() FILTER (WHERE fb.is_legal_ball), 0)), 2) AS dot_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star() FILTER (WHERE fb.is_legal_ball), 0)), 2) AS boundary_pct, round(((sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) * 1.0) / "nullif"(count_star() FILTER (WHERE fb.is_legal_ball), 0)), 4) AS wickets_per_ball, CASE  WHEN ((count_star() FILTER (WHERE fb.is_legal_ball) < 60)) THEN ('LOW') WHEN ((count_star() FILTER (WHERE fb.is_legal_ball) < 200)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) INNER JOIN ipl_2026_squads AS sq ON ((fb.batter_id = sq.player_id)) WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (sq.batting_hand IS NOT NULL)) GROUP BY dp_bowl.player_id, dp_bowl.current_name, sq.batting_hand;

CREATE OR REPLACE VIEW analytics_ipl_bowler_vs_batter_handedness_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp_bowl.player_id AS bowler_id, dp_bowl.current_name AS bowler_name, sq.batting_hand, count_star() FILTER (WHERE fb.is_legal_ball) AS balls, sum((fb.batter_runs + fb.extra_runs)) AS runs, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, round(((sum((fb.batter_runs + fb.extra_runs)) * 6.0) / "nullif"(count_star() FILTER (WHERE fb.is_legal_ball), 0)), 2) AS economy, round(((count_star() FILTER (WHERE fb.is_legal_ball) * 1.0) / "nullif"(sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star() FILTER (WHERE fb.is_legal_ball), 0)), 2) AS dot_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star() FILTER (WHERE fb.is_legal_ball), 0)), 2) AS boundary_pct, round(((sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) * 1.0) / "nullif"(count_star() FILTER (WHERE fb.is_legal_ball), 0)), 4) AS wickets_per_ball, CASE  WHEN ((count_star() FILTER (WHERE fb.is_legal_ball) < 60)) THEN ('LOW') WHEN ((count_star() FILTER (WHERE fb.is_legal_ball) < 200)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) INNER JOIN ipl_2026_squads AS sq ON ((fb.batter_id = sq.player_id)) WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (sq.batting_hand IS NOT NULL)) GROUP BY dp_bowl.player_id, dp_bowl.current_name, sq.batting_hand;

CREATE OR REPLACE VIEW analytics_ipl_bowler_vs_batter_handedness_since2023 AS SELECT * FROM analytics_ipl_bowler_vs_batter_handedness;

CREATE OR REPLACE VIEW analytics_ipl_bowler_vs_batter_phase AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp_bowl.player_id AS bowler_id, dp_bowl.current_name AS bowler_name, dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, fb.match_phase, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(count_star(), 0)), 2) AS economy, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((count_star() < 6)) THEN ('LOW') WHEN ((count_star() < 20)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp_bowl.player_id, dp_bowl.current_name, dp_bat.player_id, dp_bat.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowler_vs_batter_phase_alltime AS SELECT * FROM analytics_ipl_bowler_vs_batter_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowler_vs_batter_phase_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT dp_bowl.player_id AS bowler_id, dp_bowl.current_name AS bowler_name, dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, fb.match_phase, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(count_star(), 0)), 2) AS economy, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((count_star() < 6)) THEN ('LOW') WHEN ((count_star() < 20)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp_bowl.player_id, dp_bowl.current_name, dp_bat.player_id, dp_bat.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowler_vs_team AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id AS bowler_id, dp.current_name AS bowler_name, COALESCE(fa.canonical_name, dt_opp.team_name) AS opposition, count(DISTINCT fb.match_id) AS matches, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(count_star(), 0)), 2) AS economy, round(((count_star() * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((count_star() < 30)) THEN ('LOW') WHEN ((count_star() < 100)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) INNER JOIN dim_team AS dt_opp ON ((fb.batting_team_id = dt_opp.team_id)) LEFT JOIN dim_franchise_alias AS fa ON ((dt_opp.team_name = fa.team_name)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp.player_id, dp.current_name, COALESCE(fa.canonical_name, dt_opp.team_name);

CREATE OR REPLACE VIEW analytics_ipl_bowler_vs_team_alltime AS SELECT * FROM analytics_ipl_bowler_vs_team;

CREATE OR REPLACE VIEW analytics_ipl_bowler_vs_team_phase AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT dp.player_id AS bowler_id, dp.current_name AS bowler_name, COALESCE(fa.canonical_name, dt_opp.team_name) AS opposition, fb.match_phase, count(DISTINCT fb.match_id) AS matches, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(count_star(), 0)), 2) AS economy, round(((count_star() * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((count_star() < 12)) THEN ('LOW') WHEN ((count_star() < 36)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) INNER JOIN dim_team AS dt_opp ON ((fb.batting_team_id = dt_opp.team_id)) LEFT JOIN dim_franchise_alias AS fa ON ((dt_opp.team_name = fa.team_name)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp.player_id, dp.current_name, COALESCE(fa.canonical_name, dt_opp.team_name), fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowler_vs_team_phase_alltime AS SELECT * FROM analytics_ipl_bowler_vs_team_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowler_vs_team_phase_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT dp.player_id AS bowler_id, dp.current_name AS bowler_name, COALESCE(fa.canonical_name, dt_opp.team_name) AS opposition, fb.match_phase, count(DISTINCT fb.match_id) AS matches, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(count_star(), 0)), 2) AS economy, round(((count_star() * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((count_star() < 12)) THEN ('LOW') WHEN ((count_star() < 36)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) INNER JOIN dim_team AS dt_opp ON ((fb.batting_team_id = dt_opp.team_id)) LEFT JOIN dim_franchise_alias AS fa ON ((dt_opp.team_name = fa.team_name)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp.player_id, dp.current_name, COALESCE(fa.canonical_name, dt_opp.team_name), fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowler_vs_team_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT dp.player_id AS bowler_id, dp.current_name AS bowler_name, COALESCE(fa.canonical_name, dt_opp.team_name) AS opposition, count(DISTINCT fb.match_id) AS matches, count_star() AS balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(count_star(), 0)), 2) AS economy, round(((count_star() * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((count_star() < 30)) THEN ('LOW') WHEN ((count_star() < 100)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) INNER JOIN dim_team AS dt_opp ON ((fb.batting_team_id = dt_opp.team_id)) LEFT JOIN dim_franchise_alias AS fa ON ((dt_opp.team_name = fa.team_name)) WHERE ((fb.is_legal_ball = CAST('t' AS BOOLEAN)) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches))) GROUP BY dp.player_id, dp.current_name, COALESCE(fa.canonical_name, dt_opp.team_name);

CREATE OR REPLACE VIEW analytics_ipl_bowling_benchmarks AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(fb.total_runs) AS total_runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS total_balls, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS total_wickets, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_economy, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS avg_bowling_avg, round(((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS avg_bowling_sr, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_dot_ball_pct FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowling_benchmarks_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(fb.total_runs) AS total_runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS total_balls, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS total_wickets, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_economy, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS avg_bowling_avg, round(((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS avg_bowling_sr, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_dot_ball_pct FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowling_benchmarks_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(fb.total_runs) AS total_runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS total_balls, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS total_wickets, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_economy, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS avg_bowling_avg, round(((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS avg_bowling_sr, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS avg_dot_ball_pct FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_bowling_career AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), bowling_stats AS (SELECT fb.bowler_id AS player_id, count(DISTINCT fb.match_id) AS matches_bowled, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.bowler_id), best_figures AS (SELECT fb.bowler_id AS player_id, fb.match_id, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS match_wickets, sum(fb.total_runs) AS match_runs FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.bowler_id, fb.match_id), best_bowling AS (SELECT player_id, max(match_wickets) AS best_wickets, "first"(match_runs ORDER BY match_wickets DESC, match_runs ASC) AS best_runs FROM best_figures GROUP BY player_id)SELECT dp.player_id, dp.current_name AS player_name, dp.primary_role, bs.matches_bowled, bs.balls_bowled, round((bs.balls_bowled / 6.0), 1) AS overs_bowled, bs.runs_conceded, bs.wickets, bb.best_wickets, bb.best_runs, bs.dot_balls, bs.fours_conceded, bs.sixes_conceded, round(((bs.runs_conceded * 6.0) / "nullif"(bs.balls_bowled, 0)), 2) AS economy_rate, round(((bs.runs_conceded * 1.0) / "nullif"(bs.wickets, 0)), 2) AS bowling_average, round(((bs.balls_bowled * 1.0) / "nullif"(bs.wickets, 0)), 2) AS bowling_strike_rate, round(((bs.dot_balls * 100.0) / "nullif"(bs.balls_bowled, 0)), 2) AS dot_ball_pct, round((((bs.fours_conceded + bs.sixes_conceded) * 100.0) / "nullif"(bs.balls_bowled, 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((bs.matches_bowled < 10)) THEN ('LOW') WHEN ((bs.matches_bowled < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM bowling_stats AS bs INNER JOIN dim_player AS dp ON ((bs.player_id = dp.player_id)) INNER JOIN best_bowling AS bb ON ((bs.player_id = bb.player_id));

CREATE OR REPLACE VIEW analytics_ipl_bowling_career_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), bowling_stats AS (SELECT fb.bowler_id AS player_id, count(DISTINCT fb.match_id) AS matches_bowled, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.bowler_id), best_figures AS (SELECT fb.bowler_id AS player_id, fb.match_id, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS match_wickets, sum(fb.total_runs) AS match_runs FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.bowler_id, fb.match_id), best_bowling AS (SELECT player_id, max(match_wickets) AS best_wickets, "first"(match_runs ORDER BY match_wickets DESC, match_runs ASC) AS best_runs FROM best_figures GROUP BY player_id)SELECT dp.player_id, dp.current_name AS player_name, dp.primary_role, bs.matches_bowled, bs.balls_bowled, round((bs.balls_bowled / 6.0), 1) AS overs_bowled, bs.runs_conceded, bs.wickets, bb.best_wickets, bb.best_runs, bs.dot_balls, bs.fours_conceded, bs.sixes_conceded, round(((bs.runs_conceded * 6.0) / "nullif"(bs.balls_bowled, 0)), 2) AS economy_rate, round(((bs.runs_conceded * 1.0) / "nullif"(bs.wickets, 0)), 2) AS bowling_average, round(((bs.balls_bowled * 1.0) / "nullif"(bs.wickets, 0)), 2) AS bowling_strike_rate, round(((bs.dot_balls * 100.0) / "nullif"(bs.balls_bowled, 0)), 2) AS dot_ball_pct, round((((bs.fours_conceded + bs.sixes_conceded) * 100.0) / "nullif"(bs.balls_bowled, 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((bs.matches_bowled < 10)) THEN ('LOW') WHEN ((bs.matches_bowled < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM bowling_stats AS bs INNER JOIN dim_player AS dp ON ((bs.player_id = dp.player_id)) INNER JOIN best_bowling AS bb ON ((bs.player_id = bb.player_id));

CREATE OR REPLACE VIEW analytics_ipl_bowling_career_since2023 AS SELECT * FROM analytics_ipl_bowling_career;

CREATE OR REPLACE VIEW analytics_ipl_bowling_change_impact_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), bowler_overs AS (SELECT DISTINCT fb.match_id, fb.innings, fb.bowler_id, fb."over" FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches))), with_prev AS (SELECT bo.*, lag(bo."over") OVER (PARTITION BY bo.match_id, bo.innings, bo.bowler_id ORDER BY bo."over") AS prev_over FROM bowler_overs AS bo), spell_marked AS (SELECT wp.*, CASE  WHEN (((wp.prev_over IS NULL) OR ((wp."over" - wp.prev_over) > 1))) THEN ('first_over') ELSE 'continuation' END AS spell_position FROM with_prev AS wp)SELECT sm.bowler_id, dp.current_name AS bowler_name, sm.spell_position, count_star() AS overs_bowled, sum(fb_agg.over_runs) AS runs_conceded, sum(fb_agg.over_wickets) AS wickets, round(((sum(fb_agg.over_runs) * 6.0) / "nullif"(sum(fb_agg.over_legal_balls), 0)), 2) AS economy, round(((sum(fb_agg.over_dots) * 100.0) / "nullif"(sum(fb_agg.over_legal_balls), 0)), 2) AS dot_ball_pct FROM spell_marked AS sm INNER JOIN (SELECT fb.match_id, fb.innings, fb.bowler_id, fb."over", sum(fb.total_runs) AS over_runs, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS over_wickets, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS over_legal_balls, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) AS over_dots FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.match_id, fb.innings, fb.bowler_id, fb."over") AS fb_agg ON (((sm.match_id = fb_agg.match_id) AND (sm.innings = fb_agg.innings) AND (sm.bowler_id = fb_agg.bowler_id) AND (sm."over" = fb_agg."over"))) INNER JOIN dim_player AS dp ON ((sm.bowler_id = dp.player_id)) GROUP BY sm.bowler_id, dp.current_name, sm.spell_position;

CREATE OR REPLACE VIEW analytics_ipl_bowling_change_impact_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), bowler_overs AS (SELECT DISTINCT fb.match_id, fb.innings, fb.bowler_id, fb."over" FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches))), with_prev AS (SELECT bo.*, lag(bo."over") OVER (PARTITION BY bo.match_id, bo.innings, bo.bowler_id ORDER BY bo."over") AS prev_over FROM bowler_overs AS bo), spell_marked AS (SELECT wp.*, CASE  WHEN (((wp.prev_over IS NULL) OR ((wp."over" - wp.prev_over) > 1))) THEN ('first_over') ELSE 'continuation' END AS spell_position FROM with_prev AS wp)SELECT sm.bowler_id, dp.current_name AS bowler_name, sm.spell_position, count_star() AS overs_bowled, sum(fb_agg.over_runs) AS runs_conceded, sum(fb_agg.over_wickets) AS wickets, round(((sum(fb_agg.over_runs) * 6.0) / "nullif"(sum(fb_agg.over_legal_balls), 0)), 2) AS economy, round(((sum(fb_agg.over_dots) * 100.0) / "nullif"(sum(fb_agg.over_legal_balls), 0)), 2) AS dot_ball_pct FROM spell_marked AS sm INNER JOIN (SELECT fb.match_id, fb.innings, fb.bowler_id, fb."over", sum(fb.total_runs) AS over_runs, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS over_wickets, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS over_legal_balls, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) AS over_dots FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.match_id, fb.innings, fb.bowler_id, fb."over") AS fb_agg ON (((sm.match_id = fb_agg.match_id) AND (sm.innings = fb_agg.innings) AND (sm.bowler_id = fb_agg.bowler_id) AND (sm."over" = fb_agg."over"))) INNER JOIN dim_player AS dp ON ((sm.bowler_id = dp.player_id)) GROUP BY sm.bowler_id, dp.current_name, sm.spell_position;

CREATE OR REPLACE VIEW analytics_ipl_bowling_percentiles AS WITH qualified_bowlers AS (SELECT * FROM analytics_ipl_bowling_career WHERE (balls_bowled >= 300))SELECT player_id, player_name, matches_bowled, balls_bowled, overs_bowled, wickets, economy_rate, bowling_average, bowling_strike_rate, dot_ball_pct, boundary_conceded_pct, sample_size, round((percent_rank() OVER (ORDER BY economy_rate DESC) * 100), 1) AS economy_percentile, round((percent_rank() OVER (ORDER BY bowling_average DESC) * 100), 1) AS avg_percentile, round((percent_rank() OVER (ORDER BY bowling_strike_rate DESC) * 100), 1) AS sr_percentile, round((percent_rank() OVER (ORDER BY dot_ball_pct) * 100), 1) AS dot_ball_percentile FROM qualified_bowlers;

CREATE OR REPLACE VIEW analytics_ipl_bowling_percentiles_alltime AS WITH qualified_bowlers AS (SELECT * FROM analytics_ipl_bowling_career_alltime WHERE (balls_bowled >= 300))SELECT player_id, player_name, matches_bowled, balls_bowled, overs_bowled, wickets, economy_rate, bowling_average, bowling_strike_rate, dot_ball_pct, boundary_conceded_pct, sample_size, round((percent_rank() OVER (ORDER BY economy_rate DESC) * 100), 1) AS economy_percentile, round((percent_rank() OVER (ORDER BY bowling_average DESC) * 100), 1) AS avg_percentile, round((percent_rank() OVER (ORDER BY bowling_strike_rate DESC) * 100), 1) AS sr_percentile, round((percent_rank() OVER (ORDER BY dot_ball_pct) * 100), 1) AS dot_ball_percentile FROM qualified_bowlers;

CREATE OR REPLACE VIEW analytics_ipl_bowling_percentiles_since2023 AS SELECT * FROM analytics_ipl_bowling_percentiles;

CREATE OR REPLACE VIEW analytics_ipl_career_benchmarks AS (SELECT 'batting' AS category, count_star() AS qualified_players, round(avg(strike_rate), 2) AS avg_strike_rate, round(avg(batting_average), 2) AS avg_batting_avg, round(avg(boundary_pct), 2) AS avg_boundary_pct, round(avg(dot_ball_pct), 2) AS avg_dot_ball_pct, round(quantile_cont(0.5 ORDER BY strike_rate), 2) AS median_strike_rate, round(quantile_cont(0.5 ORDER BY batting_average), 2) AS median_batting_avg FROM analytics_ipl_batting_career WHERE (balls_faced >= 500)) UNION ALL (SELECT 'bowling' AS category, count_star() AS qualified_players, round(avg(economy_rate), 2) AS avg_economy, round(avg(bowling_average), 2) AS avg_bowling_avg, round(avg(dot_ball_pct), 2) AS avg_dot_ball_pct, round(avg(boundary_conceded_pct), 2) AS avg_boundary_pct, round(quantile_cont(0.5 ORDER BY economy_rate), 2) AS median_economy, round(quantile_cont(0.5 ORDER BY bowling_average), 2) AS median_bowling_avg FROM analytics_ipl_bowling_career WHERE (balls_bowled >= 300));

CREATE OR REPLACE VIEW analytics_ipl_career_benchmarks_alltime AS (SELECT 'batting' AS category, count_star() AS qualified_players, round(avg(strike_rate), 2) AS avg_strike_rate, round(avg(batting_average), 2) AS avg_batting_avg, round(avg(boundary_pct), 2) AS avg_boundary_pct, round(avg(dot_ball_pct), 2) AS avg_dot_ball_pct, round(quantile_cont(0.5 ORDER BY strike_rate), 2) AS median_strike_rate, round(quantile_cont(0.5 ORDER BY batting_average), 2) AS median_batting_avg FROM analytics_ipl_batting_career_alltime WHERE (balls_faced >= 500)) UNION ALL (SELECT 'bowling' AS category, count_star() AS qualified_players, round(avg(economy_rate), 2) AS avg_economy, round(avg(bowling_average), 2) AS avg_bowling_avg, round(avg(dot_ball_pct), 2) AS avg_dot_ball_pct, round(avg(boundary_conceded_pct), 2) AS avg_boundary_pct, round(quantile_cont(0.5 ORDER BY economy_rate), 2) AS median_economy, round(quantile_cont(0.5 ORDER BY bowling_average), 2) AS median_bowling_avg FROM analytics_ipl_bowling_career_alltime WHERE (balls_bowled >= 300));

CREATE OR REPLACE VIEW analytics_ipl_career_benchmarks_since2023 AS SELECT * FROM analytics_ipl_career_benchmarks;

CREATE OR REPLACE VIEW analytics_ipl_dot_ball_pressure_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), numbered AS (SELECT fb.*, CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0) AND fb.is_legal_ball)) THEN (0) ELSE 1 END AS is_scoring, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0) AND fb.is_legal_ball)) THEN (0) ELSE 1 END) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS scoring_group FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches))), dot_runs AS (SELECT match_id, innings, scoring_group, count_star() AS dots_in_sequence, max(ball_seq) AS last_dot_seq FROM numbered WHERE (is_scoring = 0) GROUP BY match_id, innings, scoring_group), next_ball AS (SELECT dr.*, fb_next.is_wicket AS next_is_wicket FROM dot_runs AS dr LEFT JOIN fact_ball AS fb_next ON (((dr.match_id = fb_next.match_id) AND (dr.innings = fb_next.innings) AND (fb_next.ball_seq = (dr.last_dot_seq + 1)))) WHERE (dr.dots_in_sequence >= 2))SELECT CASE  WHEN ((dots_in_sequence >= 6)) THEN ('6+') ELSE CAST(dots_in_sequence AS VARCHAR) END AS consecutive_dots, count_star() AS occurrences, round(((sum(CASE  WHEN (next_is_wicket) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS next_ball_wicket_pct FROM next_ball GROUP BY CASE  WHEN ((dots_in_sequence >= 6)) THEN ('6+') ELSE CAST(dots_in_sequence AS VARCHAR) END;

CREATE OR REPLACE VIEW analytics_ipl_dot_ball_pressure_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), numbered AS (SELECT fb.*, CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0) AND fb.is_legal_ball)) THEN (0) ELSE 1 END AS is_scoring, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0) AND fb.is_legal_ball)) THEN (0) ELSE 1 END) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS scoring_group FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches))), dot_runs AS (SELECT match_id, innings, scoring_group, count_star() AS dots_in_sequence, max(ball_seq) AS last_dot_seq FROM numbered WHERE (is_scoring = 0) GROUP BY match_id, innings, scoring_group), next_ball AS (SELECT dr.*, fb_next.is_wicket AS next_is_wicket FROM dot_runs AS dr LEFT JOIN fact_ball AS fb_next ON (((dr.match_id = fb_next.match_id) AND (dr.innings = fb_next.innings) AND (fb_next.ball_seq = (dr.last_dot_seq + 1)))) WHERE (dr.dots_in_sequence >= 2))SELECT CASE  WHEN ((dots_in_sequence >= 6)) THEN ('6+') ELSE CAST(dots_in_sequence AS VARCHAR) END AS consecutive_dots, count_star() AS occurrences, round(((sum(CASE  WHEN (next_is_wicket) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS next_ball_wicket_pct FROM next_ball GROUP BY CASE  WHEN ((dots_in_sequence >= 6)) THEN ('6+') ELSE CAST(dots_in_sequence AS VARCHAR) END;

CREATE OR REPLACE VIEW analytics_ipl_innings_progression_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), over_agg AS (SELECT fb.match_id, fb.innings, fb."over" AS over_number, sum(fb.total_runs) AS runs_this_over, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS wickets_this_over, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS legal_balls_this_over FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.match_id, fb.innings, fb."over"), with_cumulative AS (SELECT oa.*, sum(oa.runs_this_over) OVER (PARTITION BY oa.match_id, oa.innings ORDER BY oa.over_number) AS cumulative_runs, sum(oa.wickets_this_over) OVER (PARTITION BY oa.match_id, oa.innings ORDER BY oa.over_number) AS cumulative_wickets, sum(oa.legal_balls_this_over) OVER (PARTITION BY oa.match_id, oa.innings ORDER BY oa.over_number) AS cumulative_legal_balls FROM over_agg AS oa), innings1_total AS (SELECT match_id, (sum(runs_this_over) + 1) AS chase_target FROM over_agg WHERE (innings = 1) GROUP BY match_id)SELECT wc.match_id, wc.innings, wc.over_number, wc.runs_this_over, wc.wickets_this_over, wc.cumulative_runs, wc.cumulative_wickets, round(((wc.cumulative_runs * 6.0) / "nullif"(wc.cumulative_legal_balls, 0)), 2) AS run_rate, CASE  WHEN ((wc.innings = 2)) THEN (i1t.chase_target) ELSE NULL END AS chase_target, CASE  WHEN ((wc.innings = 2)) THEN ((i1t.chase_target - wc.cumulative_runs)) ELSE NULL END AS runs_remaining, CASE  WHEN ((wc.innings = 2)) THEN (round((((i1t.chase_target - wc.cumulative_runs) * 6.0) / "nullif"((120 - wc.cumulative_legal_balls), 0)), 2)) ELSE NULL END AS required_run_rate FROM with_cumulative AS wc LEFT JOIN innings1_total AS i1t ON ((wc.match_id = i1t.match_id));

CREATE OR REPLACE VIEW analytics_ipl_innings_progression_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), over_agg AS (SELECT fb.match_id, fb.innings, fb."over" AS over_number, sum(fb.total_runs) AS runs_this_over, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS wickets_this_over, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS legal_balls_this_over FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.match_id, fb.innings, fb."over"), with_cumulative AS (SELECT oa.*, sum(oa.runs_this_over) OVER (PARTITION BY oa.match_id, oa.innings ORDER BY oa.over_number) AS cumulative_runs, sum(oa.wickets_this_over) OVER (PARTITION BY oa.match_id, oa.innings ORDER BY oa.over_number) AS cumulative_wickets, sum(oa.legal_balls_this_over) OVER (PARTITION BY oa.match_id, oa.innings ORDER BY oa.over_number) AS cumulative_legal_balls FROM over_agg AS oa), innings1_total AS (SELECT match_id, (sum(runs_this_over) + 1) AS chase_target FROM over_agg WHERE (innings = 1) GROUP BY match_id)SELECT wc.match_id, wc.innings, wc.over_number, wc.runs_this_over, wc.wickets_this_over, wc.cumulative_runs, wc.cumulative_wickets, round(((wc.cumulative_runs * 6.0) / "nullif"(wc.cumulative_legal_balls, 0)), 2) AS run_rate, CASE  WHEN ((wc.innings = 2)) THEN (i1t.chase_target) ELSE NULL END AS chase_target, CASE  WHEN ((wc.innings = 2)) THEN ((i1t.chase_target - wc.cumulative_runs)) ELSE NULL END AS runs_remaining, CASE  WHEN ((wc.innings = 2)) THEN (round((((i1t.chase_target - wc.cumulative_runs) * 6.0) / "nullif"((120 - wc.cumulative_legal_balls), 0)), 2)) ELSE NULL END AS required_run_rate FROM with_cumulative AS wc LEFT JOIN innings1_total AS i1t ON ((wc.match_id = i1t.match_id));

CREATE OR REPLACE VIEW analytics_ipl_match_context_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), innings_agg AS (SELECT fb.match_id, fb.innings, sum(fb.total_runs) AS runs, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS wickets, round((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) / 6.0), 1) AS overs, min(fb.batting_team_id) AS batting_team_id FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.match_id, fb.innings)SELECT dm.match_id, dm.season, dm.match_date, dv.venue_name, dv.city, dt1.team_name AS team1_name, dt2.team_name AS team2_name, dm.toss_decision, dtw.team_name AS winner_name, i1.runs AS innings1_runs, i1.wickets AS innings1_wickets, i1.overs AS innings1_overs, i2.runs AS innings2_runs, i2.wickets AS innings2_wickets, i2.overs AS innings2_overs, (i1.runs + 1) AS chase_target, CASE  WHEN ((dm.winner_id = i2.batting_team_id)) THEN ('Won') WHEN ((dm.winner_id IS NULL)) THEN ('No Result') ELSE 'Lost' END AS chase_result FROM dim_match AS dm INNER JOIN dim_tournament AS dtt ON ((dm.tournament_id = dtt.tournament_id)) INNER JOIN dim_venue AS dv ON ((dm.venue_id = dv.venue_id)) INNER JOIN dim_team AS dt1 ON ((dm.team1_id = dt1.team_id)) INNER JOIN dim_team AS dt2 ON ((dm.team2_id = dt2.team_id)) LEFT JOIN dim_team AS dtw ON ((dm.winner_id = dtw.team_id)) LEFT JOIN innings_agg AS i1 ON (((dm.match_id = i1.match_id) AND (i1.innings = 1))) LEFT JOIN innings_agg AS i2 ON (((dm.match_id = i2.match_id) AND (i2.innings = 2))) WHERE (dm.match_id = ANY(SELECT match_id FROM ipl_matches));

CREATE OR REPLACE VIEW analytics_ipl_match_context_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), innings_agg AS (SELECT fb.match_id, fb.innings, sum(fb.total_runs) AS runs, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS wickets, round((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) / 6.0), 1) AS overs, min(fb.batting_team_id) AS batting_team_id FROM fact_ball AS fb WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.match_id, fb.innings)SELECT dm.match_id, dm.season, dm.match_date, dv.venue_name, dv.city, dt1.team_name AS team1_name, dt2.team_name AS team2_name, dm.toss_decision, dtw.team_name AS winner_name, i1.runs AS innings1_runs, i1.wickets AS innings1_wickets, i1.overs AS innings1_overs, i2.runs AS innings2_runs, i2.wickets AS innings2_wickets, i2.overs AS innings2_overs, (i1.runs + 1) AS chase_target, CASE  WHEN ((dm.winner_id = i2.batting_team_id)) THEN ('Won') WHEN ((dm.winner_id IS NULL)) THEN ('No Result') ELSE 'Lost' END AS chase_result FROM dim_match AS dm INNER JOIN dim_tournament AS dtt ON ((dm.tournament_id = dtt.tournament_id)) INNER JOIN dim_venue AS dv ON ((dm.venue_id = dv.venue_id)) INNER JOIN dim_team AS dt1 ON ((dm.team1_id = dt1.team_id)) INNER JOIN dim_team AS dt2 ON ((dm.team2_id = dt2.team_id)) LEFT JOIN dim_team AS dtw ON ((dm.winner_id = dtw.team_id)) LEFT JOIN innings_agg AS i1 ON (((dm.match_id = i1.match_id) AND (i1.innings = 1))) LEFT JOIN innings_agg AS i2 ON (((dm.match_id = i2.match_id) AND (i2.innings = 2))) WHERE (dm.match_id = ANY(SELECT match_id FROM ipl_matches));

CREATE OR REPLACE VIEW analytics_ipl_new_batter_vulnerability_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), numbered_balls AS (SELECT fb.*, row_number() OVER (PARTITION BY fb.match_id, fb.innings, fb.batter_id ORDER BY fb.ball_seq) AS batter_ball_num FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND fb.is_legal_ball))SELECT nb.batter_id, dp.current_name AS batter_name, CASE  WHEN ((nb.batter_ball_num <= 10)) THEN ('first_10') ELSE 'settled' END AS ball_phase, count_star() AS balls, sum(nb.batter_runs) AS runs, sum(CASE  WHEN ((nb.is_wicket AND (nb.player_out_id = nb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(nb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(CASE  WHEN ((nb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((nb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((nb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct FROM numbered_balls AS nb INNER JOIN dim_player AS dp ON ((nb.batter_id = dp.player_id)) GROUP BY nb.batter_id, dp.current_name, CASE  WHEN ((nb.batter_ball_num <= 10)) THEN ('first_10') ELSE 'settled' END;

CREATE OR REPLACE VIEW analytics_ipl_new_batter_vulnerability_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), numbered_balls AS (SELECT fb.*, row_number() OVER (PARTITION BY fb.match_id, fb.innings, fb.batter_id ORDER BY fb.ball_seq) AS batter_ball_num FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND fb.is_legal_ball))SELECT nb.batter_id, dp.current_name AS batter_name, CASE  WHEN ((nb.batter_ball_num <= 10)) THEN ('first_10') ELSE 'settled' END AS ball_phase, count_star() AS balls, sum(nb.batter_runs) AS runs, sum(CASE  WHEN ((nb.is_wicket AND (nb.player_out_id = nb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(nb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(CASE  WHEN ((nb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((nb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((nb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct FROM numbered_balls AS nb INNER JOIN dim_player AS dp ON ((nb.batter_id = dp.player_id)) GROUP BY nb.batter_id, dp.current_name, CASE  WHEN ((nb.batter_ball_num <= 10)) THEN ('first_10') ELSE 'settled' END;

CREATE OR REPLACE VIEW analytics_ipl_partnership_analysis_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT least(fb.batter_id, fb.non_striker_id) AS player_a_id, dp_a.current_name AS player_a_name, greatest(fb.batter_id, fb.non_striker_id) AS player_b_id, dp_b.current_name AS player_b_name, count(DISTINCT concat(CAST(fb.match_id AS VARCHAR), '-', CAST(fb.innings AS VARCHAR))) AS partnerships, sum(fb.total_runs) AS total_runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls, sum(CASE  WHEN ((fb.batter_runs IN (4, 6))) THEN (1) ELSE 0 END) AS boundaries, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS run_rate FROM fact_ball AS fb INNER JOIN dim_player AS dp_a ON ((least(fb.batter_id, fb.non_striker_id) = dp_a.player_id)) INNER JOIN dim_player AS dp_b ON ((greatest(fb.batter_id, fb.non_striker_id) = dp_b.player_id)) WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY least(fb.batter_id, fb.non_striker_id), dp_a.current_name, greatest(fb.batter_id, fb.non_striker_id), dp_b.current_name;

CREATE OR REPLACE VIEW analytics_ipl_partnership_analysis_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT least(fb.batter_id, fb.non_striker_id) AS player_a_id, dp_a.current_name AS player_a_name, greatest(fb.batter_id, fb.non_striker_id) AS player_b_id, dp_b.current_name AS player_b_name, count(DISTINCT concat(CAST(fb.match_id AS VARCHAR), '-', CAST(fb.innings AS VARCHAR))) AS partnerships, sum(fb.total_runs) AS total_runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls, sum(CASE  WHEN ((fb.batter_runs IN (4, 6))) THEN (1) ELSE 0 END) AS boundaries, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS run_rate FROM fact_ball AS fb INNER JOIN dim_player AS dp_a ON ((least(fb.batter_id, fb.non_striker_id) = dp_a.player_id)) INNER JOIN dim_player AS dp_b ON ((greatest(fb.batter_id, fb.non_striker_id) = dp_b.player_id)) WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY least(fb.batter_id, fb.non_striker_id), dp_a.current_name, greatest(fb.batter_id, fb.non_striker_id), dp_b.current_name;

CREATE OR REPLACE VIEW analytics_ipl_player_matchup_matrix AS WITH raw AS (SELECT fb.batter_id, dp_bat.current_name AS batter_name, sq_bat.team_name AS batter_team, fb.bowler_id, dp_bowl.current_name AS bowler_name, sq_bowl.team_name AS bowler_team, fb.batter_runs, fb.is_legal_ball, fb.is_wicket, fb.player_out_id FROM fact_ball AS fb INNER JOIN dim_match AS dm ON ((fb.match_id = dm.match_id)) INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) INNER JOIN ipl_2026_squads AS sq_bat ON ((fb.batter_id = sq_bat.player_id)) INNER JOIN ipl_2026_squads AS sq_bowl ON ((fb.bowler_id = sq_bowl.player_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01') AND (fb.is_legal_ball = CAST('t' AS BOOLEAN))))SELECT batter_id, batter_name, batter_team, bowler_id, bowler_name, bowler_team, count_star() AS balls, sum(batter_runs) AS runs, sum(CASE  WHEN ((is_wicket AND (player_out_id = batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((is_wicket AND (player_out_id = batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, sum(CASE  WHEN ((batter_runs = 0)) THEN (1) ELSE 0 END) AS dots, sum(CASE  WHEN ((batter_runs IN (4, 6))) THEN (1) ELSE 0 END) AS boundaries, round(((sum(CASE  WHEN ((batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_pct, round(((sum(CASE  WHEN ((batter_runs IN (4, 6))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 10)) THEN ('LOW') WHEN ((count_star() < 30)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM raw GROUP BY batter_id, batter_name, batter_team, bowler_id, bowler_name, bowler_team HAVING (count_star() >= 10);

CREATE OR REPLACE VIEW analytics_ipl_pressure_boundary_sequences_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), first_innings_total AS (SELECT fb.match_id, sum(fb.total_runs) AS target_runs FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.innings = 1)) GROUP BY fb.match_id), running_context AS (SELECT fb.match_id, fb.innings, fb.ball_seq, fb.batter_id, fb.batter_runs, fb.extra_runs, fb.total_runs, fb.is_legal_ball, sum(fb.total_runs) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS cumulative_runs, (fit.target_runs + 1) AS "target", (120 - fb.ball_seq) AS balls_remaining, CASE  WHEN ((fb.batter_runs IN (4, 6))) THEN (0) ELSE 1 END AS is_non_boundary, sum(CASE  WHEN ((fb.batter_runs IN (4, 6))) THEN (0) ELSE 1 END) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS non_boundary_group FROM fact_ball AS fb INNER JOIN first_innings_total AS fit ON ((fb.match_id = fit.match_id)) WHERE ((fb.innings = 2) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches)))), pressure_balls AS (SELECT *, CASE  WHEN ((balls_remaining > 0)) THEN (((("target" - cumulative_runs) * 6.0) / balls_remaining)) ELSE NULL END AS rrr FROM running_context WHERE ((balls_remaining > 0) AND (((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 10))), boundary_runs AS (SELECT batter_id, match_id, innings, non_boundary_group, count_star() AS boundaries_in_sequence FROM pressure_balls WHERE (is_non_boundary = 0) GROUP BY batter_id, match_id, innings, non_boundary_group HAVING (count_star() >= 2))SELECT dp.current_name AS batter_name, br.batter_id, count_star() AS boundary_sequences, round(avg(br.boundaries_in_sequence), 1) AS avg_boundary_seq_length, max(br.boundaries_in_sequence) AS max_boundary_seq, sum(br.boundaries_in_sequence) AS total_boundaries_in_sequences FROM boundary_runs AS br INNER JOIN dim_player AS dp ON ((br.batter_id = dp.player_id)) GROUP BY br.batter_id, dp.current_name HAVING (count_star() >= 2) ORDER BY avg_boundary_seq_length DESC;

CREATE OR REPLACE VIEW analytics_ipl_pressure_boundary_sequences_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), first_innings_total AS (SELECT fb.match_id, sum(fb.total_runs) AS target_runs FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.innings = 1)) GROUP BY fb.match_id), running_context AS (SELECT fb.match_id, fb.innings, fb.ball_seq, fb.batter_id, fb.batter_runs, fb.extra_runs, fb.total_runs, fb.is_legal_ball, sum(fb.total_runs) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS cumulative_runs, (fit.target_runs + 1) AS "target", (120 - fb.ball_seq) AS balls_remaining, CASE  WHEN ((fb.batter_runs IN (4, 6))) THEN (0) ELSE 1 END AS is_non_boundary, sum(CASE  WHEN ((fb.batter_runs IN (4, 6))) THEN (0) ELSE 1 END) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS non_boundary_group FROM fact_ball AS fb INNER JOIN first_innings_total AS fit ON ((fb.match_id = fit.match_id)) WHERE ((fb.innings = 2) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches)))), pressure_balls AS (SELECT *, CASE  WHEN ((balls_remaining > 0)) THEN (((("target" - cumulative_runs) * 6.0) / balls_remaining)) ELSE NULL END AS rrr FROM running_context WHERE ((balls_remaining > 0) AND (((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 10))), boundary_runs AS (SELECT batter_id, match_id, innings, non_boundary_group, count_star() AS boundaries_in_sequence FROM pressure_balls WHERE (is_non_boundary = 0) GROUP BY batter_id, match_id, innings, non_boundary_group HAVING (count_star() >= 2))SELECT dp.current_name AS batter_name, br.batter_id, count_star() AS boundary_sequences, round(avg(br.boundaries_in_sequence), 1) AS avg_boundary_seq_length, max(br.boundaries_in_sequence) AS max_boundary_seq, sum(br.boundaries_in_sequence) AS total_boundaries_in_sequences FROM boundary_runs AS br INNER JOIN dim_player AS dp ON ((br.batter_id = dp.player_id)) GROUP BY br.batter_id, dp.current_name HAVING (count_star() >= 2) ORDER BY avg_boundary_seq_length DESC;

CREATE OR REPLACE VIEW analytics_ipl_pressure_deltas_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), ipl_innings_count AS (SELECT fb.batter_id, count(DISTINCT fb.match_id) AS ipl_innings FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND fb.is_legal_ball) GROUP BY fb.batter_id HAVING (count(DISTINCT fb.match_id) >= 10)), first_innings_total AS (SELECT fb.match_id, sum(fb.total_runs) AS target_runs FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.innings = 1)) GROUP BY fb.match_id), running_context AS (SELECT fb.match_id, fb.innings, fb.ball_seq, fb."over", fb.batter_id, fb.bowler_id, fb.batter_runs, fb.extra_runs, fb.total_runs, fb.is_wicket, fb.wicket_type, fb.is_legal_ball, sum(fb.total_runs) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS cumulative_runs, (fit.target_runs + 1) AS "target", (120 - fb.ball_seq) AS balls_remaining, COALESCE(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) OVER (PARTITION BY fb.match_id, fb.innings, fb.batter_id ORDER BY fb.ball_seq ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING), 0) AS batter_balls_before FROM fact_ball AS fb INNER JOIN first_innings_total AS fit ON ((fb.match_id = fit.match_id)) WHERE ((fb.innings = 2) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches)))), with_bands AS (SELECT *, CASE  WHEN ((balls_remaining <= 0)) THEN (NULL) WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 10)) THEN ('HIGH_PRESSURE') ELSE 'NORMAL' END AS pressure_group FROM running_context WHERE (balls_remaining > 0)), batter_entry_context AS (SELECT batter_id, round(avg(batter_balls_before), 1) AS avg_balls_before_pressure, CASE  WHEN ((avg(batter_balls_before) > 40)) THEN ('DEEP_SET') WHEN ((avg(batter_balls_before) > 25)) THEN ('SET') WHEN ((avg(batter_balls_before) >= 10)) THEN ('BUILDING') ELSE 'FRESH' END AS entry_context FROM with_bands WHERE (pressure_group = 'HIGH_PRESSURE') GROUP BY batter_id), batter_overall AS (SELECT wb.batter_id, sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END) AS overall_balls, round(((sum(wb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS overall_sr, round(((sum(CASE  WHEN ((wb.batter_runs IN (4, 6))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS overall_boundary_pct, round(((sum(CASE  WHEN (((wb.batter_runs = 0) AND (wb.extra_runs = 0) AND wb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS overall_dot_pct FROM with_bands AS wb INNER JOIN ipl_innings_count AS ic ON ((wb.batter_id = ic.batter_id)) GROUP BY wb.batter_id HAVING (sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END) >= 50)), batter_pressure AS (SELECT batter_id, sum(CASE  WHEN (is_legal_ball) THEN (1) ELSE 0 END) AS pressure_balls, round(((sum(batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS pressure_sr, round(((sum(CASE  WHEN ((batter_runs IN (4, 6))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS pressure_boundary_pct, round(((sum(CASE  WHEN (((batter_runs = 0) AND (extra_runs = 0) AND is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS pressure_dot_pct, sum(CASE  WHEN ((is_legal_ball AND ("over" >= 15))) THEN (1) ELSE 0 END) AS death_pressure_balls, round(((sum(CASE  WHEN (("over" >= 15)) THEN (batter_runs) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN ((is_legal_ball AND ("over" >= 15))) THEN (1) ELSE 0 END), 0)), 2) AS death_pressure_sr FROM with_bands WHERE (pressure_group = 'HIGH_PRESSURE') GROUP BY batter_id HAVING (sum(CASE  WHEN (is_legal_ball) THEN (1) ELSE 0 END) >= 30))SELECT dp.current_name AS player_name, bo.batter_id AS player_id, 'BATTER' AS "role", bo.overall_balls, bp.pressure_balls, bp.death_pressure_balls, bp.death_pressure_sr, bo.overall_sr, bp.pressure_sr, round((((bp.pressure_sr - bo.overall_sr) / "nullif"(bo.overall_sr, 0)) * 100), 1) AS sr_delta_pct, bo.overall_boundary_pct, bp.pressure_boundary_pct, round((((bp.pressure_boundary_pct - bo.overall_boundary_pct) / "nullif"(bo.overall_boundary_pct, 0)) * 100), 1) AS boundary_delta_pct, bo.overall_dot_pct, bp.pressure_dot_pct, round((((bp.pressure_dot_pct - bo.overall_dot_pct) / "nullif"(bo.overall_dot_pct, 0)) * 100), 1) AS dot_delta_pct, CASE  WHEN ((bp.pressure_balls >= 100)) THEN ('HIGH') WHEN ((bp.pressure_balls >= 50)) THEN ('MEDIUM') ELSE 'LOW' END AS sample_confidence, CASE  WHEN (((((bp.pressure_sr - bo.overall_sr) / "nullif"(bo.overall_sr, 0)) * 100) >= 10)) THEN ('CLUTCH') WHEN ((abs((((bp.pressure_sr - bo.overall_sr) / "nullif"(bo.overall_sr, 0)) * 100)) <= 5)) THEN ('PRESSURE_PROOF') WHEN (((((bp.pressure_sr - bo.overall_sr) / "nullif"(bo.overall_sr, 0)) * 100) <= -10)) THEN ('PRESSURE_SENSITIVE') ELSE 'MODERATE' END AS pressure_rating, round((((((bp.pressure_sr - bo.overall_sr) / "nullif"(bo.overall_sr, 0)) * 100) * (1.0 + log2((bp.pressure_balls / 30.0)))) * (1.0 + (0.3 * ((bp.death_pressure_balls * 1.0) / "nullif"(bp.pressure_balls, 0))))), 2) AS pressure_score, bec.avg_balls_before_pressure, bec.entry_context FROM batter_overall AS bo INNER JOIN batter_pressure AS bp ON ((bo.batter_id = bp.batter_id)) INNER JOIN dim_player AS dp ON ((bo.batter_id = dp.player_id)) LEFT JOIN batter_entry_context AS bec ON ((bo.batter_id = bec.batter_id)) ORDER BY pressure_score DESC;

CREATE OR REPLACE VIEW analytics_ipl_pressure_deltas_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), ipl_innings_count AS (SELECT fb.batter_id, count(DISTINCT fb.match_id) AS ipl_innings FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND fb.is_legal_ball) GROUP BY fb.batter_id HAVING (count(DISTINCT fb.match_id) >= 10)), first_innings_total AS (SELECT fb.match_id, sum(fb.total_runs) AS target_runs FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.innings = 1)) GROUP BY fb.match_id), running_context AS (SELECT fb.match_id, fb.innings, fb.ball_seq, fb."over", fb.batter_id, fb.bowler_id, fb.batter_runs, fb.extra_runs, fb.total_runs, fb.is_wicket, fb.wicket_type, fb.is_legal_ball, sum(fb.total_runs) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS cumulative_runs, (fit.target_runs + 1) AS "target", (120 - fb.ball_seq) AS balls_remaining, COALESCE(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) OVER (PARTITION BY fb.match_id, fb.innings, fb.batter_id ORDER BY fb.ball_seq ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING), 0) AS batter_balls_before FROM fact_ball AS fb INNER JOIN first_innings_total AS fit ON ((fb.match_id = fit.match_id)) WHERE ((fb.innings = 2) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches)))), with_bands AS (SELECT *, CASE  WHEN ((balls_remaining <= 0)) THEN (NULL) WHEN ((((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 10)) THEN ('HIGH_PRESSURE') ELSE 'NORMAL' END AS pressure_group FROM running_context WHERE (balls_remaining > 0)), batter_entry_context AS (SELECT batter_id, round(avg(batter_balls_before), 1) AS avg_balls_before_pressure, CASE  WHEN ((avg(batter_balls_before) > 40)) THEN ('DEEP_SET') WHEN ((avg(batter_balls_before) > 25)) THEN ('SET') WHEN ((avg(batter_balls_before) >= 10)) THEN ('BUILDING') ELSE 'FRESH' END AS entry_context FROM with_bands WHERE (pressure_group = 'HIGH_PRESSURE') GROUP BY batter_id), batter_overall AS (SELECT wb.batter_id, sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END) AS overall_balls, round(((sum(wb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS overall_sr, round(((sum(CASE  WHEN ((wb.batter_runs IN (4, 6))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS overall_boundary_pct, round(((sum(CASE  WHEN (((wb.batter_runs = 0) AND (wb.extra_runs = 0) AND wb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS overall_dot_pct FROM with_bands AS wb INNER JOIN ipl_innings_count AS ic ON ((wb.batter_id = ic.batter_id)) GROUP BY wb.batter_id HAVING (sum(CASE  WHEN (wb.is_legal_ball) THEN (1) ELSE 0 END) >= 50)), batter_pressure AS (SELECT batter_id, sum(CASE  WHEN (is_legal_ball) THEN (1) ELSE 0 END) AS pressure_balls, round(((sum(batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS pressure_sr, round(((sum(CASE  WHEN ((batter_runs IN (4, 6))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS pressure_boundary_pct, round(((sum(CASE  WHEN (((batter_runs = 0) AND (extra_runs = 0) AND is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS pressure_dot_pct, sum(CASE  WHEN ((is_legal_ball AND ("over" >= 15))) THEN (1) ELSE 0 END) AS death_pressure_balls, round(((sum(CASE  WHEN (("over" >= 15)) THEN (batter_runs) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN ((is_legal_ball AND ("over" >= 15))) THEN (1) ELSE 0 END), 0)), 2) AS death_pressure_sr FROM with_bands WHERE (pressure_group = 'HIGH_PRESSURE') GROUP BY batter_id HAVING (sum(CASE  WHEN (is_legal_ball) THEN (1) ELSE 0 END) >= 30))SELECT dp.current_name AS player_name, bo.batter_id AS player_id, 'BATTER' AS "role", bo.overall_balls, bp.pressure_balls, bp.death_pressure_balls, bp.death_pressure_sr, bo.overall_sr, bp.pressure_sr, round((((bp.pressure_sr - bo.overall_sr) / "nullif"(bo.overall_sr, 0)) * 100), 1) AS sr_delta_pct, bo.overall_boundary_pct, bp.pressure_boundary_pct, round((((bp.pressure_boundary_pct - bo.overall_boundary_pct) / "nullif"(bo.overall_boundary_pct, 0)) * 100), 1) AS boundary_delta_pct, bo.overall_dot_pct, bp.pressure_dot_pct, round((((bp.pressure_dot_pct - bo.overall_dot_pct) / "nullif"(bo.overall_dot_pct, 0)) * 100), 1) AS dot_delta_pct, CASE  WHEN ((bp.pressure_balls >= 100)) THEN ('HIGH') WHEN ((bp.pressure_balls >= 50)) THEN ('MEDIUM') ELSE 'LOW' END AS sample_confidence, CASE  WHEN (((((bp.pressure_sr - bo.overall_sr) / "nullif"(bo.overall_sr, 0)) * 100) >= 10)) THEN ('CLUTCH') WHEN ((abs((((bp.pressure_sr - bo.overall_sr) / "nullif"(bo.overall_sr, 0)) * 100)) <= 5)) THEN ('PRESSURE_PROOF') WHEN (((((bp.pressure_sr - bo.overall_sr) / "nullif"(bo.overall_sr, 0)) * 100) <= -10)) THEN ('PRESSURE_SENSITIVE') ELSE 'MODERATE' END AS pressure_rating, round((((((bp.pressure_sr - bo.overall_sr) / "nullif"(bo.overall_sr, 0)) * 100) * (1.0 + log2((bp.pressure_balls / 30.0)))) * (1.0 + (0.3 * ((bp.death_pressure_balls * 1.0) / "nullif"(bp.pressure_balls, 0))))), 2) AS pressure_score, bec.avg_balls_before_pressure, bec.entry_context FROM batter_overall AS bo INNER JOIN batter_pressure AS bp ON ((bo.batter_id = bp.batter_id)) INNER JOIN dim_player AS dp ON ((bo.batter_id = dp.player_id)) LEFT JOIN batter_entry_context AS bec ON ((bo.batter_id = bec.batter_id)) ORDER BY pressure_score DESC;

CREATE OR REPLACE VIEW analytics_ipl_pressure_dot_sequences_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), first_innings_total AS (SELECT fb.match_id, sum(fb.total_runs) AS target_runs FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.innings = 1)) GROUP BY fb.match_id), running_context AS (SELECT fb.match_id, fb.innings, fb.ball_seq, fb.bowler_id, fb.batter_id, fb.batter_runs, fb.extra_runs, fb.total_runs, fb.is_legal_ball, sum(fb.total_runs) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS cumulative_runs, (fit.target_runs + 1) AS "target", (120 - fb.ball_seq) AS balls_remaining, CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0) AND fb.is_legal_ball)) THEN (0) ELSE 1 END AS is_scoring, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0) AND fb.is_legal_ball)) THEN (0) ELSE 1 END) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS scoring_group FROM fact_ball AS fb INNER JOIN first_innings_total AS fit ON ((fb.match_id = fit.match_id)) WHERE ((fb.innings = 2) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches)))), pressure_balls AS (SELECT *, CASE  WHEN ((balls_remaining > 0)) THEN (((("target" - cumulative_runs) * 6.0) / balls_remaining)) ELSE NULL END AS rrr FROM running_context WHERE ((balls_remaining > 0) AND (((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 10))), dot_runs AS (SELECT bowler_id, match_id, innings, scoring_group, count_star() AS dots_in_sequence FROM pressure_balls WHERE (is_scoring = 0) GROUP BY bowler_id, match_id, innings, scoring_group HAVING (count_star() >= 2))SELECT dp.current_name AS bowler_name, dr.bowler_id, count_star() AS dot_sequences, round(avg(dr.dots_in_sequence), 1) AS avg_dot_seq_length, max(dr.dots_in_sequence) AS max_dot_seq, sum(dr.dots_in_sequence) AS total_dots_in_sequences FROM dot_runs AS dr INNER JOIN dim_player AS dp ON ((dr.bowler_id = dp.player_id)) GROUP BY dr.bowler_id, dp.current_name HAVING (count_star() >= 3) ORDER BY avg_dot_seq_length DESC;

CREATE OR REPLACE VIEW analytics_ipl_pressure_dot_sequences_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), first_innings_total AS (SELECT fb.match_id, sum(fb.total_runs) AS target_runs FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.innings = 1)) GROUP BY fb.match_id), running_context AS (SELECT fb.match_id, fb.innings, fb.ball_seq, fb.bowler_id, fb.batter_id, fb.batter_runs, fb.extra_runs, fb.total_runs, fb.is_legal_ball, sum(fb.total_runs) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS cumulative_runs, (fit.target_runs + 1) AS "target", (120 - fb.ball_seq) AS balls_remaining, CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0) AND fb.is_legal_ball)) THEN (0) ELSE 1 END AS is_scoring, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0) AND fb.is_legal_ball)) THEN (0) ELSE 1 END) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS scoring_group FROM fact_ball AS fb INNER JOIN first_innings_total AS fit ON ((fb.match_id = fit.match_id)) WHERE ((fb.innings = 2) AND (fb.match_id = ANY(SELECT match_id FROM ipl_matches)))), pressure_balls AS (SELECT *, CASE  WHEN ((balls_remaining > 0)) THEN (((("target" - cumulative_runs) * 6.0) / balls_remaining)) ELSE NULL END AS rrr FROM running_context WHERE ((balls_remaining > 0) AND (((("target" - cumulative_runs) * 6.0) / balls_remaining) >= 10))), dot_runs AS (SELECT bowler_id, match_id, innings, scoring_group, count_star() AS dots_in_sequence FROM pressure_balls WHERE (is_scoring = 0) GROUP BY bowler_id, match_id, innings, scoring_group HAVING (count_star() >= 2))SELECT dp.current_name AS bowler_name, dr.bowler_id, count_star() AS dot_sequences, round(avg(dr.dots_in_sequence), 1) AS avg_dot_seq_length, max(dr.dots_in_sequence) AS max_dot_seq, sum(dr.dots_in_sequence) AS total_dots_in_sequences FROM dot_runs AS dr INNER JOIN dim_player AS dp ON ((dr.bowler_id = dp.player_id)) GROUP BY dr.bowler_id, dp.current_name HAVING (count_star() >= 3) ORDER BY avg_dot_seq_length DESC;

CREATE OR REPLACE VIEW analytics_ipl_required_rate_performance_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), innings1_total AS (SELECT fb.match_id, (sum(fb.total_runs) + 1) AS chase_target FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.innings = 1)) GROUP BY fb.match_id), chase_balls AS (SELECT fb.batter_id, fb.match_id, fb.ball_seq, fb.batter_runs, fb.is_wicket, fb.player_out_id, fb.is_legal_ball, i1t.chase_target, COALESCE(sum(fb2.total_runs), 0) AS cumulative_runs_before, (120 - sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq)) AS legal_balls_remaining FROM fact_ball AS fb INNER JOIN innings1_total AS i1t ON ((fb.match_id = i1t.match_id)) LEFT JOIN fact_ball AS fb2 ON (((fb.match_id = fb2.match_id) AND (fb2.innings = 2) AND (fb2.ball_seq < fb.ball_seq) AND fb2.is_legal_ball)) WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.innings = 2) AND fb.is_legal_ball) GROUP BY fb.batter_id, fb.match_id, fb.ball_seq, fb.batter_runs, fb.is_wicket, fb.player_out_id, fb.is_legal_ball, fb.innings, i1t.chase_target), with_rrr AS (SELECT cb.*, round((((cb.chase_target - cb.cumulative_runs_before) * 6.0) / "nullif"((cb.legal_balls_remaining + 1), 0)), 2) AS required_run_rate FROM chase_balls AS cb WHERE (cb.legal_balls_remaining >= 0)), with_band AS (SELECT wr.*, CASE  WHEN ((wr.required_run_rate < 8)) THEN ('RRR_under_8') WHEN ((wr.required_run_rate < 10)) THEN ('RRR_8_10') WHEN ((wr.required_run_rate < 12)) THEN ('RRR_10_12') ELSE 'RRR_12_plus' END AS pressure_band FROM with_rrr AS wr)SELECT wb.batter_id, dp.current_name AS batter_name, wb.pressure_band, count_star() AS balls_faced, sum(wb.batter_runs) AS runs, round(((sum(wb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, sum(CASE  WHEN ((wb.is_wicket AND (wb.player_out_id = wb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round((((sum(CASE  WHEN ((wb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((wb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct FROM with_band AS wb INNER JOIN dim_player AS dp ON ((wb.batter_id = dp.player_id)) GROUP BY wb.batter_id, dp.current_name, wb.pressure_band;

CREATE OR REPLACE VIEW analytics_ipl_required_rate_performance_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), innings1_total AS (SELECT fb.match_id, (sum(fb.total_runs) + 1) AS chase_target FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.innings = 1)) GROUP BY fb.match_id), chase_balls AS (SELECT fb.batter_id, fb.match_id, fb.ball_seq, fb.batter_runs, fb.is_wicket, fb.player_out_id, fb.is_legal_ball, i1t.chase_target, COALESCE(sum(fb2.total_runs), 0) AS cumulative_runs_before, (120 - sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq)) AS legal_balls_remaining FROM fact_ball AS fb INNER JOIN innings1_total AS i1t ON ((fb.match_id = i1t.match_id)) LEFT JOIN fact_ball AS fb2 ON (((fb.match_id = fb2.match_id) AND (fb2.innings = 2) AND (fb2.ball_seq < fb.ball_seq) AND fb2.is_legal_ball)) WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.innings = 2) AND fb.is_legal_ball) GROUP BY fb.batter_id, fb.match_id, fb.ball_seq, fb.batter_runs, fb.is_wicket, fb.player_out_id, fb.is_legal_ball, fb.innings, i1t.chase_target), with_rrr AS (SELECT cb.*, round((((cb.chase_target - cb.cumulative_runs_before) * 6.0) / "nullif"((cb.legal_balls_remaining + 1), 0)), 2) AS required_run_rate FROM chase_balls AS cb WHERE (cb.legal_balls_remaining >= 0)), with_band AS (SELECT wr.*, CASE  WHEN ((wr.required_run_rate < 8)) THEN ('RRR_under_8') WHEN ((wr.required_run_rate < 10)) THEN ('RRR_8_10') WHEN ((wr.required_run_rate < 12)) THEN ('RRR_10_12') ELSE 'RRR_12_plus' END AS pressure_band FROM with_rrr AS wr)SELECT wb.batter_id, dp.current_name AS batter_name, wb.pressure_band, count_star() AS balls_faced, sum(wb.batter_runs) AS runs, round(((sum(wb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, sum(CASE  WHEN ((wb.is_wicket AND (wb.player_out_id = wb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round((((sum(CASE  WHEN ((wb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((wb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct FROM with_band AS wb INNER JOIN dim_player AS dp ON ((wb.batter_id = dp.player_id)) GROUP BY wb.batter_id, dp.current_name, wb.pressure_band;

CREATE OR REPLACE VIEW analytics_ipl_small_sample_enrichment AS WITH ipl_bat AS (SELECT fb.batter_id AS player_id, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS ipl_balls FROM fact_ball AS fb INNER JOIN dim_match AS dm ON ((fb.match_id = dm.match_id)) WHERE ((dm.tournament_id = 'indian_premier_league') AND (dm.match_date >= '2023-01-01')) GROUP BY fb.batter_id), ipl_bowl AS (SELECT fb.bowler_id AS player_id, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS ipl_balls FROM fact_ball AS fb INNER JOIN dim_match AS dm ON ((fb.match_id = dm.match_id)) WHERE ((dm.tournament_id = 'indian_premier_league') AND (dm.match_date >= '2023-01-01')) GROUP BY fb.bowler_id)SELECT sq.player_id, sq.player_name, sq.team_name, sq."role", COALESCE(ib.ipl_balls, 0) AS ipl_bat_balls, COALESCE(ibl.ipl_balls, 0) AS ipl_bowl_balls, CASE  WHEN ((COALESCE(ib.ipl_balls, 0) < 300)) THEN (CAST('t' AS BOOLEAN)) ELSE CAST('f' AS BOOLEAN) END AS bat_small_sample, CASE  WHEN ((COALESCE(ibl.ipl_balls, 0) < 200)) THEN (CAST('t' AS BOOLEAN)) ELSE CAST('f' AS BOOLEAN) END AS bowl_small_sample, wcb.weighted_sr AS cross_tournament_bat_sr, wcb.weighted_avg AS cross_tournament_bat_avg, wcb.weighted_boundary_pct AS cross_tournament_boundary_pct, wcb.tournaments_played AS bat_tournaments, wcb.total_balls AS bat_total_t20_balls, wcbl.weighted_economy AS cross_tournament_bowl_econ, wcbl.weighted_bowling_sr AS cross_tournament_bowl_sr, wcbl.weighted_dot_pct AS cross_tournament_dot_pct, wcbl.tournaments_played AS bowl_tournaments, wcbl.total_balls AS bowl_total_t20_balls FROM ipl_2026_squads AS sq LEFT JOIN ipl_bat AS ib ON ((sq.player_id = ib.player_id)) LEFT JOIN ipl_bowl AS ibl ON ((sq.player_id = ibl.player_id)) LEFT JOIN analytics_weighted_composite_batting AS wcb ON ((sq.player_id = wcb.player_id)) LEFT JOIN analytics_weighted_composite_bowling AS wcbl ON ((sq.player_id = wcbl.player_id)) WHERE ((COALESCE(ib.ipl_balls, 0) < 300) OR (COALESCE(ibl.ipl_balls, 0) < 200));

CREATE OR REPLACE VIEW analytics_ipl_squad_batting AS SELECT sq.team_name, sq.player_name, sq."role", sq.batting_hand, ct.price_cr, ct.acquisition_type, ct.year_joined, ipl.innings AS ipl_innings, ipl.runs AS ipl_runs, ipl.balls_faced AS ipl_balls, ipl.strike_rate AS ipl_sr, ipl.batting_average AS ipl_avg, ipl.boundary_pct AS ipl_boundary_pct, ipl.dot_ball_pct AS ipl_dot_pct, ipl.fifties AS ipl_fifties, ipl.hundreds AS ipl_hundreds, ipl.sample_size AS ipl_sample_size, t20.innings AS t20_innings, t20.runs AS t20_runs, t20.strike_rate AS t20_sr, t20.batting_average AS t20_avg, t20.sample_size_innings AS t20_sample_size FROM ipl_2026_squads AS sq LEFT JOIN ipl_2026_contracts AS ct ON (((sq.team_name = ct.team_name) AND (sq.player_name = ct.player_name))) LEFT JOIN analytics_ipl_batting_career AS ipl ON ((sq.player_id = ipl.player_id)) LEFT JOIN analytics_batting_career AS t20 ON ((sq.player_id = t20.player_id)) WHERE (sq."role" IN ('Batter', 'Wicketkeeper', 'All-rounder')) ORDER BY sq.team_name, COALESCE(ct.price_cr, 0) DESC;

CREATE OR REPLACE VIEW analytics_ipl_squad_batting_alltime AS SELECT sq.team_name, sq.player_name, sq."role", sq.batting_hand, ct.price_cr, ct.acquisition_type, ct.year_joined, ipl.innings AS ipl_innings, ipl.runs AS ipl_runs, ipl.balls_faced AS ipl_balls, ipl.strike_rate AS ipl_sr, ipl.batting_average AS ipl_avg, ipl.boundary_pct AS ipl_boundary_pct, ipl.dot_ball_pct AS ipl_dot_pct, ipl.fifties AS ipl_fifties, ipl.hundreds AS ipl_hundreds, ipl.sample_size AS ipl_sample_size, t20.innings AS t20_innings, t20.runs AS t20_runs, t20.strike_rate AS t20_sr, t20.batting_average AS t20_avg, t20.sample_size_innings AS t20_sample_size FROM ipl_2026_squads AS sq LEFT JOIN ipl_2026_contracts AS ct ON (((sq.team_name = ct.team_name) AND (sq.player_name = ct.player_name))) LEFT JOIN analytics_ipl_batting_career_alltime AS ipl ON ((sq.player_id = ipl.player_id)) LEFT JOIN analytics_batting_career AS t20 ON ((sq.player_id = t20.player_id)) WHERE (sq."role" IN ('Batter', 'Wicketkeeper', 'All-rounder')) ORDER BY sq.team_name, COALESCE(ct.price_cr, 0) DESC;

CREATE OR REPLACE VIEW analytics_ipl_squad_batting_phase AS SELECT sq.team_name, sq.player_name, sq."role", ct.price_cr, bp.match_phase, bp.innings, bp.runs, bp.balls_faced, bp.strike_rate, bp.batting_average, bp.boundary_pct, bp.dot_ball_pct, bp.sample_size FROM ipl_2026_squads AS sq LEFT JOIN ipl_2026_contracts AS ct ON (((sq.team_name = ct.team_name) AND (sq.player_name = ct.player_name))) LEFT JOIN analytics_ipl_batter_phase AS bp ON ((sq.player_id = bp.player_id)) WHERE (sq."role" IN ('Batter', 'Wicketkeeper', 'All-rounder')) ORDER BY sq.team_name, sq.player_name, bp.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_squad_batting_phase_alltime AS SELECT sq.team_name, sq.player_name, sq."role", ct.price_cr, bp.match_phase, bp.innings, bp.runs, bp.balls_faced, bp.strike_rate, bp.batting_average, bp.boundary_pct, bp.dot_ball_pct, bp.sample_size FROM ipl_2026_squads AS sq LEFT JOIN ipl_2026_contracts AS ct ON (((sq.team_name = ct.team_name) AND (sq.player_name = ct.player_name))) LEFT JOIN analytics_ipl_batter_phase_alltime AS bp ON ((sq.player_id = bp.player_id)) WHERE (sq."role" IN ('Batter', 'Wicketkeeper', 'All-rounder')) ORDER BY sq.team_name, sq.player_name, bp.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_squad_batting_phase_since2023 AS SELECT * FROM analytics_ipl_squad_batting_phase;

CREATE OR REPLACE VIEW analytics_ipl_squad_batting_since2023 AS SELECT * FROM analytics_ipl_squad_batting;

CREATE OR REPLACE VIEW analytics_ipl_squad_bowling AS SELECT sq.team_name, sq.player_name, sq."role", sq.bowling_arm, sq.bowling_type, ct.price_cr, ct.acquisition_type, ct.year_joined, ipl.matches_bowled AS ipl_matches, ipl.overs_bowled AS ipl_overs, ipl.wickets AS ipl_wickets, ipl.economy_rate AS ipl_economy, ipl.bowling_average AS ipl_avg, ipl.bowling_strike_rate AS ipl_sr, ipl.dot_ball_pct AS ipl_dot_pct, ipl.boundary_conceded_pct AS ipl_boundary_pct, ipl.sample_size AS ipl_sample_size, t20.matches_bowled AS t20_matches, t20.wickets AS t20_wickets, t20.economy_rate AS t20_economy, t20.bowling_average AS t20_avg, t20.sample_size_matches AS t20_sample_size FROM ipl_2026_squads AS sq LEFT JOIN ipl_2026_contracts AS ct ON (((sq.team_name = ct.team_name) AND (sq.player_name = ct.player_name))) LEFT JOIN analytics_ipl_bowling_career AS ipl ON ((sq.player_id = ipl.player_id)) LEFT JOIN analytics_bowling_career AS t20 ON ((sq.player_id = t20.player_id)) WHERE (sq."role" IN ('Bowler', 'All-rounder')) ORDER BY sq.team_name, COALESCE(ct.price_cr, 0) DESC;

CREATE OR REPLACE VIEW analytics_ipl_squad_bowling_alltime AS SELECT sq.team_name, sq.player_name, sq."role", sq.bowling_arm, sq.bowling_type, ct.price_cr, ct.acquisition_type, ct.year_joined, ipl.matches_bowled AS ipl_matches, ipl.overs_bowled AS ipl_overs, ipl.wickets AS ipl_wickets, ipl.economy_rate AS ipl_economy, ipl.bowling_average AS ipl_avg, ipl.bowling_strike_rate AS ipl_sr, ipl.dot_ball_pct AS ipl_dot_pct, ipl.boundary_conceded_pct AS ipl_boundary_pct, ipl.sample_size AS ipl_sample_size, t20.matches_bowled AS t20_matches, t20.wickets AS t20_wickets, t20.economy_rate AS t20_economy, t20.bowling_average AS t20_avg, t20.sample_size_matches AS t20_sample_size FROM ipl_2026_squads AS sq LEFT JOIN ipl_2026_contracts AS ct ON (((sq.team_name = ct.team_name) AND (sq.player_name = ct.player_name))) LEFT JOIN analytics_ipl_bowling_career_alltime AS ipl ON ((sq.player_id = ipl.player_id)) LEFT JOIN analytics_bowling_career AS t20 ON ((sq.player_id = t20.player_id)) WHERE (sq."role" IN ('Bowler', 'All-rounder')) ORDER BY sq.team_name, COALESCE(ct.price_cr, 0) DESC;

CREATE OR REPLACE VIEW analytics_ipl_squad_bowling_phase AS SELECT sq.team_name, sq.player_name, sq."role", sq.bowling_type, ct.price_cr, bp.match_phase, bp.matches, bp.overs, bp.wickets, bp.economy_rate, bp.bowling_average, bp.dot_ball_pct, bp.boundary_conceded_pct, bp.sample_size FROM ipl_2026_squads AS sq LEFT JOIN ipl_2026_contracts AS ct ON (((sq.team_name = ct.team_name) AND (sq.player_name = ct.player_name))) LEFT JOIN analytics_ipl_bowler_phase AS bp ON ((sq.player_id = bp.player_id)) WHERE (sq."role" IN ('Bowler', 'All-rounder')) ORDER BY sq.team_name, sq.player_name, bp.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_squad_bowling_phase_alltime AS SELECT sq.team_name, sq.player_name, sq."role", sq.bowling_type, ct.price_cr, bp.match_phase, bp.matches, bp.overs, bp.wickets, bp.economy_rate, bp.bowling_average, bp.dot_ball_pct, bp.boundary_conceded_pct, bp.sample_size FROM ipl_2026_squads AS sq LEFT JOIN ipl_2026_contracts AS ct ON (((sq.team_name = ct.team_name) AND (sq.player_name = ct.player_name))) LEFT JOIN analytics_ipl_bowler_phase_alltime AS bp ON ((sq.player_id = bp.player_id)) WHERE (sq."role" IN ('Bowler', 'All-rounder')) ORDER BY sq.team_name, sq.player_name, bp.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_squad_bowling_phase_since2023 AS SELECT * FROM analytics_ipl_squad_bowling_phase;

CREATE OR REPLACE VIEW analytics_ipl_squad_bowling_since2023 AS SELECT * FROM analytics_ipl_squad_bowling;

CREATE OR REPLACE VIEW analytics_ipl_team_batting_order_since2023 AS WITH first_ball AS (SELECT fb.match_id, fb.innings, fb.batter_id, fb.batting_team_id, dm.season, min(fb.ball_seq) AS first_ball_seq FROM fact_ball AS fb INNER JOIN dim_match AS dm ON ((fb.match_id = dm.match_id)) INNER JOIN dim_tournament AS dtr ON ((dm.tournament_id = dtr.tournament_id)) WHERE ((dtr.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')) GROUP BY fb.match_id, fb.innings, fb.batter_id, fb.batting_team_id, dm.season), batter_order AS (SELECT match_id, innings, batter_id, batting_team_id, season, row_number() OVER (PARTITION BY match_id, innings, batting_team_id ORDER BY first_ball_seq) AS batting_position FROM first_ball), classified AS (SELECT dtt.team_name AS batting_team, bo.season, CASE  WHEN ((bo.batting_position <= 3)) THEN ('top_order') WHEN ((bo.batting_position <= 5)) THEN ('middle_order') ELSE 'lower_order' END AS order_segment, fb.batter_runs, fb.is_legal_ball FROM fact_ball AS fb INNER JOIN batter_order AS bo ON (((fb.match_id = bo.match_id) AND (fb.innings = bo.innings) AND (fb.batter_id = bo.batter_id))) INNER JOIN dim_team AS dtt ON ((fb.batting_team_id = dtt.team_id)))SELECT batting_team, season, order_segment, sum(batter_runs) AS runs, sum(CASE  WHEN (is_legal_ball) THEN (1) ELSE 0 END) AS balls, round(((sum(batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (is_legal_ball) THEN (1) ELSE 0 END), 0)), 1) AS strike_rate FROM classified GROUP BY batting_team, season, order_segment;

CREATE OR REPLACE VIEW analytics_ipl_team_matchup_batting AS SELECT sq_bat.team_name AS batting_team, sq_bowl.team_name AS bowling_team, count(DISTINCT fb.batter_id) AS batters_faced, count(DISTINCT fb.bowler_id) AS bowlers_faced, count(DISTINCT fb.match_id) AS matches, sum(fb.batter_runs) AS total_runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS total_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS run_rate, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN ((fb.batter_runs IN (4, 6))) THEN (1) ELSE 0 END) AS boundaries, sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(CASE  WHEN ((fb.batter_runs IN (4, 6))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_pct, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct FROM fact_ball AS fb INNER JOIN dim_match AS dm ON ((fb.match_id = dm.match_id)) INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) INNER JOIN ipl_2026_squads AS sq_bat ON ((fb.batter_id = sq_bat.player_id)) INNER JOIN ipl_2026_squads AS sq_bowl ON ((fb.bowler_id = sq_bowl.player_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01') AND (sq_bat.team_name != sq_bowl.team_name)) GROUP BY sq_bat.team_name, sq_bowl.team_name;

CREATE OR REPLACE VIEW analytics_ipl_team_phase_batting_since2023 AS SELECT dtt.team_name AS batting_team, dm.season, fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS legal_balls, sum(fb.batter_runs) AS runs, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 1) AS strike_rate, round(((sum(fb.batter_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS run_rate, round(((sum(CASE  WHEN ((fb.batter_runs IN (4, 6))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 1) AS boundary_pct, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 1) AS dot_ball_pct, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS wickets_lost FROM fact_ball AS fb INNER JOIN dim_match AS dm ON ((fb.match_id = dm.match_id)) INNER JOIN dim_tournament AS dtr ON ((dm.tournament_id = dtr.tournament_id)) INNER JOIN dim_team AS dtt ON ((fb.batting_team_id = dtt.team_id)) WHERE ((dtr.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')) GROUP BY dtt.team_name, dm.season, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_team_phase_bowling_since2023 AS SELECT dtt.team_name AS bowling_team, dm.season, fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS legal_balls, sum((fb.batter_runs + fb.extra_runs)) AS runs_conceded, round(((sum((fb.batter_runs + fb.extra_runs)) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS economy, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS wickets_taken, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 1) AS dot_ball_pct, round(((sum(CASE  WHEN ((fb.batter_runs IN (4, 6))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 1) AS boundary_conceded_pct FROM fact_ball AS fb INNER JOIN dim_match AS dm ON ((fb.match_id = dm.match_id)) INNER JOIN dim_tournament AS dtr ON ((dm.tournament_id = dtr.tournament_id)) INNER JOIN dim_team AS dtt ON ((fb.bowling_team_id = dtt.team_id)) WHERE ((dtr.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')) GROUP BY dtt.team_name, dm.season, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_team_phase_scoring_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT fb.batting_team_id, dtt.team_name, fb.innings, fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(fb.total_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS run_rate, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS wickets_lost, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_pct, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct FROM fact_ball AS fb INNER JOIN dim_team AS dtt ON ((fb.batting_team_id = dtt.team_id)) WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.batting_team_id, dtt.team_name, fb.innings, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_team_phase_scoring_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT fb.batting_team_id, dtt.team_name, fb.innings, fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(fb.total_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS run_rate, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS wickets_lost, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_pct, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct FROM fact_ball AS fb INNER JOIN dim_team AS dtt ON ((fb.batting_team_id = dtt.team_id)) WHERE (fb.match_id = ANY(SELECT match_id FROM ipl_matches)) GROUP BY fb.batting_team_id, dtt.team_name, fb.innings, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_team_roster AS SELECT sq.team_name, sq.player_name, sq."role", sq.bowling_type, sq.batting_hand, ct.price_cr, ct.acquisition_type, ct.year_joined, CASE  WHEN ((sq."role" = 'Batter')) THEN ('Batting') WHEN ((sq."role" = 'Bowler')) THEN ('Bowling') WHEN ((sq."role" = 'All-rounder')) THEN ('All-round') WHEN ((sq."role" = 'Wicketkeeper')) THEN ('Batting') ELSE 'Other' END AS primary_skill FROM ipl_2026_squads AS sq LEFT JOIN ipl_2026_contracts AS ct ON (((sq.team_name = ct.team_name) AND (sq.player_name = ct.player_name))) ORDER BY sq.team_name, COALESCE(ct.price_cr, 0) DESC;

CREATE OR REPLACE VIEW analytics_ipl_team_roster_alltime AS SELECT * FROM analytics_ipl_team_roster;

CREATE OR REPLACE VIEW analytics_ipl_team_roster_since2023 AS SELECT * FROM analytics_ipl_team_roster;

CREATE OR REPLACE VIEW analytics_ipl_toss_advantage AS WITH ipl_matches AS (SELECT dm.match_id, dm.venue_id, dm.toss_winner_id, dm.toss_decision, dm.winner_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01') AND (dm.winner_id IS NOT NULL))), venue_stats AS (SELECT im.venue_id, dv.venue_name, dv.city, count_star() AS matches, count_star() FILTER (WHERE (im.toss_decision = 'bat')) AS bat_first_total, count_star() FILTER (WHERE ((im.toss_decision = 'bat') AND (im.toss_winner_id = im.winner_id))) AS bat_first_wins, count_star() FILTER (WHERE (im.toss_decision = 'field')) AS field_first_total, count_star() FILTER (WHERE ((im.toss_decision = 'field') AND (im.toss_winner_id = im.winner_id))) AS field_first_wins, count_star() FILTER (WHERE (im.toss_winner_id = im.winner_id)) AS toss_wins FROM ipl_matches AS im INNER JOIN dim_venue AS dv ON ((im.venue_id = dv.venue_id)) GROUP BY im.venue_id, dv.venue_name, dv.city)SELECT venue_id, venue_name, city, matches, bat_first_wins, bat_first_total, round(COALESCE(((bat_first_wins * 1.0) / "nullif"(bat_first_total, 0)), 0), 4) AS bat_first_win_rate, field_first_wins, field_first_total, round(COALESCE(((field_first_wins * 1.0) / "nullif"(field_first_total, 0)), 0), 4) AS field_first_win_rate, round(((toss_wins * 1.0) / matches), 4) AS toss_advantage, round(abs((COALESCE(((field_first_wins * 1.0) / "nullif"(field_first_total, 0)), 0) - COALESCE(((bat_first_wins * 1.0) / "nullif"(bat_first_total, 0)), 0))), 4) AS tai, CASE  WHEN ((COALESCE(((bat_first_wins * 1.0) / "nullif"(bat_first_total, 0)), 0) >= COALESCE(((field_first_wins * 1.0) / "nullif"(field_first_total, 0)), 0))) THEN ('bat') ELSE 'field' END AS preferred_decision, CASE  WHEN ((matches >= 15)) THEN ('HIGH') WHEN ((matches >= 8)) THEN ('MEDIUM') ELSE 'LOW' END AS confidence FROM venue_stats ORDER BY tai DESC;

CREATE OR REPLACE VIEW analytics_ipl_venue_profile_alltime AS WITH ipl_matches AS (SELECT dm.match_id, dm.venue_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT im.venue_id, dv.venue_name, dv.city, fb.innings, fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(fb.total_runs) AS total_runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS total_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS run_rate, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_pct, round(((sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) * 1.0) / "nullif"(count(DISTINCT fb.match_id), 0)), 2) AS wickets_per_match, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct FROM fact_ball AS fb INNER JOIN ipl_matches AS im ON ((fb.match_id = im.match_id)) INNER JOIN dim_venue AS dv ON ((im.venue_id = dv.venue_id)) GROUP BY im.venue_id, dv.venue_name, dv.city, fb.innings, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_venue_profile_since2023 AS WITH ipl_matches AS (SELECT dm.match_id, dm.venue_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT im.venue_id, dv.venue_name, dv.city, fb.innings, fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(fb.total_runs) AS total_runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS total_balls, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS run_rate, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_pct, round(((sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) * 1.0) / "nullif"(count(DISTINCT fb.match_id), 0)), 2) AS wickets_per_match, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct FROM fact_ball AS fb INNER JOIN ipl_matches AS im ON ((fb.match_id = im.match_id)) INNER JOIN dim_venue AS dv ON ((im.venue_id = dv.venue_id)) GROUP BY im.venue_id, dv.venue_name, dv.city, fb.innings, fb.match_phase;

CREATE OR REPLACE VIEW analytics_ipl_vs_bowler_type_benchmarks AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown') AS bowler_type, count_star() AS total_balls, sum(fb.batter_runs) AS total_runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS total_dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS avg_strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS avg_batting_avg, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS avg_boundary_pct FROM fact_ball AS fb INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) LEFT JOIN ipl_2026_squads AS sq ON ((dp_bowl.player_id = sq.player_id)) LEFT JOIN dim_bowler_classification AS bc ON ((dp_bowl.player_id = bc.player_id)) WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.is_legal_ball = CAST('t' AS BOOLEAN))) GROUP BY COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown');

CREATE OR REPLACE VIEW analytics_ipl_vs_bowler_type_benchmarks_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League'))SELECT COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown') AS bowler_type, count_star() AS total_balls, sum(fb.batter_runs) AS total_runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS total_dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS avg_strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS avg_batting_avg, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS avg_boundary_pct FROM fact_ball AS fb INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) LEFT JOIN ipl_2026_squads AS sq ON ((dp_bowl.player_id = sq.player_id)) LEFT JOIN dim_bowler_classification AS bc ON ((dp_bowl.player_id = bc.player_id)) WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.is_legal_ball = CAST('t' AS BOOLEAN))) GROUP BY COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown');

CREATE OR REPLACE VIEW analytics_ipl_vs_bowler_type_benchmarks_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01')))SELECT COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown') AS bowler_type, count_star() AS total_balls, sum(fb.batter_runs) AS total_runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS total_dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS avg_strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS avg_batting_avg, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS avg_boundary_pct FROM fact_ball AS fb INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) LEFT JOIN ipl_2026_squads AS sq ON ((dp_bowl.player_id = sq.player_id)) LEFT JOIN dim_bowler_classification AS bc ON ((dp_bowl.player_id = bc.player_id)) WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND (fb.is_legal_ball = CAST('t' AS BOOLEAN))) GROUP BY COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown');

CREATE OR REPLACE VIEW analytics_ipl_wicket_clusters_alltime AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE (dt.tournament_name = 'Indian Premier League')), wicket_balls AS (SELECT fb.match_id, fb.innings, fb.batting_team_id, fb.bowling_team_id, fb.ball_seq, lag(fb.ball_seq) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS prev_wicket_seq FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND fb.is_wicket)), cluster_flags AS (SELECT wb.*, CASE  WHEN (((wb.ball_seq - wb.prev_wicket_seq) <= 12)) THEN (1) ELSE 0 END AS in_cluster FROM wicket_balls AS wb WHERE (wb.prev_wicket_seq IS NOT NULL))SELECT cf.batting_team_id, dt_bat.team_name AS batting_team_name, cf.bowling_team_id, dt_bowl.team_name AS bowling_team_name, sum(cf.in_cluster) AS cluster_events, (sum(cf.in_cluster) * 2) AS total_cluster_wickets, count(DISTINCT CASE  WHEN ((cf.in_cluster = 1)) THEN (cf.match_id) ELSE NULL END) AS matches_with_clusters FROM cluster_flags AS cf INNER JOIN dim_team AS dt_bat ON ((cf.batting_team_id = dt_bat.team_id)) INNER JOIN dim_team AS dt_bowl ON ((cf.bowling_team_id = dt_bowl.team_id)) GROUP BY cf.batting_team_id, dt_bat.team_name, cf.bowling_team_id, dt_bowl.team_name;

CREATE OR REPLACE VIEW analytics_ipl_wicket_clusters_since2023 AS WITH ipl_matches AS (SELECT dm.match_id FROM dim_match AS dm INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) WHERE ((dt.tournament_name = 'Indian Premier League') AND (dm.match_date >= '2023-01-01'))), wicket_balls AS (SELECT fb.match_id, fb.innings, fb.batting_team_id, fb.bowling_team_id, fb.ball_seq, lag(fb.ball_seq) OVER (PARTITION BY fb.match_id, fb.innings ORDER BY fb.ball_seq) AS prev_wicket_seq FROM fact_ball AS fb WHERE ((fb.match_id = ANY(SELECT match_id FROM ipl_matches)) AND fb.is_wicket)), cluster_flags AS (SELECT wb.*, CASE  WHEN (((wb.ball_seq - wb.prev_wicket_seq) <= 12)) THEN (1) ELSE 0 END AS in_cluster FROM wicket_balls AS wb WHERE (wb.prev_wicket_seq IS NOT NULL))SELECT cf.batting_team_id, dt_bat.team_name AS batting_team_name, cf.bowling_team_id, dt_bowl.team_name AS bowling_team_name, sum(cf.in_cluster) AS cluster_events, (sum(cf.in_cluster) * 2) AS total_cluster_wickets, count(DISTINCT CASE  WHEN ((cf.in_cluster = 1)) THEN (cf.match_id) ELSE NULL END) AS matches_with_clusters FROM cluster_flags AS cf INNER JOIN dim_team AS dt_bat ON ((cf.batting_team_id = dt_bat.team_id)) INNER JOIN dim_team AS dt_bowl ON ((cf.bowling_team_id = dt_bowl.team_id)) GROUP BY cf.batting_team_id, dt_bat.team_name, cf.bowling_team_id, dt_bowl.team_name;

CREATE OR REPLACE VIEW analytics_powerplay_hitters AS SELECT player_id, player_name, innings, runs, balls_faced, strike_rate, boundary_pct, sample_size FROM analytics_batting_by_phase WHERE ((match_phase = 'powerplay') AND (balls_faced >= 200)) ORDER BY strike_rate DESC;

CREATE OR REPLACE VIEW analytics_t20_batter_phase AS SELECT dp.player_id, dp.current_name AS player_name, fb.match_phase, count(DISTINCT fb.match_id) AS innings, sum(fb.batter_runs) AS runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) AS dot_balls, round(((sum(fb.batter_runs) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS batting_average, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_pct, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, CASE  WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 100)) THEN ('LOW') WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) GROUP BY dp.player_id, dp.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_t20_batter_vs_bowler_type AS SELECT dp_bat.player_id AS batter_id, dp_bat.current_name AS batter_name, COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown') AS bowler_type, count_star() AS balls, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END) AS dismissals, round(((sum(fb.batter_runs) * 100.0) / "nullif"(count_star(), 0)), 2) AS strike_rate, round(((sum(fb.batter_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.player_out_id = fb.batter_id))) THEN (1) ELSE 0 END), 0)), 2) AS average, sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes, round(((sum(CASE  WHEN ((fb.batter_runs = 0)) THEN (1) ELSE 0 END) * 100.0) / "nullif"(count_star(), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(count_star(), 0)), 2) AS boundary_pct, CASE  WHEN ((count_star() < 50)) THEN ('LOW') WHEN ((count_star() < 200)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp_bat ON ((fb.batter_id = dp_bat.player_id)) INNER JOIN dim_player AS dp_bowl ON ((fb.bowler_id = dp_bowl.player_id)) LEFT JOIN ipl_2026_squads AS sq ON ((dp_bowl.player_id = sq.player_id)) LEFT JOIN dim_bowler_classification AS bc ON ((dp_bowl.player_id = bc.player_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY dp_bat.player_id, dp_bat.current_name, COALESCE(sq.bowling_type, bc.bowling_style, 'Unknown');

CREATE OR REPLACE VIEW analytics_t20_bowler_phase AS SELECT dp.player_id, dp.current_name AS player_name, fb.match_phase, count(DISTINCT fb.match_id) AS matches, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, round((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) / 6.0), 1) AS overs, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) AS dot_balls, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours_conceded, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes_conceded, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS economy_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END), 0)), 2) AS bowling_average, round(((sum(CASE  WHEN (((fb.batter_runs = 0) AND (fb.extra_runs = 0))) THEN (1) ELSE 0 END) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS dot_ball_pct, round((((sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) + sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END)) * 100.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS boundary_conceded_pct, CASE  WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 100)) THEN ('LOW') WHEN ((sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) < 500)) THEN ('MEDIUM') ELSE 'HIGH' END AS sample_size FROM fact_ball AS fb INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) GROUP BY dp.player_id, dp.current_name, fb.match_phase;

CREATE OR REPLACE VIEW analytics_team_batting AS SELECT dt.team_id, dt.team_name, count(DISTINCT fb.match_id) AS matches, sum(fb.total_runs) AS total_runs, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS wickets_lost, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS run_rate, round(((sum(fb.total_runs) * 1.0) / "nullif"(sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END), 0)), 2) AS runs_per_wicket FROM fact_ball AS fb INNER JOIN dim_team AS dt ON ((fb.batting_team_id = dt.team_id)) GROUP BY dt.team_id, dt.team_name ORDER BY total_runs DESC;

CREATE OR REPLACE VIEW analytics_team_bowling AS SELECT dt.team_id, dt.team_name, count(DISTINCT fb.match_id) AS matches, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_bowled, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out')))) THEN (1) ELSE 0 END) AS wickets_taken, round(((sum(fb.total_runs) * 6.0) / "nullif"(sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END), 0)), 2) AS economy_rate FROM fact_ball AS fb INNER JOIN dim_team AS dt ON ((fb.bowling_team_id = dt.team_id)) GROUP BY dt.team_id, dt.team_name ORDER BY wickets_taken DESC;

CREATE OR REPLACE VIEW analytics_top_run_scorers AS SELECT player_id, player_name, primary_role, innings, runs, balls_faced, highest_score, fifties, hundreds, strike_rate, batting_average, boundary_pct, sample_size_innings FROM analytics_batting_career WHERE (innings >= 10) ORDER BY runs DESC;

CREATE OR REPLACE VIEW analytics_top_wicket_takers AS SELECT player_id, player_name, primary_role, matches_bowled, overs_bowled, wickets, best_wickets, best_runs, economy_rate, bowling_average, bowling_strike_rate, dot_ball_pct, sample_size_matches FROM analytics_bowling_career WHERE (matches_bowled >= 10) ORDER BY wickets DESC;

CREATE OR REPLACE VIEW analytics_weighted_composite_batting AS WITH per_tournament AS (SELECT fb.batter_id AS player_id, dp.current_name AS player_name, dt.tournament_name, dtw.composite_weight, dtw.tier, count(DISTINCT fb.match_id) AS matches, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS balls_faced, sum(fb.batter_runs) AS runs, sum(CASE  WHEN ((fb.is_wicket AND (fb.wicket_type NOT IN ('run out', 'retired hurt', 'retired out', 'obstructing the field')))) THEN (1) ELSE 0 END) AS dismissals, sum(CASE  WHEN ((fb.batter_runs = 4)) THEN (1) ELSE 0 END) AS fours, sum(CASE  WHEN ((fb.batter_runs = 6)) THEN (1) ELSE 0 END) AS sixes FROM fact_ball AS fb INNER JOIN dim_match AS dm ON ((fb.match_id = dm.match_id)) INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) INNER JOIN dim_tournament_weights AS dtw ON ((dt.tournament_name = dtw.tournament_name)) INNER JOIN dim_player AS dp ON ((fb.batter_id = dp.player_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY fb.batter_id, dp.current_name, dt.tournament_name, dtw.composite_weight, dtw.tier HAVING (balls_faced >= 20))SELECT player_id, player_name, count(DISTINCT tournament_name) AS tournaments_played, sum(matches) AS total_matches, sum(balls_faced) AS total_balls, sum(runs) AS total_runs, round(((sum((runs * composite_weight)) * 100.0) / "nullif"(sum((balls_faced * composite_weight)), 0)), 2) AS weighted_sr, round((sum((runs * composite_weight)) / "nullif"(sum((dismissals * composite_weight)), 0)), 2) AS weighted_avg, round(((sum(runs) * 100.0) / "nullif"(sum(balls_faced), 0)), 2) AS raw_sr, round(((sum(((fours + sixes) * composite_weight)) * 100.0) / "nullif"(sum((balls_faced * composite_weight)), 0)), 2) AS weighted_boundary_pct, round((sum((balls_faced * composite_weight)) / "nullif"(sum(balls_faced), 0)), 4) AS avg_weight, list(struct_pack(t := tournament_name, w := composite_weight, b := balls_faced, sr := round(((runs * 100.0) / "nullif"(balls_faced, 0)), 1)) ORDER BY balls_faced DESC)[:3] AS top_tournaments FROM per_tournament GROUP BY player_id, player_name;

CREATE OR REPLACE VIEW analytics_weighted_composite_bowling AS WITH per_tournament AS (SELECT fb.bowler_id AS player_id, dp.current_name AS player_name, dt.tournament_name, dtw.composite_weight, dtw.tier, count(DISTINCT fb.match_id) AS matches, sum(CASE  WHEN (fb.is_legal_ball) THEN (1) ELSE 0 END) AS legal_balls, sum(fb.total_runs) AS runs_conceded, sum(CASE  WHEN (fb.is_wicket) THEN (1) ELSE 0 END) AS wickets, sum(CASE  WHEN (((fb.batter_runs = 0) AND fb.is_legal_ball)) THEN (1) ELSE 0 END) AS dot_balls FROM fact_ball AS fb INNER JOIN dim_match AS dm ON ((fb.match_id = dm.match_id)) INNER JOIN dim_tournament AS dt ON ((dm.tournament_id = dt.tournament_id)) INNER JOIN dim_tournament_weights AS dtw ON ((dt.tournament_name = dtw.tournament_name)) INNER JOIN dim_player AS dp ON ((fb.bowler_id = dp.player_id)) WHERE (fb.is_legal_ball = CAST('t' AS BOOLEAN)) GROUP BY fb.bowler_id, dp.current_name, dt.tournament_name, dtw.composite_weight, dtw.tier HAVING (legal_balls >= 12))SELECT player_id, player_name, count(DISTINCT tournament_name) AS tournaments_played, sum(matches) AS total_matches, sum(legal_balls) AS total_balls, sum(wickets) AS total_wickets, round(((sum((runs_conceded * composite_weight)) * 6.0) / "nullif"(sum((legal_balls * composite_weight)), 0)), 2) AS weighted_economy, round((sum((legal_balls * composite_weight)) / "nullif"(sum((wickets * composite_weight)), 0)), 2) AS weighted_bowling_sr, round(((sum(runs_conceded) * 6.0) / "nullif"(sum(legal_balls), 0)), 2) AS raw_economy, round(((sum((dot_balls * composite_weight)) * 100.0) / "nullif"(sum((legal_balls * composite_weight)), 0)), 2) AS weighted_dot_pct, round((sum((legal_balls * composite_weight)) / "nullif"(sum(legal_balls), 0)), 4) AS avg_weight, list(struct_pack(t := tournament_name, w := composite_weight, b := legal_balls, econ := round(((runs_conceded * 6.0) / "nullif"(legal_balls, 0)), 1)) ORDER BY legal_balls DESC)[:3] AS top_tournaments FROM per_tournament GROUP BY player_id, player_name;
