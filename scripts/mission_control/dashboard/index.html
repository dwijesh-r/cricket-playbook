<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission Control - Cricket Playbook</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ==================== THEME SYSTEM ==================== */
        :root {
            /* Dark Theme (Default) */
            --bg-primary: #000000;
            --bg-secondary: #1c1c1e;
            --bg-tertiary: #2c2c2e;
            --bg-elevated: #3a3a3c;
            --text-primary: #ffffff;
            --text-secondary: #8e8e93;
            --text-tertiary: #636366;
            --accent: #0a84ff;
            --accent-green: #30d158;
            --accent-yellow: #ffd60a;
            --accent-orange: #ff9f0a;
            --accent-red: #ff453a;
            --accent-purple: #bf5af2;
            --accent-pink: #ff375f;
            --accent-teal: #64d2ff;
            --border: rgba(255, 255, 255, 0.1);
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.08);
            --bg-sports: rgba(255, 255, 255, 0.02);
            --text-sports: rgba(255, 255, 255, 0.04);
            --shadow: rgba(0, 0, 0, 0.4);
        }

        [data-theme="light"] {
            /* Light Theme */
            --bg-primary: #f5f5f7;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e5e5ea;
            --bg-elevated: #d1d1d6;
            --text-primary: #1d1d1f;
            --text-secondary: #6e6e73;
            --text-tertiary: #8e8e93;
            --accent: #007aff;
            --accent-green: #28cd41;
            --accent-yellow: #ffcc00;
            --accent-orange: #ff9500;
            --accent-red: #ff3b30;
            --accent-purple: #af52de;
            --accent-pink: #ff2d55;
            --accent-teal: #5ac8fa;
            --border: rgba(0, 0, 0, 0.08);
            --glass: rgba(0, 0, 0, 0.03);
            --glass-border: rgba(0, 0, 0, 0.06);
            --bg-sports: rgba(0, 0, 0, 0.02);
            --text-sports: rgba(0, 0, 0, 0.04);
            --shadow: rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            position: relative;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* ==================== SPORTS-THEMED BACKGROUND ==================== */
        .bg-gradient {
            position: fixed;
            inset: 0;
            z-index: -2;
            overflow: hidden;
        }

        .bg-gradient::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background:
                radial-gradient(ellipse at 20% 20%, rgba(10, 132, 255, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(191, 90, 242, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 40% 60%, rgba(48, 209, 88, 0.04) 0%, transparent 40%);
            animation: bgShift 30s ease-in-out infinite;
        }

        [data-theme="light"] .bg-gradient::before {
            background:
                radial-gradient(ellipse at 20% 20%, rgba(0, 122, 255, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(175, 82, 222, 0.04) 0%, transparent 50%),
                radial-gradient(ellipse at 40% 60%, rgba(40, 205, 65, 0.03) 0%, transparent 40%);
        }

        @keyframes bgShift {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(2%, 2%) rotate(1deg); }
            66% { transform: translate(-1%, 1%) rotate(-1deg); }
        }

        /* Grid pattern overlay */
        .bg-grid {
            position: fixed;
            inset: 0;
            z-index: -1;
            background-image:
                linear-gradient(var(--text-sports) 1px, transparent 1px),
                linear-gradient(90deg, var(--text-sports) 1px, transparent 1px);
            background-size: 60px 60px;
            mask-image: radial-gradient(ellipse at center, black 0%, transparent 70%);
            -webkit-mask-image: radial-gradient(ellipse at center, black 0%, transparent 70%);
        }

        /* Sports-themed floating elements */
        .sports-bg {
            position: fixed;
            inset: 0;
            z-index: -1;
            pointer-events: none;
            overflow: hidden;
        }

        .sports-text {
            position: absolute;
            font-weight: 700;
            color: var(--text-sports);
            white-space: nowrap;
            user-select: none;
        }

        .sports-text.names {
            font-size: 80px;
            letter-spacing: -0.04em;
            opacity: 0.6;
        }

        .sports-text.quotes {
            font-size: 18px;
            font-style: italic;
            font-weight: 400;
            max-width: 300px;
            white-space: normal;
            line-height: 1.4;
        }

        .sports-text.teams {
            font-size: 48px;
            letter-spacing: 0.1em;
            font-weight: 800;
            text-transform: uppercase;
        }

        /* Sports icons */
        .sports-icon {
            position: absolute;
            font-size: 60px;
            opacity: 0.03;
            user-select: none;
        }

        /* ==================== NAVIGATION ==================== */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 52px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: saturate(180%) blur(20px);
            -webkit-backdrop-filter: saturate(180%) blur(20px);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            z-index: 100;
            transition: background 0.3s ease;
        }

        [data-theme="light"] .nav {
            background: rgba(245, 245, 247, 0.85);
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-logo {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-purple) 100%);
            border-radius: 7px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .nav-title {
            font-size: 15px;
            font-weight: 600;
            letter-spacing: -0.01em;
        }

        .nav-tabs {
            display: flex;
            gap: 4px;
            background: var(--bg-secondary);
            padding: 4px;
            border-radius: 8px;
        }

        .nav-tab {
            padding: 6px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            background: none;
            font-family: inherit;
        }

        .nav-tab:hover { color: var(--text-primary); }
        .nav-tab.active { background: var(--bg-tertiary); color: var(--text-primary); }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-time {
            font-size: 12px;
            color: var(--text-secondary);
            font-variant-numeric: tabular-nums;
        }

        /* Theme toggle */
        .theme-toggle {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--glass);
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .theme-toggle:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-btn {
            background: var(--glass);
            border: 1px solid var(--glass-border);
            color: var(--accent);
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .nav-btn:hover { background: rgba(10, 132, 255, 0.15); }

        /* ==================== MAIN CONTAINER ==================== */
        .main {
            padding-top: 52px;
            min-height: 100vh;
        }

        .view { display: none; }
        .view.active { display: block; }

        /* ==================== HERO SECTION ==================== */
        .hero {
            padding: 40px 24px 32px;
            border-bottom: 1px solid var(--border);
        }

        .hero-content {
            max-width: 1400px;
            margin: 0 auto;
        }

        .sprint-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 8px;
        }

        .sprint-title {
            font-size: 48px;
            font-weight: 700;
            letter-spacing: -0.03em;
            line-height: 1.1;
            margin-bottom: 8px;
        }

        .sprint-dates {
            font-size: 17px;
            color: var(--text-secondary);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background: var(--border);
            border-radius: 12px;
            overflow: hidden;
            margin-top: 32px;
        }

        .stat-item {
            background: var(--bg-secondary);
            backdrop-filter: blur(10px);
            padding: 24px;
            text-align: center;
            transition: background 0.3s ease;
        }

        .stat-value {
            font-size: 40px;
            font-weight: 700;
            letter-spacing: -0.02em;
            font-variant-numeric: tabular-nums;
        }

        .stat-value.accent-green { color: var(--accent-green); }
        .stat-value.accent-yellow { color: var(--accent-yellow); }
        .stat-value.accent-red { color: var(--accent-red); }
        .stat-value.accent-blue { color: var(--accent); }

        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 4px;
        }

        /* ==================== BOARD SECTION ==================== */
        .board-section {
            padding: 32px 24px;
            max-width: 1800px;
            margin: 0 auto;
        }

        .board-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .board-title {
            font-size: 22px;
            font-weight: 600;
            letter-spacing: -0.02em;
        }

        .board-filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .filter-btn:hover, .filter-btn.active {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-color: var(--accent);
        }

        .filter-btn.active {
            background: rgba(10, 132, 255, 0.15);
            color: var(--accent);
        }

        /* Agent filter dropdown */
        .agent-filter {
            position: relative;
        }

        .agent-filter-btn {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .agent-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 8px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 8px;
            min-width: 220px;
            display: none;
            z-index: 50;
            box-shadow: 0 20px 40px var(--shadow);
        }

        .agent-dropdown.active { display: block; }

        .agent-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .agent-option:hover { background: var(--bg-tertiary); }
        .agent-option.selected { background: rgba(10, 132, 255, 0.15); }

        .agent-option-avatar {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .agent-option-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 6px;
        }

        .agent-option-name {
            font-size: 13px;
            font-weight: 500;
            flex: 1;
        }

        .agent-option-count {
            font-size: 12px;
            color: var(--text-tertiary);
            background: var(--bg-tertiary);
            padding: 2px 6px;
            border-radius: 4px;
        }

        /* ==================== KANBAN BOARD ==================== */
        .kanban {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 12px;
        }

        .column {
            background: var(--bg-secondary);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border);
            transition: background 0.3s ease;
        }

        .column-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .column-name {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .column-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .dot-idea { background: var(--accent-purple); }
        .dot-backlog { background: var(--text-secondary); }
        .dot-ready { background: var(--accent); }
        .dot-running { background: var(--accent-yellow); box-shadow: 0 0 10px var(--accent-yellow); }
        .dot-blocked { background: var(--accent-red); box-shadow: 0 0 10px var(--accent-red); }
        .dot-review { background: var(--accent-orange); }
        .dot-validation { background: var(--accent-pink); }
        .dot-done { background: var(--accent-green); }

        .column-count {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-tertiary);
            background: var(--bg-tertiary);
            padding: 2px 8px;
            border-radius: 10px;
        }

        .column-body {
            padding: 12px;
            flex: 1;
            overflow-y: auto;
        }

        /* ==================== TICKET CARD ==================== */
        .ticket {
            background: var(--bg-tertiary);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }

        .ticket:hover {
            background: var(--bg-elevated);
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 10px 30px var(--shadow);
        }

        .ticket.filtered-out {
            opacity: 0.3;
            transform: scale(0.98);
        }

        .ticket-top {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 10px;
        }

        /* Agent Avatar */
        .agent-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.1);
        }

        .agent-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .ticket-info { flex: 1; min-width: 0; }

        .ticket-id {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-tertiary);
            font-variant-numeric: tabular-nums;
        }

        .ticket-title {
            font-size: 14px;
            font-weight: 500;
            line-height: 1.35;
            margin-top: 3px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .ticket-agent {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .ticket-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .priority {
            font-size: 10px;
            font-weight: 700;
            padding: 3px 7px;
            border-radius: 4px;
        }

        .priority-p0 { background: rgba(255, 69, 58, 0.15); color: var(--accent-red); }
        .priority-p1 { background: rgba(255, 159, 10, 0.15); color: var(--accent-orange); }
        .priority-p2 { background: rgba(10, 132, 255, 0.15); color: var(--accent); }
        .priority-p3 { background: rgba(142, 142, 147, 0.15); color: var(--text-secondary); }

        .tag {
            font-size: 10px;
            font-weight: 500;
            padding: 3px 7px;
            border-radius: 4px;
            background: var(--glass);
            color: var(--text-secondary);
        }

        .ticket-links {
            display: flex;
            gap: 6px;
            margin-top: 10px;
        }

        .link-btn {
            font-size: 10px;
            font-weight: 500;
            padding: 4px 8px;
            border-radius: 4px;
            background: var(--bg-secondary);
            color: var(--accent);
            transition: all 0.2s ease;
        }

        .link-btn:hover { background: rgba(10, 132, 255, 0.15); }

        .gate-progress {
            display: flex;
            gap: 3px;
            margin-top: 10px;
        }

        .gate-step {
            flex: 1;
            height: 3px;
            border-radius: 2px;
            background: var(--bg-secondary);
        }

        .gate-step.passed { background: var(--accent-green); }
        .gate-step.current { background: var(--accent-yellow); }

        .empty-state {
            text-align: center;
            padding: 32px 16px;
            color: var(--text-tertiary);
            font-size: 13px;
        }

        /* ==================== AGENT ROSTER ==================== */
        .roster-section {
            padding: 32px 24px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .roster-header {
            margin-bottom: 32px;
        }

        .roster-title {
            font-size: 48px;
            font-weight: 700;
            letter-spacing: -0.03em;
            margin-bottom: 8px;
        }

        .roster-subtitle {
            font-size: 17px;
            color: var(--text-secondary);
        }

        .roster-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 16px;
        }

        .agent-card {
            background: var(--bg-secondary);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .agent-card:hover {
            border-color: var(--accent);
            transform: translateY(-4px);
            box-shadow: 0 20px 40px var(--shadow);
        }

        .agent-card-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .agent-card-avatar {
            width: 60px;
            height: 60px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            border: 2px solid rgba(255,255,255,0.1);
            overflow: hidden;
            flex-shrink: 0;
        }

        .agent-card-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        .agent-card-info h3 {
            font-size: 18px;
            font-weight: 600;
            letter-spacing: -0.01em;
        }

        .agent-card-role {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .agent-card-team {
            font-size: 11px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 4px;
        }

        .agent-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .agent-stat {
            text-align: center;
            padding: 12px 8px;
            background: var(--bg-tertiary);
            border-radius: 10px;
        }

        .agent-stat-value {
            font-size: 24px;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
        }

        .agent-stat-label {
            font-size: 10px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 2px;
        }

        .agent-priority-breakdown {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .priority-chip {
            flex: 1;
            text-align: center;
            padding: 8px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
        }

        .priority-chip.p0 { background: rgba(255, 69, 58, 0.1); color: var(--accent-red); }
        .priority-chip.p1 { background: rgba(255, 159, 10, 0.1); color: var(--accent-orange); }
        .priority-chip.p2 { background: rgba(10, 132, 255, 0.1); color: var(--accent); }
        .priority-chip.p3 { background: rgba(142, 142, 147, 0.1); color: var(--text-secondary); }

        .agent-progress {
            margin-top: 16px;
        }

        .agent-progress-label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .agent-progress-bar {
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
        }

        .agent-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-teal));
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .agent-recent {
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .agent-recent-title {
            font-size: 11px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 12px;
        }

        .agent-recent-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
        }

        .recent-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .recent-status.done { background: var(--accent-green); }
        .recent-status.running { background: var(--accent-yellow); }
        .recent-status.blocked { background: var(--accent-red); }

        .recent-title {
            flex: 1;
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .recent-time {
            font-size: 11px;
            color: var(--text-tertiary);
        }

        /* ==================== MODAL ==================== */
        .modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            z-index: 200;
            justify-content: center;
            align-items: center;
            padding: 24px;
        }

        .modal-overlay.active { display: flex; }

        .modal {
            background: var(--bg-secondary);
            border-radius: 16px;
            width: 100%;
            max-width: 560px;
            max-height: 85vh;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .modal-header-content {
            display: flex;
            gap: 16px;
            align-items: flex-start;
        }

        .modal-avatar {
            width: 52px;
            height: 52px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .modal-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            line-height: 1.3;
        }

        .modal-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .modal-close {
            background: var(--bg-tertiary);
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .modal-close:hover { background: var(--bg-elevated); color: var(--text-primary); }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
            max-height: calc(85vh - 100px);
        }

        .modal-section { margin-bottom: 24px; }
        .modal-section:last-child { margin-bottom: 0; }

        .modal-section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 12px;
        }

        .gate-list { display: flex; flex-direction: column; gap: 8px; }

        .gate-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            background: var(--bg-tertiary);
            border-radius: 10px;
        }

        .gate-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .gate-icon.passed { background: rgba(48, 209, 88, 0.15); color: var(--accent-green); }
        .gate-icon.pending { background: rgba(255, 214, 10, 0.15); color: var(--accent-yellow); }
        .gate-icon.waiting { background: var(--bg-elevated); color: var(--text-tertiary); }

        .gate-info { flex: 1; }
        .gate-name { font-size: 14px; font-weight: 500; }
        .gate-approver { font-size: 12px; color: var(--text-secondary); margin-top: 2px; }

        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .detail-item {
            background: var(--bg-tertiary);
            padding: 14px;
            border-radius: 10px;
        }

        .detail-label {
            font-size: 11px;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .detail-value {
            font-size: 15px;
            font-weight: 500;
            margin-top: 4px;
        }

        .link-list { display: flex; flex-direction: column; gap: 8px; }

        .modal-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            text-decoration: none;
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        .modal-link:hover { background: var(--bg-elevated); }
        .modal-link-icon { font-size: 16px; }
        .modal-link-text { font-size: 14px; font-weight: 500; }
        .modal-link-arrow { margin-left: auto; color: var(--text-tertiary); }

        /* ==================== LIST VIEW ==================== */
        .list-section {
            padding: 32px 24px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .list-header {
            margin-bottom: 24px;
        }

        .list-title {
            font-size: 32px;
            font-weight: 700;
            letter-spacing: -0.03em;
            margin-bottom: 8px;
        }

        .list-subtitle {
            font-size: 15px;
            color: var(--text-secondary);
        }

        /* Desktop Table */
        .ticket-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-secondary);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .ticket-table th,
        .ticket-table td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .ticket-table th {
            background: var(--bg-tertiary);
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            position: sticky;
            top: 0;
        }

        .ticket-table tr:last-child td {
            border-bottom: none;
        }

        .ticket-table tr {
            transition: background 0.15s ease;
            cursor: pointer;
        }

        .ticket-table tbody tr:hover {
            background: var(--bg-tertiary);
        }

        .table-avatar {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            overflow: hidden;
        }

        .table-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .table-agent-cell {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .table-agent-name {
            font-weight: 500;
            font-size: 14px;
        }

        .table-id {
            font-family: 'SF Mono', 'Monaco', monospace;
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .table-title {
            font-weight: 500;
            font-size: 14px;
            max-width: 300px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .table-state {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .state-idea { background: rgba(191, 90, 242, 0.15); color: var(--accent-purple); }
        .state-backlog { background: var(--glass); color: var(--text-secondary); }
        .state-ready { background: rgba(10, 132, 255, 0.15); color: var(--accent); }
        .state-running { background: rgba(255, 214, 10, 0.15); color: var(--accent-yellow); }
        .state-blocked { background: rgba(255, 69, 58, 0.15); color: var(--accent-red); }
        .state-review { background: rgba(255, 159, 10, 0.15); color: var(--accent-orange); }
        .state-validation { background: rgba(255, 55, 95, 0.15); color: var(--accent-pink); }
        .state-done { background: rgba(48, 209, 88, 0.15); color: var(--accent-green); }

        .table-sprint {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .table-priority {
            font-size: 11px;
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 4px;
        }

        .table-wrapper {
            overflow-x: auto;
            border-radius: 12px;
        }

        /* Mobile Cards View */
        .mobile-cards {
            display: none;
        }

        .mobile-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .mobile-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px var(--shadow);
        }

        .mobile-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .mobile-card-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .mobile-card-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .mobile-card-main {
            flex: 1;
            min-width: 0;
        }

        .mobile-card-id {
            font-size: 11px;
            color: var(--text-tertiary);
            font-weight: 600;
        }

        .mobile-card-title {
            font-size: 15px;
            font-weight: 500;
            line-height: 1.3;
            margin-top: 2px;
        }

        .mobile-card-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .mobile-card-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-top: 1px solid var(--border);
        }

        .mobile-card-label {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .mobile-card-value {
            font-size: 13px;
            font-weight: 500;
        }

        /* Mobile nav tabs */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            padding: 8px 16px;
            padding-bottom: max(8px, env(safe-area-inset-bottom));
            z-index: 100;
        }

        .mobile-nav-tabs {
            display: flex;
            justify-content: space-around;
        }

        .mobile-nav-tab {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            border: none;
            background: none;
            color: var(--text-tertiary);
            font-size: 10px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .mobile-nav-tab.active {
            color: var(--accent);
            background: rgba(10, 132, 255, 0.1);
        }

        .mobile-nav-icon {
            font-size: 20px;
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 1400px) {
            .kanban { grid-template-columns: repeat(4, 1fr); }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 900px) {
            .kanban { grid-template-columns: repeat(2, 1fr); }
            .sprint-title, .roster-title, .list-title { font-size: 28px; }
            .nav-tabs { display: none; }
            .mobile-nav { display: block; }
            .main { padding-bottom: 80px; }
            .sports-text.names { font-size: 50px; }
            .ticket-table { font-size: 13px; }
            .table-title { max-width: 180px; }
        }

        @media (max-width: 600px) {
            .kanban { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .roster-grid { grid-template-columns: 1fr; }
            .agent-stats { grid-template-columns: repeat(2, 1fr); }
            .table-wrapper { display: none; }
            .mobile-cards { display: block; }
            .hero { padding: 24px 16px 20px; }
            .board-section, .list-section, .roster-section { padding: 20px 16px; }
            .sprint-title, .roster-title, .list-title { font-size: 24px; }
            .stat-value { font-size: 28px; }
            .stat-item { padding: 16px; }
        }
    </style>
</head>
<body>
    <!-- Sports-themed background -->
    <div class="bg-gradient"></div>
    <div class="bg-grid"></div>
    <div class="sports-bg" id="sportsBg"></div>

    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-brand">
            <div class="nav-logo">üèè</div>
            <span class="nav-title">Mission Control</span>
        </div>
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showView('board')">Board</button>
            <button class="nav-tab" onclick="showView('list')">List</button>
            <button class="nav-tab" onclick="showView('roster')">Roster</button>
        </div>
        <div class="nav-actions">
            <span class="nav-time" id="navTime">--:--:--</span>
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme" id="themeToggle">üåô</button>
            <button class="nav-btn" onclick="loadData()">Refresh</button>
        </div>
    </nav>

    <!-- Main -->
    <main class="main">
        <!-- Board View -->
        <div class="view active" id="boardView">
            <section class="hero">
                <div class="hero-content">
                    <div class="sprint-label">Active Sprint</div>
                    <h1 class="sprint-title">Sprint 4</h1>
                    <p class="sprint-dates">Jan 31 ‚Äî Feb 14, 2026</p>

                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value accent-blue" id="statTotal">9</div>
                            <div class="stat-label">Total</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value accent-yellow" id="statRunning">2</div>
                            <div class="stat-label">In Progress</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value accent-red" id="statBlocked">1</div>
                            <div class="stat-label">Blocked</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value accent-green" id="statDone">1</div>
                            <div class="stat-label">Done</div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="board-section">
                <div class="board-header">
                    <h2 class="board-title">Kanban Board</h2>
                    <div class="board-filters">
                        <button class="filter-btn active" data-filter="all">All</button>
                        <button class="filter-btn" data-filter="p0">P0 Critical</button>
                        <div class="agent-filter">
                            <button class="filter-btn agent-filter-btn" onclick="toggleAgentDropdown()">
                                <span id="agentFilterLabel">All Agents</span> ‚ñæ
                            </button>
                            <div class="agent-dropdown" id="agentDropdown"></div>
                        </div>
                    </div>
                </div>

                <div class="kanban" id="kanban"></div>
            </section>
        </div>

        <!-- List View -->
        <div class="view" id="listView">
            <section class="list-section">
                <div class="list-header">
                    <h1 class="list-title">All Tickets</h1>
                    <p class="list-subtitle">Complete ticket overview with all details</p>
                </div>

                <!-- Desktop Table -->
                <div class="table-wrapper">
                    <table class="ticket-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Title</th>
                                <th>Agent</th>
                                <th>State</th>
                                <th>Sprint</th>
                                <th>Priority</th>
                                <th>Progress</th>
                            </tr>
                        </thead>
                        <tbody id="ticketTableBody"></tbody>
                    </table>
                </div>

                <!-- Mobile Cards -->
                <div class="mobile-cards" id="mobileCards"></div>
            </section>
        </div>

        <!-- Agent Roster View -->
        <div class="view" id="rosterView">
            <section class="roster-section">
                <div class="roster-header">
                    <h1 class="roster-title">Agent Roster</h1>
                    <p class="roster-subtitle">Performance metrics and workload distribution</p>
                </div>
                <div class="roster-grid" id="rosterGrid"></div>
            </section>
        </div>
    </main>

    <!-- Mobile Bottom Navigation -->
    <nav class="mobile-nav">
        <div class="mobile-nav-tabs">
            <button class="mobile-nav-tab active" onclick="showView('board')">
                <span class="mobile-nav-icon">üìã</span>
                Board
            </button>
            <button class="mobile-nav-tab" onclick="showView('list')">
                <span class="mobile-nav-icon">üìä</span>
                List
            </button>
            <button class="mobile-nav-tab" onclick="showView('roster')">
                <span class="mobile-nav-icon">üë•</span>
                Roster
            </button>
        </div>
    </nav>

    <!-- Modal -->
    <div class="modal-overlay" id="modal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-header-content">
                    <div class="modal-avatar" id="modalAvatar"></div>
                    <div>
                        <div class="modal-title" id="modalTitle">Ticket Title</div>
                        <div class="modal-subtitle" id="modalSubtitle">TKT-000 ¬∑ P0</div>
                    </div>
                </div>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <div class="modal-section-title">Task Integrity Loop</div>
                    <div class="gate-list" id="modalGates"></div>
                </div>
                <div class="modal-section">
                    <div class="modal-section-title">Details</div>
                    <div class="detail-grid" id="modalDetails"></div>
                </div>
                <div class="modal-section">
                    <div class="modal-section-title">Links</div>
                    <div class="link-list" id="modalLinks"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== INLINE SVG AVATAR SYSTEM ====================
        // Self-contained for portability - no external files needed
        const AgentAvatars = {
            'Tom Brady': `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <defs><linearGradient id="brady-bg" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#002244"/><stop offset="100%" style="stop-color:#c60c30"/>
                </linearGradient></defs>
                <rect width="64" height="64" rx="12" fill="url(#brady-bg)"/>
                <ellipse cx="32" cy="34" rx="18" ry="20" fill="#F5D0B0"/>
                <path d="M14 38 Q20 52 32 54 Q44 52 50 38" fill="#E8C4A0"/>
                <path d="M14 26 Q14 14 32 12 Q50 14 50 26 L50 20 Q50 10 32 8 Q14 10 14 20 Z" fill="#5C4033"/>
                <ellipse cx="24" cy="32" rx="4" ry="3" fill="white"/><ellipse cx="40" cy="32" rx="4" ry="3" fill="white"/>
                <circle cx="24" cy="32" r="2" fill="#2E4A62"/><circle cx="40" cy="32" r="2" fill="#2E4A62"/>
                <path d="M18 27 L28 29" stroke="#5C4033" stroke-width="2" stroke-linecap="round"/>
                <path d="M46 27 L36 29" stroke="#5C4033" stroke-width="2" stroke-linecap="round"/>
                <path d="M32 35 L34 42 L30 42 Z" fill="#E8C4A0"/>
                <path d="M26 46 Q32 50 38 46" stroke="#8B4513" stroke-width="2" fill="none" stroke-linecap="round"/>
                <text x="8" y="58" font-size="8" fill="white" font-weight="bold" opacity="0.6">12</text>
            </svg>`,

            'Stephen Curry': `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <defs><linearGradient id="curry-bg" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#1d428a"/><stop offset="100%" style="stop-color:#ffc72c"/>
                </linearGradient></defs>
                <rect width="64" height="64" rx="12" fill="url(#curry-bg)"/>
                <ellipse cx="32" cy="34" rx="17" ry="19" fill="#C68642"/>
                <path d="M15 26 Q15 12 32 10 Q49 12 49 26" fill="#1A1A1A"/>
                <circle cx="18" cy="20" r="3" fill="#1A1A1A"/><circle cx="24" cy="16" r="3" fill="#1A1A1A"/>
                <circle cx="32" cy="14" r="3" fill="#1A1A1A"/><circle cx="40" cy="16" r="3" fill="#1A1A1A"/>
                <circle cx="46" cy="20" r="3" fill="#1A1A1A"/>
                <ellipse cx="24" cy="32" rx="4" ry="3" fill="white"/><ellipse cx="40" cy="32" rx="4" ry="3" fill="white"/>
                <circle cx="24" cy="32" r="2" fill="#3D2314"/><circle cx="40" cy="32" r="2" fill="#3D2314"/>
                <path d="M19 28 Q24 26 29 28" stroke="#1A1A1A" stroke-width="1.5" fill="none"/>
                <path d="M35 28 Q40 26 45 28" stroke="#1A1A1A" stroke-width="1.5" fill="none"/>
                <ellipse cx="32" cy="40" rx="3" ry="2" fill="#B07836"/>
                <path d="M18 42 Q18 54 32 56 Q46 54 46 42 Q46 48 32 50 Q18 48 18 42" fill="#1A1A1A"/>
                <path d="M24 46 Q32 52 40 46" stroke="white" stroke-width="2" fill="none" stroke-linecap="round"/>
                <text x="8" y="58" font-size="8" fill="white" font-weight="bold" opacity="0.6">30</text>
            </svg>`,

            'Kevin de Bruyne': `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <defs><linearGradient id="kdb-bg" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#6cabdd"/><stop offset="100%" style="stop-color:#1c2c5b"/>
                </linearGradient></defs>
                <rect width="64" height="64" rx="12" fill="url(#kdb-bg)"/>
                <ellipse cx="32" cy="35" rx="17" ry="18" fill="#F5D0B0"/>
                <path d="M14 28 Q14 12 32 10 Q50 12 50 28" fill="#D35400"/>
                <path d="M14 24 Q20 18 28 22" fill="#D35400"/><path d="M50 24 Q44 18 36 22" fill="#D35400"/>
                <path d="M18 20 L20 28" stroke="#D35400" stroke-width="3"/>
                <path d="M46 20 L44 28" stroke="#D35400" stroke-width="3"/>
                <ellipse cx="24" cy="33" rx="4" ry="3" fill="white"/><ellipse cx="40" cy="33" rx="4" ry="3" fill="white"/>
                <circle cx="24" cy="33" r="2" fill="#3498DB"/><circle cx="40" cy="33" r="2" fill="#3498DB"/>
                <path d="M19 29 L29 29" stroke="#E67E22" stroke-width="2" stroke-linecap="round"/>
                <path d="M45 29 L35 29" stroke="#E67E22" stroke-width="2" stroke-linecap="round"/>
                <path d="M32 36 L34 42 L30 42 Z" fill="#E8C4A0"/>
                <path d="M27 48 Q32 51 37 48" stroke="#8B4513" stroke-width="2" fill="none" stroke-linecap="round"/>
                <text x="8" y="58" font-size="8" fill="white" font-weight="bold" opacity="0.6">17</text>
            </svg>`,

            'Jose Mourinho': `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <defs><linearGradient id="mou-bg" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#034694"/><stop offset="100%" style="stop-color:#d1d3d4"/>
                </linearGradient></defs>
                <rect width="64" height="64" rx="12" fill="url(#mou-bg)"/>
                <ellipse cx="32" cy="35" rx="17" ry="18" fill="#E8C4A0"/>
                <path d="M14 28 Q14 14 32 12 Q50 14 50 28" fill="#A0A0A0"/>
                <ellipse cx="24" cy="32" rx="5" ry="4" fill="white"/><ellipse cx="40" cy="32" rx="5" ry="4" fill="white"/>
                <circle cx="24" cy="32" r="2.5" fill="#2C3E50"/><circle cx="40" cy="32" r="2.5" fill="#2C3E50"/>
                <circle cx="24" cy="31" r="1" fill="white"/><circle cx="40" cy="31" r="1" fill="white"/>
                <path d="M17 27 L28 30" stroke="#606060" stroke-width="2.5" stroke-linecap="round"/>
                <path d="M47 27 L36 30" stroke="#606060" stroke-width="2.5" stroke-linecap="round"/>
                <path d="M32 35 L35 43 L29 43 Z" fill="#D4B896"/>
                <path d="M26 48 L38 48" stroke="#8B4513" stroke-width="2" stroke-linecap="round"/>
                <rect x="22" y="49" width="20" height="6" rx="3" fill="#80808030"/>
                <text x="6" y="58" font-size="6" fill="white" font-weight="bold" opacity="0.5">TSO</text>
            </svg>`,

            'LeBron James': `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <defs><linearGradient id="lebron-bg" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#552583"/><stop offset="100%" style="stop-color:#fdb927"/>
                </linearGradient></defs>
                <rect width="64" height="64" rx="12" fill="url(#lebron-bg)"/>
                <ellipse cx="32" cy="36" rx="17" ry="18" fill="#8B5A2B"/>
                <path d="M15 28 Q15 16 32 14 Q49 16 49 28" fill="#1A1A1A"/>
                <rect x="12" y="20" width="40" height="6" rx="2" fill="#552583"/>
                <rect x="12" y="22" width="40" height="2" fill="#fdb927"/>
                <ellipse cx="24" cy="34" rx="4" ry="3" fill="white"/><ellipse cx="40" cy="34" rx="4" ry="3" fill="white"/>
                <circle cx="24" cy="34" r="2" fill="#3D2314"/><circle cx="40" cy="34" r="2" fill="#3D2314"/>
                <path d="M18 30 L28 30" stroke="#1A1A1A" stroke-width="2" stroke-linecap="round"/>
                <path d="M46 30 L36 30" stroke="#1A1A1A" stroke-width="2" stroke-linecap="round"/>
                <ellipse cx="32" cy="41" rx="3.5" ry="2.5" fill="#7A4B1E"/>
                <path d="M26 48 Q32 56 38 48 L38 50 Q32 58 26 50 Z" fill="#1A1A1A"/>
                <path d="M26 46 Q32 48 38 46" stroke="#1A1A1A" stroke-width="2" fill="none"/>
                <text x="8" y="58" font-size="8" fill="#fdb927" font-weight="bold" opacity="0.7">23</text>
            </svg>`,

            'Brad Stevens': `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <defs><linearGradient id="stevens-bg" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#007a33"/><stop offset="100%" style="stop-color:#ba9653"/>
                </linearGradient></defs>
                <rect width="64" height="64" rx="12" fill="url(#stevens-bg)"/>
                <ellipse cx="32" cy="35" rx="16" ry="18" fill="#F5D0B0"/>
                <path d="M16 28 Q16 14 32 12 Q48 14 48 28" fill="#5C4033"/>
                <rect x="17" y="29" width="12" height="10" rx="2" fill="none" stroke="#333" stroke-width="1.5"/>
                <rect x="35" y="29" width="12" height="10" rx="2" fill="none" stroke="#333" stroke-width="1.5"/>
                <path d="M29 34 L35 34" stroke="#333" stroke-width="1.5"/>
                <ellipse cx="23" cy="34" rx="3" ry="2.5" fill="white"/><ellipse cx="41" cy="34" rx="3" ry="2.5" fill="white"/>
                <circle cx="23" cy="34" r="1.5" fill="#4A6741"/><circle cx="41" cy="34" r="1.5" fill="#4A6741"/>
                <path d="M18 28 L28 28" stroke="#5C4033" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M46 28 L36 28" stroke="#5C4033" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M32 36 L33 42 L31 42 Z" fill="#E8C4A0"/>
                <path d="M27 48 Q32 51 37 48" stroke="#8B4513" stroke-width="1.5" fill="none" stroke-linecap="round"/>
                <text x="6" y="58" font-size="7" fill="white" font-weight="bold" opacity="0.5">BOS</text>
            </svg>`,

            'Brock Purdy': `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <defs><linearGradient id="purdy-bg" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#aa0000"/><stop offset="100%" style="stop-color:#b3995d"/>
                </linearGradient></defs>
                <rect width="64" height="64" rx="12" fill="url(#purdy-bg)"/>
                <ellipse cx="32" cy="35" rx="16" ry="18" fill="#F5D0B0"/>
                <path d="M16 26 Q16 12 32 10 Q48 12 48 26" fill="#4A3728"/>
                <path d="M18 20 Q22 16 28 18" fill="#4A3728"/><path d="M46 20 Q42 16 36 18" fill="#4A3728"/>
                <path d="M28 8 Q32 6 36 8" stroke="#b3995d" stroke-width="2"/>
                <ellipse cx="24" cy="33" rx="4" ry="3" fill="white"/><ellipse cx="40" cy="33" rx="4" ry="3" fill="white"/>
                <circle cx="24" cy="33" r="2" fill="#4A6741"/><circle cx="40" cy="33" r="2" fill="#4A6741"/>
                <path d="M19 29 L28 29" stroke="#4A3728" stroke-width="2" stroke-linecap="round"/>
                <path d="M45 29 L36 29" stroke="#4A3728" stroke-width="2" stroke-linecap="round"/>
                <path d="M32 36 L33 41 L31 41 Z" fill="#E8C4A0"/>
                <path d="M26 46 Q32 50 38 46" stroke="#8B4513" stroke-width="2" fill="none" stroke-linecap="round"/>
                <text x="8" y="58" font-size="8" fill="white" font-weight="bold" opacity="0.6">13</text>
            </svg>`,

            'Andy Flower': `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <defs><linearGradient id="flower-bg" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#005c2f"/><stop offset="100%" style="stop-color:#fce300"/>
                </linearGradient></defs>
                <rect width="64" height="64" rx="12" fill="url(#flower-bg)"/>
                <ellipse cx="32" cy="38" rx="16" ry="17" fill="#F5D0B0"/>
                <ellipse cx="32" cy="22" rx="20" ry="8" fill="#005c2f"/>
                <path d="M12 22 Q12 14 32 12 Q52 14 52 22" fill="#005c2f"/>
                <rect x="12" y="18" width="40" height="6" fill="#005c2f"/>
                <ellipse cx="32" cy="24" rx="22" ry="4" fill="#004020"/>
                <circle cx="32" cy="16" r="3" fill="#fce300"/>
                <ellipse cx="24" cy="36" rx="4" ry="3" fill="white"/><ellipse cx="40" cy="36" rx="4" ry="3" fill="white"/>
                <circle cx="24" cy="36" r="2" fill="#4A3728"/><circle cx="40" cy="36" r="2" fill="#4A3728"/>
                <path d="M19 32 L28 32" stroke="#5C4033" stroke-width="2" stroke-linecap="round"/>
                <path d="M45 32 L36 32" stroke="#5C4033" stroke-width="2" stroke-linecap="round"/>
                <path d="M32 38 L33 44 L31 44 Z" fill="#E8C4A0"/>
                <path d="M27 50 Q32 53 37 50" stroke="#8B4513" stroke-width="1.5" fill="none" stroke-linecap="round"/>
                <text x="4" y="58" font-size="6" fill="white" font-weight="bold" opacity="0.5">ZIM</text>
            </svg>`,

            "N'Golo Kant√©": `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <defs><linearGradient id="kante-bg" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#034694"/><stop offset="100%" style="stop-color:#d1d3d4"/>
                </linearGradient></defs>
                <rect width="64" height="64" rx="12" fill="url(#kante-bg)"/>
                <ellipse cx="32" cy="35" rx="16" ry="18" fill="#8B5A2B"/>
                <path d="M16 28 Q16 14 32 12 Q48 14 48 28" fill="#1A1A1A"/>
                <circle cx="20" cy="22" r="2" fill="#1A1A1A"/><circle cx="26" cy="18" r="2" fill="#1A1A1A"/>
                <circle cx="32" cy="16" r="2" fill="#1A1A1A"/><circle cx="38" cy="18" r="2" fill="#1A1A1A"/>
                <circle cx="44" cy="22" r="2" fill="#1A1A1A"/>
                <ellipse cx="24" cy="33" rx="5" ry="4" fill="white"/><ellipse cx="40" cy="33" rx="5" ry="4" fill="white"/>
                <circle cx="24" cy="33" r="2.5" fill="#3D2314"/><circle cx="40" cy="33" r="2.5" fill="#3D2314"/>
                <circle cx="23" cy="32" r="1" fill="white"/><circle cx="39" cy="32" r="1" fill="white"/>
                <path d="M18 29 Q23 27 28 29" stroke="#1A1A1A" stroke-width="1.5" fill="none"/>
                <path d="M36 29 Q41 27 46 29" stroke="#1A1A1A" stroke-width="1.5" fill="none"/>
                <ellipse cx="32" cy="40" rx="3" ry="2" fill="#7A4B1E"/>
                <path d="M22 46 Q32 56 42 46" stroke="#1A1A1A" stroke-width="2" fill="none"/>
                <path d="M24 48 Q32 54 40 48" fill="white"/>
                <ellipse cx="18" cy="40" rx="3" ry="2" fill="#C0785050"/><ellipse cx="46" cy="40" rx="3" ry="2" fill="#C0785050"/>
                <text x="8" y="58" font-size="8" fill="white" font-weight="bold" opacity="0.6">7</text>
            </svg>`,

            'Florentino Perez': `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <defs><linearGradient id="flo-bg" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#ffffff"/><stop offset="100%" style="stop-color:#febe10"/>
                </linearGradient></defs>
                <rect width="64" height="64" rx="12" fill="url(#flo-bg)"/>
                <path d="M8 64 L14 48 L32 52 L50 48 L56 64" fill="#1a1a1a"/>
                <path d="M24 52 L32 56 L40 52 L38 48 L32 50 L26 48 Z" fill="white"/>
                <path d="M30 50 L32 58 L34 50 Z" fill="#034694"/>
                <ellipse cx="32" cy="34" rx="15" ry="17" fill="#F5D0B0"/>
                <path d="M20 24 Q20 16 32 14 Q44 16 44 24" fill="#A0A0A0"/>
                <ellipse cx="25" cy="32" rx="4" ry="3" fill="white"/><ellipse cx="39" cy="32" rx="4" ry="3" fill="white"/>
                <circle cx="25" cy="32" r="2" fill="#2C3E50"/><circle cx="39" cy="32" r="2" fill="#2C3E50"/>
                <path d="M20 28 L30 28" stroke="#808080" stroke-width="2" stroke-linecap="round"/>
                <path d="M44 28 L34 28" stroke="#808080" stroke-width="2" stroke-linecap="round"/>
                <path d="M32 34 L34 40 L30 40 Z" fill="#E8C4A0"/>
                <path d="M27 44 Q32 47 37 44" stroke="#8B4513" stroke-width="1.5" fill="none" stroke-linecap="round"/>
                <text x="4" y="12" font-size="8" fill="#034694" font-weight="bold" opacity="0.7">RM</text>
            </svg>`,

            'Pep Guardiola': `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <defs><linearGradient id="pep-bg" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#6cabdd"/><stop offset="100%" style="stop-color:#1c2c5b"/>
                </linearGradient></defs>
                <rect width="64" height="64" rx="12" fill="url(#pep-bg)"/>
                <path d="M10 64 L16 48 L32 50 L48 48 L54 64" fill="#1a1a1a"/>
                <rect x="22" y="46" width="20" height="8" rx="2" fill="#1a1a1a"/>
                <rect x="24" y="44" width="16" height="6" rx="2" fill="#333"/>
                <ellipse cx="32" cy="32" rx="16" ry="17" fill="#E8C4A0"/>
                <ellipse cx="32" cy="24" rx="16" ry="12" fill="#E0B890"/>
                <ellipse cx="28" cy="18" rx="6" ry="4" fill="#F0C8A040"/>
                <ellipse cx="25" cy="32" rx="4" ry="3" fill="white"/><ellipse cx="39" cy="32" rx="4" ry="3" fill="white"/>
                <circle cx="25" cy="32" r="2" fill="#2C3E50"/><circle cx="39" cy="32" r="2" fill="#2C3E50"/>
                <path d="M20 28 L30 29" stroke="#5C4033" stroke-width="2" stroke-linecap="round"/>
                <path d="M44 28 L34 29" stroke="#5C4033" stroke-width="2" stroke-linecap="round"/>
                <path d="M32 33 L34 39 L30 39 Z" fill="#D4B896"/>
                <ellipse cx="32" cy="44" rx="10" ry="4" fill="#5C403320"/>
                <path d="M27 44 L37 44" stroke="#8B4513" stroke-width="2" stroke-linecap="round"/>
                <ellipse cx="14" cy="32" rx="3" ry="5" fill="#E0B890"/><ellipse cx="50" cy="32" rx="3" ry="5" fill="#E0B890"/>
                <text x="6" y="58" font-size="6" fill="white" font-weight="bold" opacity="0.5">MCFC</text>
            </svg>`,

            'Ime Udoka': `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <defs><linearGradient id="udoka-bg" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#ce1141"/><stop offset="100%" style="stop-color:#c4ced4"/>
                </linearGradient></defs>
                <rect width="64" height="64" rx="12" fill="url(#udoka-bg)"/>
                <ellipse cx="32" cy="35" rx="16" ry="18" fill="#8B5A2B"/>
                <path d="M16 28 Q16 14 32 12 Q48 14 48 28" fill="#1A1A1A"/>
                <ellipse cx="24" cy="33" rx="4" ry="3" fill="white"/><ellipse cx="40" cy="33" rx="4" ry="3" fill="white"/>
                <circle cx="24" cy="33" r="2" fill="#3D2314"/><circle cx="40" cy="33" r="2" fill="#3D2314"/>
                <path d="M18 29 L28 29" stroke="#1A1A1A" stroke-width="2" stroke-linecap="round"/>
                <path d="M46 29 L36 29" stroke="#1A1A1A" stroke-width="2" stroke-linecap="round"/>
                <ellipse cx="32" cy="40" rx="3" ry="2" fill="#7A4B1E"/>
                <rect x="22" y="46" width="20" height="8" rx="3" fill="#1A1A1A"/>
                <path d="M26 48 Q32 50 38 48" stroke="white" stroke-width="1" fill="none"/>
                <text x="6" y="58" font-size="6" fill="white" font-weight="bold" opacity="0.5">HOU</text>
            </svg>`,

            'Unassigned': `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
                <defs><linearGradient id="unassigned-bg" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#3a3a3c"/><stop offset="100%" style="stop-color:#1c1c1e"/>
                </linearGradient></defs>
                <rect width="64" height="64" rx="12" fill="url(#unassigned-bg)"/>
                <circle cx="32" cy="24" r="12" fill="#636366"/>
                <ellipse cx="32" cy="54" rx="16" ry="14" fill="#636366"/>
                <text x="32" y="38" font-size="16" fill="white" text-anchor="middle" font-weight="bold">?</text>
            </svg>`
        };

        function getAgentAvatar(agentName) {
            return AgentAvatars[agentName] || AgentAvatars['Unassigned'];
        }

        function svgToDataUri(svg) {
            return `data:image/svg+xml,${encodeURIComponent(svg).replace(/'/g, '%27').replace(/"/g, '%22')}`;
        }

        function getAgentAvatarImg(agentName, className = '') {
            const svg = getAgentAvatar(agentName);
            const dataUri = svgToDataUri(svg);
            return `<img src="${dataUri}" alt="${agentName || 'Unassigned'}" class="${className}" />`;
        }

        // ==================== SPORTS BACKGROUND ====================
        const sportsQuotes = [
            '"Excellence is not a singular act, but a habit." ‚Äî Shaquille O\'Neal',
            '"Hard work beats talent when talent doesn\'t work hard." ‚Äî Tim Notke',
            '"Champions keep playing until they get it right." ‚Äî Billie Jean King',
            '"The only way to prove you are a good sport is to lose." ‚Äî Ernie Banks',
            '"You miss 100% of the shots you don\'t take." ‚Äî Wayne Gretzky',
            '"Pressure is a privilege." ‚Äî Billie Jean King',
            '"The more difficult the victory, the greater the happiness." ‚Äî Pel√©',
            '"It ain\'t over till it\'s over." ‚Äî Yogi Berra',
            '"Talent wins games, teamwork wins championships." ‚Äî Michael Jordan'
        ];

        const sportsTeams = ['PATRIOTS', 'WARRIORS', 'LAKERS', 'CELTICS', '49ERS', 'MAN CITY', 'CHELSEA', 'REAL MADRID'];
        const sportsIcons = ['üèà', 'üèÄ', '‚öΩ', 'üèè', 'üéæ', 'üèÜ', 'ü•á', 'üí™'];
        const playerNames = ['BRADY', 'CURRY', 'LEBRON', 'DE BRUYNE', 'MOURINHO', 'PEP', 'PURDY', 'FLOWER'];

        function initSportsBg() {
            const bg = document.getElementById('sportsBg');
            let html = '';

            // Floating player names
            playerNames.forEach((name, i) => {
                const top = 10 + (i * 12) % 85;
                const left = 5 + (i * 17) % 90;
                const rotate = -15 + (i * 7) % 30;
                html += `<div class="sports-text names" style="top: ${top}%; left: ${left}%; transform: rotate(${rotate}deg);">${name}</div>`;
            });

            // Floating team names
            sportsTeams.forEach((team, i) => {
                const top = 15 + (i * 14) % 80;
                const right = 2 + (i * 13) % 85;
                const rotate = -10 + (i * 5) % 20;
                html += `<div class="sports-text teams" style="top: ${top}%; right: ${right}%; transform: rotate(${rotate}deg);">${team}</div>`;
            });

            // Floating quotes
            sportsQuotes.slice(0, 4).forEach((quote, i) => {
                const positions = [
                    { top: '20%', left: '60%' },
                    { top: '45%', left: '5%' },
                    { top: '70%', right: '10%' },
                    { top: '85%', left: '30%' }
                ];
                const pos = positions[i];
                html += `<div class="sports-text quotes" style="${Object.entries(pos).map(([k,v]) => `${k}: ${v}`).join('; ')}">${quote}</div>`;
            });

            // Sports icons
            sportsIcons.forEach((icon, i) => {
                const top = 8 + (i * 15) % 85;
                const left = 10 + (i * 20) % 85;
                html += `<div class="sports-icon" style="top: ${top}%; left: ${left}%;">${icon}</div>`;
            });

            bg.innerHTML = html;
        }

        // ==================== THEME TOGGLE ====================
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            document.getElementById('themeToggle').textContent = newTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
            localStorage.setItem('theme', newTheme);
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            document.getElementById('themeToggle').textContent = savedTheme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
        }

        // ==================== AGENTS DATA ====================
        const agents = {
            'Tom Brady': { role: 'Delivery Owner', team: 'New England Patriots' },
            'Stephen Curry': { role: 'Executor', team: 'Golden State Warriors' },
            'Kevin de Bruyne': { role: 'Visualization Lead', team: 'Manchester City' },
            'Jose Mourinho': { role: 'Data Science Lead', team: 'AS Roma' },
            'LeBron James': { role: 'Social & Engagement', team: 'Los Angeles Lakers' },
            'Brad Stevens': { role: 'Architecture', team: 'Boston Celtics' },
            'Brock Purdy': { role: 'Data Pipeline', team: 'San Francisco 49ers' },
            'Andy Flower': { role: 'Cricket Domain Expert', team: 'Zimbabwe Cricket' },
            "N'Golo Kant√©": { role: 'QA Lead', team: 'Al-Ittihad' },
            'Florentino Perez': { role: 'Founder', team: 'Real Madrid' },
            'Pep Guardiola': { role: 'Tactical Analysis', team: 'Manchester City' },
            'Ime Udoka': { role: 'DevOps Lead', team: 'Houston Rockets' }
        };

        const columns = [
            { id: 'IDEA', name: 'Idea', dot: 'dot-idea' },
            { id: 'BACKLOG', name: 'Backlog', dot: 'dot-backlog' },
            { id: 'READY', name: 'Ready', dot: 'dot-ready' },
            { id: 'RUNNING', name: 'Running', dot: 'dot-running' },
            { id: 'BLOCKED', name: 'Blocked', dot: 'dot-blocked' },
            { id: 'REVIEW', name: 'Review', dot: 'dot-review' },
            { id: 'VALIDATION', name: 'Validation', dot: 'dot-validation' },
            { id: 'DONE', name: 'Done', dot: 'dot-done' }
        ];

        const gates = [
            { id: 'florentino_gate', name: 'Florentino Gate', step: 1, approver: 'Florentino Perez' },
            { id: 'domain_sanity', name: 'Domain Sanity', step: 3, approver: 'Jose / Andy / Pep' },
            { id: 'enforcement_check', name: 'Enforcement', step: 4, approver: 'Brad Stevens' },
            { id: 'system_check', name: 'System Check', step: 5, approver: "N'Golo Kant√©" },
            { id: 'founder_validation', name: 'Founder Sign-off', step: 6, approver: 'Florentino Perez' }
        ];

        // Sample ticket data
        const tickets = [
            {
                id: 'TKT-001', title: 'Implement Mission Control Phase 2 - Workflow Engine',
                state: 'DONE', priority: 'P0', assignee: 'Stephen Curry', epic: 'EPIC-001', progress: 100,
                prd: 'governance/MISSION_CONTROL_DESIGN_020426_v1.md', output: 'scripts/mission_control/',
                gates: { florentino_gate: 'APPROVED', domain_sanity: 'YES', system_check: 'PASS', founder_validation: 'APPROVED' },
                tags: ['Backend', 'Core'], daysSpent: 3, iterations: 2
            },
            {
                id: 'TKT-002', title: 'HTML Dashboard with Apple Design Language',
                state: 'RUNNING', priority: 'P0', assignee: 'Kevin de Bruyne', epic: 'EPIC-001', progress: 85,
                prd: 'governance/MISSION_CONTROL_DESIGN_020426_v1.md', output: 'scripts/mission_control/dashboard/',
                gates: { florentino_gate: 'APPROVED', domain_sanity: 'YES' },
                tags: ['Frontend', 'UI/UX'], daysSpent: 2, iterations: 4
            },
            {
                id: 'TKT-003', title: 'Agent Caricature Avatar System',
                state: 'DONE', priority: 'P1', assignee: 'LeBron James', epic: 'EPIC-001', progress: 100,
                prd: null, output: 'scripts/mission_control/dashboard/avatars.js',
                gates: { florentino_gate: 'APPROVED', domain_sanity: 'YES', system_check: 'PASS', founder_validation: 'APPROVED' },
                tags: ['Design', 'Assets'], daysSpent: 1, iterations: 2
            },
            {
                id: 'TKT-004', title: 'Predicted XII Algorithm v3.1 Refinement',
                state: 'REVIEW', priority: 'P1', assignee: 'Jose Mourinho', epic: 'EPIC-002', progress: 90,
                prd: 'docs/specs/ALGORITHM_SPEC.md', output: 'outputs/predicted_xis/',
                gates: { florentino_gate: 'APPROVED', domain_sanity: 'YES', enforcement_check: 'PASS' },
                tags: ['Algorithm', 'Data'], daysSpent: 5, iterations: 4
            },
            {
                id: 'TKT-005', title: 'Depth Chart Export to PDF/PNG',
                state: 'BACKLOG', priority: 'P2', assignee: 'Brock Purdy', epic: 'EPIC-002', progress: 0,
                prd: 'docs/specs/WIREFRAMES_V1.md', output: null,
                gates: { florentino_gate: 'APPROVED' },
                tags: ['Export', 'Sharing'], daysSpent: 0, iterations: 0
            },
            {
                id: 'TKT-006', title: 'Player ID Mismatch - MI vs LSG Trade',
                state: 'BLOCKED', priority: 'P0', assignee: 'Stephen Curry', epic: 'EPIC-003', progress: 30,
                prd: null, output: null,
                gates: { florentino_gate: 'APPROVED' },
                tags: ['Bug', 'Data'], daysSpent: 2, iterations: 1
            },
            {
                id: 'TKT-007', title: 'Sprint Velocity Dashboard Widget',
                state: 'VALIDATION', priority: 'P1', assignee: 'Tom Brady', epic: 'EPIC-001', progress: 95,
                prd: 'governance/MISSION_CONTROL_DESIGN_020426_v1.md', output: 'scripts/mission_control/views/',
                gates: { florentino_gate: 'APPROVED', domain_sanity: 'YES', system_check: 'PASS' },
                tags: ['Analytics', 'Dashboard'], daysSpent: 2, iterations: 2
            },
            {
                id: 'TKT-008', title: 'Role Permission Matrix Implementation',
                state: 'READY', priority: 'P2', assignee: 'Brad Stevens', epic: 'EPIC-001', progress: 0,
                prd: 'governance/MISSION_CONTROL_DESIGN_020426_v1.md', output: null,
                gates: { florentino_gate: 'APPROVED' },
                tags: ['Security', 'Backend'], daysSpent: 0, iterations: 0
            },
            {
                id: 'TKT-009', title: 'New IPL 2026 Season Data Pipeline',
                state: 'IDEA', priority: 'P1', assignee: null, epic: null, progress: 0,
                prd: null, output: null, gates: {},
                tags: ['Data', 'Pipeline'], daysSpent: 0, iterations: 0
            }
        ];

        let activeFilter = 'all';
        let activeAgentFilter = null;

        function getAgentInfo(name) {
            return agents[name] || { role: 'Unassigned', team: '' };
        }

        function getGateStatus(ticketGates, gateId) {
            if (!ticketGates || !ticketGates[gateId]) return 'waiting';
            const val = ticketGates[gateId];
            if (val === 'APPROVED' || val === 'PASS' || val === 'YES') return 'passed';
            return 'pending';
        }

        function showView(view) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.mobile-nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(view + 'View').classList.add('active');
            // Update desktop nav
            const desktopTab = document.querySelector(`.nav-tabs [onclick="showView('${view}')"]`);
            if (desktopTab) desktopTab.classList.add('active');
            // Update mobile nav
            const mobileTab = document.querySelector(`.mobile-nav [onclick="showView('${view}')"]`);
            if (mobileTab) mobileTab.classList.add('active');
        }

        function initBoard() {
            const kanban = document.getElementById('kanban');
            kanban.innerHTML = columns.map(col => `
                <div class="column">
                    <div class="column-header">
                        <span class="column-name">
                            <span class="column-dot ${col.dot}"></span>
                            ${col.name}
                        </span>
                        <span class="column-count" id="count-${col.id}">0</span>
                    </div>
                    <div class="column-body" id="col-${col.id}"></div>
                </div>
            `).join('');

            // Agent dropdown
            const dropdown = document.getElementById('agentDropdown');
            const agentCounts = {};
            tickets.forEach(t => {
                if (t.assignee) agentCounts[t.assignee] = (agentCounts[t.assignee] || 0) + 1;
            });

            dropdown.innerHTML = `
                <div class="agent-option ${!activeAgentFilter ? 'selected' : ''}" onclick="filterByAgent(null)">
                    <div class="agent-option-avatar" style="background: var(--bg-tertiary);">üë•</div>
                    <span class="agent-option-name">All Agents</span>
                    <span class="agent-option-count">${tickets.length}</span>
                </div>
                ${Object.keys(agents).filter(a => agentCounts[a]).map(name => `
                    <div class="agent-option ${activeAgentFilter === name ? 'selected' : ''}" onclick="filterByAgent('${name}')">
                        <div class="agent-option-avatar">${getAgentAvatarImg(name)}</div>
                        <span class="agent-option-name">${name.split(' ')[0]}</span>
                        <span class="agent-option-count">${agentCounts[name] || 0}</span>
                    </div>
                `).join('')}
            `;
        }

        function toggleAgentDropdown() {
            document.getElementById('agentDropdown').classList.toggle('active');
        }

        function filterByAgent(agentName) {
            activeAgentFilter = agentName;
            document.getElementById('agentFilterLabel').textContent = agentName ? agentName.split(' ')[0] : 'All Agents';
            document.getElementById('agentDropdown').classList.remove('active');
            renderBoard();
        }

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.agent-filter')) {
                document.getElementById('agentDropdown').classList.remove('active');
            }
        });

        function renderBoard() {
            columns.forEach(col => {
                const container = document.getElementById(`col-${col.id}`);
                const colTickets = tickets.filter(t => t.state === col.id);
                document.getElementById(`count-${col.id}`).textContent = colTickets.length;

                if (colTickets.length === 0) {
                    container.innerHTML = '<div class="empty-state">No tickets</div>';
                } else {
                    container.innerHTML = colTickets.map(t => {
                        const isFiltered = activeAgentFilter && t.assignee !== activeAgentFilter;
                        return renderTicket(t, isFiltered);
                    }).join('');
                }
            });
            updateStats();
        }

        function renderTicket(t, isFiltered = false) {
            const passedGates = gates.filter(g => getGateStatus(t.gates, g.id) === 'passed').length;

            return `
                <div class="ticket ${isFiltered ? 'filtered-out' : ''}" onclick="openModal('${t.id}')">
                    <div class="ticket-top">
                        <div class="agent-avatar" title="${t.assignee || 'Unassigned'}">${getAgentAvatarImg(t.assignee)}</div>
                        <div class="ticket-info">
                            <div class="ticket-id">${t.id}</div>
                            <div class="ticket-title">${t.title}</div>
                            <div class="ticket-agent">${t.assignee || 'Unassigned'}</div>
                        </div>
                    </div>
                    <div class="ticket-meta">
                        <span class="priority priority-${t.priority.toLowerCase()}">${t.priority}</span>
                        ${t.tags.slice(0, 2).map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    ${t.prd || t.output ? `
                        <div class="ticket-links">
                            ${t.prd ? '<span class="link-btn">üìÑ PRD</span>' : ''}
                            ${t.output ? '<span class="link-btn">üìÅ Output</span>' : ''}
                        </div>
                    ` : ''}
                    <div class="gate-progress">
                        ${gates.map((g, i) => `<div class="gate-step ${i < passedGates ? 'passed' : i === passedGates ? 'current' : ''}"></div>`).join('')}
                    </div>
                </div>
            `;
        }

        function renderRoster() {
            const grid = document.getElementById('rosterGrid');
            const agentStats = {};

            Object.keys(agents).forEach(name => {
                const agentTickets = tickets.filter(t => t.assignee === name);
                const done = agentTickets.filter(t => t.state === 'DONE');

                agentStats[name] = {
                    total: agentTickets.length,
                    done: done.length,
                    running: agentTickets.filter(t => t.state === 'RUNNING').length,
                    blocked: agentTickets.filter(t => t.state === 'BLOCKED').length,
                    avgDays: agentTickets.length ? (agentTickets.reduce((sum, t) => sum + t.daysSpent, 0) / agentTickets.length).toFixed(1) : 0,
                    totalIterations: agentTickets.reduce((sum, t) => sum + t.iterations, 0),
                    p0: agentTickets.filter(t => t.priority === 'P0').length,
                    p1: agentTickets.filter(t => t.priority === 'P1').length,
                    p2: agentTickets.filter(t => t.priority === 'P2').length,
                    p3: agentTickets.filter(t => t.priority === 'P3').length,
                    tickets: agentTickets.slice(0, 3)
                };
            });

            grid.innerHTML = Object.entries(agents)
                .filter(([name]) => agentStats[name].total > 0)
                .sort((a, b) => agentStats[b[0]].total - agentStats[a[0]].total)
                .map(([name, info]) => {
                    const stats = agentStats[name];
                    const completionRate = stats.total ? Math.round((stats.done / stats.total) * 100) : 0;

                    return `
                        <div class="agent-card" onclick="filterByAgent('${name}'); showView('board');">
                            <div class="agent-card-header">
                                <div class="agent-card-avatar">${getAgentAvatarImg(name)}</div>
                                <div class="agent-card-info">
                                    <h3>${name}</h3>
                                    <div class="agent-card-role">${info.role}</div>
                                    <div class="agent-card-team">${info.team}</div>
                                </div>
                            </div>

                            <div class="agent-stats">
                                <div class="agent-stat">
                                    <div class="agent-stat-value">${stats.total}</div>
                                    <div class="agent-stat-label">Tickets</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value" style="color: var(--accent-green)">${stats.done}</div>
                                    <div class="agent-stat-label">Done</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">${stats.avgDays}d</div>
                                    <div class="agent-stat-label">Avg Time</div>
                                </div>
                                <div class="agent-stat">
                                    <div class="agent-stat-value">${stats.totalIterations}</div>
                                    <div class="agent-stat-label">Iterations</div>
                                </div>
                            </div>

                            <div class="agent-priority-breakdown">
                                <div class="priority-chip p0">P0: ${stats.p0}</div>
                                <div class="priority-chip p1">P1: ${stats.p1}</div>
                                <div class="priority-chip p2">P2: ${stats.p2}</div>
                            </div>

                            <div class="agent-progress">
                                <div class="agent-progress-label">
                                    <span>Completion Rate</span>
                                    <span style="color: var(--accent-green)">${completionRate}%</span>
                                </div>
                                <div class="agent-progress-bar">
                                    <div class="agent-progress-fill" style="width: ${completionRate}%"></div>
                                </div>
                            </div>

                            ${stats.tickets.length ? `
                                <div class="agent-recent">
                                    <div class="agent-recent-title">Recent Tickets</div>
                                    ${stats.tickets.map(t => `
                                        <div class="agent-recent-item">
                                            <div class="recent-status ${t.state.toLowerCase()}"></div>
                                            <div class="recent-title">${t.title}</div>
                                            <div class="recent-time">${t.daysSpent}d</div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                        </div>
                    `;
                }).join('');
        }

        function updateStats() {
            document.getElementById('statTotal').textContent = tickets.length;
            document.getElementById('statRunning').textContent = tickets.filter(t => t.state === 'RUNNING').length;
            document.getElementById('statBlocked').textContent = tickets.filter(t => t.state === 'BLOCKED').length;
            document.getElementById('statDone').textContent = tickets.filter(t => t.state === 'DONE').length;
        }

        function openModal(ticketId) {
            const t = tickets.find(x => x.id === ticketId);
            if (!t) return;

            document.getElementById('modalAvatar').innerHTML = getAgentAvatarImg(t.assignee);
            document.getElementById('modalTitle').textContent = t.title;
            document.getElementById('modalSubtitle').textContent = `${t.id} ¬∑ ${t.priority} ¬∑ ${t.assignee || 'Unassigned'}`;

            document.getElementById('modalGates').innerHTML = gates.map(g => {
                const status = getGateStatus(t.gates, g.id);
                const icon = status === 'passed' ? '‚úì' : status === 'pending' ? '‚óê' : '‚óã';
                return `
                    <div class="gate-item">
                        <div class="gate-icon ${status}">${icon}</div>
                        <div class="gate-info">
                            <div class="gate-name">Step ${g.step}: ${g.name}</div>
                            <div class="gate-approver">${g.approver}</div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('modalDetails').innerHTML = `
                <div class="detail-item">
                    <div class="detail-label">Epic</div>
                    <div class="detail-value">${t.epic || '‚Äî'}</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Progress</div>
                    <div class="detail-value">${t.progress}%</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Days Spent</div>
                    <div class="detail-value">${t.daysSpent} days</div>
                </div>
                <div class="detail-item">
                    <div class="detail-label">Iterations</div>
                    <div class="detail-value">${t.iterations}</div>
                </div>
            `;

            document.getElementById('modalLinks').innerHTML = `
                ${t.prd ? `<a href="#" class="modal-link"><span class="modal-link-icon">üìÑ</span><span class="modal-link-text">PRD Document</span><span class="modal-link-arrow">‚Üí</span></a>` : ''}
                ${t.output ? `<a href="#" class="modal-link"><span class="modal-link-icon">üìÅ</span><span class="modal-link-text">Output Directory</span><span class="modal-link-arrow">‚Üí</span></a>` : ''}
                ${!t.prd && !t.output ? '<div class="empty-state">No links available</div>' : ''}
            `;

            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        document.getElementById('modal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        function updateTime() {
            document.getElementById('navTime').textContent = new Date().toLocaleTimeString('en-US', { hour12: false });
        }

        function renderList() {
            // Desktop Table
            const tbody = document.getElementById('ticketTableBody');
            tbody.innerHTML = tickets.map(t => `
                <tr onclick="openModal('${t.id}')">
                    <td><span class="table-id">${t.id}</span></td>
                    <td><span class="table-title" title="${t.title}">${t.title}</span></td>
                    <td>
                        <div class="table-agent-cell">
                            <div class="table-avatar">${getAgentAvatarImg(t.assignee)}</div>
                            <span class="table-agent-name">${t.assignee || 'Unassigned'}</span>
                        </div>
                    </td>
                    <td><span class="table-state state-${t.state.toLowerCase()}">${t.state}</span></td>
                    <td><span class="table-sprint">${t.epic || '‚Äî'}</span></td>
                    <td><span class="table-priority priority-${t.priority.toLowerCase()}">${t.priority}</span></td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="flex: 1; height: 6px; background: var(--bg-tertiary); border-radius: 3px; overflow: hidden;">
                                <div style="height: 100%; width: ${t.progress}%; background: var(--accent-green); border-radius: 3px;"></div>
                            </div>
                            <span style="font-size: 12px; color: var(--text-secondary); min-width: 32px;">${t.progress}%</span>
                        </div>
                    </td>
                </tr>
            `).join('');

            // Mobile Cards
            const mobileCards = document.getElementById('mobileCards');
            mobileCards.innerHTML = tickets.map(t => `
                <div class="mobile-card" onclick="openModal('${t.id}')">
                    <div class="mobile-card-header">
                        <div class="mobile-card-avatar">${getAgentAvatarImg(t.assignee)}</div>
                        <div class="mobile-card-main">
                            <div class="mobile-card-id">${t.id}</div>
                            <div class="mobile-card-title">${t.title}</div>
                        </div>
                    </div>
                    <div class="mobile-card-meta">
                        <span class="table-state state-${t.state.toLowerCase()}">${t.state}</span>
                        <span class="table-priority priority-${t.priority.toLowerCase()}">${t.priority}</span>
                    </div>
                    <div class="mobile-card-row">
                        <span class="mobile-card-label">Agent</span>
                        <span class="mobile-card-value">${t.assignee || 'Unassigned'}</span>
                    </div>
                    <div class="mobile-card-row">
                        <span class="mobile-card-label">Sprint / Epic</span>
                        <span class="mobile-card-value">${t.epic || '‚Äî'}</span>
                    </div>
                    <div class="mobile-card-row">
                        <span class="mobile-card-label">Progress</span>
                        <span class="mobile-card-value" style="color: var(--accent-green)">${t.progress}%</span>
                    </div>
                </div>
            `).join('');
        }

        function loadData() {
            renderBoard();
            renderList();
            renderRoster();
            updateTime();
        }

        // Filter buttons
        document.querySelectorAll('.filter-btn[data-filter]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn[data-filter]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                activeFilter = btn.dataset.filter;
                renderBoard();
            });
        });

        // Init
        initTheme();
        initSportsBg();
        initBoard();
        loadData();
        setInterval(updateTime, 1000);
    </script>
</body>
</html>
