# Data

Source data, database, and reference files.

**Version:** 4.1.0 | **Last Updated:** 2026-02-05

---

## Data Flow

```
raw/                     Source Cricsheet ZIP files
  |
  v
scripts/core/ingest.py   Parse JSON, transform, load
  |
  v
cricket_playbook.duckdb  Central DuckDB database (159MB)
  |
  v
scripts/core/analytics_ipl.py  Create analytics views
  |
  +---> processed/       Schema docs, QA certificates
  |
  +---> manifests/manifest.json  Track ingestion metadata
```

**Key Principle:** Raw data is immutable. All transformations flow through `ingest.py` into DuckDB. Never modify raw files or the database directly.

---

## Directory Structure

```
data/
├── README.md                       # This file (you are here)
├── cricket_playbook.duckdb         # Main DuckDB database (159MB)
│
├── ipl_2026_squads.csv             # IPL 2026 team rosters
├── ipl_2026_player_contracts.csv   # Player contract prices
├── bowler_classifications_v2.csv   # Bowling style mappings (current)
├── bowler_classifications_v3.csv   # Bowling style mappings (latest)
│
├── raw/                            # Source Cricsheet ZIP files
│   └── (18 T20 datasets)
│
├── processed/                      # Intermediate processed data
│   ├── schema.md
│   └── QA_CERTIFICATE_1.0.0.md
│
├── manifests/                      # Data manifest files
│   └── manifest.json
│
└── archive/                        # Deprecated files
    ├── README.md
    └── bowler_classifications_v1.csv
```

---

## Folder Usage Guide

### data/raw/ - Source Data (Immutable)

**What goes here:**
- Cricsheet ZIP files downloaded from cricsheet.org
- Original, unmodified source data only
- New T20 league datasets (BBL, CPL, PSL, etc.)

**What does NOT go here:**
- Modified or cleaned versions of source files
- CSV exports or intermediate files
- Anything generated by our scripts

**Rules:**
- NEVER modify files in this folder
- NEVER delete files without archiving first
- Download new datasets here before running ingest

**Current contents:** 18 T20 league ZIP files (IPL, BBL, CPL, PSL, T20I, etc.)

---

### data/processed/ - Pipeline Outputs

**What goes here:**
- Schema documentation generated by ingest scripts
- QA certificates documenting validation results
- Structure review reports
- Any intermediate artifacts from data processing

**What does NOT go here:**
- Source data (belongs in raw/)
- Final outputs like stat packs (belong in outputs/)
- Manual documentation (belongs in docs/)

**When to update:**
- After running `ingest.py` - schema.md is regenerated
- After QA validation passes - new QA certificate added
- After major schema changes

**Current contents:**
- `schema.md` - Database schema documentation
- `QA_CERTIFICATE_1.0.0.md` - Data quality validation results
- `STRUCTURE_REVIEW_1.0.0.md` - Structure validation report

---

### data/manifests/ - Ingestion Tracking

**What goes here:**
- `manifest.json` - Tracks every ingestion run
- Future: Additional manifest files for incremental updates

**What the manifest tracks:**
- Data version number
- Timestamp of last ingestion
- Stats: matches processed, balls, players, teams, venues
- Errors encountered during ingestion

**When to update:**
- Automatically updated by `ingest.py` after each run
- NEVER manually edit - always regenerate by running ingest

**Example manifest.json:**
```json
{
  "data_version": "1.1.0",
  "ingested_at": "2026-01-19T12:46:12.414926",
  "stats": {
    "zip_files_processed": 17,
    "matches_processed": 9289,
    "balls_processed": 2137915,
    "players_found": 7864
  }
}
```

---

### data/archive/ - Deprecated Files

**What goes here:**
- Previous versions of reference files (bowler_classifications_v1.csv)
- Deprecated datasets no longer in active use
- Files preserved for historical reference only

**What does NOT go here:**
- Files still referenced by any script
- Current production data
- Backup copies (use git for that)

**Archive policy:**
1. When replacing a file (e.g., v1 -> v2), move v1 to archive/
2. Add entry to archive/README.md with deprecation date and reason
3. Verify no scripts reference the old file before archiving
4. Keep archived files for minimum 6 months

**Current contents:**
- `bowler_classifications_v1.csv` - Deprecated 2026-01-20, replaced by v2

---

## Quick Reference: Where Does This File Go?

| File Type | Location | Example |
|-----------|----------|---------|
| Downloaded ZIP from Cricsheet | `raw/` | `IPL_Male.zip` |
| Generated schema docs | `processed/` | `schema.md` |
| Ingestion run metadata | `manifests/` | `manifest.json` |
| Old version of reference file | `archive/` | `bowler_classifications_v1.csv` |
| Team roster CSV | `data/` (root) | `ipl_2026_squads.csv` |
| Final stat pack output | `outputs/` | NOT in data folder |
| Analysis notebooks | `notebooks/` | NOT in data folder |

---

## Database (DuckDB)

**File:** `cricket_playbook.duckdb` (159MB)

### Core Tables

| Table | Rows | Description |
|-------|------|-------------|
| `fact_ball` | 2,137,915 | Ball-by-ball delivery records |
| `dim_player` | ~15,000 | Player dimension (all T20 players) |
| `dim_match` | 9,357 | Match dimension |
| `dim_team` | ~200 | Team dimension |

### Key Columns in `fact_ball`

| Column | Type | Description |
|--------|------|-------------|
| `match_id` | INT | Foreign key to dim_match |
| `innings` | INT | 1 or 2 |
| `over_num` | INT | Over number (1-20) |
| `ball_num` | INT | Ball in over (1-6+) |
| `ball_seq` | INT | Sequential ball number (1-120) |
| `batter_id` | INT | Foreign key to dim_player |
| `bowler_id` | INT | Foreign key to dim_player |
| `batter_runs` | INT | Runs scored by batter |
| `extra_runs` | INT | Extra runs (wides, no-balls, etc.) |
| `total_runs` | INT | Total runs for delivery |
| `is_wicket` | BOOL | Dismissal on this ball |
| `dismissal_kind` | STR | Type of dismissal |

### Analytics Views

The database contains 35 analytics views created by `scripts/core/analytics_ipl.py`. Key views:

| View | Description |
|------|-------------|
| `analytics_ipl_batting_career` | Career batting stats |
| `analytics_ipl_bowling_career` | Career bowling stats |
| `analytics_ipl_batter_phase` | Phase-wise batting |
| `analytics_ipl_bowler_phase` | Phase-wise bowling |
| `analytics_ipl_batter_vs_bowler` | Head-to-head matchups |

---

## Squad Data

### `ipl_2026_squads.csv`

| Column | Description |
|--------|-------------|
| `team_name` | Full team name |
| `player_name` | Player name |
| `player_id` | Cricsheet player ID |
| `role` | Batter, Bowler, All-rounder, Wicketkeeper |
| `bowling_arm` | Right-arm, Left-arm |
| `bowling_type` | Fast, Off-spin, Leg-spin, etc. |
| `batting_hand` | Right-hand, Left-hand |
| `batter_classification` | Elite Top-Order, Power Finisher, etc. |
| `bowler_classification` | Workhorse Seamer, Middle-Overs Spinner, etc. |
| `batter_tags` | Pipe-separated batter tags |
| `bowler_tags` | Pipe-separated bowler tags |
| `is_captain` | TRUE if team captain (NEW in v4.0) |

**Records:** 231 players across 10 teams

**Captains (IPL 2026):**
| Team | Captain |
|------|---------|
| CSK | Ruturaj Gaikwad |
| MI | Hardik Pandya |
| RCB | Rajat Patidar |
| KKR | Ajinkya Rahane |
| RR | Riyan Parag* |
| PBKS | Shreyas Iyer |
| DC | Axar Patel |
| SRH | Pat Cummins |
| GT | Shubman Gill |
| LSG | Rishabh Pant |

*\* Subject to confirmation*

### `ipl_2026_player_contracts.csv`

| Column | Description |
|--------|-------------|
| `player_name` | Player name |
| `team` | Team abbreviation |
| `price_inr` | Contract price in INR |
| `price_usd` | Contract price in USD |
| `category` | RETAINED, AUCTION, RTM |

---

## Bowler Classifications

### `bowler_classifications_v2.csv` (Current)

| Column | Description |
|--------|-------------|
| `player_id` | Cricsheet player ID |
| `player_name` | Player name |
| `bowling_style` | Standardized bowling style |

**Coverage:** 280 bowlers (98.8% of IPL balls)

**Bowling Styles:**
- Right-arm pace
- Left-arm pace
- Right-arm off-spin
- Right-arm leg-spin
- Left-arm orthodox
- Left-arm wrist spin

---

## Raw Data (`raw/`)

Source Cricsheet ZIP files (18 T20 datasets):

| Dataset | Matches | Coverage |
|---------|---------|----------|
| IPL | 1,089 | 2008-2025 |
| T20 International | 1,500+ | All time |
| BBL | 500+ | All time |
| CPL | 400+ | All time |
| PSL | 300+ | All time |
| Other T20 leagues | 5,000+ | Various |

**Total:** 9,357 T20 matches

---

## Data Pipeline

```bash
# 1. Ingest raw data into DuckDB
python scripts/core/ingest.py

# 2. Create analytics views
python scripts/core/analytics_ipl.py

# 3. Validate schema
python scripts/core/validate_schema.py
```

---

## Data Quality

### Known Issues
- **15 player ID mismatches** documented in `analysis/player_id_audit_report.md`
- Root cause: Surname collisions (Singh, Sharma, Kumar, Khan)
- Fix planned for Sprint 3.1

### Validation
- Schema validation: 33 checks
- Smoke tests: 76 pytest tests
- See `data/processed/QA_CERTIFICATE_1.0.0.md`

---

## Important Notes

1. **2023+ Filter:** Analytics use only 2023-2025 IPL data (219 matches)
2. **Do Not Modify:** Never edit `cricket_playbook.duckdb` directly
3. **Regenerate Views:** Run `analytics_ipl.py` after schema changes

---

## Post Task Note: TKT-033 Archive Completion

**Date:** 2026-02-05
**Owner:** Tom Brady

### What Changed
- Data documentation archived at v4.0.0 with comprehensive README (348 lines)
- PROVENANCE.md documents data sources and lineage
- Directory structure guide for raw/, processed/, manifests/, archive/

### Assumption Tested
- **Hypothesis:** Comprehensive data documentation prevents "where is X" questions
- **Validated:** Yes - README covers data flow, database schema, squad data, and pipeline commands

### Risk Introduced
- Documentation may drift from actual data if not updated during schema changes
- Version number (v4.0.0) needs manual updates when data changes significantly

### USP of This Change
- **Buyer Value:** Analysts can self-serve understanding of data structure
- **Preparation Burden Removed:** No need to ask "which table has X" or "where does Y come from"

---

*Cricket Playbook v4.1.0*
